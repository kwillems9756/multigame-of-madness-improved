(()=>{var Pv={4662:(s,e,i)=>{i(3430);var o=i(8791);s.exports=o("Array","sort")},8343:(s,e,i)=>{i(4769);var o=i(9276);s.exports=o.Object.keys},7111:(s,e,i)=>{var o=i(6733),a=i(9821),l=TypeError;s.exports=function(d){if(o(d))return d;throw l(a(d)+" is not a function")}},1176:(s,e,i)=>{var o=i(5052),a=String,l=TypeError;s.exports=function(d){if(o(d))return d;throw l(a(d)+" is not an object")}},9540:(s,e,i)=>{var o=i(905),a=i(3231),l=i(9646),d=function(g){return function(m,y,x){var A=o(m),T=l(A),P=a(x,T),B;if(g&&y!=y){for(;T>P;)if(B=A[P++],B!=B)return!0}else for(;T>P;P++)if((g||P in A)&&A[P]===y)return g||P||0;return!g&&-1}};s.exports={includes:d(!0),indexOf:d(!1)}},6038:(s,e,i)=>{var o=i(4229);s.exports=function(a,l){var d=[][a];return!!d&&o(function(){d.call(null,l||function(){return 1},1)})}},9794:(s,e,i)=>{var o=i(3231),a=i(9646),l=i(2324),d=Array,g=Math.max;s.exports=function(m,y,x){for(var A=a(m),T=o(y,A),P=o(x===void 0?A:x,A),B=d(g(P-T,0)),H=0;T<P;T++,H++)l(B,H,m[T]);return B.length=H,B}},3867:(s,e,i)=>{var o=i(9794),a=Math.floor,l=function(m,y){var x=m.length,A=a(x/2);return x<8?d(m,y):g(m,l(o(m,0,A),y),l(o(m,A),y),y)},d=function(m,y){for(var x=m.length,A=1,T,P;A<x;){for(P=A,T=m[A];P&&y(m[P-1],T)>0;)m[P]=m[--P];P!==A++&&(m[P]=T)}return m},g=function(m,y,x,A){for(var T=y.length,P=x.length,B=0,H=0;B<T||H<P;)m[B+H]=B<T&&H<P?A(y[B],x[H])<=0?y[B++]:x[H++]:B<T?y[B++]:x[H++];return m};s.exports=l},7079:(s,e,i)=>{var o=i(5968),a=o({}.toString),l=o("".slice);s.exports=function(d){return l(a(d),8,-1)}},1589:(s,e,i)=>{var o=i(1601),a=i(6733),l=i(7079),d=i(95),g=d("toStringTag"),m=Object,y=l(function(){return arguments}())=="Arguments",x=function(A,T){try{return A[T]}catch{}};s.exports=o?l:function(A){var T,P,B;return A===void 0?"Undefined":A===null?"Null":typeof(P=x(T=m(A),g))=="string"?P:y?l(T):(B=l(T))=="Object"&&a(T.callee)?"Arguments":B}},7081:(s,e,i)=>{var o=i(8270),a=i(4826),l=i(7933),d=i(1787);s.exports=function(g,m,y){for(var x=a(m),A=d.f,T=l.f,P=0;P<x.length;P++){var B=x[P];!o(g,B)&&!(y&&o(y,B))&&A(g,B,T(m,B))}}},5762:(s,e,i)=>{var o=i(7400),a=i(1787),l=i(5358);s.exports=o?function(d,g,m){return a.f(d,g,l(1,m))}:function(d,g,m){return d[g]=m,d}},5358:s=>{s.exports=function(e,i){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:i}}},2324:(s,e,i)=>{var o=i(9310),a=i(1787),l=i(5358);s.exports=function(d,g,m){var y=o(g);y in d?a.f(d,y,l(0,m)):d[y]=m}},4768:(s,e,i)=>{var o=i(6733),a=i(1787),l=i(6039),d=i(8400);s.exports=function(g,m,y,x){x||(x={});var A=x.enumerable,T=x.name!==void 0?x.name:m;if(o(y)&&l(y,T,x),x.global)A?g[m]=y:d(m,y);else{try{x.unsafe?g[m]&&(A=!0):delete g[m]}catch{}A?g[m]=y:a.f(g,m,{value:y,enumerable:!1,configurable:!x.nonConfigurable,writable:!x.nonWritable})}return g}},8400:(s,e,i)=>{var o=i(9859),a=Object.defineProperty;s.exports=function(l,d){try{a(o,l,{value:d,configurable:!0,writable:!0})}catch{o[l]=d}return d}},9563:(s,e,i)=>{var o=i(9821),a=TypeError;s.exports=function(l,d){if(!delete l[d])throw a("Cannot delete property "+o(d)+" of "+o(l))}},7400:(s,e,i)=>{var o=i(4229);s.exports=!o(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},3777:s=>{var e=typeof document=="object"&&document.all,i=typeof e>"u"&&e!==void 0;s.exports={all:e,IS_HTMLDDA:i}},2635:(s,e,i)=>{var o=i(9859),a=i(5052),l=o.document,d=a(l)&&a(l.createElement);s.exports=function(g){return d?l.createElement(g):{}}},2671:(s,e,i)=>{var o=i(598),a=o.match(/firefox\/(\d+)/i);s.exports=!!a&&+a[1]},8506:(s,e,i)=>{var o=i(598);s.exports=/MSIE|Trident/.test(o)},598:s=>{s.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},5884:(s,e,i)=>{var o=i(9859),a=i(598),l=o.process,d=o.Deno,g=l&&l.versions||d&&d.version,m=g&&g.v8,y,x;m&&(y=m.split("."),x=y[0]>0&&y[0]<4?1:+(y[0]+y[1])),!x&&a&&(y=a.match(/Edge\/(\d+)/),(!y||y[1]>=74)&&(y=a.match(/Chrome\/(\d+)/),y&&(x=+y[1]))),s.exports=x},9811:(s,e,i)=>{var o=i(598),a=o.match(/AppleWebKit\/(\d+)\./);s.exports=!!a&&+a[1]},8791:(s,e,i)=>{var o=i(9859),a=i(5968);s.exports=function(l,d){return a(o[l].prototype[d])}},3837:s=>{s.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3103:(s,e,i)=>{var o=i(9859),a=i(7933).f,l=i(5762),d=i(4768),g=i(8400),m=i(7081),y=i(6541);s.exports=function(x,A){var T=x.target,P=x.global,B=x.stat,H,W,j,at,ct,xt;if(P?W=o:B?W=o[T]||g(T,{}):W=(o[T]||{}).prototype,W)for(j in A){if(ct=A[j],x.dontCallGetSet?(xt=a(W,j),at=xt&&xt.value):at=W[j],H=y(P?j:T+(B?".":"#")+j,x.forced),!H&&at!==void 0){if(typeof ct==typeof at)continue;m(ct,at)}(x.sham||at&&at.sham)&&l(ct,"sham",!0),d(W,j,ct,x)}}},4229:s=>{s.exports=function(e){try{return!!e()}catch{return!0}}},7188:(s,e,i)=>{var o=i(4229);s.exports=!o(function(){var a=function(){}.bind();return typeof a!="function"||a.hasOwnProperty("prototype")})},266:(s,e,i)=>{var o=i(7188),a=Function.prototype.call;s.exports=o?a.bind(a):function(){return a.apply(a,arguments)}},1805:(s,e,i)=>{var o=i(7400),a=i(8270),l=Function.prototype,d=o&&Object.getOwnPropertyDescriptor,g=a(l,"name"),m=g&&function(){}.name==="something",y=g&&(!o||o&&d(l,"name").configurable);s.exports={EXISTS:g,PROPER:m,CONFIGURABLE:y}},5968:(s,e,i)=>{var o=i(7188),a=Function.prototype,l=a.call,d=o&&a.bind.bind(l,l);s.exports=o?d:function(g){return function(){return l.apply(g,arguments)}}},1333:(s,e,i)=>{var o=i(9859),a=i(6733),l=function(d){return a(d)?d:void 0};s.exports=function(d,g){return arguments.length<2?l(o[d]):o[d]&&o[d][g]}},5300:(s,e,i)=>{var o=i(7111),a=i(9650);s.exports=function(l,d){var g=l[d];return a(g)?void 0:o(g)}},9859:function(s,e,i){var o=function(a){return a&&a.Math==Math&&a};s.exports=o(typeof globalThis=="object"&&globalThis)||o(typeof window=="object"&&window)||o(typeof self=="object"&&self)||o(typeof i.g=="object"&&i.g)||function(){return this}()||this||Function("return this")()},8270:(s,e,i)=>{var o=i(5968),a=i(2991),l=o({}.hasOwnProperty);s.exports=Object.hasOwn||function(g,m){return l(a(g),m)}},5977:s=>{s.exports={}},4394:(s,e,i)=>{var o=i(7400),a=i(4229),l=i(2635);s.exports=!o&&!a(function(){return Object.defineProperty(l("div"),"a",{get:function(){return 7}}).a!=7})},9337:(s,e,i)=>{var o=i(5968),a=i(4229),l=i(7079),d=Object,g=o("".split);s.exports=a(function(){return!d("z").propertyIsEnumerable(0)})?function(m){return l(m)=="String"?g(m,""):d(m)}:d},8511:(s,e,i)=>{var o=i(5968),a=i(6733),l=i(5353),d=o(Function.toString);a(l.inspectSource)||(l.inspectSource=function(g){return d(g)}),s.exports=l.inspectSource},6407:(s,e,i)=>{var o=i(1180),a=i(9859),l=i(5052),d=i(5762),g=i(8270),m=i(5353),y=i(4399),x=i(5977),A="Object already initialized",T=a.TypeError,P=a.WeakMap,B,H,W,j=function(tt){return W(tt)?H(tt):B(tt,{})},at=function(tt){return function(nt){var bt;if(!l(nt)||(bt=H(nt)).type!==tt)throw T("Incompatible receiver, "+tt+" required");return bt}};if(o||m.state){var ct=m.state||(m.state=new P);ct.get=ct.get,ct.has=ct.has,ct.set=ct.set,B=function(tt,nt){if(ct.has(tt))throw T(A);return nt.facade=tt,ct.set(tt,nt),nt},H=function(tt){return ct.get(tt)||{}},W=function(tt){return ct.has(tt)}}else{var xt=y("state");x[xt]=!0,B=function(tt,nt){if(g(tt,xt))throw T(A);return nt.facade=tt,d(tt,xt,nt),nt},H=function(tt){return g(tt,xt)?tt[xt]:{}},W=function(tt){return g(tt,xt)}}s.exports={set:B,get:H,has:W,enforce:j,getterFor:at}},6733:(s,e,i)=>{var o=i(3777),a=o.all;s.exports=o.IS_HTMLDDA?function(l){return typeof l=="function"||l===a}:function(l){return typeof l=="function"}},6541:(s,e,i)=>{var o=i(4229),a=i(6733),l=/#|\.prototype\./,d=function(A,T){var P=m[g(A)];return P==x?!0:P==y?!1:a(T)?o(T):!!T},g=d.normalize=function(A){return String(A).replace(l,".").toLowerCase()},m=d.data={},y=d.NATIVE="N",x=d.POLYFILL="P";s.exports=d},9650:s=>{s.exports=function(e){return e==null}},5052:(s,e,i)=>{var o=i(6733),a=i(3777),l=a.all;s.exports=a.IS_HTMLDDA?function(d){return typeof d=="object"?d!==null:o(d)||d===l}:function(d){return typeof d=="object"?d!==null:o(d)}},4231:s=>{s.exports=!1},9395:(s,e,i)=>{var o=i(1333),a=i(6733),l=i(1321),d=i(6969),g=Object;s.exports=d?function(m){return typeof m=="symbol"}:function(m){var y=o("Symbol");return a(y)&&l(y.prototype,g(m))}},9646:(s,e,i)=>{var o=i(4237);s.exports=function(a){return o(a.length)}},6039:(s,e,i)=>{var o=i(5968),a=i(4229),l=i(6733),d=i(8270),g=i(7400),m=i(1805).CONFIGURABLE,y=i(8511),x=i(6407),A=x.enforce,T=x.get,P=String,B=Object.defineProperty,H=o("".slice),W=o("".replace),j=o([].join),at=g&&!a(function(){return B(function(){},"length",{value:8}).length!==8}),ct=String(String).split("String"),xt=s.exports=function(tt,nt,bt){H(P(nt),0,7)==="Symbol("&&(nt="["+W(P(nt),/^Symbol\(([^)]*)\)/,"$1")+"]"),bt&&bt.getter&&(nt="get "+nt),bt&&bt.setter&&(nt="set "+nt),(!d(tt,"name")||m&&tt.name!==nt)&&(g?B(tt,"name",{value:nt,configurable:!0}):tt.name=nt),at&&bt&&d(bt,"arity")&&tt.length!==bt.arity&&B(tt,"length",{value:bt.arity});try{bt&&d(bt,"constructor")&&bt.constructor?g&&B(tt,"prototype",{writable:!1}):tt.prototype&&(tt.prototype=void 0)}catch{}var Oe=A(tt);return d(Oe,"source")||(Oe.source=j(ct,typeof nt=="string"?nt:"")),tt};Function.prototype.toString=xt(function(){return l(this)&&T(this).source||y(this)},"toString")},917:s=>{var e=Math.ceil,i=Math.floor;s.exports=Math.trunc||function(a){var l=+a;return(l>0?i:e)(l)}},1787:(s,e,i)=>{var o=i(7400),a=i(4394),l=i(7137),d=i(1176),g=i(9310),m=TypeError,y=Object.defineProperty,x=Object.getOwnPropertyDescriptor,A="enumerable",T="configurable",P="writable";e.f=o?l?function(H,W,j){if(d(H),W=g(W),d(j),typeof H=="function"&&W==="prototype"&&"value"in j&&P in j&&!j[P]){var at=x(H,W);at&&at[P]&&(H[W]=j.value,j={configurable:T in j?j[T]:at[T],enumerable:A in j?j[A]:at[A],writable:!1})}return y(H,W,j)}:y:function(H,W,j){if(d(H),W=g(W),d(j),a)try{return y(H,W,j)}catch{}if("get"in j||"set"in j)throw m("Accessors not supported");return"value"in j&&(H[W]=j.value),H}},7933:(s,e,i)=>{var o=i(7400),a=i(266),l=i(9195),d=i(5358),g=i(905),m=i(9310),y=i(8270),x=i(4394),A=Object.getOwnPropertyDescriptor;e.f=o?A:function(P,B){if(P=g(P),B=m(B),x)try{return A(P,B)}catch{}if(y(P,B))return d(!a(l.f,P,B),P[B])}},8151:(s,e,i)=>{var o=i(140),a=i(3837),l=a.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(g){return o(g,l)}},894:(s,e)=>{e.f=Object.getOwnPropertySymbols},1321:(s,e,i)=>{var o=i(5968);s.exports=o({}.isPrototypeOf)},140:(s,e,i)=>{var o=i(5968),a=i(8270),l=i(905),d=i(9540).indexOf,g=i(5977),m=o([].push);s.exports=function(y,x){var A=l(y),T=0,P=[],B;for(B in A)!a(g,B)&&a(A,B)&&m(P,B);for(;x.length>T;)a(A,B=x[T++])&&(~d(P,B)||m(P,B));return P}},5632:(s,e,i)=>{var o=i(140),a=i(3837);s.exports=Object.keys||function(d){return o(d,a)}},9195:(s,e)=>{var i={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,a=o&&!i.call({1:2},1);e.f=a?function(d){var g=o(this,d);return!!g&&g.enumerable}:i},2914:(s,e,i)=>{var o=i(266),a=i(6733),l=i(5052),d=TypeError;s.exports=function(g,m){var y,x;if(m==="string"&&a(y=g.toString)&&!l(x=o(y,g))||a(y=g.valueOf)&&!l(x=o(y,g))||m!=="string"&&a(y=g.toString)&&!l(x=o(y,g)))return x;throw d("Can't convert object to primitive value")}},4826:(s,e,i)=>{var o=i(1333),a=i(5968),l=i(8151),d=i(894),g=i(1176),m=a([].concat);s.exports=o("Reflect","ownKeys")||function(x){var A=l.f(g(x)),T=d.f;return T?m(A,T(x)):A}},9276:(s,e,i)=>{var o=i(9859);s.exports=o},8885:(s,e,i)=>{var o=i(9650),a=TypeError;s.exports=function(l){if(o(l))throw a("Can't call method on "+l);return l}},4399:(s,e,i)=>{var o=i(3036),a=i(1441),l=o("keys");s.exports=function(d){return l[d]||(l[d]=a(d))}},5353:(s,e,i)=>{var o=i(9859),a=i(8400),l="__core-js_shared__",d=o[l]||a(l,{});s.exports=d},3036:(s,e,i)=>{var o=i(4231),a=i(5353);(s.exports=function(l,d){return a[l]||(a[l]=d!==void 0?d:{})})("versions",[]).push({version:"3.32.0",mode:o?"pure":"global",copyright:"\xA9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.0/LICENSE",source:"https://github.com/zloirock/core-js"})},4860:(s,e,i)=>{var o=i(5884),a=i(4229),l=i(9859),d=l.String;s.exports=!!Object.getOwnPropertySymbols&&!a(function(){var g=Symbol();return!d(g)||!(Object(g)instanceof Symbol)||!Symbol.sham&&o&&o<41})},3231:(s,e,i)=>{var o=i(3329),a=Math.max,l=Math.min;s.exports=function(d,g){var m=o(d);return m<0?a(m+g,0):l(m,g)}},905:(s,e,i)=>{var o=i(9337),a=i(8885);s.exports=function(l){return o(a(l))}},3329:(s,e,i)=>{var o=i(917);s.exports=function(a){var l=+a;return l!==l||l===0?0:o(l)}},4237:(s,e,i)=>{var o=i(3329),a=Math.min;s.exports=function(l){return l>0?a(o(l),9007199254740991):0}},2991:(s,e,i)=>{var o=i(8885),a=Object;s.exports=function(l){return a(o(l))}},2066:(s,e,i)=>{var o=i(266),a=i(5052),l=i(9395),d=i(5300),g=i(2914),m=i(95),y=TypeError,x=m("toPrimitive");s.exports=function(A,T){if(!a(A)||l(A))return A;var P=d(A,x),B;if(P){if(T===void 0&&(T="default"),B=o(P,A,T),!a(B)||l(B))return B;throw y("Can't convert object to primitive value")}return T===void 0&&(T="number"),g(A,T)}},9310:(s,e,i)=>{var o=i(2066),a=i(9395);s.exports=function(l){var d=o(l,"string");return a(d)?d:d+""}},1601:(s,e,i)=>{var o=i(95),a=o("toStringTag"),l={};l[a]="z",s.exports=String(l)==="[object z]"},3326:(s,e,i)=>{var o=i(1589),a=String;s.exports=function(l){if(o(l)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return a(l)}},9821:s=>{var e=String;s.exports=function(i){try{return e(i)}catch{return"Object"}}},1441:(s,e,i)=>{var o=i(5968),a=0,l=Math.random(),d=o(1 .toString);s.exports=function(g){return"Symbol("+(g===void 0?"":g)+")_"+d(++a+l,36)}},6969:(s,e,i)=>{var o=i(4860);s.exports=o&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},7137:(s,e,i)=>{var o=i(7400),a=i(4229);s.exports=o&&a(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},1180:(s,e,i)=>{var o=i(9859),a=i(6733),l=o.WeakMap;s.exports=a(l)&&/native code/.test(String(l))},95:(s,e,i)=>{var o=i(9859),a=i(3036),l=i(8270),d=i(1441),g=i(4860),m=i(6969),y=o.Symbol,x=a("wks"),A=m?y.for||y:y&&y.withoutSetter||d;s.exports=function(T){return l(x,T)||(x[T]=g&&l(y,T)?y[T]:A("Symbol."+T)),x[T]}},3430:(s,e,i)=>{var o=i(3103),a=i(5968),l=i(7111),d=i(2991),g=i(9646),m=i(9563),y=i(3326),x=i(4229),A=i(3867),T=i(6038),P=i(2671),B=i(8506),H=i(5884),W=i(9811),j=[],at=a(j.sort),ct=a(j.push),xt=x(function(){j.sort(void 0)}),tt=x(function(){j.sort(null)}),nt=T("sort"),bt=!x(function(){if(H)return H<70;if(!(P&&P>3)){if(B)return!0;if(W)return W<603;var xe="",te,Lt,Ue,be;for(te=65;te<76;te++){switch(Lt=String.fromCharCode(te),te){case 66:case 69:case 70:case 72:Ue=3;break;case 68:case 71:Ue=4;break;default:Ue=2}for(be=0;be<47;be++)j.push({k:Lt+be,v:Ue})}for(j.sort(function(Ks,Ht){return Ht.v-Ks.v}),be=0;be<j.length;be++)Lt=j[be].k.charAt(0),xe.charAt(xe.length-1)!==Lt&&(xe+=Lt);return xe!=="DGBEFHACIJK"}}),Oe=xt||!tt||!nt||!bt,$s=function(xe){return function(te,Lt){return Lt===void 0?-1:te===void 0?1:xe!==void 0?+xe(te,Lt)||0:y(te)>y(Lt)?1:-1}};o({target:"Array",proto:!0,forced:Oe},{sort:function(te){te!==void 0&&l(te);var Lt=d(this);if(bt)return te===void 0?at(Lt):at(Lt,te);var Ue=[],be=g(Lt),Ks,Ht;for(Ht=0;Ht<be;Ht++)Ht in Lt&&ct(Ue,Lt[Ht]);for(A(Ue,$s(te)),Ks=g(Ue),Ht=0;Ht<Ks;)Lt[Ht]=Ue[Ht++];for(;Ht<be;)m(Lt,Ht++);return Lt}})},4769:(s,e,i)=>{var o=i(3103),a=i(2991),l=i(5632),d=i(4229),g=d(function(){l(1)});o({target:"Object",stat:!0,forced:g},{keys:function(y){return l(a(y))}})},1388:(s,e,i)=>{i.d(e,{Z:()=>m});var o=i(272),a=i.n(o),l=i(2609),d=i.n(l),g=d()(a());g.push([s.id,`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition: background 250ms ease-in-out, transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,"",{version:3,sources:["webpack://./Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition: background 250ms ease-in-out, transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`],sourceRoot:""}]);let m=g},7379:(s,e,i)=>{i.d(e,{Z:()=>m});var o=i(272),a=i.n(o),l=i(2609),d=i.n(l),g=d()(a());g.push([s.id,`
#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;


  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}


.ex-toast-message button {
  align-self: flex-start;
}`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:";AACA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;;EAG9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;;AAGA;EACE,sBAAsB;AACxB",sourcesContent:[`\r
#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}`],sourceRoot:""}]);let m=g},2609:s=>{s.exports=function(e){var i=[];return i.toString=function(){return this.map(function(a){var l="",d=typeof a[5]<"u";return a[4]&&(l+="@supports (".concat(a[4],") {")),a[2]&&(l+="@media ".concat(a[2]," {")),d&&(l+="@layer".concat(a[5].length>0?" ".concat(a[5]):""," {")),l+=e(a),d&&(l+="}"),a[2]&&(l+="}"),a[4]&&(l+="}"),l}).join("")},i.i=function(a,l,d,g,m){typeof a=="string"&&(a=[[null,a,void 0]]);var y={};if(d)for(var x=0;x<this.length;x++){var A=this[x][0];A!=null&&(y[A]=!0)}for(var T=0;T<a.length;T++){var P=[].concat(a[T]);d&&y[P[0]]||(typeof m<"u"&&(typeof P[5]>"u"||(P[1]="@layer".concat(P[5].length>0?" ".concat(P[5]):""," {").concat(P[1],"}")),P[5]=m),l&&(P[2]&&(P[1]="@media ".concat(P[2]," {").concat(P[1],"}")),P[2]=l),g&&(P[4]?(P[1]="@supports (".concat(P[4],") {").concat(P[1],"}"),P[4]=g):P[4]="".concat(g)),i.push(P))}},i}},272:s=>{s.exports=function(e){var i=e[1],o=e[3];if(!o)return i;if(typeof btoa=="function"){var a=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),d="/*# ".concat(l," */");return[i].concat([d]).join(`
`)}return[i].join(`
`)}}},Wf={};function Ft(s){var e=Wf[s];if(e!==void 0)return e.exports;var i=Wf[s]={id:s,exports:{}};return Pv[s].call(i.exports,i,i.exports,Ft),i.exports}Ft.n=s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return Ft.d(e,{a:e}),e};Ft.d=(s,e)=>{for(var i in e)Ft.o(e,i)&&!Ft.o(s,i)&&Object.defineProperty(s,i,{enumerable:!0,get:e[i]})};Ft.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}();Ft.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);Ft.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var b={};(()=>{Ft.d(b,{fWn:()=>qn,Ia8:()=>Nd,rqv:()=>sl,hLI:()=>Yi,yyv:()=>Cf,tX5:()=>vh,vtX:()=>rs,r7K:()=>Md,lCh:()=>uf,cE4:()=>qt,fwF:()=>_s,sce:()=>Kn,AQ6:()=>rv,_c7:()=>as,KUs:()=>yf,Ajp:()=>$i,dkO:()=>Gi,RDh:()=>Io,_H9:()=>bo,mxs:()=>Qd,OmD:()=>pt,kBf:()=>ot,C4F:()=>po,NQt:()=>Zh,JjN:()=>Ff,EK_:()=>zi,V1s:()=>lf,xHm:()=>ev,Xz7:()=>co,Cdc:()=>yo,FKn:()=>le,SUY:()=>tl,ab2:()=>go,GfZ:()=>ps,YMS:()=>Ys,oyv:()=>$t,aUb:()=>pi,SdD:()=>Ln,JUv:()=>is,jEj:()=>vi,TFq:()=>ns,HDU:()=>oo,R_y:()=>ro,ydN:()=>fi,t50:()=>Bn,s$$:()=>Yh,v2G:()=>ut,Ilk:()=>O,s9i:()=>kf,dxL:()=>gi,LLX:()=>Df,wA2:()=>He,R_p:()=>ge,IQ$:()=>bf,I5F:()=>Th,X8$:()=>wf,FR6:()=>no,U8o:()=>io,kbG:()=>ke,iS_:()=>yh,cGG:()=>Mf,RPN:()=>Co,skb:()=>Af,SLU:()=>kh,RdJ:()=>Ae,cNu:()=>Yd,gU7:()=>Pd,LSk:()=>Zd,Nmp:()=>To,d1Y:()=>ee,xrL:()=>Wh,sRW:()=>qh,cmV:()=>Hf,qWz:()=>Kd,N0Q:()=>$d,q8b:()=>Bt,ynB:()=>Me,jT9:()=>of,wAz:()=>tn,D4V:()=>nn,NLr:()=>dv,N6H:()=>bh,W1A:()=>xh,JHW:()=>ne,ZZ$:()=>Jm,v2K:()=>ff,pBf:()=>fv,vpe:()=>x,GMl:()=>A,zW2:()=>s,B0K:()=>Oh,Nv7:()=>lo,C_p:()=>Qs,MUA:()=>Eh,xqU:()=>wh,pTp:()=>Xd,vUK:()=>m,j9l:()=>Kh,Zxw:()=>Ji,v51:()=>Pt,Hdx:()=>Eo,Z$d:()=>wo,iqV:()=>Lf,o$7:()=>Yn,olM:()=>ji,Zm$:()=>T,$QH:()=>W,i78:()=>j,nJg:()=>Vn,h6u:()=>Ue,hts:()=>Lt,j88:()=>xe,VME:()=>te,fy2:()=>Nn,nt:()=>Av,Ukr:()=>Zn,zsu:()=>De,oA6:()=>ue,TVh:()=>Qn,TwZ:()=>Wn,GTT:()=>mo,xxj:()=>Tf,XdK:()=>Ks,Jmb:()=>_e,cXo:()=>Dh,Dm5:()=>Ui,IIB:()=>o,ebW:()=>Of,zI0:()=>_o,LYD:()=>Do,cEG:()=>If,SEl:()=>_v,t9V:()=>Uf,ez5:()=>Wi,N1d:()=>Ah,R8U:()=>Hi,SKZ:()=>P,__J:()=>pv,RI$:()=>hf,x12:()=>nl,ccz:()=>Te,aNw:()=>Id,XrL:()=>Qm,xwn:()=>rf,dNK:()=>nf,ini:()=>Ee,YdH:()=>et,F5T:()=>Ed,y3G:()=>Re,l57:()=>Rh,xn0:()=>Uh,t2V:()=>Qh,uxB:()=>Vt,cpd:()=>vf,fiy:()=>Ud,$XZ:()=>zd,UG6:()=>Os,uqK:()=>Xs,STE:()=>Ad,y$z:()=>fs,mAD:()=>Sf,sOq:()=>We,hUw:()=>Ao,_0G:()=>gv,Sqs:()=>Gf,hpZ:()=>Po,Vol:()=>Ef,vYX:()=>en,wIZ:()=>Y,cBi:()=>ko,c30:()=>Pf,MPV:()=>gs,RFv:()=>Xi,Ux6:()=>sn,rxy:()=>Jn,I$c:()=>hi,kfC:()=>Ro,VjY:()=>ms,mgq:()=>rl,YVA:()=>ie,Kgp:()=>bd,HH$:()=>ai,M_d:()=>tt,rgh:()=>ct,Ra6:()=>$s,KhR:()=>H,BS5:()=>bt,xhz:()=>Ht,xOq:()=>xt,a9j:()=>at,bHk:()=>Oe,CgK:()=>B,cuY:()=>nt,kvE:()=>Hn,SBu:()=>zn,AE_:()=>pf,ctO:()=>_f,OLH:()=>af,kky:()=>On,nSF:()=>Ki,zHn:()=>Vs,zwx:()=>xf,AeJ:()=>vo,hLz:()=>Bd,D9g:()=>df,wA:()=>Vd,jhr:()=>Od,GVs:()=>Bh,_zO:()=>ao,LXZ:()=>_m,w6$:()=>Hd,mhV:()=>Gd,MOD:()=>qe,kwd:()=>qd,Lmr:()=>Wd,xsS:()=>Xn,K5l:()=>av,lLr:()=>Lh,Z$r:()=>pd,IXb:()=>Xh,SGH:()=>Rf,SMj:()=>Zs,L34:()=>Sv,exe:()=>Ge,bnF:()=>ce,MFA:()=>Wt,$uU:()=>Cd,Sap:()=>Km,jyi:()=>ci,E03:()=>ho,V6q:()=>ui,rg2:()=>el,DVW:()=>uo,nVo:()=>sf,F6N:()=>zf,xP7:()=>os,Odq:()=>gf,Zif:()=>Fe,ZGJ:()=>Gh,MJk:()=>Nf,xvT:()=>jn,PHM:()=>xo,dpR:()=>he,n9L:()=>ef,KwO:()=>tf,SxM:()=>tv,B7y:()=>_i,x7r:()=>Vf,wx7:()=>Gn,Uvn:()=>K,OFT:()=>Hh,xzN:()=>cf,CcZ:()=>sv,M5Z:()=>es,ZrN:()=>a,OWs:()=>I,dF9:()=>zh,oZy:()=>Ls,rD2:()=>Ns,VHo:()=>be,ohE:()=>di,R$E:()=>Td,xQN:()=>mi,AdJ:()=>Jh,q3I:()=>mf,Pab:()=>qi,uZ5:()=>Pe,McK:()=>y,F9c:()=>cm,k0b:()=>$h,hnT:()=>vv,RSJ:()=>bv,Mku:()=>wv,h90:()=>Tv,rms:()=>Ev,ErP:()=>mv,aVg:()=>xv,lPc:()=>yv,Z8E:()=>Fd,_N2:()=>$n,yFn:()=>nv,lNv:()=>Ld,cu9:()=>Jd,MZQ:()=>Rd,FUM:()=>Dd,BxR:()=>_t,vdf:()=>Fs,iaL:()=>dm,w6H:()=>Ih,Q4c:()=>Xm,Xxe:()=>ze,Uxb:()=>gd,Yr5:()=>um,Bhw:()=>M,yOA:()=>e});var s={};Ft.r(s),Ft.d(s,{ActivateEvent:()=>vh,CollisionEndEvent:()=>Ln,CollisionPostSolveEvent:()=>oo,CollisionPreSolveEvent:()=>ro,CollisionStartEvent:()=>Bn,ContactEndEvent:()=>no,ContactStartEvent:()=>io,DeactivateEvent:()=>yh,EnterTriggerEvent:()=>bh,EnterViewPortEvent:()=>xh,EventTypes:()=>A,ExitTriggerEvent:()=>Eh,ExitViewPortEvent:()=>wh,GameEvent:()=>T,GameStartEvent:()=>W,GameStopEvent:()=>j,GamepadAxisEvent:()=>Ue,GamepadButtonEvent:()=>Lt,GamepadConnectEvent:()=>xe,GamepadDisconnectEvent:()=>te,HiddenEvent:()=>Ks,InitializeEvent:()=>Ui,KillEvent:()=>P,PostCollisionEvent:()=>ai,PostDebugDrawEvent:()=>tt,PostDrawEvent:()=>ct,PostFrameEvent:()=>$s,PostKillEvent:()=>H,PostUpdateEvent:()=>bt,PreCollisionEvent:()=>Ht,PreDebugDrawEvent:()=>xt,PreDrawEvent:()=>at,PreFrameEvent:()=>Oe,PreKillEvent:()=>B,PreUpdateEvent:()=>nt,VisibleEvent:()=>be});var e={};Ft.r(e),Ft.d(e,{getAttributeComponentSize:()=>wd,getAttributePointerType:()=>xd,getGlTypeSizeBytes:()=>Fh});var i={};Ft.r(i),Ft.d(i,{circle:()=>Wm,line:()=>Nh,point:()=>Gm,roundRect:()=>Vh,vector:()=>Hm});var o={};Ft.r(o),Ft.d(o,{Axes:()=>Gi,Buttons:()=>zi,Gamepad:()=>Vn,Gamepads:()=>Nn,KeyEvent:()=>Wi,Keyboard:()=>Ah,Keys:()=>Hi,NativePointerButton:()=>Os,PointerButton:()=>gs,PointerComponent:()=>Xi,PointerEvent:()=>sn,PointerEventReceiver:()=>Jn,PointerScope:()=>hi,PointerSystem:()=>Ro,PointerType:()=>ms,WheelDeltaMode:()=>mi,WheelEvent:()=>Jh});var a={};Ft.r(a),Ft.d(a,{ConsoleAppender:()=>Th,DrawUtil:()=>i,EasingFunctions:()=>Bt,LogLevel:()=>Ee,Logger:()=>et,Observable:()=>fs,ScreenAppender:()=>pd,addItemToArray:()=>fm,contains:()=>Sh,delay:()=>Ph,fail:()=>md,getPosition:()=>Un,removeItemFromArray:()=>Bs});var l=Ft(4662),d=Ft(8343);function g(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(u){window.setInterval(u,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){let t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(n){return new Promise((r,h)=>{t.call(this,n,r,h)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1)}class m{static useCanvasGraphicsContext(){m.enable("use-canvas-context")}static freeze(){m._FROZEN=!0}static _reset(){m._FROZEN=!1,m._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");m._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");m._FLAGS[t]=!1}static isEnabled(t){return!!m._FLAGS[t]}static show(){return Object.keys(m._FLAGS)}}m._FROZEN=!1,m._FLAGS={};function y(u,t){return{type:u,value:t}}class x{constructor(){this._paused=!1,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0}on(t,n){var r;return this._listeners[t]=(r=this._listeners[t])!==null&&r!==void 0?r:[],this._listeners[t].push(n),{close:()=>this.off(t,n)}}once(t,n){var r;return this._listenersOnce[t]=(r=this._listenersOnce[t])!==null&&r!==void 0?r:[],this._listenersOnce[t].push(n),{close:()=>this.off(t,n)}}off(t,n){var r,h,c,f;if(n){let p=(r=this._listeners[t])===null||r===void 0?void 0:r.indexOf(n);p>-1&&((h=this._listeners[t])===null||h===void 0||h.splice(p,1));let _=(c=this._listenersOnce[t])===null||c===void 0?void 0:c.indexOf(n);_>-1&&((f=this._listenersOnce[t])===null||f===void 0||f.splice(_,1))}else delete this._listeners[t]}emit(t,n){var r;if(this._paused)return;(r=this._listeners[t])===null||r===void 0||r.forEach(c=>c(n));let h=this._listenersOnce[t];this._listenersOnce[t]=[],h&&h.forEach(c=>c(n)),this._pipes.forEach(c=>{c.emit(t,n)})}pipe(t){if(this===t)throw Error("Cannot pipe to self");return this._pipes.push(t),{close:()=>{let n=this._pipes.indexOf(t);n>-1&&this._pipes.splice(n,1)}}}unpipe(t){let n=this._pipes.indexOf(t);n>-1&&this._pipes.splice(n,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var A;(function(u){u.Kill="kill",u.PreKill="prekill",u.PostKill="postkill",u.PreDraw="predraw",u.PostDraw="postdraw",u.PreDebugDraw="predebugdraw",u.PostDebugDraw="postdebugdraw",u.PreUpdate="preupdate",u.PostUpdate="postupdate",u.PreFrame="preframe",u.PostFrame="postframe",u.PreCollision="precollision",u.CollisionStart="collisionstart",u.CollisionEnd="collisionend",u.PostCollision="postcollision",u.Initialize="initialize",u.Activate="activate",u.Deactivate="deactivate",u.ExitViewport="exitviewport",u.EnterViewport="enterviewport",u.ExitTrigger="exit",u.EnterTrigger="enter",u.Connect="connect",u.Disconnect="disconnect",u.Button="button",u.Axis="axis",u.Visible="visible",u.Hidden="hidden",u.Start="start",u.Stop="stop",u.PointerUp="pointerup",u.PointerDown="pointerdown",u.PointerMove="pointermove",u.PointerEnter="pointerenter",u.PointerLeave="pointerleave",u.PointerCancel="pointercancel",u.PointerWheel="pointerwheel",u.Up="up",u.Down="down",u.Move="move",u.Enter="enter",u.Leave="leave",u.Cancel="cancel",u.Wheel="wheel",u.Press="press",u.Release="release",u.Hold="hold",u.PointerDragStart="pointerdragstart",u.PointerDragEnd="pointerdragend",u.PointerDragEnter="pointerdragenter",u.PointerDragLeave="pointerdragleave",u.PointerDragMove="pointerdragmove"})(A||(A={}));class T{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class P extends T{constructor(t){super(),this.target=t}}class B extends T{constructor(t){super(),this.target=t}}class H extends T{constructor(t){super(),this.target=t}}class W extends T{constructor(t){super(),this.target=t}}class j extends T{constructor(t){super(),this.target=t}}class at extends T{constructor(t,n,r){super(),this.ctx=t,this.delta=n,this.target=r}}class ct extends T{constructor(t,n,r){super(),this.ctx=t,this.delta=n,this.target=r}}class xt extends T{constructor(t,n){super(),this.ctx=t,this.target=n}}class tt extends T{constructor(t,n){super(),this.ctx=t,this.target=n}}class nt extends T{constructor(t,n,r){super(),this.engine=t,this.delta=n,this.target=r}}class bt extends T{constructor(t,n,r){super(),this.engine=t,this.delta=n,this.target=r}}class Oe extends T{constructor(t,n){super(),this.engine=t,this.prevStats=n,this.target=t}}class $s extends T{constructor(t,n){super(),this.engine=t,this.stats=n,this.target=t}}class xe extends T{constructor(t,n){super(),this.index=t,this.gamepad=n,this.target=n}}class te extends T{constructor(t,n){super(),this.index=t,this.gamepad=n,this.target=n}}class Lt extends T{constructor(t,n,r){super(),this.button=t,this.value=n,this.target=r}}class Ue extends T{constructor(t,n,r){super(),this.axis=t,this.value=n,this.target=r}}class be extends T{constructor(t){super(),this.target=t}}class Ks extends T{constructor(t){super(),this.target=t}}class Ht extends T{constructor(t,n,r,h){super(),this.other=n,this.side=r,this.intersection=h,this.target=t}}class ai extends T{constructor(t,n,r,h){super(),this.other=n,this.side=r,this.intersection=h,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class io{constructor(t,n,r){this.target=t,this.other=n,this.contact=r}}class no{constructor(t,n){this.target=t,this.other=n}}class ro{constructor(t,n,r,h,c){this.target=t,this.other=n,this.side=r,this.intersection=h,this.contact=c}}class oo{constructor(t,n,r,h,c){this.target=t,this.other=n,this.side=r,this.intersection=h,this.contact=c}}class Bn extends T{constructor(t,n,r){super(),this.other=n,this.contact=r,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Ln extends T{constructor(t,n){super(),this.other=n,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Ui extends T{constructor(t,n){super(),this.engine=t,this.target=n}}class vh extends T{constructor(t,n){super(),this.context=t,this.target=n}}class yh extends T{constructor(t,n){super(),this.context=t,this.target=n}}class wh extends T{constructor(t){super(),this.target=t}}class xh extends T{constructor(t){super(),this.target=t}}class bh extends T{constructor(t,n){super(),this.target=t,this.actor=n}}class Eh extends T{constructor(t,n){super(),this.target=t,this.actor=n}}let Y0={GamepadConnect:"connect",GamepadDisconnect:"disconnect",GamepadButton:"button",GamepadAxis:"axis"};class Nn{constructor(){this.events=new x,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;let n=t.axes.filter(h=>typeof h!==void 0).length,r=t.buttons.filter(h=>typeof h!==void 0).length;return n>=this._minimumConfiguration.axis&&r>=this._minimumConfiguration.buttons&&t.connected}emit(t,n){this.events.emit(t,n)}on(t,n){return this._enableAndUpdate(),this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this._enableAndUpdate(),this.events.off(t,n)}update(){if(!this.enabled||!this.supported)return;this.init();let t=this._navigator.getGamepads();for(let n=0;n<t.length;n++){if(t[n])!this.at(n).connected&&this._isGamepadValid(t[n])&&this.events.emit("connect",new xe(n,this.at(n))),this.at(n).connected=!0;else{let _=this.at(n);_.connected&&this.events.emit("disconnect",new te(n,_)),_.connected=!1;continue}if(this.at(n).update(),t[n].timestamp&&t[n].timestamp===this._gamePadTimeStamps[n])continue;this._gamePadTimeStamps[n]=t[n].timestamp,this.at(n).navigatorGamepad=t[n];let r,h,c,f,p;for(r in zi)h=zi[r],typeof h=="number"&&t[n].buttons[h]&&(p=t[n].buttons[h].value,p!==this._oldPads[n].getButton(h)&&(t[n].buttons[h].pressed?(this.at(n).updateButton(h,p),this.at(n).events.emit("button",new Lt(h,p,this.at(n)))):this.at(n).updateButton(h,0)));for(c in Gi)f=Gi[c],typeof f=="number"&&(p=t[n].axes[f],p!==this._oldPads[n].getAxes(f)&&(this.at(n).updateAxes(f,p),this.at(n).events.emit("axis",new Ue(f,p,this.at(n)))));this._oldPads[n]=this._clonePad(t[n])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let n=this._pads.length-1,r=t;n<r;n++)this._pads.push(new Vn),this._oldPads.push(new Vn);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();let t=[];for(let n=0;n<this._pads.length;n++)this._isGamepadValid(this.at(n).navigatorGamepad)&&this.at(n).connected&&t.push(this.at(n));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){let n=[];for(let r=0,h=t.length;r<h;r++)n.push(this._clonePad(t[r]));return n}_clonePad(t){let n,r,h=new Vn;if(!t)return h;for(n=0,r=t.buttons.length;n<r;n++)t.buttons[n]&&h.updateButton(n,t.buttons[n].value);for(n=0,r=t.axes.length;n<r;n++)h.updateAxes(n,t.axes[n]);return h}}Nn.MinAxisMoveThreshold=.05;class Vn{constructor(){this.events=new x,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,n=1){return this._buttons[t]>=n}isButtonHeld(t,n=1){return this._buttons[t]>=n}wasButtonPressed(t,n=1){return this._buttonsDown[t]>=n}wasButtonReleased(t){return!!this._buttonsUp[t]}getButton(t){return this._buttons[t]}getAxes(t){let n=this._axes[t];return Math.abs(n)<Nn.MinAxisMoveThreshold?0:n}updateButton(t,n){n===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=n,this._buttons[t]=n}updateAxes(t,n){this._axes[t]=n}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}}var zi;(function(u){u[u.Face1=0]="Face1",u[u.Face2=1]="Face2",u[u.Face3=2]="Face3",u[u.Face4=3]="Face4",u[u.LeftBumper=4]="LeftBumper",u[u.RightBumper=5]="RightBumper",u[u.LeftTrigger=6]="LeftTrigger",u[u.RightTrigger=7]="RightTrigger",u[u.Select=8]="Select",u[u.Start=9]="Start",u[u.LeftStick=10]="LeftStick",u[u.RightStick=11]="RightStick",u[u.DpadUp=12]="DpadUp",u[u.DpadDown=13]="DpadDown",u[u.DpadLeft=14]="DpadLeft",u[u.DpadRight=15]="DpadRight"})(zi||(zi={}));var Gi;(function(u){u[u.LeftStickX=0]="LeftStickX",u[u.LeftStickY=1]="LeftStickY",u[u.RightStickX=2]="RightStickX",u[u.RightStickY=3]="RightStickY"})(Gi||(Gi={}));var Ee;(function(u){u[u.Debug=0]="Debug",u[u.Info=1]="Info",u[u.Warn=2]="Warn",u[u.Error=3]="Error",u[u.Fatal=4]="Fatal"})(Ee||(Ee={}));class et{constructor(){if(this._appenders=[],this.defaultLevel=Ee.Info,et._INSTANCE)throw new Error("Logger is a singleton");return et._INSTANCE=this,et._INSTANCE.addAppender(new Th),et._INSTANCE}static getInstance(){return et._INSTANCE==null&&(et._INSTANCE=new et),et._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,n){t==null&&(t=this.defaultLevel);let r=this._appenders.length;for(let h=0;h<r;h++)t>=this.defaultLevel&&this._appenders[h].log(t,n)}debug(...t){this._log(Ee.Debug,t)}info(...t){this._log(Ee.Info,t)}warn(...t){this._log(Ee.Warn,t)}error(...t){this._log(Ee.Error,t)}fatal(...t){this._log(Ee.Fatal,t)}}et._INSTANCE=null;class Th{log(t,n){if(!console&&!console.log&&console.warn&&console.error)return;let r=[];r.unshift.apply(r,n),r.unshift("["+Ee[t]+"] : "),t<Ee.Warn?console.log.apply?console.log.apply(console,r):console.log(r.join(" ")):t<Ee.Error?console.warn.apply?console.warn.apply(console,r):console.warn(r.join(" ")):console.error.apply?console.error.apply(console,r):console.error(r.join(" "))}}class pd{constructor(t,n){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=n||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}log(t,n){let r=n.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+Ee[t]+"] : "+r);let h=10,c=1;for(let f=0;f<this._messages.length;f++)this._ctx.fillStyle="rgba(255,255,255,"+c.toFixed(2)+")",this._ctx.fillText(this._messages[f],200,h),h+=10,c=c>0?c-.05:0}}function _d(){try{let u=()=>{};window.top.addEventListener("blur",u),window.top.removeEventListener("blur",u)}catch{return!0}return!1}var Hi;(function(u){u.Num0="Numpad0",u.Num1="Numpad1",u.Num2="Numpad2",u.Num3="Numpad3",u.Num4="Numpad4",u.Num5="Numpad5",u.Num6="Numpad6",u.Num7="Numpad7",u.Num8="Numpad8",u.Num9="Numpad9",u.NumAdd="NumpadAdd",u.NumSubtract="NumpadSubtract",u.NumMultiply="NumpadMultiply",u.NumDivide="NumpadDivide",u.NumDecimal="NumpadDecimal",u.Numpad0="Numpad0",u.Numpad1="Numpad1",u.Numpad2="Numpad2",u.Numpad3="Numpad3",u.Numpad4="Numpad4",u.Numpad5="Numpad5",u.Numpad6="Numpad6",u.Numpad7="Numpad7",u.Numpad8="Numpad8",u.Numpad9="Numpad9",u.NumpadAdd="NumpadAdd",u.NumpadSubtract="NumpadSubtract",u.NumpadMultiply="NumpadMultiply",u.NumpadDivide="NumpadDivide",u.NumpadDecimal="NumpadDecimal",u.NumLock="NumLock",u.ShiftLeft="ShiftLeft",u.ShiftRight="ShiftRight",u.AltLeft="AltLeft",u.AltRight="AltRight",u.ControlLeft="ControlLeft",u.ControlRight="ControlRight",u.MetaLeft="MetaLeft",u.MetaRight="MetaRight",u.Key0="Digit0",u.Key1="Digit1",u.Key2="Digit2",u.Key3="Digit3",u.Key4="Digit4",u.Key5="Digit5",u.Key6="Digit6",u.Key7="Digit7",u.Key8="Digit8",u.Key9="Digit9",u.Digit0="Digit0",u.Digit1="Digit1",u.Digit2="Digit2",u.Digit3="Digit3",u.Digit4="Digit4",u.Digit5="Digit5",u.Digit6="Digit6",u.Digit7="Digit7",u.Digit8="Digit8",u.Digit9="Digit9",u.F1="F1",u.F2="F2",u.F3="F3",u.F4="F4",u.F5="F5",u.F6="F6",u.F7="F7",u.F8="F8",u.F9="F9",u.F10="F10",u.F11="F11",u.F12="F12",u.A="KeyA",u.B="KeyB",u.C="KeyC",u.D="KeyD",u.E="KeyE",u.F="KeyF",u.G="KeyG",u.H="KeyH",u.I="KeyI",u.J="KeyJ",u.K="KeyK",u.L="KeyL",u.M="KeyM",u.N="KeyN",u.O="KeyO",u.P="KeyP",u.Q="KeyQ",u.R="KeyR",u.S="KeyS",u.T="KeyT",u.U="KeyU",u.V="KeyV",u.W="KeyW",u.X="KeyX",u.Y="KeyY",u.Z="KeyZ",u.KeyA="KeyA",u.KeyB="KeyB",u.KeyC="KeyC",u.KeyD="KeyD",u.KeyE="KeyE",u.KeyF="KeyF",u.KeyG="KeyG",u.KeyH="KeyH",u.KeyI="KeyI",u.KeyJ="KeyJ",u.KeyK="KeyK",u.KeyL="KeyL",u.KeyM="KeyM",u.KeyN="KeyN",u.KeyO="KeyO",u.KeyP="KeyP",u.KeyQ="KeyQ",u.KeyR="KeyR",u.KeyS="KeyS",u.KeyT="KeyT",u.KeyU="KeyU",u.KeyV="KeyV",u.KeyW="KeyW",u.KeyX="KeyX",u.KeyY="KeyY",u.KeyZ="KeyZ",u.Semicolon="Semicolon",u.Quote="Quote",u.Comma="Comma",u.Minus="Minus",u.Period="Period",u.Slash="Slash",u.Equal="Equal",u.BracketLeft="BracketLeft",u.Backslash="Backslash",u.BracketRight="BracketRight",u.Backquote="Backquote",u.Up="ArrowUp",u.Down="ArrowDown",u.Left="ArrowLeft",u.Right="ArrowRight",u.ArrowUp="ArrowUp",u.ArrowDown="ArrowDown",u.ArrowLeft="ArrowLeft",u.ArrowRight="ArrowRight",u.Space="Space",u.Backspace="Backspace",u.Delete="Delete",u.Esc="Escape",u.Escape="Escape",u.Enter="Enter",u.NumpadEnter="NumpadEnter",u.ContextMenu="ContextMenu"})(Hi||(Hi={}));class Wi extends T{constructor(t,n,r){super(),this.key=t,this.value=n,this.originalEvent=r}}let Z0={Press:"press",Hold:"hold",Release:"release"};class Ah{constructor(){this.events=new x,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=t=>{for(let n of this._keys){let r=new Wi(n,t.key,t);this.events.emit("up",r),this.events.emit("release",r)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=t=>{!t.metaKey&&(this._keys.includes(Hi.MetaLeft)||this._keys.includes(Hi.MetaRight))&&this._releaseAllKeys(t);let n=t.code;if(this._keys.indexOf(n)===-1){this._keys.push(n),this._keysDown.push(n);let r=new Wi(n,t.key,t);this.events.emit("down",r),this.events.emit("press",r)}},this._handleKeyUp=t=>{let n=t.code,r=this._keys.indexOf(n);this._keys.splice(r,1),this._keysUp.push(n);let h=new Wi(n,t.key,t);this.events.emit("up",h),this.events.emit("release",h),t.key==="Meta"&&this._releaseAllKeys(t)}}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}init(t){let{global:n}=t,{grabWindowFocus:r}=t;n||(_d()?(n=window,r&&window.focus(),et.getInstance().warn("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):n=window.top),n.addEventListener("blur",()=>{this._keys.length=0}),n.addEventListener("keyup",this._handleKeyUp),n.addEventListener("keydown",this._handleKeyDown)}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.events.emit("hold",new Wi(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}triggerEvent(t,n,r){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:n,key:r??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:n,key:r??null}))}}var hi;(function(u){u.Canvas="Canvas",u.Document="Document"})(hi||(hi={}));let Ch=4294967295;class On{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let n=1;n<this._n;n++){let r=this._mt[n-1]^this._mt[n-1]>>>this._w-2;this._mt[n]=(this._f*((r&4294901760)>>>16)<<16)+this._f*(r&65535)+n>>>0}this._index=this._n}_twist(){let t=[0,this._a],n=0,r=0;for(;r<this._n-this._m;r++)n=this._mt[r]&this._upperMask|this._mt[r+1]&this._lowerMask,this._mt[r]=this._mt[r+this._m]^n>>>1^t[n&1]&Ch;for(;r<this._n-1;r++)n=this._mt[r]&this._upperMask|this._mt[r+1]&this._lowerMask,this._mt[r]=this._mt[r+(this._m-this._n)]^n>>>1^t[n&1]&Ch;n=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^n>>>1^t[n&1]&Ch,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,n){return(n-t)*this.next()+t}integer(t,n){return Math.floor((n-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,n,r=!1){return r?this._pickSetWithDuplicates(t,n):this._pickSetWithoutDuplicates(t,n)}_pickSetWithoutDuplicates(t,n){if(n>t.length||n<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(n===t.length)return t;let r=new Array(n),h=0,c=t.slice(0);for(;h<n;){let f=this.integer(0,c.length-1);r[h++]=c[f],c.splice(f,1)}return r}_pickSetWithDuplicates(t,n){if(n<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");let r=new Array(n);for(let h=0;h<n;h++)r[h]=this.pickOne(t);return r}shuffle(t){let n=t.slice(0),r=null;for(let h=0;h<n.length-2;h++){let c=this.integer(h,n.length-1);r=n[h],n[h]=n[c],n[c]=r}return n}range(t,n,r){let h=new Array(t);for(let c=0;c<t;c++)h[c]=this.integer(n,r);return h}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}let es=Math.PI*2;function cm(u){return u>=0?u-Math.floor(u):u-Math.ceil(u)}function ze(u){return u===0?0:u<0?-1:1}function Pe(u,t,n){return Math.min(Math.max(t,u),n)}function qi(u){let t=u;if(u>es)for(;t>es;)t-=es;if(u<0)for(;t<0;)t+=es;return t}function gd(u){return 180/Math.PI*u}function um(u){return u/180*Math.PI}let Ih=(u,t)=>Array.from(new Array(t-u+1),(n,r)=>r+u);function Fs(u,t,n=new On){return n?n.floating(u,t):u+Math.random()*(t-u)}function dm(u,t,n=new On){return n?n.integer(u,t):Math.round(Fs(u,t))}class I{static get Zero(){return new I(0,0)}static get One(){return new I(1,1)}static get Half(){return new I(.5,.5)}static get Up(){return new I(0,-1)}static get Down(){return new I(0,1)}static get Left(){return new I(-1,0)}static get Right(){return new I(1,0)}static fromAngle(t){return new I(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}static min(t,n){return new I(Math.min(t.x,n.x),Math.min(t.y,n.y))}static max(t,n){return new I(Math.max(t.x,n.x),Math.max(t.y,n.y))}constructor(t,n){this._x=0,this._y=0,this._x=t,this._y=n}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,n){this.x=t,this.y=n}equals(t,n=.001){return Math.abs(this.x-t.x)<=n&&Math.abs(this.y-t.y)<=n}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);let n=this.x-t.x,r=this.y-t.y;return Math.sqrt(n*n+r*r)}squareDistance(t){t||(t=I.Zero);let n=this.x-t.x,r=this.y-t.y;return n*n+r*r}clampMagnitude(t){let n=this.size,r=Pe(n,0,t);return this.size=r,this}get size(){return this.distance()}set size(t){let n=this.normalize().scale(t);this.setTo(n.x,n.y)}normalize(){let t=this.distance();return t>0?new I(this.x/t,this.y/t):new I(0,1)}average(t){return this.add(t).scale(.5)}scale(t,n){let r=n||new I(0,0);return t instanceof I?(r.x=this.x*t.x,r.y=this.y*t.y):(r.x=this.x*t,r.y=this.y*t),r}add(t,n){return n?(n.x=this.x+t.x,n.y=this.y+t.y,n):new I(this.x+t.x,this.y+t.y)}sub(t){return new I(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof I)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new I(t*this.y,-t*this.x)}static cross(t,n){return new I(-t*n.y,t*n.x)}perpendicular(){return new I(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,n){n||(n=new I(0,0));let r=Math.sin(t),h=Math.cos(t),c=h*(this.x-n.x)-r*(this.y-n.y)+n.x,f=r*(this.x-n.x)+h*(this.y-n.y)+n.y;return new I(c,f)}clone(t){let n=t??new I(0,0);return n.x=this.x,n.y=this.y,n}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}function M(u,t){return new I(u,t)}class O{constructor(t,n,r,h){this.r=t,this.g=n,this.b=r,this.a=h??1}static fromRGB(t,n,r,h){return new O(t,n,r,h)}static fromRGBString(t){let n=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i,r=null;if(r=t.match(n)){let h=parseInt(r[1],10),c=parseInt(r[2],10),f=parseInt(r[3],10),p=1;return r[4]&&(p=parseFloat(r[4])),new O(h,c,f,p)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){let n=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,r=null;if(r=t.match(n)){let h=parseInt(r[1],16),c=parseInt(r[2],16),f=parseInt(r[3],16),p=1;return r[4]&&(p=parseInt(r[4],16)/255),new O(h,c,f,p)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,n,r,h=1){return new ss(t,n,r,h).toRGBA()}lighten(t=.1){let n=ss.fromRGBA(this.r,this.g,this.b,this.a);return n.l+=(1-n.l)*t,n.toRGBA()}darken(t=.1){let n=ss.fromRGBA(this.r,this.g,this.b,this.a);return n.l-=n.l*t,n.toRGBA()}saturate(t=.1){let n=ss.fromRGBA(this.r,this.g,this.b,this.a);return n.s+=n.s*t,n.toRGBA()}desaturate(t=.1){let n=ss.fromRGBA(this.r,this.g,this.b,this.a);return n.s-=n.s*t,n.toRGBA()}multiply(t){let n=t.r/255*this.r/255*255,r=t.g/255*this.g/255*255,h=t.b/255*this.b/255*255,c=t.a*this.a;return new O(n,r,h,c)}screen(t){let n=t.invert(),r=t.invert();return n.multiply(r).invert()}invert(){return new O(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){let n=(t.r+this.r)/2,r=(t.g+this.g)/2,h=(t.b+this.b)/2,c=(t.a+this.a)/2;return new O(n,r,h,c)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){let n=t.toString(16);return n.length===1?"0"+n:n}toHex(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)}toRGBA(){let t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return ss.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new O(this.r,this.g,this.b,this.a)}static get Black(){return O.fromHex("#000000")}static get White(){return O.fromHex("#FFFFFF")}static get Gray(){return O.fromHex("#808080")}static get LightGray(){return O.fromHex("#D3D3D3")}static get DarkGray(){return O.fromHex("#A9A9A9")}static get Yellow(){return O.fromHex("#FFFF00")}static get Orange(){return O.fromHex("#FFA500")}static get Red(){return O.fromHex("#FF0000")}static get Vermilion(){return O.fromHex("#FF5B31")}static get Rose(){return O.fromHex("#FF007F")}static get Magenta(){return O.fromHex("#FF00FF")}static get Violet(){return O.fromHex("#7F00FF")}static get Blue(){return O.fromHex("#0000FF")}static get Azure(){return O.fromHex("#007FFF")}static get Cyan(){return O.fromHex("#00FFFF")}static get Viridian(){return O.fromHex("#59978F")}static get Green(){return O.fromHex("#00FF00")}static get Chartreuse(){return O.fromHex("#7FFF00")}static get Transparent(){return O.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return O.fromHex("#176BAA")}}class ss{constructor(t,n,r,h){this.h=t,this.s=n,this.l=r,this.a=h}static hue2rgb(t,n,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(n-t)*6*r:r<1/2?n:r<2/3?t+(n-t)*(2/3-r)*6:t}static fromRGBA(t,n,r,h){t/=255,n/=255,r/=255;let c=Math.max(t,n,r),f=Math.min(t,n,r),p,_,v=(c+f)/2;if(c===f)p=_=0;else{let w=c-f;switch(_=v>.5?w/(2-c-f):w/(c+f),c){case t:p=(n-r)/w+(n<r?6:0);break;case n:p=(r-t)/w+2;break;case r:p=(t-n)/w+4;break}p/=6}return new ss(p,_,v,h)}toRGBA(){let t,n,r;if(this.s===0)t=n=r=this.l;else{let h=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,c=2*this.l-h;t=ss.hue2rgb(c,h,this.h+1/3),n=ss.hue2rgb(c,h,this.h),r=ss.hue2rgb(c,h,this.h-1/3)}return new O(t*255,n*255,r*255,this.a)}toString(){let t=this.h.toFixed(0),n=this.s.toFixed(0),r=this.l.toFixed(0),h=this.a.toFixed(0);return`hsla(${t}, ${n}, ${r}, ${h})`}}var Wt;(function(u){u.None="None",u.Top="Top",u.Bottom="Bottom",u.Left="Left",u.Right="Right"})(Wt||(Wt={})),function(u){function t(r){return r===u.Top?u.Bottom:r===u.Bottom?u.Top:r===u.Left?u.Right:r===u.Right?u.Left:u.None}u.getOpposite=t;function n(r){let h=[I.Left,I.Right,I.Up,I.Down],c=[u.Left,u.Right,u.Top,u.Bottom],f=-Number.MAX_VALUE,p=-1;for(let _=0;_<h.length;_++)h[_].dot(r)>f&&(f=h[_].dot(r),p=_);return c[p]}u.fromDirection=n}(Wt||(Wt={}));class ot{constructor(t=0,n=0,r=0,h=0){typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=n,this.right=r,this.bottom=h)}clone(){return new ot(this.left,this.top,this.right,this.bottom)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?Wt.Right:Wt.Left:t.y<0?Wt.Bottom:Wt.Top:Wt.None}static fromPoints(t){let n=1/0,r=1/0,h=-1/0,c=-1/0;for(let f=0;f<t.length;f++)t[f].x<n&&(n=t[f].x),t[f].x>h&&(h=t[f].x),t[f].y<r&&(r=t[f].y),t[f].y>c&&(c=t[f].y);return new ot(n,r,h,c)}static fromDimension(t,n,r=I.Half,h=I.Zero){return new ot(-t*r.x+h.x,-n*r.y+h.y,t-t*r.x+h.x,n-n*r.y+h.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new I((this.left+this.right)/2,(this.top+this.bottom)/2)}translate(t){return new ot(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,n=I.Zero){let r=this.getPoints().map(h=>h.rotate(t,n));return ot.fromPoints(r)}scale(t,n=I.Zero){let r=this.translate(n);return new ot(r.left*t.x,r.top*t.y,r.right*t.x,r.bottom*t.y)}transform(t){let n=t.data[0]*this.left,r=t.data[1]*this.left,h=t.data[0]*this.right,c=t.data[1]*this.right,f=t.data[2]*this.top,p=t.data[3]*this.top,_=t.data[2]*this.bottom,v=t.data[3]*this.bottom,w=t.getPosition(),E=Math.min(n,h)+Math.min(f,_)+w.x,C=Math.min(r,c)+Math.min(p,v)+w.y,S=Math.max(n,h)+Math.max(f,_)+w.x,k=Math.max(r,c)+Math.max(p,v)+w.y;return new ot({left:E,top:C,right:S,bottom:k})}getPerimeter(){let t=this.width,n=this.height;return 2*(t+n)}getPoints(){let t=[];return t.push(new I(this.left,this.top)),t.push(new I(this.right,this.top)),t.push(new I(this.right,this.bottom)),t.push(new I(this.left,this.bottom)),t}rayCast(t,n=1/0){let r=-1/0,h=1/0,c=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,f=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,p=(this.left-t.pos.x)*c,_=(this.right-t.pos.x)*c;r=Math.min(p,_),h=Math.max(p,_);let v=(this.top-t.pos.y)*f,w=(this.bottom-t.pos.y)*f;return r=Math.max(r,Math.min(v,w)),h=Math.min(h,Math.max(v,w)),h>=Math.max(0,r)&&r<n}rayCastTime(t,n=1/0){let r=-1/0,h=1/0,c=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,f=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,p=(this.left-t.pos.x)*c,_=(this.right-t.pos.x)*c;r=Math.min(p,_),h=Math.max(p,_);let v=(this.top-t.pos.y)*f,w=(this.bottom-t.pos.y)*f;return r=Math.max(r,Math.min(v,w)),h=Math.min(h,Math.max(v,w)),h>=Math.max(0,r)&&r<n?r:-1}contains(t){return t instanceof I?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof ot?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t){return new ot(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new I(this.width,this.height)}overlaps(t,n){let r=n||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);let h=this.combine(t);return h.width+r<t.width+this.width&&h.height+r<t.height+this.height}intersect(t){let n=this.combine(t);if(n.width<t.width+this.width&&n.height<t.height+this.height&&!n.dimensions.equals(t.dimensions)&&!n.dimensions.equals(this.dimensions)){let r=0;this.right>=t.left&&this.right<=t.right?r=t.left-this.right:r=t.right-this.left;let h=0;return this.top<=t.bottom&&this.top>=t.top?h=t.bottom-this.top:h=t.top-this.bottom,Math.abs(r)<Math.abs(h)?new I(r,0):new I(0,h)}else if(n.dimensions.equals(t.dimensions)||n.dimensions.equals(this.dimensions)){let r=0;this.width-t.width>=0?this.right-t.right<=t.left-this.left?r=t.left-this.right:r=t.right-this.left:t.right-this.right<=this.left-t.left?r=this.left-t.right:r=this.right-t.left;let h=0;return this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?h=t.top-this.bottom:h=t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?h=this.top-t.bottom:h=this.bottom-t.top,Math.abs(r)<Math.abs(h)?new I(r,0):new I(0,h)}else return null}intersectWithSide(t){let n=this.intersect(t);return ot.getSideFromIntersection(n)}draw(t,n=O.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:n})}}class ji{constructor(){this._isCompleted=!1,this.promise=new Promise((t,n)=>{this._resolver=t,this._rejecter=n})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}function Un(u){let t=0,n=0,r=c=>{t+=c.offsetLeft,c.offsetParent&&r(c.offsetParent)},h=c=>{n+=c.offsetTop,c.offsetParent&&h(c.offsetParent)};return r(u),h(u),new I(t,n)}function fm(u,t){return t.indexOf(u)===-1?(t.push(u),!0):!1}function Bs(u,t){let n=-1;return(n=t.indexOf(u))>-1?(t.splice(n,1),!0):!1}function Sh(u,t){for(let n=0;n<u.length;n++)if(u[n]===t)return!0;return!1}function md(u){throw new Error(u)}function Ph(u,t){var n;let r=new ji;return((n=t?.schedule.bind(t))!==null&&n!==void 0?n:setTimeout)(()=>{r.resolve()},u),r.promise}var Rh;(function(u){u[u.X=12]="X",u[u.Y=13]="Y"})(Rh||(Rh={}));class Re{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,n,r,h,c,f){let p=new Re;return p.data[0]=2/(n-t),p.data[1]=0,p.data[2]=0,p.data[3]=0,p.data[4]=0,p.data[5]=2/(h-r),p.data[6]=0,p.data[7]=0,p.data[8]=0,p.data[9]=0,p.data[10]=-2/(f-c),p.data[11]=0,p.data[12]=-(n+t)/(n-t),p.data[13]=-(h+r)/(h-r),p.data[14]=-(f+c)/(f-c),p.data[15]=1,p}clone(t){let n=t||new Re;return n.data[0]=this.data[0],n.data[1]=this.data[1],n.data[2]=this.data[2],n.data[3]=this.data[3],n.data[4]=this.data[4],n.data[5]=this.data[5],n.data[6]=this.data[6],n.data[7]=this.data[7],n.data[8]=this.data[8],n.data[9]=this.data[9],n.data[10]=this.data[10],n.data[11]=this.data[11],n.data[12]=this.data[12],n.data[13]=this.data[13],n.data[14]=this.data[14],n.data[15]=this.data[15],n}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){let n=new Re;return n.data=t,n}static identity(){let t=new Re;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){let t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,n){let r=Re.identity();return r.data[12]=t,r.data[13]=n,r}static scale(t,n){let r=Re.identity();return r.data[0]=t,r.data[5]=n,r.data[10]=1,r.data[15]=1,r}static rotation(t){let n=Re.identity();return n.data[0]=Math.cos(t),n.data[4]=-Math.sin(t),n.data[1]=Math.sin(t),n.data[5]=Math.cos(t),n}multiply(t,n){if(t instanceof I){let r=n||new I(0,0),h=t,c=h.x*this.data[0]+h.y*this.data[4]+this.data[12],f=h.x*this.data[1]+h.y*this.data[5]+this.data[13];return r.x=c,r.y=f,r}else{let r=n||new Re,h=t,c=this.data[0],f=this.data[1],p=this.data[2],_=this.data[3],v=this.data[4],w=this.data[5],E=this.data[6],C=this.data[7],S=this.data[8],k=this.data[9],N=this.data[10],V=this.data[11],D=this.data[12],R=this.data[13],z=this.data[14],G=this.data[15],st=h.data[0],Q=h.data[1],F=h.data[2],gt=h.data[3],Et=h.data[4],Ct=h.data[5],vt=h.data[6],Xt=h.data[7],Be=h.data[8],Le=h.data[9],Ne=h.data[10],vs=h.data[11],ys=h.data[12],ws=h.data[13],rt=h.data[14],yi=h.data[15];r.data[0]=c*st+v*Q+S*F+D*gt,r.data[1]=f*st+w*Q+k*F+R*gt,r.data[2]=p*st+E*Q+N*F+z*gt,r.data[3]=_*st+C*Q+V*F+G*gt,r.data[4]=c*Et+v*Ct+S*vt+D*Xt,r.data[5]=f*Et+w*Ct+k*vt+R*Xt,r.data[6]=p*Et+E*Ct+N*vt+z*Xt,r.data[7]=_*Et+C*Ct+V*vt+G*Xt,r.data[8]=c*Be+v*Le+S*Ne+D*vs,r.data[9]=f*Be+w*Le+k*Ne+R*vs,r.data[10]=p*Be+E*Le+N*Ne+z*vs,r.data[11]=_*Be+C*Le+V*Ne+G*vs,r.data[12]=c*ys+v*ws+S*rt+D*yi,r.data[13]=f*ys+w*ws+k*rt+R*yi,r.data[14]=p*ys+E*ws+N*rt+z*yi,r.data[15]=_*ys+C*ws+V*rt+G*yi;let Fo=this.getScale();return r._scaleSignX=ze(Fo.x)*ze(r._scaleSignX),r._scaleSignY=ze(Fo.y)*ze(r._scaleSignY),r}}translate(t,n){let r=this.data[0],h=this.data[1],c=this.data[2],f=this.data[3],p=this.data[4],_=this.data[5],v=this.data[6],w=this.data[7],E=this.data[8],C=this.data[9],S=this.data[10],k=this.data[11],N=this.data[12],V=this.data[13],D=this.data[14],R=this.data[15],z=0,G=1;return this.data[12]=r*t+p*n+E*z+N*G,this.data[13]=h*t+_*n+C*z+V*G,this.data[14]=c*t+v*n+S*z+D*G,this.data[15]=f*t+w*n+k*z+R*G,this}setPosition(t,n){this.data[12]=t,this.data[13]=n}getPosition(){return M(this.data[12],this.data[13])}rotate(t){let n=this.data[0],r=this.data[1],h=this.data[2],c=this.data[3],f=this.data[4],p=this.data[5],_=this.data[6],v=this.data[7],w=Math.sin(t),E=Math.cos(t);return this.data[0]=E*n+w*f,this.data[1]=E*r+w*p,this.data[2]=E*h+w*_,this.data[3]=E*c+w*v,this.data[4]=E*f-w*n,this.data[5]=E*p-w*r,this.data[6]=E*_-w*h,this.data[7]=E*v-w*c,this}scale(t,n){let r=this.data[0],h=this.data[1],c=this.data[2],f=this.data[3],p=this.data[4],_=this.data[5],v=this.data[6],w=this.data[7];return this.data[0]=r*t,this.data[1]=h*t,this.data[2]=c*t,this.data[3]=f*t,this.data[4]=p*n,this.data[5]=_*n,this.data[6]=v*n,this.data[7]=w*n,this}setRotation(t){let n=this.getScale(),r=Math.sin(t),h=Math.cos(t);this.data[0]=h*n.x,this.data[1]=r*n.y,this.data[4]=-r*n.x,this.data[5]=h*n.y}getRotation(){let t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return qi(t)}getScaleX(){let t=M(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){let t=M(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return M(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=ze(t);let n=M(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=n.x*t,this.data[4]=n.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=ze(t);let n=M(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=n.x*t,this.data[5]=n.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){let r=1/this.getBasisDeterminant(),h=this.data[0],c=this.data[4],f=this.data[1],p=this.data[5],_=t||Re.identity();_.data[0]=p*r,_.data[1]=-f*r,_.data[4]=-c*r,_.data[5]=h*r;let v=this.data[12],w=this.data[13];return _.data[12]=-(v*_.data[0]+w*_.data[4]),_.data[13]=-(v*_.data[1]+w*_.data[5]),_}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class qt{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){let t=new qt;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,n){let r=qt.identity();return r.data[4]=t,r.data[5]=n,r}static scale(t,n){let r=qt.identity();return r.data[0]=t,r.data[3]=n,r._scale[0]=t,r._scale[1]=n,r}static rotation(t){let n=qt.identity();return n.data[0]=Math.cos(t),n.data[1]=Math.sin(t),n.data[2]=-Math.sin(t),n.data[3]=Math.cos(t),n}setPosition(t,n){this.data[4]=t,this.data[5]=n}getPosition(){return M(this.data[4],this.data[5])}rotate(t){let n=this.data[0],r=this.data[1],h=this.data[2],c=this.data[3],f=Math.sin(t),p=Math.cos(t);return this.data[0]=p*n+f*h,this.data[1]=p*r+f*c,this.data[2]=p*h-f*n,this.data[3]=p*c-f*r,this}translate(t,n){let r=this.data[0],h=this.data[1],c=this.data[2],f=this.data[3],p=this.data[4],_=this.data[5];return this.data[4]=r*t+c*n+p,this.data[5]=h*t+f*n+_,this}scale(t,n){let r=this.data[0],h=this.data[1],c=this.data[2],f=this.data[3];return this.data[0]=r*t,this.data[1]=h*t,this.data[2]=c*n,this.data[3]=f*n,this._scale[0]=t,this._scale[1]=n,this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){let r=1/this.determinant(),h=this.data[0],c=this.data[2],f=this.data[1],p=this.data[3],_=t||qt.identity();_.data[0]=p*r,_.data[1]=-f*r,_.data[2]=-c*r,_.data[3]=h*r;let v=this.data[4],w=this.data[5];return _.data[4]=-(v*_.data[0]+w*_.data[2]),_.data[5]=-(v*_.data[1]+w*_.data[3]),_}multiply(t,n){if(t instanceof I){let r=n||new I(0,0),h=t,c=h.x*this.data[0]+h.y*this.data[2]+this.data[4],f=h.x*this.data[1]+h.y*this.data[3]+this.data[5];return r.x=c,r.y=f,r}else{let r=n||new qt,h=t,c=this.data[0],f=this.data[1],p=this.data[2],_=this.data[3],v=this.data[4],w=this.data[5],E=h.data[0],C=h.data[1],S=h.data[2],k=h.data[3],N=h.data[4],V=h.data[5];r.data[0]=c*E+p*C,r.data[1]=f*E+_*C,r.data[2]=c*S+p*k,r.data[3]=f*S+_*k,r.data[4]=c*N+p*V+v,r.data[5]=f*N+_*V+w;let D=this.getScale();return r._scaleSignX=ze(D.x)*ze(r._scaleSignX),r._scaleSignY=ze(D.y)*ze(r._scaleSignY),r}}to4x4(){let t=new Re;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){let n=this.getScale(),r=Math.sin(t),h=Math.cos(t);this.data[0]=h*n.x,this.data[1]=r*n.y,this.data[2]=-r*n.x,this.data[3]=h*n.y}getRotation(){let t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return qi(t)}getScaleX(){let t=M(this.data[0],this.data[2]).distance();return this._scaleSignX*t}getScaleY(){let t=M(this.data[1],this.data[3]).distance();return this._scaleSignY*t}getScale(){return M(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=ze(t);let n=M(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=n.x*t,this.data[2]=n.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=ze(t);let n=M(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=n.x*t,this.data[3]=n.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){let t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){let n=t||new qt;return n.data[0]=this.data[0],n.data[1]=this.data[1],n.data[2]=this.data[2],n.data[3]=this.data[3],n.data[4]=this.data[4],n.data[5]=this.data[5],n}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class pm{constructor(){this._transforms=[],this._currentTransform=qt.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,n){return this._currentTransform.translate(t,n)}rotate(t){return this._currentTransform.rotate(t)}scale(t,n){return this._currentTransform.scale(t,n)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class vd{constructor(){this._states=[],this._currentState=this._getDefaultState()}_getDefaultState(){return{opacity:1,z:0,tint:O.White,material:null}}_cloneState(){return{opacity:this._currentState.opacity,z:this._currentState.z,tint:this._currentState.tint.clone(),material:this._currentState.material}}save(){this._states.push(this._currentState),this._currentState=this._cloneState()}restore(){this._currentState=this._states.pop()}get current(){return this._currentState}set current(t){this._currentState=t}}let _m={Complete:"complete",Load:"load",LoadStart:"loadstart",Progress:"progress",Error:"error"};class ao{constructor(t,n,r=!1){this.path=t,this.responseType=n,this.bustCache=r,this.data=null,this.logger=et.getInstance(),this.events=new x}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,n)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}let r=new XMLHttpRequest;r.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),r.responseType=this.responseType,r.addEventListener("loadstart",h=>this.events.emit("loadstart",h)),r.addEventListener("progress",h=>this.events.emit("progress",h)),r.addEventListener("error",h=>this.events.emit("error",h)),r.addEventListener("load",h=>this.events.emit("load",h)),r.addEventListener("load",()=>{if(r.status!==0&&r.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",r.status),this.events.emit("error",r.response),n(new Error(r.statusText));return}this.data=r.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),r.send()})}}function li(u,t){return u&&(u.__isProxy===void 0?new Proxy(u,{set:(n,r,h)=>(n[r]!==h&&(n[r]=h,typeof r=="string"&&r[0]!=="_"&&t(n)),!0),get:(n,r)=>r!=="__isProxy"?n[r]:!0}):u)}function yd(u,t){return u&&(u.__isProxy===void 0?new Proxy(u,{set:(n,r,h)=>(n[r]=h,typeof r=="string"&&r[0]!=="_"&&t(n),!0),get:(n,r)=>r!=="__isProxy"?n[r]:!0}):u)}class De{isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=li(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){this._origin=li(t,()=>{this._transformStale=!0}),this._transformStale=!0}constructor(t){var n,r,h,c,f,p;this.id=De._ID++,this.transform=qt.identity(),this.tint=null,this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=I.One,this._origin=null,this._width=0,this._height=0,t&&(this.origin=(n=t.origin)!==null&&n!==void 0?n:this.origin,this.flipHorizontal=(r=t.flipHorizontal)!==null&&r!==void 0?r:this.flipHorizontal,this.flipVertical=(h=t.flipVertical)!==null&&h!==void 0?h:this.flipVertical,this.rotation=(c=t.rotation)!==null&&c!==void 0?c:this.rotation,this.opacity=(f=t.opacity)!==null&&f!==void 0?f:this.opacity,this.scale=(p=t.scale)!==null&&p!==void 0?p:this.scale)}cloneGraphicOptions(){return{origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return ot.fromDimension(this.width,this.height,I.Zero)}draw(t,n,r){this._preDraw(t,n,r),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,n,r){t.save(),t.translate(n,r),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var n;let r=this.scale.x>0?1:-1,h=this.scale.y>0?1:-1,c=(n=this.origin)!==null&&n!==void 0?n:M(this.width/2,this.height/2);t.translate(c.x,c.y),t.rotate(this.rotation),t.scale(r,h),t.translate(-c.x,-c.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}De._ID=0;class ci extends De{static from(t){return new ci({image:t})}constructor(t){var n,r;super(t),this._logger=et.getInstance(),this._dirty=!0,this._logNotLoadedWarning=!1,this.image=t.image;let{width:h,height:c}=t;this.sourceView=(n=t.sourceView)!==null&&n!==void 0?n:{x:0,y:0,width:h??0,height:c??0},this.destSize=(r=t.destSize)!==null&&r!==void 0?r:{width:h??0,height:c??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,n,r,h,c,f;let{width:p,height:_}=this.image;this.sourceView.width=((t=this.sourceView)===null||t===void 0?void 0:t.width)||p,this.sourceView.height=((n=this.sourceView)===null||n===void 0?void 0:n.height)||_,this.destSize.width=((r=this.destSize)===null||r===void 0?void 0:r.width)||((h=this.sourceView)===null||h===void 0?void 0:h.width)||p,this.destSize.height=((c=this.destSize)===null||c===void 0?void 0:c.height)||((f=this.sourceView)===null||f===void 0?void 0:f.height)||_,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,n,r){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,n,r)}_drawImage(t,n,r){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,n,r,this.destSize.width,this.destSize.height):(this._logNotLoadedWarning||this._logger.warn(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`),this._logNotLoadedWarning=!0)}clone(){return new ci({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var _e;(function(u){u.Pixel="Pixel",u.Blended="Blended"})(_e||(_e={}));class he{constructor(t){this._textureMap=new Map,this._gl=t,he._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}get(t){return this._textureMap.get(t)}has(t){return this._textureMap.has(t)}load(t,n,r=!1){let h=this._gl;if(!h)return null;let c=null;if(this.has(t)&&(c=this.get(t)),c)return r&&(h.bindTexture(h.TEXTURE_2D,c),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t)),c;c=h.createTexture(),he.checkImageSizeSupportedAndLog(t),h.bindTexture(h.TEXTURE_2D,c),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);let f=n??he.filtering;return h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,f===_e.Pixel?h.NEAREST:h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,f===_e.Pixel?h.NEAREST:h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t),this._textureMap.set(t,c),c}delete(t){let n=this._gl;if(!n)return null;let r=null;this.has(t)&&(r=this.get(t),n.deleteTexture(r))}static checkImageSizeSupportedAndLog(t){var n;let r=(n=t.dataset.originalSrc)!==null&&n!==void 0?n:"internal canvas bitmap";return t.width>he._MAX_TEXTURE_SIZE||t.height>he._MAX_TEXTURE_SIZE?(he._LOGGER.error(`The image [${r}] provided to Excalibur is too large for the device's maximum texture size of (${he._MAX_TEXTURE_SIZE}x${he._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&he._LOGGER.warn(`The image [${r}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}he._LOGGER=et.getInstance(),he.filtering=_e.Blended,he._MAX_TEXTURE_SIZE=4096;class Dh{get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}constructor(t,n=!1,r){this.path=t,this._logger=et.getInstance(),this.data=new Image,this._readyFuture=new ji,this.ready=this._readyFuture.promise,this._resource=new ao(t,"blob",n),this.filtering=r,(t.endsWith(".svg")||t.endsWith(".gif"))&&this._logger.warn(`Image type is not fully supported, you may have mixed results ${t}. Fully supported: jpg, bmp, and png`)}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){if(this.isLoaded())return this.data;try{let t;if(this.path.includes("data:image/"))t=this.path;else{let h=await this._resource.load();t=URL.createObjectURL(h)}let n=new Image,r=new ji;n.onload=()=>r.resolve(),n.src=t,n.setAttribute("data-original-src",this.path),await r.promise,this.data=n,he.checkImageSizeSupportedAndLog(this.data)}catch(t){throw`Error loading ImageSource from path '${this.path}' with error [${t.message}]`}return this.data.setAttribute("filtering",this.filtering),this._readyFuture.resolve(this.data),this.data}toSprite(){return ci.from(this)}unload(){this.data=new Image}}class ui{constructor(t){this._logger=et.getInstance(),this.sprites=[];let{sprites:n,rows:r,columns:h}=t;this.sprites=n,this.rows=r??1,this.columns=h??this.sprites.length}getSprite(t,n){if(t>=this.columns||t<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${n}), x: ${t} should be between 0 and ${this.columns-1}`),null;if(n>=this.rows||n<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${n}), y: ${n} should be between 0 and ${this.rows-1}`),null;let r=t+n*this.columns;return this.sprites[r]}static fromImageSourceWithSourceViews(t){let n=t.sourceViews.map(r=>new ci({image:t.image,sourceView:r}));return new ui({sprites:n})}static fromImageSource(t){var n;let r=[];t.spacing=(n=t.spacing)!==null&&n!==void 0?n:{};let{image:h,grid:{rows:c,columns:f,spriteWidth:p,spriteHeight:_},spacing:{originOffset:v,margin:w}}=t,E={x:0,y:0,...v},C={x:0,y:0,...w};for(let S=0;S<f;S++)for(let k=0;k<c;k++)r[S+k*f]=new ci({image:h,sourceView:{x:S*p+C.x*S+E.x,y:k*_+C.y*k+E.y,width:p,height:_},destSize:{height:_,width:p}});return new ui({sprites:r,rows:c,columns:f})}clone(){return new ui({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}class ho extends De{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this._logger=et.getInstance(),this._alreadyWarnedAlphabet=!1,this._alreadyWarnedSpriteSheet=!1;let{alphabet:n,spriteSheet:r,caseInsensitive:h,spacing:c,shadow:f}=t;this.alphabet=n,this.spriteSheet=r,this.caseInsensitive=h??this.caseInsensitive,this.spacing=c??this.spacing,this.shadow=f??this.shadow}_getCharacterSprites(t){let n=[],r=this.caseInsensitive?t.toLocaleLowerCase():t,h=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let c=0;c<r.length;c++){let f=r[c],p=h.indexOf(f);p===-1&&(p=0,this._alreadyWarnedAlphabet||(this._logger.warn(`SpriteFont - Cannot find letter '${f}' in configured alphabet '${h}'.`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedAlphabet=!0));let _=this.spriteSheet.sprites[p];_?n.push(_):this._alreadyWarnedSpriteSheet||(this._logger.warn(`SpriteFont - Cannot find sprite for '${f}' at index '${p}' in configured SpriteSheet`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedSpriteSheet=!0)}return n}measureText(t,n){let r=this._getLinesFromText(t,n),h=r.reduce((_,v)=>_.length>v.length?_:v),c=this._getCharacterSprites(h),f=0,p=0;for(let _ of c)f+=_.width+this.spacing,p=Math.max(p,_.height);return ot.fromDimension(f,p*r.length,I.Zero)}_drawImage(t,n,r,h){let c=0,f=0,p=0,_=this._getLinesFromText(this._text,h);for(let v of _){for(let w of this._getCharacterSprites(v))w.draw(t,n+c,r+f),c+=w.width+this.spacing,p=Math.max(p,w.height);c=0,f+=p}}render(t,n,r,h,c,f){this._text=n;let p=this.measureText(n,f);this.width=p.width,this.height=p.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,h,c),this._drawImage(t,0,0,f),this._postDraw(t),t.restore()),this._preDraw(t,h,c),this._drawImage(t,0,0,f),this._postDraw(t)}clone(){return new ho({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,n){if(this._cachedText===t&&this._cachedRenderWidth===n)return this._cachedLines;let r=t.split(`
`);if(n==null)return r;for(let h=0;h<r.length;h++){let c=r[h],f="";if(this.measureText(c).width>n){for(;this.measureText(c).width>n;)f=c[c.length-1]+f,c=c.slice(0,-1);r[h]=c,r[h+1]=f}}return this._cachedText=t,this._cachedLines=r,this._cachedRenderWidth=n,r}}let gm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAwCAYAAAD+f6R/AAAAAXNSR0IArs4c6QAABcJJREFUeJztnemu7CgMhGE07//KmT9NhrAFVzkQndQntXRP3/bCZkwCSQhCCCGEEEIIIYQQQog/TRz953Ecx/nDGIe/vdNhlc9tIz605Fk/ZmWfsO1hn9Gxuv1KHbvb3iL/VN+d1WORbyr7yR/5b9M4vjNeqko6jPJHq5wGHU151o9J2Udse9hndCxuv0rH7rY3yD/Wdyf13MrnQeDfkZIUSGKM4ff3cWN82pEZuTyQGX2IxeyR63va//8VNCYCq+1yEkLtWyagXv1P1r1H+110gP3PzT4gT8uW/mdQ8mUG8E9DqOz4MS9ICKGbXpS2BpnIrRzYeS96cll08INlCMl2/glzdcfazuuPqQO03lmqrBHsf272Q6NODXj6zzZIJd/LAHYTg3Mays5gBi7ZR27fOgs0yj8rm36DLMFiPgkAdXHKOwUQeMCQ/adSh/qBQrT/tPxbAwA9+DOZEILPAATSuHMgTv7+Auk/df2lHPCZLvMSLJe34LkEQ9PwXF1SRTllMYgvIaflqyVAjLGbsiCDcOK76jflxZ+sINPyROc5071yKWK5CJTV3dMp6+tBlyCtNlhAq/+XbWoBDcRNXYBMzD4VvQygSuPYC2jGGaSSOxXfy3dTUEsanIvNeepm38N/hssSALTPZnAXfwIYRJn2b7UBcw0FKX+nDdAMpm2j9WVnxrUa7TXaVAca/B+TgaAVh6R/rH0P/5m01dt/RLYViJn+w/bhVX2P7f/duqom5qb02pRLCLGIMgBU1wCEEN9BAUCID6MAIMSHUQAQ4sMoAAjxYRQAhPgwd1uB0fuZ7H3cnn2P+9mr/Pe4B8/eB/fwP4eRtci/0f6OfTCPt/9oHwC6G6y19RHZDumxmwzR4eE/s/2Tte/q/+XLdc9DeJ19diesQc/j7Z8fCe4tAS4CxZ7sp7eiJi7HiZmjmOTGJs+93CbS3nP0XIPH3vW8/qz6QPnX2QdsV/1uw/iZYvg8ACeHd28rpPzfNfhL+7vkw/4Ou9s+Onhbv91elpKZ48Dl6bzpwwibHigRArf+Ptk9+L3Y1Q5OB4LgCeSBw1iuB3GeJh1/HrX/zF0A9Mk+u45zMkc3r4rWPomma5+p/514LB+Zo93MErJ1JHxXPzByGa/licRYVKbpeQCoQ6Q8yxuCwJF9IPsoDkHAo/3Tx26cvA4EtJ/n04w8QOq/mrR7ddfLAC5BYFNlVI/0CnOVUflOpvJUQMx9AIMIW/nWDM67/qw0+95v9goBqD9j+72u/KD9U89IbnQbMIR2Zbneh5zUY7Hdk7XIP3UffVb+r+wDYAZLq+1n1+C7y3/ny2r7p5yeByDEh9HzAIQQJwoAQnwYBQAhPowCgBBjoNu3hNxSFACE6INuKvPajPZ4EFEAEKINcybGYzOd247WEd3TgA2jlmjEyrd+j9hvfVbD2PWQ3ZmGlu2HyO8og8eBuNUvNYWoDgMVpwHTJoLWdz1Y+ZYOy5uF7t6PPruZxANrud1lQXkP0jsGz/Yz+vGGMuygFyhSPcJnc1pMnQZElc+cRnoAlxdTvoDuK7puqF7uCQy+3fyFMiA02/vJQHh7DQDogMPTSGFNA56HTzbZ9yAfBOb1Zyo3qGM3MfMZ3f76huXf6xlmAHknMlLNXsBBBvbljIz9Uyz5Y5TzIBLR/qy/rNyrZ8+L/0BZ0m+tgXD0OK5XZxC/9P7I/g4hVFvzXf1/6i5A7+3AlijMPBLMZfCvuAp7A9rY56ApHitmLQc7c8bOv6ftAxlM9Xp35nkEK7nJetBsaMhtAAAuOLQGXwhh2dXQnn1rZ/a42BI3dL7L+jkFAbQddwdA9Ah35yMKhgEgVT46EFh5D4jz+OgavNKxeBCd1wDSJ/97oR8eoJkLi9t9/BDgDHTJ5NE7Dnzechh914OVv9M1K9PCqsfqb88XVg9qN9lm6nG176UPu+zn17GOxuO0vOWEEC/j+LFKTgghlvEfYJaLS+SA2O0AAAAASUVORK5CYII=";class kh{constructor(){this.fontSheet=gm,this.size=16,this.load()}load(){return this._imageSource=new Dh(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=ui.fromImageSource({image:this._imageSource,grid:{rows:3,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new ho({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+ `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,n,r){this._imageSource.isLoaded()&&this._spriteFont.render(t,n,null,r.x,r.y)}}class mm{constructor(t,n){this._gl=t,this._texture=n}use(){let t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){let t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class Mh{constructor(t){this.width=t.width,this.height=t.height,this._gl=t.gl,this._setupFramebuffer()}setResolution(t,n){let r=this._gl;this.width=t,this.height=n,r.bindTexture(r.TEXTURE_2D,this._frameTexture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null)}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupFramebuffer(){let t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);let n=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,n,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return new mm(this._gl,this._frameTexture)}use(){let t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){let t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}let vm=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
\r
out lowp vec4 v_color;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Passthrough the color\r
   v_color = a_color;\r
}`,ym=`#version 300 es\r
precision mediump float;\r
\r
// Color\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = v_color;\r
}`;function Fh(u,t){switch(t){case u.FLOAT:return 4;case u.SHORT:return 2;case u.UNSIGNED_SHORT:return 2;case u.BYTE:return 1;case u.UNSIGNED_BYTE:return 1;default:return 1}}function wd(u,t){switch(t){case u.LOW_FLOAT:case u.HIGH_FLOAT:case u.FLOAT:return 1;case u.FLOAT_VEC2:return 2;case u.FLOAT_VEC3:return 3;case u.FLOAT_VEC4:return 4;case u.BYTE:return 1;case u.UNSIGNED_BYTE:return 1;case u.UNSIGNED_SHORT:case u.SHORT:return 1;default:return 1}}function xd(u,t){switch(t){case u.LOW_FLOAT:case u.HIGH_FLOAT:case u.FLOAT:case u.FLOAT_VEC2:case u.FLOAT_VEC3:case u.FLOAT_VEC4:return u.FLOAT;case u.BYTE:return u.BYTE;case u.UNSIGNED_BYTE:return u.UNSIGNED_BYTE;case u.SHORT:return u.SHORT;case u.UNSIGNED_SHORT:return u.UNSIGNED_SHORT;default:return u.FLOAT}}class Ge{get compiled(){return this._compiled}constructor(t){this._logger=et.getInstance(),this.uniforms={},this.attributes={},this._compiled=!1;let{gl:n,vertexSource:r,fragmentSource:h}=t;this._gl=n,this.vertexSource=r,this.fragmentSource=h}use(){this._gl.useProgram(this.program),Ge._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Ge._ACTIVE_SHADER_INSTANCE===this}compile(){let t=this._gl,n=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),r=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,n,r);let h=this.getAttributes();for(let f of h)this.attributes[f.name]=f;let c=this.getUniforms();for(let f of c)this.uniforms[f.name]=f;return this._compiled=!0,this.program}getUniforms(){let t=this._gl,n=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),r=[];for(let h=0;h<n;h++){let c=t.getActiveUniform(this.program,h),f=t.getUniformLocation(this.program,c.name);r.push({name:c.name,glType:c.type,location:f})}return r}getAttributes(){let t=this._gl,n=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),r=[];for(let h=0;h<n;h++){let c=t.getActiveAttrib(this.program,h),f=t.getAttribLocation(this.program,c.name);r.push({name:c.name,glType:xd(t,c.type),size:wd(t,c.type),location:f,normalized:!1})}return r}setTexture(t,n){let r=this._gl;r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,n)}setUniformInt(t,n){this.setUniform("uniform1i",t,~~n)}trySetUniformInt(t,n){return this.trySetUniform("uniform1i",t,~~n)}setUniformIntArray(t,n){this.setUniform("uniform1iv",t,n)}trySetUniformIntArray(t,n){return this.trySetUniform("uniform1iv",t,n)}setUniformBoolean(t,n){this.setUniform("uniform1i",t,n?1:0)}trySetUniformBoolean(t,n){return this.trySetUniform("uniform1i",t,n?1:0)}setUniformFloat(t,n){this.setUniform("uniform1f",t,n)}trySetUniformFloat(t,n){return this.trySetUniform("uniform1f",t,n)}setUniformFloatArray(t,n){this.setUniform("uniform1fv",t,n)}trySetUniformFloatArray(t,n){return this.trySetUniform("uniform1fv",t,n)}setUniformFloatVector(t,n){this.setUniform("uniform2f",t,n.x,n.y)}trySetUniformFloatVector(t,n){return this.trySetUniform("uniform2f",t,n.x,n.y)}setUniformFloatColor(t,n){this.setUniform("uniform4f",t,n.r/255,n.g/255,n.b/255,n.a)}trySetUniformFloatColor(t,n){return this.trySetUniform("uniform4f",t,n.r/255,n.g/255,n.b/255,n.a)}setUniformMatrix(t,n){this.setUniform("uniformMatrix4fv",t,!1,n.data)}trySetUniformMatrix(t,n){return this.trySetUniform("uniformMatrix4fv",t,!1,n.data)}setUniform(t,n,...r){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${n}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");let c=this._gl.getUniformLocation(this.program,n);if(c){let f=[c,...r];this._gl[t].apply(this._gl,f)}else throw Error(`Uniform ${t}:${n} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(t,n,...r){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${t}:${n}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;let c=this._gl.getUniformLocation(this.program,n);if(c){let f=[c,...r];this._gl[t].apply(this._gl,f)}else return!1;return!0}_createProgram(t,n,r){let h=t.createProgram();if(h===null)throw Error("Could not create graphics shader program");if(t.attachShader(h,n),t.attachShader(h,r),t.linkProgram(h),!t.getProgramParameter(h,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(h)}]`);return h}_compileShader(t,n,r){let h=t.VERTEX_SHADER===r?"vertex":"fragment",c=t.createShader(r);if(c===null)throw Error(`Could not build shader: [${n}]`);if(t.shaderSource(c,n),t.compileShader(c),!t.getShaderParameter(c,t.COMPILE_STATUS)){let p=t.getShaderInfoLog(c);throw Error(`Could not compile ${h} shader:

${p}${this._processSourceForError(n,p)}`)}return c}_processSourceForError(t,n){let r=t.split(`
`),h=n.search(/\d:\d/),c=n.indexOf(" ",h),[f,p]=n.slice(h,c).split(":").map(_=>Number(_));for(let _=0;_<r.length;_++)r[_]=`${_+1}: ${r[_]}${p===_+1?" <----- ERROR!":""}`;return`

Source:
`+r.join(`
`)}}Ge._ACTIVE_SHADER_INSTANCE=null;class Ls{constructor(t){this.type="dynamic";let{gl:n,size:r,type:h,data:c}=t;if(this._gl=n,this.buffer=this._gl.createBuffer(),!c&&!r)throw Error("Must either provide data or a size to the VertexBuffer");c?this.bufferData=c:this.bufferData=new Float32Array(r),this.type=h??this.type,n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.bufferData(n.ARRAY_BUFFER,this.bufferData,this.type==="static"?n.STATIC_DRAW:n.DYNAMIC_DRAW)}bind(){let t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}upload(t){let n=this._gl;n.bindBuffer(n.ARRAY_BUFFER,this.buffer),t?n.bufferSubData(n.ARRAY_BUFFER,0,this.bufferData,0,t):n.bufferData(n.ARRAY_BUFFER,this.bufferData,this.type==="static"?n.STATIC_DRAW:n.DYNAMIC_DRAW)}}class Ns{get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}constructor(t){this._logger=et.getInstance(),this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0;let{gl:n,shader:r,vertexBuffer:h,attributes:c}=t;this._gl=n,this._vertexBuffer=h,this._attributes=c,this._shader=r,r&&this.initialize()}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(t){t&&this._shader!==t&&(this._shader=t,this.initialize())}get shader(){return this._shader}initialize(){if(!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._layout.length=0;let t=this._shader.attributes;for(let r of this._attributes){let h=t[r[0]];if(!h)throw Error(`The attribute named: ${r[0]} size ${r[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);if(h.size!==r[1])throw Error(`VertexLayout size definition for attribute: [${r[0]}, ${r[1]}], doesnt match shader source size ${h.size}:
 ${this._shader.vertexSource}`);this._layout.push(h)}let n=0;for(let r of this._layout){let h=Fh(this._gl,r.glType);this._vertexTotalSizeBytes+=h*r.size,n+=r.size}this._vertexBuffer.bufferData.length%n!==0&&this._logger.warn(`The vertex component size (${n})  does divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`)}use(t=!1,n){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");let r=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(n);let h=0;for(let c of this._layout)r.vertexAttribPointer(c.location,c.size,c.glType,c.normalized,this.totalVertexSizeBytes,h),r.enableVertexAttribArray(c.location),h+=Fh(r,c.glType)*c.size}}class jt{static clear(){jt.DrawCallCount=0,jt.DrawnImagesCount=0}}jt.DrawCallCount=0,jt.DrawnImagesCount=0;class wm{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0}initialize(t,n){this._gl=t,this._context=n,this._shader=new Ge({gl:t,vertexSource:vm,fragmentSource:ym}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new Ls({gl:t,size:6*2*this._maxLines,type:"dynamic"}),this._layout=new Ns({gl:t,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}draw(t,n,r){this._isFull()&&this.flush(),this._lineCount++;let h=this._context.getTransform(),c=h.multiply(t),f=h.multiply(n),p=this._vertexBuffer.bufferData;p[this._vertexIndex++]=c.x,p[this._vertexIndex++]=c.y,p[this._vertexIndex++]=r.r/255,p[this._vertexIndex++]=r.g/255,p[this._vertexIndex++]=r.b/255,p[this._vertexIndex++]=r.a,p[this._vertexIndex++]=f.x,p[this._vertexIndex++]=f.y,p[this._vertexIndex++]=r.r/255,p[this._vertexIndex++]=r.g/255,p[this._vertexIndex++]=r.b/255,p[this._vertexIndex++]=r.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;let t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),jt.DrawnImagesCount+=this._lineCount,jt.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}let xm=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
in float a_size;\r
out lowp vec4 v_color;\r
uniform mat4 u_matrix;\r
\r
void main() {\r
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
  gl_PointSize = a_size * 2.0;\r
  v_color = a_color;\r
}`,bm=`#version 300 es\r
\r
precision mediump float;\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  float r = 0.0, delta = 0.0, alpha = 1.0;\r
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\r
  r = dot(cxy, cxy);\r
\r
  delta = fwidth(r);\r
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\r
  // "premultiply" the color by alpha\r
  vec4 color = v_color;\r
  color.a = color.a * alpha;\r
  color.rgb = color.rgb * color.a;\r
  fragColor = color;\r
}`;class Em{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,n){this._gl=t,this._context=n,this._shader=new Ge({gl:t,vertexSource:xm,fragmentSource:bm}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new Ls({gl:t,size:7*this._maxPoints,type:"dynamic"}),this._layout=new Ns({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}draw(t,n,r){this._isFull()&&this.flush(),this._pointCount++;let h=this._context.getTransform(),c=this._context.opacity,f=this._context.snapToPixel,p=h.multiply(t);f&&(p.x=~~(p.x+_t),p.y=~~(p.y+_t));let _=this._buffer.bufferData;_[this._vertexIndex++]=p.x,_[this._vertexIndex++]=p.y,_[this._vertexIndex++]=n.r/255,_[this._vertexIndex++]=n.g/255,_[this._vertexIndex++]=n.b/255,_[this._vertexIndex++]=n.a*c,_[this._vertexIndex++]=r*Math.max(h.getScaleX(),h.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;let t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),jt.DrawnImagesCount+=this._pointCount,jt.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}let Tm=`#version 300 es\r
in vec2 a_position;\r
\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
void main() {\r
  gl_Position = vec4(a_position, 0.0, 1.0);\r
\r
  // Pass the texcoord to the fragment shader.\r
  v_texcoord = a_texcoord;\r
}`,Am=`#version 300 es\r
precision mediump float;\r
\r
// Passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// The texture.\r
uniform sampler2D u_texture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   fragColor = texture(u_texture, v_texcoord);\r
}`;class Cm{constructor(t){this._gl=t,this._shader=new Ge({gl:t,vertexSource:Tm,fragmentSource:Am}),this._shader.compile(),this._buffer=new Ls({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Ns({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){let n=this._gl;t.getShader().use(),t.getLayout().use(),n.drawArrays(n.TRIANGLES,0,6)}renderToScreen(){let t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class zn{constructor(t,n,r){this._logger=et.getInstance(),this._gl=t,this.buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer);let h=n*6;if(!r)this.bufferData=new Uint32Array(h);else{let p=Math.floor(16383.5);this.bufferGlType=t.UNSIGNED_SHORT,this.bufferData=new Uint16Array(h),n>p&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${p}) requested quads(${n})`)}let c=0;for(let f=0;f<h;f+=6)this.bufferData[f+0]=c+0,this.bufferData[f+1]=c+1,this.bufferData[f+2]=c+2,this.bufferData[f+3]=c+2,this.bufferData[f+4]=c+1,this.bufferData[f+5]=c+3,c+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){let t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){let t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}}let Im=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Texture index\r
in lowp float v_textureIndex;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
// Opacity\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   // In order to support the most efficient sprite batching, we have multiple\r
   // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
   // that do not apply to a particular sprite.\r
\r
   vec4 color = vec4(1.0, 0, 0, 1.0);\r
\r
   // GLSL is templated out to pick the right texture and set the vec4 color\r
   %%texture_picker%%\r
\r
   color.rgb = color.rgb * v_opacity;\r
   color.a = color.a * v_opacity;\r
   fragColor = color * v_tint;\r
}`,Sm=`#version 300 es\r
in vec2 a_position;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
// UV coordinate\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
// Texture number\r
in lowp float a_textureIndex;\r
out lowp float v_textureIndex;\r
\r
in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the UV coord to the fragment shader\r
   v_texcoord = a_texcoord;\r
   // Pass through the texture number to the fragment shader\r
   v_textureIndex = a_textureIndex;\r
   // Pass through the tint\r
   v_tint = a_tint;\r
}`;class Pm{constructor(){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._vertexIndex=0}initialize(t,n){this._gl=t,this._context=n,this._maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),125);let r=this._transformFragmentSource(Im,this._maxTextures);this._shader=new Ge({gl:t,fragmentSource:r,vertexSource:Sm}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",n.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((h,c)=>c)),this._buffer=new Ls({gl:t,size:10*4*this._maxImages,type:"dynamic"}),this._layout=new Ns({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new zn(t,this._maxImages,!0)}_transformFragmentSource(t,n){let r=t.replace("%%count%%",n.toString()),h="";for(let c=0;c<n;c++)c===0?h+=`if (v_textureIndex <= ${c}.5) {
`:h+=`   else if (v_textureIndex <= ${c}.5) {
`,h+=`      color = texture(u_textures[${c}], v_texcoord);
`,h+=`   }
`;return r=r.replace("%%texture_picker%%",h),r}_addImageAsTexture(t){let n=t.getAttribute("filtering"),r=null;(n===_e.Blended||n===_e.Pixel)&&(r=n);let h=t.getAttribute("forceUpload")==="true",c=this._context.textureLoader.load(t,r,h);t.removeAttribute("forceUpload"),this._textures.indexOf(c)===-1&&this._textures.push(c)}_bindTextures(t){for(let n=0;n<this._maxTextures;n++)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,this._textures[n]||this._textures[0])}_getTextureIdForImage(t){if(t){let n=this._context.textureLoader.get(t);return this._textures.indexOf(n)}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}draw(t,n,r,h,c,f,p,_,v){var w,E,C,S;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);let k=t?.width||h||0,N=t?.height||c||0,V=[0,0,(w=h??t?.width)!==null&&w!==void 0?w:0,(E=c??t?.height)!==null&&E!==void 0?E:0],D=[n??1,r??1];f!==void 0&&p!==void 0&&_!==void 0&&v!==void 0&&(V=[n??1,r??1,(C=h??t?.width)!==null&&C!==void 0?C:0,(S=c??t?.height)!==null&&S!==void 0?S:0],D=[f,p],k=_,N=v),n=V[0],r=V[1];let R=V[2],z=V[3],G=this._context.getTransform(),st=this._context.opacity,Q=this._context.snapToPixel,F=M(D[0],D[1]),gt=M(D[0]+k,D[1]),Et=M(D[0],D[1]+N),Ct=M(D[0]+k,D[1]+N);F=G.multiply(F),gt=G.multiply(gt),Et=G.multiply(Et),Ct=G.multiply(Ct),Q&&(F.x=~~(F.x+_t),F.y=~~(F.y+_t),gt.x=~~(gt.x+_t),gt.y=~~(gt.y+_t),Et.x=~~(Et.x+_t),Et.y=~~(Et.y+_t),Ct.x=~~(Ct.x+_t),Ct.y=~~(Ct.y+_t));let vt=this._context.tint,Xt=this._getTextureIdForImage(t),Be=t.width||k,Le=t.height||N,Ne=n/Be,vs=r/Le,ys=(n+R-.01)/Be,ws=(r+z-.01)/Le,rt=this._layout.vertexBuffer.bufferData;rt[this._vertexIndex++]=F.x,rt[this._vertexIndex++]=F.y,rt[this._vertexIndex++]=st,rt[this._vertexIndex++]=Ne,rt[this._vertexIndex++]=vs,rt[this._vertexIndex++]=Xt,rt[this._vertexIndex++]=vt.r/255,rt[this._vertexIndex++]=vt.g/255,rt[this._vertexIndex++]=vt.b/255,rt[this._vertexIndex++]=vt.a,rt[this._vertexIndex++]=Et.x,rt[this._vertexIndex++]=Et.y,rt[this._vertexIndex++]=st,rt[this._vertexIndex++]=Ne,rt[this._vertexIndex++]=ws,rt[this._vertexIndex++]=Xt,rt[this._vertexIndex++]=vt.r/255,rt[this._vertexIndex++]=vt.g/255,rt[this._vertexIndex++]=vt.b/255,rt[this._vertexIndex++]=vt.a,rt[this._vertexIndex++]=gt.x,rt[this._vertexIndex++]=gt.y,rt[this._vertexIndex++]=st,rt[this._vertexIndex++]=ys,rt[this._vertexIndex++]=vs,rt[this._vertexIndex++]=Xt,rt[this._vertexIndex++]=vt.r/255,rt[this._vertexIndex++]=vt.g/255,rt[this._vertexIndex++]=vt.b/255,rt[this._vertexIndex++]=vt.a,rt[this._vertexIndex++]=Ct.x,rt[this._vertexIndex++]=Ct.y,rt[this._vertexIndex++]=st,rt[this._vertexIndex++]=ys,rt[this._vertexIndex++]=ws,rt[this._vertexIndex++]=Xt,rt[this._vertexIndex++]=vt.r/255,rt[this._vertexIndex++]=vt.g/255,rt[this._vertexIndex++]=vt.b/255,rt[this._vertexIndex++]=vt.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;let t=this._gl;this._shader.use(),this._layout.use(!0,4*10*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),jt.DrawnImagesCount+=this._imageCount,jt.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0}}let Rm=`#version 300 es\r
\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
in vec2 v_size; // in pixels\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness; // in pixels\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r
    vec2 uv = v_uv;\r
    vec2 fragCoord = uv * v_size;\r
    float maxX = v_size.x - v_strokeThickness;\r
    float minX = v_strokeThickness;\r
    float maxY = v_size.y - v_strokeThickness;\r
    float minY = v_strokeThickness;\r
\r
    if (fragCoord.x < maxX && fragCoord.x > minX &&\r
        fragCoord.y < maxY && fragCoord.y > minY) {\r
      fragColor = v_color;\r
    } else {\r
      fragColor = v_strokeColor;\r
    }\r
    fragColor.a *= v_opacity;\r
    fragColor.rgb *= fragColor.a;\r
\r
    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\r
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\r
\r
    // float fHalfBorderDist      = 0.0;\r
    // float fHalfBorderThickness = 0.0;\r
\r
    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \r
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \r
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else\r
    // {\r
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\r
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\r
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\r
        \r
    //     float ellipse_ab    = v_radius-v_strokeThickness;\r
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\r
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \r
            \r
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\r
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\r
    // }\r
\r
    // vec4 v4FromColor = v_strokeColor;\r
    // v4FromColor.rgb *= v4FromColor.a;\r
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\r
    // if (fHalfBorderDist < 0.0) {\r
    //     v4ToColor = v_color;\r
    //     v4ToColor.rgb *= v4ToColor.a;\r
    // }\r
\r
    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\r
\r
    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\r
    // gl_FragColor = finalColor;\r
}`,Dm=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
in vec2 a_size;\r
out vec2 v_size;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through size\r
   v_size = a_size;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class km{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0}initialize(t,n){this._gl=t,this._context=n,this._shader=new Ge({gl:t,fragmentSource:Rm,vertexSource:Dm}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",n.ortho),this._buffer=new Ls({gl:t,size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new Ns({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new zn(t,this._maxRectangles,!0)}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof I&&t[1]instanceof I?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,n,r,h=1){this._isFull()&&this.flush(),this._rectangleCount++;let c=this._context.getTransform(),f=this._context.opacity,p=this._context.snapToPixel,_=n.sub(t),v=_.size,w=_.normalize().perpendicular(),E=h/2,C=c.multiply(w.scale(E).add(t)),S=c.multiply(w.scale(-E).add(t)),k=c.multiply(w.scale(E).add(n)),N=c.multiply(w.scale(-E).add(n));p&&(C.x=~~(C.x+_t),C.y=~~(C.y+_t),k.x=~~(k.x+_t),k.y=~~(k.y+_t),S.x=~~(S.x+_t),S.y=~~(S.y+_t),N.x=~~(N.x+_t),N.y=~~(N.y+_t));let V=0,D=0,R=1,z=1,G=O.Transparent,st=0,Q=1,F=this._layout.vertexBuffer.bufferData;F[this._vertexIndex++]=C.x,F[this._vertexIndex++]=C.y,F[this._vertexIndex++]=V,F[this._vertexIndex++]=D,F[this._vertexIndex++]=v,F[this._vertexIndex++]=h,F[this._vertexIndex++]=f,F[this._vertexIndex++]=r.r/255,F[this._vertexIndex++]=r.g/255,F[this._vertexIndex++]=r.b/255,F[this._vertexIndex++]=r.a,F[this._vertexIndex++]=G.r/255,F[this._vertexIndex++]=G.g/255,F[this._vertexIndex++]=G.b/255,F[this._vertexIndex++]=G.a,F[this._vertexIndex++]=st/Q,F[this._vertexIndex++]=S.x,F[this._vertexIndex++]=S.y,F[this._vertexIndex++]=V,F[this._vertexIndex++]=z,F[this._vertexIndex++]=v,F[this._vertexIndex++]=h,F[this._vertexIndex++]=f,F[this._vertexIndex++]=r.r/255,F[this._vertexIndex++]=r.g/255,F[this._vertexIndex++]=r.b/255,F[this._vertexIndex++]=r.a,F[this._vertexIndex++]=G.r/255,F[this._vertexIndex++]=G.g/255,F[this._vertexIndex++]=G.b/255,F[this._vertexIndex++]=G.a,F[this._vertexIndex++]=st/Q,F[this._vertexIndex++]=k.x,F[this._vertexIndex++]=k.y,F[this._vertexIndex++]=R,F[this._vertexIndex++]=D,F[this._vertexIndex++]=v,F[this._vertexIndex++]=h,F[this._vertexIndex++]=f,F[this._vertexIndex++]=r.r/255,F[this._vertexIndex++]=r.g/255,F[this._vertexIndex++]=r.b/255,F[this._vertexIndex++]=r.a,F[this._vertexIndex++]=G.r/255,F[this._vertexIndex++]=G.g/255,F[this._vertexIndex++]=G.b/255,F[this._vertexIndex++]=G.a,F[this._vertexIndex++]=st/Q,F[this._vertexIndex++]=N.x,F[this._vertexIndex++]=N.y,F[this._vertexIndex++]=R,F[this._vertexIndex++]=z,F[this._vertexIndex++]=v,F[this._vertexIndex++]=h,F[this._vertexIndex++]=f,F[this._vertexIndex++]=r.r/255,F[this._vertexIndex++]=r.g/255,F[this._vertexIndex++]=r.b/255,F[this._vertexIndex++]=r.a,F[this._vertexIndex++]=G.r/255,F[this._vertexIndex++]=G.g/255,F[this._vertexIndex++]=G.b/255,F[this._vertexIndex++]=G.a,F[this._vertexIndex++]=st/Q}drawRectangle(t,n,r,h,c=O.Transparent,f=0){this._isFull()&&this.flush(),this._rectangleCount++;let p=this._context.getTransform(),_=this._context.opacity,v=this._context.snapToPixel,w=p.multiply(t.add(M(0,0))),E=p.multiply(t.add(M(n,0))),C=p.multiply(t.add(M(n,r))),S=p.multiply(t.add(M(0,r)));v&&(w.x=~~(w.x+_t),w.y=~~(w.y+_t),E.x=~~(E.x+_t),E.y=~~(E.y+_t),S.x=~~(S.x+_t),S.y=~~(S.y+_t),C.x=~~(C.x+_t),C.y=~~(C.y+_t));let k=0,N=0,V=1,D=1,R=this._layout.vertexBuffer.bufferData;R[this._vertexIndex++]=w.x,R[this._vertexIndex++]=w.y,R[this._vertexIndex++]=k,R[this._vertexIndex++]=N,R[this._vertexIndex++]=n,R[this._vertexIndex++]=r,R[this._vertexIndex++]=_,R[this._vertexIndex++]=h.r/255,R[this._vertexIndex++]=h.g/255,R[this._vertexIndex++]=h.b/255,R[this._vertexIndex++]=h.a,R[this._vertexIndex++]=c.r/255,R[this._vertexIndex++]=c.g/255,R[this._vertexIndex++]=c.b/255,R[this._vertexIndex++]=c.a,R[this._vertexIndex++]=f,R[this._vertexIndex++]=S.x,R[this._vertexIndex++]=S.y,R[this._vertexIndex++]=k,R[this._vertexIndex++]=D,R[this._vertexIndex++]=n,R[this._vertexIndex++]=r,R[this._vertexIndex++]=_,R[this._vertexIndex++]=h.r/255,R[this._vertexIndex++]=h.g/255,R[this._vertexIndex++]=h.b/255,R[this._vertexIndex++]=h.a,R[this._vertexIndex++]=c.r/255,R[this._vertexIndex++]=c.g/255,R[this._vertexIndex++]=c.b/255,R[this._vertexIndex++]=c.a,R[this._vertexIndex++]=f,R[this._vertexIndex++]=E.x,R[this._vertexIndex++]=E.y,R[this._vertexIndex++]=V,R[this._vertexIndex++]=N,R[this._vertexIndex++]=n,R[this._vertexIndex++]=r,R[this._vertexIndex++]=_,R[this._vertexIndex++]=h.r/255,R[this._vertexIndex++]=h.g/255,R[this._vertexIndex++]=h.b/255,R[this._vertexIndex++]=h.a,R[this._vertexIndex++]=c.r/255,R[this._vertexIndex++]=c.g/255,R[this._vertexIndex++]=c.b/255,R[this._vertexIndex++]=c.a,R[this._vertexIndex++]=f,R[this._vertexIndex++]=C.x,R[this._vertexIndex++]=C.y,R[this._vertexIndex++]=V,R[this._vertexIndex++]=D,R[this._vertexIndex++]=n,R[this._vertexIndex++]=r,R[this._vertexIndex++]=_,R[this._vertexIndex++]=h.r/255,R[this._vertexIndex++]=h.g/255,R[this._vertexIndex++]=h.b/255,R[this._vertexIndex++]=h.a,R[this._vertexIndex++]=c.r/255,R[this._vertexIndex++]=c.g/255,R[this._vertexIndex++]=c.b/255,R[this._vertexIndex++]=c.a,R[this._vertexIndex++]=f}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;let t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),jt.DrawnImagesCount+=this._rectangleCount,jt.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}let Mm=`#version 300 es\r
precision highp float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness;\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // make (0, 0) the center the uv \r
  vec2 uv = v_uv * 2.0 - 1.0;\r
\r
  vec4 color = v_color;\r
  vec4 strokeColor = v_strokeColor;\r
\r
  // circle border is at radius 1.0 \r
  // dist is > 0 when inside the circle \r
  float d = length(uv);\r
  float dist = 1.0 - length(uv);\r
\r
  // Fade based on fwidth\r
  float fade = fwidth(dot(uv, uv));\r
\r
  // if dist is greater than 0 step to 1;\r
  // when we cross this 0 threshold add a smooth fade\r
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\r
\r
  // if dist is greater than the stroke thickness step to 1\r
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\r
\r
  strokeColor.a *= fill * stroke;\r
  strokeColor.rgb *= strokeColor.a;\r
\r
  color.a *= fill * (1.0 - stroke);\r
  color.rgb *= color.a;\r
\r
  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\r
  finalColor.rgb = finalColor.rgb * v_opacity;\r
  finalColor.a = finalColor.a * v_opacity;\r
  fragColor = finalColor;\r
}`,Fm=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class Bm{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,n){this._gl=t,this._context=n,this._shader=new Ge({gl:t,fragmentSource:Mm,vertexSource:Fm}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",n.ortho),this._buffer=new Ls({gl:t,size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new Ns({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new zn(t,this._maxCircles,!0)}_isFull(){return this._circleCount>=this._maxCircles}draw(t,n,r,h=O.Transparent,c=0){this._isFull()&&this.flush(),this._circleCount++;let f=this._context.getTransform(),p=this._context.opacity,_=this._context.snapToPixel,v=f.multiply(t.add(M(-n,-n))),w=f.multiply(t.add(M(n,-n))),E=f.multiply(t.add(M(n,n))),C=f.multiply(t.add(M(-n,n)));_&&(v.x=~~(v.x+_t),v.y=~~(v.y+_t),w.x=~~(w.x+_t),w.y=~~(w.y+_t),C.x=~~(C.x+_t),C.y=~~(C.y+_t),E.x=~~(E.x+_t),E.y=~~(E.y+_t));let S=0,k=0,N=1,V=1,D=this._layout.vertexBuffer.bufferData;D[this._vertexIndex++]=v.x,D[this._vertexIndex++]=v.y,D[this._vertexIndex++]=S,D[this._vertexIndex++]=k,D[this._vertexIndex++]=p,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=h.r/255,D[this._vertexIndex++]=h.g/255,D[this._vertexIndex++]=h.b/255,D[this._vertexIndex++]=h.a,D[this._vertexIndex++]=c/n,D[this._vertexIndex++]=C.x,D[this._vertexIndex++]=C.y,D[this._vertexIndex++]=S,D[this._vertexIndex++]=V,D[this._vertexIndex++]=p,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=h.r/255,D[this._vertexIndex++]=h.g/255,D[this._vertexIndex++]=h.b/255,D[this._vertexIndex++]=h.a,D[this._vertexIndex++]=c/n,D[this._vertexIndex++]=w.x,D[this._vertexIndex++]=w.y,D[this._vertexIndex++]=N,D[this._vertexIndex++]=k,D[this._vertexIndex++]=p,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=h.r/255,D[this._vertexIndex++]=h.g/255,D[this._vertexIndex++]=h.b/255,D[this._vertexIndex++]=h.a,D[this._vertexIndex++]=c/n,D[this._vertexIndex++]=E.x,D[this._vertexIndex++]=E.y,D[this._vertexIndex++]=N,D[this._vertexIndex++]=V,D[this._vertexIndex++]=p,D[this._vertexIndex++]=r.r/255,D[this._vertexIndex++]=r.g/255,D[this._vertexIndex++]=r.b/255,D[this._vertexIndex++]=r.a,D[this._vertexIndex++]=h.r/255,D[this._vertexIndex++]=h.g/255,D[this._vertexIndex++]=h.b/255,D[this._vertexIndex++]=h.a,D[this._vertexIndex++]=c/n}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;let t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),jt.DrawnImagesCount+=this._circleCount,jt.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class bd{constructor(t,n,r=100){this.builder=t,this.recycler=n,this.maxObjects=r,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=et.getInstance()}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){let n=t(this);return n?this.done(...n):this.done()}borrow(t){let n=this.get();t(n),this.index--}get(...t){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler(this.objects[this.index++],...t):(this.totalAllocations++,this.objects[this.index++]=this.builder(...t))}done(...t){this.index=0;for(let n of t){let r=this.objects.indexOf(n);this.objects[r]=this.builder(),this.totalAllocations++}return t}}class Lm{constructor(){this.z=0,this.priority=0,this.transform=qt.identity(),this.state={z:0,opacity:1,tint:O.White,material:null}}}let Nm=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
}
`;class Ed{constructor(t){this._color=O.Transparent,this._initialized=!1;let{color:n,name:r,vertexSource:h,fragmentSource:c}=t;this._name=r,this._vertexSource=h??Nm,this._fragmentSource=c,this._color=n??this._color}initialize(t,n){this._initialized||(this._shader=n.createShader({vertexSource:this._vertexSource,fragmentSource:this._fragmentSource}),this._shader.compile(),this._initialized=!0)}get name(){var t;return(t=this._name)!==null&&t!==void 0?t:"anonymous material"}getShader(){return this._shader}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}class Vm{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(t,n){this._gl=t,this._context=n,this._buffer=new Ls({gl:t,size:4*4,type:"dynamic"}),this._layout=new Ns({gl:t,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2]]}),this._quads=new zn(t,1,!0)}draw(t,n,r,h,c,f,p,_,v){var w,E,C,S;let k=this._gl,N=this._context.material;N.initialize(k,this._context);let V=this._context.getTransform(),D=this._context.opacity,R=N.getShader(),z=this._layout.vertexBuffer.bufferData,G=0,st=t?.width||h||0,Q=t?.height||c||0,F=[0,0,(w=h??t?.width)!==null&&w!==void 0?w:0,(E=c??t?.height)!==null&&E!==void 0?E:0],gt=[n??1,r??1];f!==void 0&&p!==void 0&&_!==void 0&&v!==void 0&&(F=[n??1,r??1,(C=h??t?.width)!==null&&C!==void 0?C:0,(S=c??t?.height)!==null&&S!==void 0?S:0],gt=[f,p],st=_,Q=v),n=F[0],r=F[1];let Et=F[2],Ct=F[3],vt=M(gt[0],gt[1]),Xt=M(gt[0]+st,gt[1]),Be=M(gt[0],gt[1]+Q),Le=M(gt[0]+st,gt[1]+Q),Ne=t.width||st,vs=t.height||Q,ys=n/Ne,ws=r/vs,rt=(n+Et-.01)/Ne,yi=(r+Ct-.01)/vs;z[G++]=vt.x,z[G++]=vt.y,z[G++]=ys,z[G++]=ws,z[G++]=Be.x,z[G++]=Be.y,z[G++]=ys,z[G++]=yi,z[G++]=Xt.x,z[G++]=Xt.y,z[G++]=rt,z[G++]=ws,z[G++]=Le.x,z[G++]=Le.y,z[G++]=rt,z[G++]=yi;let Fo=this._addImageAsTexture(t);N.use(),this._layout.shader=R,this._layout.use(!0),R.trySetUniformFloat("u_opacity",D),R.trySetUniformFloatVector("u_resolution",M(this._context.width,this._context.height)),R.trySetUniformFloatVector("u_size",M(Et,Ct)),R.trySetUniformMatrix("u_matrix",this._context.ortho),R.trySetUniformMatrix("u_transform",V.to4x4()),k.activeTexture(k.TEXTURE0+0),k.bindTexture(k.TEXTURE_2D,Fo),R.trySetUniformInt("u_graphic",0),this._quads.bind(),k.drawElements(k.TRIANGLES,6,this._quads.bufferGlType,0)}_addImageAsTexture(t){let n=t.getAttribute("filtering"),r=null;(n===_e.Blended||n===_e.Pixel)&&(r=n);let h=t.getAttribute("forceUpload")==="true",c=this._context.textureLoader.load(t,r,h);return t.removeAttribute("forceUpload"),this._textures.indexOf(c)===-1&&this._textures.push(c),c}hasPendingDraws(){return!1}flush(){}}let _t=1e-4;class Om{constructor(t){this._webglCtx=t,this._debugText=new kh}drawRect(t,n,r,h,c={color:O.Black}){this.drawLine(M(t,n),M(t+r,n),{...c}),this.drawLine(M(t+r,n),M(t+r,n+h),{...c}),this.drawLine(M(t+r,n+h),M(t,n+h),{...c}),this.drawLine(M(t,n+h),M(t,n),{...c})}drawLine(t,n,r={color:O.Black}){this._webglCtx.draw("ex.line",t,n,r.color)}drawPoint(t,n={color:O.Black,size:5}){this._webglCtx.draw("ex.point",t,n.color,n.size)}drawText(t,n){this._debugText.write(this._webglCtx,t,n)}}class Qs{get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let n=!0;return(t.width>4096||t.height>4096)&&(n=!1),n}constructor(t){this._logger=et.getInstance(),this._renderers=new Map,this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new bd(()=>new Lm,_=>(_.priority=0,_.z=0,_.renderer=void 0,_.args=void 0,_),4e3),this._drawCalls=[],this._postProcessTargets=[],this._postprocessors=[],this._transform=new pm,this._state=new vd,this.snapToPixel=!1,this.smoothing=!1,this.backgroundColor=O.ExcaliburBlue,this._alreadyWarnedDrawLifecycle=!1,this.debug=new Om(this),this._totalPostProcessorTime=0;let{canvasElement:n,enableTransparency:r,smoothing:h,snapToPixel:c,backgroundColor:f,useDrawSorting:p}=t;if(this.__gl=n.getContext("webgl2",{antialias:h??this.smoothing,premultipliedAlpha:!1,alpha:r??!0,depth:!0,powerPreference:"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");this.textureLoader=new he(this.__gl),this.snapToPixel=c??this.snapToPixel,this.smoothing=h??this.smoothing,this.backgroundColor=f??this.backgroundColor,this.useDrawSorting=p??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}_init(){let t=this.__gl;this._ortho=Re.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.register(new Pm),this.register(new Vm),this.register(new km),this.register(new Bm),this.register(new Em),this.register(new wm),this._screenRenderer=new Cm(t),this._renderTarget=new Mh({gl:t,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new Mh({gl:t,width:t.canvas.width,height:t.canvas.height}),new Mh({gl:t,width:t.canvas.width,height:t.canvas.height})]}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}get(t){return this._renderers.get(t)}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...n){!this._isDrawLifecycle&&!this._alreadyWarnedDrawLifecycle&&(this._logger.warn(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._alreadyWarnedDrawLifecycle=!0);let r=this._renderers.get(t);if(r)if(this.useDrawSorting){let h=this._drawCallPool.get();h.z=this._state.current.z,h.priority=r.priority,h.renderer=t,this.getTransform().clone(h.transform),h.state.z=this._state.current.z,h.state.opacity=this._state.current.opacity,h.state.tint=this._state.current.tint,h.state.material=this._state.current.material,h.args=n,this._drawCalls.push(h)}else this._currentRenderer||(this._currentRenderer=r),this._isCurrentRenderer(r)||this._currentRenderer.flush(),r.draw(...n),this._currentRenderer=r;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.current=qt.identity()}updateViewport(t){let n=this.__gl;this._ortho=this._ortho=Re.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(n.canvas.width,n.canvas.height),this._postProcessTargets[0].setResolution(n.canvas.width,n.canvas.height),this._postProcessTargets[1].setResolution(n.canvas.width,n.canvas.height)}drawImage(t,n,r,h,c,f,p,_,v){if(!(h===0||c===0)){{if(_===0||v===0)return;if(t.width===0||t.height===0)return}if(!t){et.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",t,n,r,h,c,f,p,_,v):this.draw("ex.image",t,n,r,h,c,f,p,_,v)}}drawLine(t,n,r,h=1){this.draw("ex.rectangle",t,n,r,h)}drawRectangle(t,n,r,h,c,f){this.draw("ex.rectangle",t,n,r,h,c,f)}drawCircle(t,n,r,h,c){this.draw("ex.circle",t,n,r,h,c)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,n){this._transform.translate(this.snapToPixel?~~(t+_t):t,this.snapToPixel?~~(n+_t):n)}rotate(t){this._transform.rotate(t)}scale(t,n){this._transform.scale(t,n)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){let n=this._postprocessors.indexOf(t);n!==-1&&this._postprocessors.splice(n,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(t){for(let n of this._postprocessors){let r=n.getShader();r.use();let h=r.getUniforms();this._totalPostProcessorTime+=t,h.find(c=>c.name==="u_time_ms")&&r.setUniformFloat("u_time_ms",this._totalPostProcessorTime),h.find(c=>c.name==="u_elapsed_ms")&&r.setUniformFloat("u_elapsed_ms",t),h.find(c=>c.name==="u_resolution")&&r.setUniformFloatVector("u_resolution",M(this.width,this.height)),n.onUpdate&&n.onUpdate(t)}}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){let n=new Ed(t);return n.initialize(this.__gl,this),n}createShader(t){let n=this.__gl,{vertexSource:r,fragmentSource:h}=t,c=new Ge({gl:n,vertexSource:r,fragmentSource:h});return c.compile(),c}clear(){let t=this.__gl;this._renderTarget.use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){let t=this.__gl;if(this._renderTarget.use(),this.useDrawSorting){let r=new Map;for(let[f]of this._renderers){let p=this._drawCalls.findIndex(_=>_.renderer===f);r.set(f,p)}this._drawCalls.sort((f,p)=>{let _=f.z-p.z,v=r.get(f.renderer)-r.get(p.renderer),w=f.priority-p.priority;return _===0?w===0?v:w:_});let h=this._transform.current,c=this._state.current;if(this._drawCalls.length){let f=this._drawCalls[0].renderer,p=this._renderers.get(f);for(let _=0;_<this._drawCalls.length;_++)this._transform.current=this._drawCalls[_].transform,this._state.current=this._drawCalls[_].state,this._drawCalls[_].renderer!==f&&(p.flush(),f=this._drawCalls[_].renderer,p=this._renderers.get(f)),p.draw(...this._drawCalls[_].args);p.hasPendingDraws()&&p.flush()}this._transform.current=h,this._state.current=c,this._drawCallPool.done(),this._drawCalls.length=0}else for(let r of this._renderers.values())r.hasPendingDraws()&&r.flush();this._renderTarget.disable(),this._renderTarget.toRenderSource().use();for(let r=0;r<this._postprocessors.length;r++)this._postProcessTargets[r%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[r]),this._postProcessTargets[r%2].toRenderSource().use();t.bindFramebuffer(t.FRAMEBUFFER,null),this._screenRenderer.renderToScreen()}}let Nt=1e-4;class Um{constructor(t){this._ex=t,this._debugText=new kh}drawRect(t,n,r,h){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+Nt):t,this._ex.snapToPixel?~~(n+Nt):n,this._ex.snapToPixel?~~(r+Nt):r,this._ex.snapToPixel?~~(h+Nt):h),this._ex.__ctx.restore()}drawLine(t,n,r={color:O.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=r.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+Nt):t.x,this._ex.snapToPixel?~~(t.y+Nt):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(n.x+Nt):n.x,this._ex.snapToPixel?~~(n.y+Nt):n.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,n={color:O.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=n.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+Nt):t.x,this._ex.snapToPixel?~~(t.y+Nt):t.y,n.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,n){this._debugText.write(this._ex,t,n)}}class lo{get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=O.ExcaliburBlue,this._state=new vd,this.snapToPixel=!1,this.debug=new Um(this);let{canvasElement:n,enableTransparency:r,snapToPixel:h,smoothing:c,backgroundColor:f}=t;this.__ctx=n.getContext("2d",{alpha:r??!0}),this.backgroundColor=f??this.backgroundColor,this.snapToPixel=h??this.snapToPixel,this.smoothing=c??this.smoothing}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,n,r,h,c,f,p,_,v){if(h===0||c===0)return;if(_===0||v===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;let w=[t,n,r,h,c,f,p,_,v].filter(E=>E!==void 0).map(E=>typeof E=="number"&&this.snapToPixel?~~E:E);this.__ctx.drawImage.apply(this.__ctx,w),jt.DrawCallCount++,jt.DrawnImagesCount=1}drawLine(t,n,r,h=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=r.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+Nt):t.x,this.snapToPixel?~~(t.y+Nt):t.y),this.__ctx.lineTo(this.snapToPixel?~~(n.x+Nt):n.x,this.snapToPixel?~~(n.y+Nt):n.y),this.__ctx.lineWidth=h,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,n,r,h){this.__ctx.save(),this.__ctx.fillStyle=h.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+Nt):t.x,this.snapToPixel?~~(t.y+Nt):t.y,this.snapToPixel?~~(n+Nt):n,this.snapToPixel?~~(r+Nt):r),this.__ctx.restore()}drawCircle(t,n,r,h,c){this.__ctx.save(),this.__ctx.beginPath(),h&&(this.__ctx.strokeStyle=h.toString()),c&&(this.__ctx.lineWidth=c),this.__ctx.fillStyle=r.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+Nt):t.x,this.snapToPixel?~~(t.y+Nt):t.y,n,0,Math.PI*2),this.__ctx.fill(),h&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save()}restore(){this.__ctx.restore()}translate(t,n){this.__ctx.translate(this.snapToPixel?~~(t+Nt):t,this.snapToPixel?~~(n+Nt):n)}rotate(t){this.__ctx.rotate(t)}scale(t,n){this.__ctx.scale(t,n)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}updatePostProcessors(t){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),jt.clear()}flush(){}}var ee;(function(u){u.Fixed="Fixed",u.FitContainerAndFill="FitContainerAndFill",u.FitScreenAndFill="FitScreenAndFill",u.FitContainerAndZoom="FitContainerAndZoom",u.FitScreenAndZoom="FitScreenAndZoom",u.FitScreen="FitScreen",u.FillScreen="FillScreen",u.FitContainer="FitContainer",u.FillContainer="FillContainer"})(ee||(ee={}));class Bh{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class Lh{constructor(t){var n,r,h;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=et.getInstance(),this._fullscreenChangeHandler=()=>{this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen)},this._pixelRatioChangeHandler=()=>{this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport()},this._resizeHandler=()=>{let c=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(c),this.applyResolutionAndViewport()},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._alreadyWarned=!1,this._contentArea=new ot,this.viewport=t.viewport,this.resolution=(n=t.resolution)!==null&&n!==void 0?n:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(r=t.displayMode)!==null&&r!==void 0?r:ee.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(h=t.antialiasing)!==null&&h!==void 0?h:this._antialiasing,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._resizeHandler),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler))}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case ee.FillContainer:case ee.FitContainer:case ee.FitContainerAndFill:case ee.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()}applyResolutionAndViewport(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this.graphicsContext instanceof Qs&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&!this._alreadyWarned&&(this._alreadyWarned=!0,this._logger.warn(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)),this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof lo&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio)}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(t){if(t){let n=document.getElementById(t);if(n)return n.requestFullscreen()}return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}pageToScreenCoordinates(t){let n=t.x,r=t.y;if(this._isFullScreen||(n-=Un(this._canvas).x,r-=Un(this._canvas).y),this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){let h=window.innerWidth/this.aspectRatio,c=(window.innerHeight-h)/2;r=(r-c)/h*this.viewport.height,n=n/window.innerWidth*this.viewport.width}else{let h=window.innerHeight*this.aspectRatio,c=(window.innerWidth-h)/2;n=(n-c)/h*this.viewport.width,r=r/window.innerHeight*this.viewport.height}return n=n/this.viewport.width*this.resolution.width,r=r/this.viewport.height*this.resolution.height,new I(n,r)}screenToPageCoordinates(t){let n=t.x,r=t.y;if(n=n/this.resolution.width*this.viewport.width,r=r/this.resolution.height*this.viewport.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){let h=window.innerWidth/this.aspectRatio,c=(window.innerHeight-h)/2;r=r/this.viewport.height*h+c,n=n/this.viewport.width*window.innerWidth}else{let h=window.innerHeight*this.aspectRatio,c=(window.innerWidth-h)/2;n=n/this.viewport.width*h+c,r=r/this.viewport.height*window.innerHeight}return this._isFullScreen||(n+=Un(this._canvas).x,r+=Un(this._canvas).y),new I(n,r)}screenToWorldCoordinates(t){return this._camera?this._camera.inverse.multiply(t):t.sub(M(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(M(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){let n=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(n)}worldToPageCoordinates(t){let n=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(n)}getWorldBounds(){return ot.fromDimension(this.resolution.width,this.resolution.height,I.Half).scale(M(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.pos)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return M(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";let t=this.aspectRatio,n=0,r=0;window.innerWidth/t<window.innerHeight?(n=window.innerWidth,r=window.innerWidth/t):(n=window.innerHeight*t,r=window.innerHeight),this.viewport={width:n,height:r},this._contentArea=ot.fromDimension(this.resolution.width,this.resolution.height,I.Zero)}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";let t=window.innerWidth,n=window.innerHeight;this._computeFitAndFill(t,n)}_computeFitContainerAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";let t=this.canvas.parentElement,n=t.clientWidth,r=t.clientHeight;this._computeFitAndFill(n,r)}_computeFitAndFill(t,n){if(this.viewport={width:t,height:n},t/n<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*n/t};let r=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new ot({top:r,left:0,right:this._contentResolution.width,bottom:this.resolution.height-r})}else{this.resolution={width:n*this._contentResolution.height/n*t/n,height:n*this._contentResolution.height/n};let r=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new ot({top:0,left:r,right:this.resolution.width-r,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";let t=window.innerWidth,n=window.innerHeight;this._computeFitAndZoom(t,n)}_computeFitContainerAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";let t=this.canvas.parentElement;t.style.position="relative",t.style.overflow="hidden";let n=t.clientWidth,r=t.clientHeight;this._computeFitAndZoom(n,r)}_computeFitAndZoom(t,n){let r=this.aspectRatio,h=0,c=0;t/r<n?(h=t,c=t/r):(h=n*r,c=n);let f=t/h,p=n/c,_=Math.max(f,p),v=h*_,w=c*_;v>t?this.canvas.style.left=-(v-t)/2+"px":this.canvas.style.left="",w>n?this.canvas.style.top=-(w-n)/2+"px":this.canvas.style.top="",this.viewport={width:v,height:w};let E=ot.fromDimension(this.viewport.width,this.viewport.height,I.Zero);if(this.viewport.width>t){let C=(this.viewport.width-t)/this.viewport.width*this.resolution.width;E.top=0,E.left=C/2,E.right=this.resolution.width-C/2,E.bottom=this.resolution.height}if(this.viewport.height>n){let C=(this.viewport.height-n)/this.viewport.height*this.resolution.height;E.top=C/2,E.left=0,E.bottom=this.resolution.height-C/2,E.right=this.resolution.width}this._contentArea=E}_computeFitContainer(){let t=this.aspectRatio,n=0,r=0,h=this.canvas.parentElement;h.clientWidth/t<h.clientHeight?(n=h.clientWidth,r=h.clientWidth/t):(n=h.clientHeight*t,r=h.clientHeight),this.viewport={width:n,height:r},this._contentArea=ot.fromDimension(this.resolution.width,this.resolution.height,I.Zero)}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===ee.FillContainer&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===ee.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=ot.fromDimension(this.resolution.width,this.resolution.height,I.Zero),this.displayMode===ee.FitScreen&&this._computeFit(),this.displayMode===ee.FitContainer&&this._computeFitContainer(),this.displayMode===ee.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===ee.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===ee.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===ee.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class $i{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}$i._INSTANCE=null;function zm(u){return!!u.playbackState}class di{static unlock(){return new Promise((n,r)=>{if(di._UNLOCKED||!$i.create())return n(!0);let h=setTimeout(()=>{et.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),n(!1)},200),c=$i.create();c.resume().then(()=>{let f=c.createBuffer(1,1,22050),p=c.createBufferSource(),_=!1;p.buffer=f,p.connect(c.destination),p.onended=()=>_=!0,p.start(0),setTimeout(()=>{zm(p)?(p.playbackState===p.PLAYING_STATE||p.playbackState===p.FINISHED_STATE)&&(di._UNLOCKED=!0):(c.currentTime>0||_)&&(di._UNLOCKED=!0)},0),clearTimeout(h),n(!0)},()=>{r()})})}static isUnlocked(){return this._UNLOCKED}}di._UNLOCKED=!1;function Nh(u,t=O.Red,n,r,h,c,f=1,p="butt"){u.save(),u.beginPath(),u.lineWidth=f,u.lineCap=p,u.strokeStyle=t.toString(),u.moveTo(n,r),u.lineTo(h,c),u.closePath(),u.stroke(),u.restore()}function Gm(u,t=O.Red,n){u.beginPath(),u.strokeStyle=t.toString(),u.arc(n.x,n.y,5,0,Math.PI*2),u.closePath(),u.stroke()}function Hm(u,t,n,r,h=1){let c=t?t.toString():"blue",f=r.scale(h);u.beginPath(),u.strokeStyle=c,u.moveTo(n.x,n.y),u.lineTo(n.x+f.x,n.y+f.y),u.closePath(),u.stroke()}function Vh(u,t,n,r,h,c=5,f=O.White,p=null){let _;if(typeof c=="number")_={tl:c,tr:c,br:c,bl:c};else{let v={tl:0,tr:0,br:0,bl:0};for(let w in v)if(v.hasOwnProperty(w)){let E=w;_[E]=c[E]||v[E]}}u.beginPath(),u.moveTo(t+_.tl,n),u.lineTo(t+r-_.tr,n),u.quadraticCurveTo(t+r,n,t+r,n+_.tr),u.lineTo(t+r,n+h-_.br),u.quadraticCurveTo(t+r,n+h,t+r-_.br,n+h),u.lineTo(t+_.bl,n+h),u.quadraticCurveTo(t,n+h,t,n+h-_.bl),u.lineTo(t,n+_.tl),u.quadraticCurveTo(t,n,t+_.tl,n),u.closePath(),p&&(u.fillStyle=p.toString(),u.fill()),f&&(u.strokeStyle=f.toString(),u.stroke())}function Wm(u,t,n,r,h=O.White,c=null){u.beginPath(),u.arc(t,n,r,0,Math.PI*2),u.closePath(),c&&(u.fillStyle=c.toString(),u.fill()),h&&(u.strokeStyle=h.toString(),u.stroke())}let qm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=";var jm=Ft(1388);class Ki extends De{constructor(t){var n,r,h,c,f,p,_,v,w,E;super(t),this.filtering=null,this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=li(O.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(n=t.quality)!==null&&n!==void 0?n:this.quality,this.color=(r=t.color)!==null&&r!==void 0?r:O.Black,this.strokeColor=t?.strokeColor,this.smoothing=(h=t.smoothing)!==null&&h!==void 0?h:this.smoothing,this.lineWidth=(c=t.lineWidth)!==null&&c!==void 0?c:this.lineWidth,this.lineDash=(f=t.lineDash)!==null&&f!==void 0?f:this.lineDash,this.lineCap=(p=t.lineCap)!==null&&p!==void 0?p:this.lineCap,this.padding=(_=t.padding)!==null&&_!==void 0?_:this.padding,this.filtering=(v=t.filtering)!==null&&v!==void 0?v:this.filtering),this._bitmap=document.createElement("canvas");let C=(w=t?.width)!==null&&w!==void 0?w:this._bitmap.width,S=(E=t?.height)!==null&&E!==void 0?E:this._bitmap.height;this.width=C,this.height=S;let k=this._bitmap.getContext("2d");if(k)this._ctx=k;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!==null&&t!==void 0?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!==null&&t!==void 0?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return ot.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,I.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=li(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),this._strokeColor=li(t,()=>this.flagDirty())}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(t){var n,r,h;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((n=this.lineDash)!==null&&n!==void 0?n:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(r=this.strokeColor)===null||r===void 0?void 0:r.toString(),t.fillStyle=(h=this.color)===null||h===void 0?void 0:h.toString()}_drawImage(t,n,r){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,n,r)}}class co extends Ki{get ctx(){return this._ctx}constructor(t){super(t),this._options=t}clone(){return new co({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var n,r;!((n=this._options)===null||n===void 0)&&n.draw&&((r=this._options)===null||r===void 0||r.draw(t)),this._options.cache||this.flagDirty()}}class Oh{}Oh.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class uo{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,n){let r=new uo;r.data=n;for(let h in t.states)r.states.set(h,{name:h,...t.states[h]});for(let h of r.states.values())for(let c of h.transitions)if(c!=="*"&&!r.states.has(c))throw Error(`Invalid state machine, state [${h.name}] has a transition to another state that doesn't exist [${c}]`);return r.currentState=r.startState=r.states.get(t.start),r}in(t){return this.currentState.name===t}go(t,n){var r,h;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){let c=this.states.get(t);return this.currentState.onExit&&((r=this.currentState)===null||r===void 0?void 0:r.onExit({to:c.name,data:this.data}))===!1||c?.onEnter&&c?.onEnter({from:this.currentState.name,eventData:n,data:this.data})===!1?!1:(this.currentState=c,!((h=this.currentState)===null||h===void 0)&&h.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){let n=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(n.currentState),this.data=n.data}}class Td{_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingResolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingResolve(!0)}))}get loop(){return this._loop}set volume(t){t=Pe(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!==null&&t!==void 0?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}constructor(t){this._src=t,this._audioContext=$i.create(),this._volumeNode=this._audioContext.createGain(),this._playingPromise=new Promise(n=>{this._playingResolve=n}),this._stateMachine=uo.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:n})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,n.pausedAt*this._playbackRate):this._instance.start(0,n.pausedAt*this._playbackRate,this.duration),n.startedAt=this._audioContext.currentTime-n.pausedAt,n.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:n})=>{n==="STOPPED"&&this._playingResolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:n,data:r})=>{r.pausedAt=(n??0)/this._playbackRate,r.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:n})=>{n.pausedAt=0,n.startedAt=0,this._playingResolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:n})=>{n.pausedAt=this._audioContext.currentTime-n.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingPromise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){let{pausedAt:t,startedAt:n}=this._stateMachine.data;return t?t*this._playbackRate:n?(this._audioContext.currentTime-n)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}class Uh extends T{set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}constructor(t,n="MediaEvent"){super(),this.target=t,this._name=n}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Xs extends Uh{constructor(t,n){super(t,"NativeSoundEvent"),this.track=n}}class Ad extends Uh{constructor(t,n){super(t,"NativeSoundProcessedEvent"),this._processedData=n,this.data=this._processedData}}function $m(u){try{let t=new Audio,n=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,r=u.match(n)[1];return!!t.canPlayType("audio/"+r)}catch(t){return et.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}let Km={VolumeChange:"volumechange",Processed:"processed",Pause:"pause",Stop:"stop",PlaybackEnd:"playbackend",Resume:"resume",PlaybackStart:"playbackstart"};class Cd{set loop(t){this._loop=t;for(let n of this._tracks)n.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(let n of this._tracks)n.volume=this._volume;this.events.emit("volumechange",new Xs(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}constructor(...t){this.events=new x,this.logger=et.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=$i.create(),this._resource=new ao("",Oh.type.arraybuffer);for(let n of t)if($m(n)){this.path=n;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}isLoaded(){return!!this.data}async load(){var t,n;if(this.data)return this.data;let r=await this._resource.load(),h=await this.decodeAudio(r.slice(0));return this._duration=(n=(t=this._duration)!==null&&t!==void 0?t:h?.duration)!==null&&n!==void 0?n:void 0,this.events.emit("processed",new Ad(this,h)),this.data=h}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(let t of this._tracks)t.pause();this.events.emit("pause",new Xs(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(let t of this._tracks)t.stop();this.events.emit("stop",new Xs(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(n=>{n.playbackRate=this._playbackRate})}seek(t,n=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[n].seek(t)}getTotalPlaybackDuration(){return this.data.duration}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused){let t=[];for(let n of this._tracks)t.push(n.play().then(()=>(this.events.emit("playbackend",new Xs(this,n)),this._tracks.splice(this.getTrackId(n),1),!0)));this.events.emit("resume",new Xs(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){let t=await this._getTrackInstance(this.data),n=await t.play(()=>{this.events.emit("playbackstart",new Xs(this,t)),this.logger.debug("Playing new instance for sound",this.path)});return this.events.emit("playbackend",new Xs(this,t)),this._tracks.splice(this.getTrackId(t),1),n}_getTrackInstance(t){let n=new Td(t);return n.loop=this.loop,n.volume=this.volume,n.duration=this.duration,n.playbackRate=this._playbackRate,this._tracks.push(n),n}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}}let Qm={};class Id{get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){let t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}constructor(t){this.events=new x,this.canvas=new co({filtering:_e.Blended,smoothing:!0,cache:!0,draw:this.draw.bind(this)}),this._resourceList=[],this._index=0,this._playButtonShown=!1,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.logo=qm,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=O.White,this.backgroundColor="#176BAA",this.suppressPlayButton=!1,this._playButtonStyles=jm.Z.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let n=document.getElementById("excalibur-play");return n||(n=document.createElement("button")),n.id="excalibur-play",n.textContent=this.playButtonText,n.style.display="none",n},this._loadingFuture=new ji,t&&this.addResources(t)}wireEngine(t){this._engine=t,this.canvas.width=this._engine.canvas.width,this.canvas.height=this._engine.canvas.height}addResource(t){let n=this._index++;this._resourceList.push(t),this._progressCounts[n]=0,this._totalCounts[n]=1,this._resourceCount++}addResources(t){let n=0,r=t.length;for(n;n<r;n++)this.addResource(t[n])}isLoaded(){return this._numLoaded===this._resourceCount}async showPlayButton(){var t,n;if(this.suppressPlayButton)this.hidePlayButton(),await Ph(500,(t=this._engine)===null||t===void 0?void 0:t.clock);else{let r=()=>{this._positionPlayButton()};return!((n=this._engine)===null||n===void 0)&&n.browser&&this._engine.browser.window.on("resize",r),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",c=>{c.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(c=>{let f=p=>{var _;p.stopPropagation(),this.hidePlayButton(),!((_=this._engine)===null||_===void 0)&&_.browser&&this._engine.browser.window.off("resize",r),c()};this._playButton.addEventListener("click",f),this._playButton.addEventListener("touchend",f),this._playButton.addEventListener("pointerup",f)})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}update(t,n){}areResourcesLoaded(){return this._loadingFuture.promise}async load(){var t,n;await((t=this._image)===null||t===void 0?void 0:t.decode()),this.canvas.flagDirty(),await Promise.all(this._resourceList.map(async r=>{await r.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty()})}));for(let r of this._resourceList)r instanceof Cd&&r.wireEngine(this._engine);return this._loadingFuture.resolve(),await Ph(200,(n=this._engine)===null||n===void 0?void 0:n.clock),this.canvas.flagDirty(),await this.showPlayButton(),await di.unlock(),this.data=this._resourceList}markResourceComplete(){this._numLoaded++}get progress(){return this._resourceCount>0?Pe(this._numLoaded,0,this._resourceCount)/this._resourceCount:1}_positionPlayButton(){if(this._engine){let t=this._engine.screen.viewport.height,n=this._engine.screen.viewport.width;if(this._playButtonRootElement){let r=this._engine.canvas.offsetLeft,h=this._engine.canvas.offsetTop,c=this._playButton.clientWidth,f=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${r+n/2-c/2}px`,this._playButtonRootElement.style.top=`${h+t/2-f/2+100}px`)}}}draw(t){let n=this._engine.canvasHeight/this._engine.pixelRatio,r=this._engine.canvasWidth/this._engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,r,n);let h=n/2,c=Math.min(this.logoWidth,r*.75),f=r/2-c/2;this.logoPosition&&(f=this.logoPosition.x,h=this.logoPosition.y);let p=Math.floor(c*(this.logoHeight/this.logoWidth)),_=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,f,h,c,p):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,f,h-p-20,c,p),!this.suppressPlayButton&&this._playButtonShown){this._engine.setAntialiasing(_);return}let v=f,w=h;this.loadingBarPosition&&(v=this.loadingBarPosition.x,w=this.loadingBarPosition.y),t.lineWidth=2,Vh(t,v,w,c,20,10,this.loadingBarColor);let E=c*this.progress,C=5,S=E-C*2,k=20-C*2;Vh(t,v+C,w+C,S>10?S:10,k,5,null,this.loadingBarColor),this._engine.setAntialiasing(_)}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}}let Sd={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class Pd{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){let t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){let t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){let t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){let t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`,n=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],r=this.getBrowserFeatures();for(let h of Object.keys(Sd))r[h]?(t+="(%c\u2713%c)",n.push("font-weight: bold; color: green"),n.push("font-weight: normal; color: inherit")):(t+="(%c\u2717%c)",n.push("font-weight: bold; color: red"),n.push("font-weight: normal; color: inherit")),t+=" "+Sd[h]+`
`;n.unshift(t),console.log.apply(console,n)}_loadBrowserFeatures(){return{canvas:(()=>this._criticalTests.canvasSupport())(),arraybuffer:(()=>this._criticalTests.arrayBufferSupport())(),dataurl:(()=>this._criticalTests.dataUrlSupport())(),objecturl:(()=>this._criticalTests.objectUrlSupport())(),rgba:(()=>this._criticalTests.rgbaSupport())(),webaudio:(()=>this._warningTest.webAudioSupport())(),webgl:(()=>this._warningTest.webglSupport())(),gamepadapi:(()=>!!navigator.getGamepads)()}}test(){let t=!1;for(let n in this._criticalTests)this._criticalTests[n].call(this)||(this.failedTests.push(n),et.getInstance().error("Critical browser feature missing, Excalibur requires:",n),t=!0);if(t)return!1;for(let n in this._warningTest)this._warningTest[n]()||et.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",n);return!0}}var ut;(function(u){u.PreventCollision="PreventCollision",u.Passive="Passive",u.Active="Active",u.Fixed="Fixed"})(ut||(ut={}));let Rd=5,Qi={},Xm=()=>{for(let u in Qi)Qi[u]=0},fo=(u,t)=>{let n=m.isEnabled("suppress-obsolete-message");Qi[u]<Rd&&!n&&(et.getInstance().warn(u),console.trace&&t.showStackTrace&&console.trace()),Qi[u]++};function Dd(u){return u={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...u},function(t,n,r){if(r&&!(typeof r.value=="function"||typeof r.get=="function"||typeof r.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");let c=`${`${t.name||""}${t.name&&n?".":""}${n||""}`} is marked obsolete: ${u.message}`+(u.alternateMethod?` Use ${u.alternateMethod} instead`:"");Qi[c]||(Qi[c]=0);let f=r?{...r}:t;if(!r){class p extends f{constructor(...v){fo(c,u),super(...v)}}return p}return r&&r.value?(f.value=function(){return fo(c,u),r.value.apply(this,arguments)},f):(r&&r.get&&(f.get=function(){return fo(c,u),r.get.apply(this,arguments)}),r&&r.set&&(f.set=function(){return fo(c,u),r.set.apply(this,arguments)}),f)}}var Ym=function(u,t,n,r){var h=arguments.length,c=h<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(u,t,n,r);else for(var p=u.length-1;p>=0;p--)(f=u[p])&&(c=(h<3?f(c):h>3?f(t,n,c):f(t,n))||c);return h>3&&c&&Object.defineProperty(t,n,c),c},fi;(function(u){u.Arcade="arcade",u.Realistic="realistic"})(fi||(fi={}));var po;(function(u){u[u.DynamicAABBTree=0]="DynamicAABBTree"})(po||(po={}));var _o;(function(u){u[u.Euler=0]="Euler"})(_o||(_o={}));class Y{static get gravity(){return Y.acc}static set gravity(t){Y.acc=t}static useArcadePhysics(){Y.collisionResolutionStrategy=fi.Arcade}static useRealisticPhysics(){Y.collisionResolutionStrategy=fi.Realistic}static get dynamicTreeVelocityMultiplyer(){return Y.dynamicTreeVelocityMultiplier}static set dynamicTreeVelocityMultiplyer(t){Y.dynamicTreeVelocityMultiplier=t}}Y.acc=new I(0,0),Y.enabled=!0,Y.broadphaseStrategy=po.DynamicAABBTree,Y.collisionResolutionStrategy=fi.Arcade,Y.defaultMass=10,Y.integrator=_o.Euler,Y.dynamicTreeVelocityMultiplier=2,Y.boundsPadding=5,Y.positionIterations=3,Y.velocityIterations=8,Y.slop=1,Y.steeringFactor=.2,Y.warmStart=!0,Y.bodiesCanSleepByDefault=!1,Y.surfaceEpsilon=.1,Y.sleepEpsilon=.07,Y.wakeThreshold=Y.sleepEpsilon*3,Y.sleepBias=.9,Y.checkForFastBodies=!0,Y.disableMinimumSpeedForFastBody=!1,Ym([Dd({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],Y,"dynamicTreeVelocityMultiplyer",null);var ke;(function(u){u.World="world",u.Screen="screen"})(ke||(ke={}));class zh extends I{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class kd extends I{constructor(t,n){super(t.x,t.y),this.original=t,this.change=n}get x(){return this._x=this.original.x}set x(t){this.change(t,this._y),this._x=this.original.x=t}get y(){return this._y=this.original.y}set y(t){this.change(this._x,t),this._y=this.original.y=t}}class Gn{constructor(){this._parent=null,this._children=[],this._pos=M(0,0),this._rotation=0,this._scale=M(1,1),this._isDirty=!1,this._isInverseDirty=!1,this._matrix=qt.identity(),this._inverse=qt.identity()}get parent(){return this._parent}set parent(t){if(this._parent){let n=this._parent._children.indexOf(this);n>-1&&this._parent._children.splice(n,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){t.equals(this._pos)||(this._pos.x=t.x,this._pos.y=t.y,this.flagDirty())}get pos(){return new kd(this._pos,(t,n)=>{(t!==this._pos.x||n!==this._pos.y)&&this.flagDirty()})}set globalPos(t){let n=t.clone();this.parent&&(n=this.parent.inverse.multiply(t)),n.equals(this._pos)||(this._pos=n,this.flagDirty())}get globalPos(){return new zh({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){let{x:n}=this.parent.inverse.multiply(M(t,this.pos.y));this.pos.x=n}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){let{y:n}=this.parent.inverse.multiply(M(this.pos.x,t));this.pos.y=n}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}})}set rotation(t){let n=qi(t);n!==this._rotation&&this.flagDirty(),this._rotation=n}get rotation(){return this._rotation}set globalRotation(t){let n=0;this.parent&&(n=this.parent.globalRotation);let r=qi(t+n);r!==this._rotation&&this.flagDirty(),this._rotation=r}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){t.equals(this._scale)||(this._scale.x=t.x,this._scale.y=t.y,this.flagDirty())}get scale(){return new kd(this._scale,(t,n)=>{(t!==this._scale.x||n!==this._scale.y)&&this.flagDirty()})}set globalScale(t){let n=M(1,1);this.parent&&(n=this.parent.globalScale),this.scale=t.scale(M(1/n.x,1/n.y))}get globalScale(){return new zh({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){let n=this.parent.globalScale.x;this.scale.x=t/n}else this.scale.x=t},setY:t=>{if(this.parent){let n=this.parent.globalScale.y;this.scale.y=t/n}else this.scale.y=t}})}get matrix(){return this._isDirty&&(this.parent===null?this._matrix=this._calculateMatrix():this._matrix=this.parent.matrix.multiply(this._calculateMatrix()),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this._inverse=this.matrix.inverse(),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return qt.identity().translate(this.pos.x,this.pos.y).rotate(this.rotation).scale(this.scale.x,this.scale.y)}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,n,r){this._pos.x=t.x,this._pos.y=t.y,this._rotation=qi(n),this._scale.x=r.x,this._scale.y=r.y,this.flagDirty()}clone(t){let n=t??new Gn;return this._pos.clone(n._pos),n._rotation=this._rotation,this._scale.clone(n._scale),n.flagDirty(),n}}function Zm(u){return!!u?.clone}class He{constructor(){this.owner=null}clone(){let t=new this.constructor;for(let n in this)if(this.hasOwnProperty(n)){let r=this[n];Zm(r)&&n!=="owner"&&n!=="clone"?t[n]=r.clone():t[n]=r}return t}}class Gh extends He{constructor(t,n){super(),this.type=t,this.value=n}}class fs{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){let n=this.observers.indexOf(t);n!==-1&&this.observers.splice(n,1)}unsubscribe(t){let n=this.subscriptions.indexOf(t);n!==-1&&this.subscriptions.splice(n,1)}notifyAll(t){let n=this.observers.length;for(let h=0;h<n;h++)this.observers[h].notify(t);let r=this.subscriptions.length;for(let h=0;h<r;h++)this.subscriptions[h](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class K extends He{constructor(){super(...arguments),this.type="ex.transform",this._transform=new Gn,this._addChildTransform=t=>{let n=t.get(K);n&&(n._transform.parent=this._transform)},this.zIndexChanged$=new fs,this._z=0,this.coordPlane=ke.World}get(){return this._transform}onAdd(t){for(let n of t.children)this._addChildTransform(n);t.childrenAdded$.subscribe(n=>this._addChildTransform(n)),t.childrenRemoved$.subscribe(n=>{let r=n.get(K);r&&(r._transform.parent=null)})}onRemove(t){this._transform.parent=null}get z(){return this._z}set z(t){let n=this._z;this._z=t,n!==t&&this.zIndexChanged$.notifyAll(t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}clone(){let t=new K;return t._transform=this._transform.clone(),t._z=this._z,t}}class Vt extends He{constructor(){super(...arguments),this.type="ex.motion",this.vel=I.Zero,this.acc=I.Zero,this.scaleFactor=I.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class is{constructor(t,n,r){this._name=t,this._category=n,this._mask=r}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){return(this.category&t.mask)!==0&&(t.category&this.mask)!==0}invert(){return new is("~("+this.name+")",~this.category,~this.mask)}static combine(t){let n=t.map(c=>c.name).join("+"),r=t.reduce((c,f)=>f.category|c,0),h=~r;return new is(n,r,h)}static collidesWith(t){return is.combine(t).invert()}}is.All=new is("Collide with all groups",-1,-1);class We{constructor(t,n){this.colliderA=t,this.colliderB=n,this.id=null,this.id=We.calculatePairHash(t.id,n.id)}static canCollide(t,n){var r,h;let c=(r=t?.owner)===null||r===void 0?void 0:r.get(pt),f=(h=n?.owner)===null||h===void 0?void 0:h.get(pt);return!(t.id===n.id||t.owner&&n.owner&&t.owner.id===n.owner.id||t.localBounds.hasZeroDimensions()||n.localBounds.hasZeroDimensions()||!c||!f||!c.group.canCollide(f.group)||c.collisionType===ut.Fixed&&f.collisionType===ut.Fixed||f.collisionType===ut.PreventCollision||c.collisionType===ut.PreventCollision||!c.active||!f.active)}get canCollide(){let t=this.colliderA,n=this.colliderB;return We.canCollide(t,n)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,n){return t.value<n.value?`#${t.value}+${n.value}`:`#${n.value}+${t.value}`}}class Hn{constructor(t,n){this.min=t,this.max=n}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class Hh{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new ot,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class Wh{constructor(t=new ot(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this.worldBounds=t,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}let n=t.bounds,r=this.root;for(;!r.isLeaf();){let p=r.left,_=r.right,v=r.bounds.getPerimeter(),E=r.bounds.combine(n).getPerimeter(),C=2*E,S=2*(E-v),k=0,N=n.combine(p.bounds),V,D;p.isLeaf()?k=N.getPerimeter()+S:(D=p.bounds.getPerimeter(),V=N.getPerimeter(),k=V-D+S);let R=0,z=n.combine(_.bounds);if(_.isLeaf()?R=z.getPerimeter()+S:(D=_.bounds.getPerimeter(),V=z.getPerimeter(),R=V-D+S),C<k&&C<R)break;k<R?r=p:r=_}let h=r.parent,c=new Hh(h);c.bounds=n.combine(r.bounds),c.height=r.height+1,h!==null?(h.left===r?h.left=c:h.right=c,c.left=r,c.right=t,r.parent=c,t.parent=c):(c.left=r,c.right=t,r.parent=c,t.parent=c,this.root=c);let f=t.parent;for(;f;){if(f=this._balance(f),!f.left)throw new Error("Parent of current leaf cannot have a null left child"+f);if(!f.right)throw new Error("Parent of current leaf cannot have a null right child"+f);f.height=1+Math.max(f.left.height,f.right.height),f.bounds=f.left.bounds.combine(f.right.bounds),f=f.parent}}_remove(t){if(t===this.root){this.root=null;return}let n=t.parent,r=n.parent,h;if(n.left===t?h=n.right:h=n.left,r){r.left===n?r.left=h:r.right=h,h.parent=r;let c=r;for(;c;)c=this._balance(c),c.bounds=c.left.bounds.combine(c.right.bounds),c.height=1+Math.max(c.left.height,c.right.height),c=c.parent}else this.root=h,h.parent=null}trackCollider(t){let n=new Hh;n.data=t,n.bounds=t.bounds,n.bounds.left-=2,n.bounds.top-=2,n.bounds.right+=2,n.bounds.bottom+=2,this.nodes[t.id.value]=n,this._insert(n)}updateCollider(t){var n;let r=this.nodes[t.id.value];if(!r)return!1;let h=t.bounds;if(!this.worldBounds.contains(h))return et.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(r.bounds.contains(h))return!1;if(this._remove(r),h.left-=Y.boundsPadding,h.top-=Y.boundsPadding,h.right+=Y.boundsPadding,h.bottom+=Y.boundsPadding,t.owner){let c=(n=t.owner)===null||n===void 0?void 0:n.get(pt);if(c){let f=c.vel.x*32/1e3*Y.dynamicTreeVelocityMultiplier,p=c.vel.y*32/1e3*Y.dynamicTreeVelocityMultiplier;f<0?h.left+=f:h.right+=f,p<0?h.top+=p:h.bottom+=p}}return r.bounds=h,this._insert(r),!0}untrackCollider(t){let n=this.nodes[t.id.value];n&&(this._remove(n),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;let n=t.left,r=t.right,h=t,c=n,f=r,p=n.left,_=n.right,v=r.left,w=r.right,E=f.height-c.height;if(E>1)return f.left=h,f.parent=h.parent,h.parent=f,f.parent?f.parent.left===h?f.parent.left=f:f.parent.right=f:this.root=f,v.height>w.height?(f.right=v,h.right=w,w.parent=h,h.bounds=c.bounds.combine(w.bounds),f.bounds=h.bounds.combine(v.bounds),h.height=1+Math.max(c.height,w.height),f.height=1+Math.max(h.height,v.height)):(f.right=w,h.right=v,v.parent=h,h.bounds=c.bounds.combine(v.bounds),f.bounds=h.bounds.combine(w.bounds),h.height=1+Math.max(c.height,v.height),f.height=1+Math.max(h.height,w.height)),f;if(E<-1){if(c.left=h,c.parent=h.parent,h.parent=c,c.parent)if(c.parent.left===h)c.parent.left=c;else{if(c.parent.right!==h)throw"Error rotating Dynamic Tree";c.parent.right=c}else this.root=c;return p.height>_.height?(c.right=p,h.left=_,_.parent=h,h.bounds=f.bounds.combine(_.bounds),c.bounds=h.bounds.combine(p.bounds),h.height=1+Math.max(f.height,_.height),c.height=1+Math.max(h.height,p.height)):(c.right=_,h.left=p,p.parent=h,h.bounds=f.bounds.combine(p.bounds),c.bounds=h.bounds.combine(_.bounds),h.height=1+Math.max(f.height,p.height),c.height=1+Math.max(h.height,_.height)),c}return t}getHeight(){return this.root===null?0:this.root.height}query(t,n){let r=t.bounds,h=c=>{if(c&&c.bounds.overlaps(r))if(c.isLeaf()&&c.data!==t){if(n.call(t,c.data))return!0}else return h(c.left)||h(c.right);return!1};h(this.root)}rayCastQuery(t,n=1/0,r){let h=c=>{if(c&&c.bounds.rayCast(t,n))if(c.isLeaf()){if(r.call(t,c.data))return!0}else return h(c.left)||h(c.right);return!1};h(this.root)}getNodes(){let t=n=>n?[n].concat(t(n.left),t(n.right)):[];return t(this.root)}debug(t){let n=r=>{r&&(r.isLeaf()?r.bounds.draw(t,O.Green):r.bounds.draw(t,O.White),r.left&&n(r.left),r.right&&n(r.right))};n(this.root)}}class Vs{constructor(t,n){this.pos=t,this.dir=n.normalize()}intersect(t){let n=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&n.cross(this.dir)!==0)return-1;let r=this.dir.cross(t.getSlope());if(r===0)return-1;let h=n.cross(t.getSlope())/r;if(h>=0){let c=n.cross(this.dir)/r/t.getLength();if(c>=0&&c<=1)return h}return-1}intersectPoint(t){let n=this.intersect(t);return n<0?null:this.getPoint(n)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class qh{constructor(){this._dynamicCollisionTree=new Wh,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[]}getColliders(){return this._colliders}rayCast(t,n){var r,h,c;let f=[],p=(r=n?.maxDistance)!==null&&r!==void 0?r:1/0,_=(h=n?.collisionGroup)!==null&&h!==void 0?h:is.All,v=(c=n?.searchAllColliders)!==null&&c!==void 0?c:!1;return this._dynamicCollisionTree.rayCastQuery(t,p,w=>{var E;let S=w.owner.get(pt);if(_.mask!==is.All.mask&&((E=S?.group)===null||E===void 0?void 0:E.mask)!==_.mask)return!1;let k=w.rayCast(t,p);return!!(k&&(f.push({distance:k.sub(t.pos).distance(),point:k,collider:w,body:S}),!v))}),f}track(t){if(!t){et.getInstance().warn("Cannot track null collider");return}if(t instanceof ge){let n=t.getColliders();for(let r of n)r.owner=t.owner,this._colliders.push(r),this._dynamicCollisionTree.trackCollider(r)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){et.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof ge){let n=t.getColliders();for(let r of n){let h=this._colliders.indexOf(r);h!==-1&&this._colliders.splice(h,1),this._dynamicCollisionTree.untrackCollider(r)}}else{let n=this._colliders.indexOf(t);n!==-1&&this._colliders.splice(n,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,n){let r=We.calculatePairHash(t.id,n.id);return this._pairs.has(r)}broadphase(t,n,r){let h=n/1e3,c=t.filter(p=>{var _,v;let w=(_=p.owner)===null||_===void 0?void 0:_.get(pt);return((v=p.owner)===null||v===void 0?void 0:v.active)&&w.collisionType!==ut.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let f;for(let p=0,_=c.length;p<_;p++)f=c[p],this._dynamicCollisionTree.query(f,v=>{if(!this._pairExists(f,v)&&We.canCollide(f,v)){let w=new We(f,v);this._pairs.add(w.id),this._collisionPairCache.push(w)}return!1});if(r&&(r.physics.pairs=this._collisionPairCache.length),Y.checkForFastBodies)for(let p of c){let _=p.owner.get(pt);if(_.collisionType!==ut.Active)continue;let v=_.vel.size*h+_.acc.size*.5*h*h,w=Math.min(p.bounds.height,p.bounds.width);if(Y.disableMinimumSpeedForFastBody||v>w/2){r&&r.physics.fastBodies++;let E=_.globalPos.sub(_.oldPos),C=p.center,S=p.getFurthestPoint(_.vel),k=S.sub(E),N=new Vs(k,_.vel);N.pos=N.pos.add(N.dir.scale(-2*Y.surfaceEpsilon));let V,D=new I(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(N,v+Y.surfaceEpsilon*2,R=>{if(!this._pairExists(p,R)&&We.canCollide(p,R)){let z=R.rayCast(N,v+Y.surfaceEpsilon*10);if(z){let G=z.sub(k);G.size<D.size&&(D=G,V=R)}}return!1}),V&&I.isValid(D)){let R=new We(p,V);this._pairs.has(R.id)||(this._pairs.add(R.id),this._collisionPairCache.push(R));let z=C.sub(S);_.globalPos=k.add(z).add(D).add(N.dir.scale(10*Y.surfaceEpsilon)),p.update(_.transform.get()),r&&r.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,n){let r=[];for(let h=0;h<t.length;h++){let c=t[h].collide();if(r=r.concat(c),n&&c.length>0)for(let f of c)n.physics.contacts.set(f.id,f)}return n&&(n.physics.collisions+=r.length),r}update(t){let n=0,r=t.length;for(let h=0;h<r;h++)this._dynamicCollisionTree.updateCollider(t[h])&&n++;return n}debug(t){this._dynamicCollisionTree.debug(t)}}class Ys{constructor(){this.id=y("collider",Ys._ID++),this.__compositeColliderId=null,this.events=new x}touching(t){return!!this.collide(t)}}Ys._ID=0;class ge extends Ys{constructor(t){super(),this._collisionProcessor=new qh,this._dynamicAABBTree=new Wh,this._colliders=[];for(let n of t)this.addCollider(n)}clearColliders(){this._colliders=[]}addCollider(t){t.events.pipe(this.events),t.__compositeColliderId=this.id,this._colliders.push(t),this._collisionProcessor.track(t),this._dynamicAABBTree.trackCollider(t)}removeCollider(t){t.events.pipe(this.events),t.__compositeColliderId=null,Bs(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,n;return(n=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&n!==void 0?n:I.Zero}get center(){var t,n;return(n=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&n!==void 0?n:I.Zero}get bounds(){var t,n;let r=this.getColliders();return r.reduce((c,f)=>c.combine(f.bounds),(n=(t=r[0])===null||t===void 0?void 0:t.bounds)!==null&&n!==void 0?n:new ot().translate(this.worldPos))}get localBounds(){var t,n;let r=this.getColliders();return r.reduce((c,f)=>c.combine(f.localBounds),(n=(t=r[0])===null||t===void 0?void 0:t.localBounds)!==null&&n!==void 0?n:new ot)}get axes(){let t=this.getColliders(),n=[];for(let r of t)n=n.concat(r.axes);return n}getFurthestPoint(t){let n=this.getColliders(),r=[];for(let f of n)r.push(f.getFurthestPoint(t));let h=r[0],c=-Number.MAX_VALUE;for(let f of r){let p=f.dot(t);p>c&&(h=f,c=p)}return h}getInertia(t){let n=this.getColliders(),r=0;for(let h of n)r+=h.getInertia(t);return r}collide(t){let n=[t];t instanceof ge&&(n=t.getColliders());let r=[];for(let c of n)this._dynamicAABBTree.query(c,f=>(r.push(new We(c,f)),!1));let h=[];for(let c of r)h=h.concat(c.collide());return h}getClosestLineBetween(t){let n=this.getColliders(),r=[];if(t instanceof ge){let h=t.getColliders();for(let c of n)for(let f of h){let p=c.getClosestLineBetween(f);p&&r.push(p)}}else for(let h of n){let c=t.getClosestLineBetween(h);c&&r.push(c)}if(r.length){let h=r[0].getLength(),c=r[0];for(let f of r){let p=f.getLength();p<h&&(h=p,c=f)}return c}return null}contains(t){let n=this.getColliders();for(let r of n)if(r.contains(t))return!0;return!1}rayCast(t,n){let r=this.getColliders(),h=[];for(let c of r){let f=c.rayCast(t,n);f&&h.push(f)}if(h.length){let c=h[0],f=c.dot(t.dir);for(let p of h){let _=t.dir.dot(p);_<f&&(c=p,f=_)}return c}return null}project(t){let n=this.getColliders(),r=[];for(let h of n){let c=h.project(t);c&&r.push(c)}if(r.length){let h=new Hn(r[0].min,r[0].max);for(let c of r)h.min=Math.min(c.min,h.min),h.max=Math.max(c.max,h.max);return h}return null}update(t){if(t){let n=this.getColliders();for(let r of n)r.owner=this.owner,r.update(t)}}debug(t,n){let r=this.getColliders();for(let h of r)h.debug(t,n)}clone(){return new ge(this._colliders.map(t=>t.clone()))}}class Te{constructor(t,n){this.begin=t,this.end=n}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;let t=this.begin,n=this.end,r=t.distance(n);return this._slope=n.sub(t).scale(1/r)}getEdge(){let t=this.begin;return this.end.sub(t)}getLength(){if(this._length)return this._length;let t=this.begin,n=this.end,r=t.distance(n);return this._length=r}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new Te(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,n){let r=t;r=r.normalize();let h=r.dot(this.begin)-n,c=r.dot(this.end)-n,f=[];if(h<=0&&f.push(this.begin),c<=0&&f.push(this.end),h*c<0){let p=h/(h-c);f.push(this.begin.add(this.end.sub(this.begin).scale(p)))}return f.length!==2?null:new Te(f[0],f[1])}distanceToPoint(t,n=!1){let r=t.x,h=t.y,c=this.getLength(),f=this.end.y-this.begin.y,p=this.end.x-this.begin.x,_=(f*r-p*h+this.end.x*this.begin.y-this.end.y*this.begin.x)/c;return n?_:Math.abs(_)}findVectorToPoint(t){let n=this.begin.sub(t),r=this.getSlope();return n.sub(r.scale(n.dot(r)))}findPoint(t=null,n=null){let r=this.slope,h=this.intercept;if(t!==null)return new I(t,r*t+h);if(n!==null)return new I((n-h)/r,n);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,n=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new I(arguments[0],arguments[1]),n=arguments[2]||0;else if(arguments[0]instanceof I)t=arguments[0],n=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";let r=t.x-this.begin.x,h=t.y-this.begin.y,c=this.end.x-this.begin.x,f=this.end.y-this.begin.y,p=r*f-h*c;return Math.abs(p)>n?!1:Math.abs(c)>=Math.abs(f)?c>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:f>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function go(u,t,n,r){let h=u.sub(n),c=t.dot(t),f=t.dot(r),p=r.dot(r),_=t.dot(h),v=r.dot(h),w=c*p-f*f,E=w,C=w;if(w===0||w<=.01){let N=_/f;return new Te(u,n.add(r.scale(N)))}let S=f*v-p*_,k=c*v-f*_;return S<0?(S=0,k=v,C=p):S>E&&(S=E,k=v+f,C=p),k<0?(k=0,-_<0?S=0:-_>c?S=E:(S=-_,E=c)):k>C&&(k=C,-_+f<0?S=0:-_+f>c?S=E:(S=-_+f,E=c)),S=Math.abs(S)<.001?0:S/E,k=Math.abs(k)<.001?0:k/C,new Te(u.add(t.scale(S)),n.add(r.scale(k)))}let ps={PolygonPolygonClosestLine(u,t){let n=t.worldPos,r=n.sub(u.worldPos),h=r.negate(),c=new Vs(u.worldPos,r),f=new Vs(n,h),p=u.rayCast(c).add(c.dir.scale(.1)),_=t.rayCast(f).add(f.dir.scale(.1)),v=u.getClosestFace(p),w=t.getClosestFace(_),E=v.face.begin,C=v.face.getEdge(),S=w.face.begin,k=w.face.getEdge();return go(E,C,S,k)},PolygonEdgeClosestLine(u,t){let r=t.worldPos.sub(u.worldPos),h=new Vs(u.worldPos,r),c=u.rayCast(h).add(h.dir.scale(.1)),f=u.getClosestFace(c),p=f.face.begin,_=f.face.getEdge(),v=t.asLine(),w=v.begin,E=v.getEdge();return go(p,_,w,E)},PolygonCircleClosestLine(u,t){let n=t.worldPos,r=n.sub(u.worldPos),h=new Vs(u.worldPos,r.normalize()),c=u.rayCast(h).add(h.dir.scale(.1)),f=u.getClosestFace(c),p=f.face.begin,_=f.face.getEdge(),v=(_.x*(n.x-p.x)+_.y*(n.y-p.y))/(_.x*_.x+_.y*_.y);v>1?v=1:v<0&&(v=0);let w=Math.sqrt(Math.pow(p.x+_.x*v-n.x,2)+Math.pow(p.y+_.y*v-n.y,2))-t.radius,E=(p.x+_.x*v-n.x)*t.radius/(t.radius+w),C=(p.y+_.y*v-n.y)*t.radius/(t.radius+w);return new Te(_.scale(v).add(p),new I(n.x+E,n.y+C))},CircleCircleClosestLine(u,t){let r=t.worldPos.sub(u.worldPos),c=u.worldPos.sub(t.worldPos),f=new Vs(u.worldPos,r),p=new Vs(t.worldPos,c),_=u.rayCast(f),v=t.rayCast(p);return new Te(_,v)},CircleEdgeClosestLine(u,t){let n=u.worldPos,r=t.asLine(),h=r.begin,c=r.getEdge(),f=h,p=c,_=(p.x*(n.x-f.x)+p.y*(n.y-f.y))/(p.x*p.x+p.y*p.y);_>1?_=1:_<0&&(_=0);let v=Math.sqrt(Math.pow(f.x+p.x*_-n.x,2)+Math.pow(f.y+p.y*_-n.y,2))-u.radius,w=(f.x+p.x*_-n.x)*u.radius/(u.radius+v),E=(f.y+p.y*_-n.y)*u.radius/(u.radius+v);return new Te(p.scale(_).add(f),new I(n.x+w,n.y+E))},EdgeEdgeClosestLine(u,t){let n=u.asLine(),r=n.begin,h=n.getEdge(),c=r,f=h,p=t.asLine(),_=p.begin,v=p.getEdge();return go(c,f,_,v)}};class le extends Ys{get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;let n=this._transform,r=(t=n?.globalScale)!==null&&t!==void 0?t:I.One;return this._naturalRadius*Math.min(r.x,r.y)}set radius(t){var n;let r=this._transform,h=(n=r?.globalScale)!==null&&n!==void 0?n:I.One;this._naturalRadius=t/Math.min(h.x,h.y)}constructor(t){super(),this.offset=I.Zero,this._globalMatrix=qt.identity(),this.offset=t.offset||I.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}clone(){return new le({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var n,r;return((r=(n=this._transform)===null||n===void 0?void 0:n.pos)!==null&&r!==void 0?r:this.offset).distance(t)<=this.radius}rayCast(t,n=1/0){let r=this.center,h=t.dir,c=t.pos,f=Math.sqrt(Math.pow(h.dot(c.sub(r)),2)-Math.pow(c.sub(r).distance(),2)+Math.pow(this.radius,2));if(f<0)return null;{let p=0;if(f===0)return p=-h.dot(c.sub(r)),p>0&&p<n?t.getPoint(p):null;{let _=-h.dot(c.sub(r))+f,v=-h.dot(c.sub(r))-f,w=[];_>=0&&w.push(_),v>=0&&w.push(v);let E=Math.min(...w);return E<=n?t.getPoint(E):null}}}getClosestLineBetween(t){if(t instanceof le)return ps.CircleCircleClosestLine(this,t);if(t instanceof ie)return ps.PolygonCircleClosestLine(t,this).flip();if(t instanceof Me)return ps.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof le)return ns.CollideCircleCircle(this,t);if(t instanceof ie)return ns.CollideCirclePolygon(this,t);if(t instanceof Me)return ns.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){var t,n,r;let h=this._transform,c=(t=h?.globalScale)!==null&&t!==void 0?t:I.One,f=(n=h?.globalRotation)!==null&&n!==void 0?n:0,p=(r=h?.globalPos)!==null&&r!==void 0?r:I.Zero;return new ot(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius).rotate(f).scale(c).translate(p)}get localBounds(){return new ot(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius)}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var n;this._transform=t,((n=t.matrix)!==null&&n!==void 0?n:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){let n=[],h=this.center.dot(t);return n.push(h),n.push(h+this.radius),n.push(h-this.radius),new Hn(Math.min.apply(Math,n),Math.max.apply(Math,n))}debug(t,n){var r,h,c,f;let p=this._transform,_=(r=p?.globalScale)!==null&&r!==void 0?r:I.One,v=(h=p?.globalRotation)!==null&&h!==void 0?h:0,w=(c=p?.globalPos)!==null&&c!==void 0?c:I.Zero;t.save(),t.translate(w.x,w.y),t.rotate(v),t.scale(_.x,_.y),t.drawCircle((f=this.offset)!==null&&f!==void 0?f:I.Zero,this._naturalRadius,O.Transparent,n,2),t.restore()}}class pi{constructor(t,n,r,h,c,f,p,_){var v,w;this._canceled=!1,this.colliderA=t,this.colliderB=n,this.mtv=r,this.normal=h,this.tangent=c,this.points=f,this.localPoints=p,this.info=_,this.id=We.calculatePairHash(t.id,n.id),(t.__compositeColliderId||n.__compositeColliderId)&&(this.id+="|"+We.calculatePairHash((v=t.__compositeColliderId)!==null&&v!==void 0?v:t.id,(w=n.__compositeColliderId)!==null&&w!==void 0?w:n.id))}matchAwake(){let t=this.colliderA.owner.get(pt),n=this.colliderB.owner.get(pt);t&&n&&t.sleeping!==n.sleeping&&(t.sleeping&&t.collisionType!==ut.Fixed&&n.sleepMotion>=Y.wakeThreshold&&t.setSleeping(!1),n.sleeping&&n.collisionType!==ut.Fixed&&t.sleepMotion>=Y.wakeThreshold&&n.setSleeping(!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}}class jh{static findPolygonPolygonSeparation(t,n){let r=-Number.MAX_VALUE,h=null,c=null,f=-1,p=null,_=t.getSides(),v=t.getLocalSides();for(let w=0;w<_.length;w++){let E=_[w],C=E.normal(),S=n.getFurthestPoint(C.negate()),k=E.distanceToPoint(S,!0);k>r&&(r=k,h=E,c=C,f=w,p=S)}return{collider:t,separation:c?r:99,axis:c,side:h,localSide:v[f],sideId:f,point:p,localPoint:c?n.getFurthestLocalPoint(c.negate()):null}}static findCirclePolygonSeparation(t,n){let r=n.axes,c=n.center.sub(t.worldPos),f=n.getFurthestPoint(c.negate());r.push(f.sub(t.worldPos).normalize());let p=Number.MAX_VALUE,_=null,v=-1;for(let w=0;w<r.length;w++){let E=n.project(r[w]),C=t.project(r[w]),S=E.getOverlap(C);if(S<=0)return null;S<p&&(p=S,_=r[w],v=w)}return v<0?null:_.normalize().scale(p)}}let ns={CollideCircleCircle(u,t){let n=u.worldPos,r=t.worldPos,h=u.radius+t.radius,c=n.distance(r);if(c>h)return[];let f=h-c,p=r.sub(n).normalize(),_=p.perpendicular(),v=p.scale(f),w=u.getFurthestPoint(p),E=u.getFurthestLocalPoint(p),C={collider:u,separation:f,axis:p,point:w};return[new pi(u,t,v,p,_,[w],[E],C)]},CollideCirclePolygon(u,t){var n,r;let h=jh.findCirclePolygonSeparation(u,t);if(!h)return[];h=h.dot(t.center.sub(u.center))<0?h.negate():h;let f=u.getFurthestPoint(h),_=((r=(n=u.owner)===null||n===void 0?void 0:n.get(K))!==null&&r!==void 0?r:new K).applyInverse(f),v=h.normalize(),w={collider:u,separation:-h.size,axis:v,point:f,localPoint:_,side:t.findSide(v.negate()),localSide:t.findLocalSide(v.negate())};return[new pi(u,t,h,v,v.perpendicular(),[f],[_],w)]},CollideCircleEdge(u,t){let n=u.center,r=t.asLine(),h=r.end.sub(r.begin),c=h.dot(r.end.sub(n)),f=h.dot(n.sub(r.begin)),p=t.asLine(),_=t.asLocalLine();if(f<=0){let D=r.begin.sub(n),R=D.dot(D);if(R>u.radius*u.radius)return[];let z=D.normalize(),G=u.radius-Math.sqrt(R),st={collider:u,separation:G,axis:z,point:p.begin,side:p,localSide:_};return[new pi(u,t,z.scale(G),z,z.perpendicular(),[p.begin],[_.begin],st)]}if(c<=0){let D=r.end.sub(n),R=D.dot(D);if(R>u.radius*u.radius)return[];let z=D.normalize(),G=u.radius-Math.sqrt(R),st={collider:u,separation:G,axis:z,point:p.end,side:p,localSide:_};return[new pi(u,t,z.scale(G),z,z.perpendicular(),[p.end],[_.end],st)]}let v=h.dot(h),w=r.begin.scale(c).add(r.end.scale(f)).scale(1/v),E=n.sub(w),C=E.dot(E);if(C>u.radius*u.radius)return[];let S=h.perpendicular();S.dot(n.sub(r.begin))<0&&(S.x=-S.x,S.y=-S.y),S=S.normalize();let k=u.radius-Math.sqrt(C),N=S.scale(k),V={collider:u,separation:k,axis:S,point:w,side:p,localSide:_};return[new pi(u,t,N,S.negate(),S.negate().perpendicular(),[w],[w.sub(t.worldPos)],V)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(u,t){var n;let r=u.center,c=t.center.sub(r).normalize(),f=new ie({points:[t.begin,t.end,t.end.add(c.scale(100)),t.begin.add(c.scale(100))],offset:t.offset});f.owner=t.owner,((n=t.owner)===null||n===void 0?void 0:n.get(K))&&f.update(t.owner.get(K).get());let _=this.CollidePolygonPolygon(u,f);return _.length&&(_[0].colliderB=t,_[0].id=We.calculatePairHash(u.id,t.id)),_},CollidePolygonPolygon(u,t){var n,r,h,c;let f=jh.findPolygonPolygonSeparation(u,t);if(f.separation>0)return[];let p=jh.findPolygonPolygonSeparation(t,u);if(p.separation>0)return[];let _=f.separation>p.separation?f:p,w=(_.collider===u?t:u).findSide(_.axis.negate()),E=_.side,C=E.dir().normalize(),S=w.clip(C.negate(),-C.dot(E.begin)),k=null;if(S&&(k=S.clip(C,C.dot(E.end))),k){let N=k.getPoints().filter(z=>E.below(z)),V=_.axis,D=V.perpendicular();t.center.sub(u.center).dot(V)<0&&(V=V.negate(),D=V.perpendicular());let R=[];if(_.collider===u){let z=(r=(n=t.owner)===null||n===void 0?void 0:n.get(K))!==null&&r!==void 0?r:new K;R=N.map(G=>z.applyInverse(G))}else{let z=(c=(h=u.owner)===null||h===void 0?void 0:h.get(K))!==null&&c!==void 0?c:new K;R=N.map(G=>z.applyInverse(G))}return[new pi(u,t,V.scale(-_.separation),V,D,N,R,_)]}return[]},FindContactSeparation(u,t){var n,r,h,c;let f=u.colliderA,p=(r=(n=u.colliderA.owner)===null||n===void 0?void 0:n.get(K))!==null&&r!==void 0?r:new K,_=u.colliderB,v=(c=(h=u.colliderB.owner)===null||h===void 0?void 0:h.get(K))!==null&&c!==void 0?c:new K;if(f instanceof le&&_ instanceof le){let w=f.radius+_.radius,E=p.pos.distance(v.pos);return-(w-E)}if(f instanceof ie&&_ instanceof ie&&u.info.localSide){let w,E;return u.info.collider===f?(w=new Te(p.apply(u.info.localSide.begin),p.apply(u.info.localSide.end)),E=v.apply(t)):(w=new Te(v.apply(u.info.localSide.begin),v.apply(u.info.localSide.end)),E=p.apply(t)),w.distanceToPoint(E,!0)}if(f instanceof ie&&_ instanceof le||_ instanceof ie&&f instanceof le){let w=p.apply(t);if(u.info.side)return u.info.side.distanceToPoint(w,!0)}if(f instanceof Me&&_ instanceof ie||_ instanceof Me&&f instanceof ie){let w;if(u.info.collider===f?w=v.apply(t):w=p.apply(t),u.info.side)return u.info.side.distanceToPoint(w,!0)}if(f instanceof le&&_ instanceof Me||_ instanceof le&&f instanceof Me){let w=v.apply(t),E;f instanceof le&&(E=f.getFurthestPoint(u.normal));let C=w.distance(E);if(u.info.side)return C>0?-C:0}return 0}};class Me extends Ys{constructor(t){var n;super(),this._globalMatrix=qt.identity(),this.begin=t.begin||I.Zero,this.end=t.end||I.Zero,this.offset=(n=t.offset)!==null&&n!==void 0?n:I.Zero}clone(){return new Me({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;let n=this._transform;return(t=n?.globalPos.add(this.offset))!==null&&t!==void 0?t:this.offset}get center(){let t=this._getTransformedBegin(),n=this._getTransformedEnd();return t.average(n)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){let t=this._getTransformedBegin(),n=this._getTransformedEnd(),r=t.distance(n);return n.sub(t).scale(1/r)}getLength(){let t=this._getTransformedBegin(),n=this._getTransformedEnd();return t.distance(n)}contains(){return!1}rayCast(t,n=1/0){let r=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&r.cross(t.dir)!==0)return null;let h=t.dir.cross(this.getSlope());if(h===0)return null;let c=r.cross(this.getSlope())/h;if(c>=0&&c<=n){let f=r.cross(t.dir)/h/this.getLength();if(f>=0&&f<=1)return t.getPoint(c)}return null}getClosestLineBetween(t){if(t instanceof le)return ps.CircleEdgeClosestLine(t,this);if(t instanceof ie)return ps.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Me)return ps.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof le)return ns.CollideCircleEdge(t,this);if(t instanceof ie)return ns.CollidePolygonEdge(t,this);if(t instanceof Me)return ns.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){let n=this._getTransformedBegin(),r=this._getTransformedEnd();return t.dot(n)>0?n:r}_boundsFromBeginEnd(t,n,r=10){return new ot(Math.min(t.x,n.x)-r,Math.min(t.y,n.y)-r,Math.max(t.x,n.x)+r,Math.max(t.y,n.y)+r)}get bounds(){let t=this._getTransformedBegin(),n=this._getTransformedEnd();return this._boundsFromBeginEnd(t,n)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new Te(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new Te(this.begin,this.end)}get axes(){let n=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),r=[];return r.push(n),r.push(n.negate()),r.push(n.normal()),r.push(n.normal().negate()),r}getInertia(t){let n=this.end.sub(this.begin).distance()/2;return t*n*n}update(t){var n;this._transform=t,((n=t.matrix)!==null&&n!==void 0?n:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){let n=[],r=[this._getTransformedBegin(),this._getTransformedEnd()],h=r.length;for(let c=0;c<h;c++)n.push(r[c].dot(t));return new Hn(Math.min.apply(Math,n),Math.max.apply(Math,n))}debug(t,n){let r=this._getTransformedBegin(),h=this._getTransformedEnd();t.drawLine(r,h,n,2),t.drawCircle(r,2,n),t.drawCircle(h,2,n)}}class ie extends Ys{set points(t){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._sidesDirty=!0,this._points=t}get points(){return this._points}constructor(t){var n,r;super(),this._logger=et.getInstance(),this._transformedPoints=[],this._sides=[],this._localSides=[],this._globalMatrix=qt.identity(),this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(n=t.offset)!==null&&n!==void 0?n:I.Zero,this._globalMatrix.translate(this.offset.x,this.offset.y),this.points=(r=t.points)!==null&&r!==void 0?r:[],this._isCounterClockwiseWinding(this.points)||this.points.reverse(),this.isConvex()||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_isCounterClockwiseWinding(t){let n=0;for(let r=0;r<t.length;r++)n+=(t[(r+1)%t.length].x-t[r].x)*(t[(r+1)%t.length].y+t[r].y);return n<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],n=this.points[this.points.length-1],r=Math.atan2(n.y-t.y,n.x-t.x),h=0,c=0,f=0;for(let[p,_]of this.points.entries()){if(t=n,h=r,n=_,r=Math.atan2(n.y-t.y,n.x-t.x),t.equals(n))return!1;let v=r-h;if(v<=-Math.PI?v+=Math.PI*2:v>Math.PI&&(v-=Math.PI*2),p===0){if(v===0)return!1;c=v>0?1:-1}else if(c*v<=0)return!1;f+=v}return Math.abs(Math.round(f/(Math.PI*2)))===1}tessellate(){let t=[];for(let n=1;n<this.points.length-2;n++)t.push([this.points[0],this.points[n+1],this.points[n+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new ge(t.map(n=>ce.Polygon(n)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");function t(f,p){return f>=p.length?p[f%p.length]:f<0?p[f%p.length+p.length]:p[f]}function n(f,p,_,v){let w=_.sub(p),E=v.sub(_),C=p.sub(v),S=f.sub(p),k=f.sub(_),N=f.sub(v),V=w.cross(S),D=E.cross(k),R=C.cross(N);return!(V>0||D>0||R>0)}let r=[],h=[...this.points],c=Ih(0,this.points.length-1);for(;c.length>3;)for(let f=0;f<c.length;f++){let p=c[f],_=t(f-1,c),v=t(f+1,c),w=h[p],E=h[_],C=h[v],S=E.sub(w);if(!(C.sub(w).cross(S)>0))continue;let V=!0;for(let D=0;D<c.length;D++){let R=c[D];if(R===p||R===_||R===v)continue;let z=h[R];if(n(z,E,w,C)){V=!1;break}}if(V){r.push([E,w,C]),c.splice(f,1);break}}return r.push([h[c[0]],h[c[1]],h[c[2]]]),new ge(r.map(f=>ce.Polygon(f)))}clone(){return new ie({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform?this._transform.pos.add(this.offset):this.offset}get center(){return this.bounds.center}_calculateTransformation(){let t=this.points,n=t.length;this._transformedPoints.length=0;for(let r=0;r<n;r++)this._transformedPoints[r]=this._globalMatrix.multiply(t[r].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){let t=[],n=this.getTransformedPoints(),r=n.length;for(let h=0;h<r;h++)t.push(new Te(n[h],n[(h+1)%r]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){let t=[],n=this.points,r=n.length;for(let h=0;h<r;h++)t.push(new Te(n[h],n[(h+1)%r]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){let n=this.getSides(),r=n[0],h=-Number.MAX_VALUE;for(let c=0;c<n.length;c++){let f=n[c],_=f.normal().dot(t);_>h&&(r=f,h=_)}return r}findLocalSide(t){let n=this.getLocalSides(),r=n[0],h=-Number.MAX_VALUE;for(let c=0;c<n.length;c++){let f=n[c],_=f.normal().dot(t);_>h&&(r=f,h=_)}return r}get axes(){let t=[],n=this.getSides();for(let r=0;r<n.length;r++)t.push(n[r].normal());return t}update(t){var n;t&&(this._transform=t,this._transformedPointsDirty=!0,this._sidesDirty=!0,((n=t.matrix)!==null&&n!==void 0?n:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y))}contains(t){let n=new Vs(t,new I(1,0));return this.getSides().reduce(function(h,c){return n.intersect(c)>=0?h+1:h},0)%2!==0}getClosestLineBetween(t){if(t instanceof le)return ps.PolygonCircleClosestLine(this,t);if(t instanceof ie)return ps.PolygonPolygonClosestLine(this,t);if(t instanceof Me)return ps.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof le)return ns.CollideCirclePolygon(t,this);if(t instanceof ie)return ns.CollidePolygonPolygon(this,t);if(t instanceof Me)return ns.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){let n=this.getTransformedPoints(),r=null,h=-Number.MAX_VALUE;for(let c=0;c<n.length;c++){let f=t.dot(n[c]);f>h&&(h=f,r=n[c])}return r}getFurthestLocalPoint(t){let n=this.points,r=n[0],h=-Number.MAX_VALUE;for(let c=0;c<n.length;c++){let f=t.dot(n[c]);f>h&&(h=f,r=n[c])}return r}getClosestFace(t){let n=this.getSides(),r=Number.POSITIVE_INFINITY,h=-1,c=-1;for(let f=0;f<n.length;f++){let p=n[f].distanceToPoint(t);p<r&&(r=p,h=f,c=p)}return h!==-1?{distance:n[h].normal().scale(c),face:n[h]}:null}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=ot.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let n=0,r=0,h=this.points;for(let c=0;c<h.length;c++){let f=(c+1)%h.length,p=h[f].cross(h[c]);n+=p*(h[c].dot(h[c])+h[c].dot(h[f])+h[f].dot(h[f])),r+=p}return this._cachedMass=t,this._cachedInertia=t/6*(n/r)}rayCast(t,n=1/0){let r=this.getSides(),h=r.length,c=Number.MAX_VALUE,f=-1;for(let p=0;p<h;p++){let _=t.intersect(r[p]);_>=0&&_<c&&_<=n&&(c=_,f=p)}return f>=0?t.getPoint(c):null}project(t){let n=this.getTransformedPoints(),r=n.length,h=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let f=0;f<r;f++){let p=n[f].dot(t);h=Math.min(h,p),c=Math.max(c,p)}return new Hn(h,c)}debug(t,n){let r=this.getTransformedPoints()[0],h=[r,...this.getTransformedPoints(),r];for(let c=0;c<h.length-1;c++)t.drawLine(h[c],h[c+1],n,2),t.drawCircle(h[c],2,n),t.drawCircle(h[c+1],2,n)}}class ce{static Box(t,n,r=I.Half,h=I.Zero){return new ie({points:new ot(-t*r.x,-n*r.y,t-t*r.x,n-n*r.y).getPoints(),offset:h})}static Polygon(t,n=I.Zero){return new ie({points:t,offset:n})}static Circle(t,n=I.Zero){return new le({radius:t,offset:n})}static Edge(t,n){return new Me({begin:t,end:n})}static Capsule(t,n,r=I.Zero){let h=et.getInstance();return t===n&&h.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),n>=t?new ge([ce.Circle(t/2,M(0,-n/2+t/2).add(r)),ce.Box(t,n-t,I.Half,r),ce.Circle(t/2,M(0,n/2-t/2).add(r))]):new ge([ce.Circle(n/2,M(-t/2+n/2,0).add(r)),ce.Box(t-n,n,I.Half,r),ce.Circle(n/2,M(t/2-n/2,0).add(r))])}}class $t extends He{constructor(t){super(),this.type="ex.collider",this.events=new x,this.$colliderAdded=new fs,this.$colliderRemoved=new fs,this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,t.events.pipe(this.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this._collider.events.unpipe(this.events),this.$colliderRemoved.notifyAll(this._collider),this._collider.owner=null,this._collider=null)}clone(){return new $t(this._collider.clone())}get bounds(){var t,n;return(n=(t=this._collider)===null||t===void 0?void 0:t.bounds)!==null&&n!==void 0?n:new ot}get localBounds(){var t,n;return(n=(t=this._collider)===null||t===void 0?void 0:t.localBounds)!==null&&n!==void 0?n:new ot}update(){var t;let n=(t=this.owner)===null||t===void 0?void 0:t.get(K);this._collider&&(this._collider.owner=this.owner,n&&this._collider.update(n.get()))}collide(t){let n=this._collider,r=t._collider;if(!n||!r)return[];let h=!1;if(r instanceof ge&&(n=r,r=this._collider,h=!0),this._collider){let c=n.collide(r);return c?(h&&c.forEach(f=>{f.mtv=f.mtv.negate(),f.normal=f.normal.negate(),f.tangent=f.normal.perpendicular(),f.colliderA=this._collider,f.colliderB=t._collider}),c):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",n=>{let r=n;t.events.emit("precollision",new Ht(r.target.owner,r.other.owner,r.side,r.intersection))}),this.events.on("postcollision",n=>{let r=n;t.events.emit("postcollision",new ai(r.target.owner,r.other.owner,r.side,r.intersection))}),this.events.on("collisionstart",n=>{let r=n;t.events.emit("collisionstart",new Bn(r.target.owner,r.other.owner,r.contact))}),this.events.on("collisionend",n=>{let r=n;t.events.emit("collisionend",new Ln(r.target.owner,r.other.owner))})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,n,r=I.Half,h=I.Zero){let c=ce.Box(t,n,r,h);return this.set(c)}usePolygonCollider(t,n=I.Zero){let r=ce.Polygon(t,n);return this.set(r)}useCircleCollider(t,n=I.Zero){let r=ce.Circle(t,n);return this.set(r)}useEdgeCollider(t,n){let r=ce.Edge(t,n);return this.set(r)}useCompositeCollider(t){return this.set(new ge(t))}}var Ae;(function(u){u.Rotation="rotation",u.X="x",u.Y="y"})(Ae||(Ae={}));class pt extends He{constructor(t){var n,r,h;super(),this.type="ex.body",this.dependencies=[K,Vt],this.id=y("body",pt._ID++),this.events=new x,this._oldTransform=new Gn,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=ut.PreventCollision,this.group=is.All,this._mass=Y.defaultMass,this.sleepMotion=Y.sleepEpsilon*5,this.canSleep=Y.bodiesCanSleepByDefault,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this.oldVel=new I(0,0),this.oldAcc=I.Zero,t&&(this.collisionType=(n=t.type)!==null&&n!==void 0?n:this.collisionType,this.group=(r=t.group)!==null&&r!==void 0?r:this.group,this.useGravity=(h=t.useGravity)!==null&&h!==void 0?h:this.useGravity)}get matrix(){return this.transform.get().matrix}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===ut.Fixed?0:1/this.mass}get sleeping(){return this._sleeping}setSleeping(t){this._sleeping=t,t?(this.vel=I.Zero,this.acc=I.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=Y.sleepEpsilon*5}updateMotion(){this._sleeping&&this.setSleeping(!0);let t=this.vel.size*this.vel.size+Math.abs(this.angularVelocity*this.angularVelocity),n=Y.sleepBias;this.sleepMotion=n*this.sleepMotion+(1-n)*t,this.sleepMotion=Pe(this.sleepMotion,0,10*Y.sleepEpsilon),this.canSleep&&this.sleepMotion<Y.sleepEpsilon&&this.setSleeping(!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;let t=this.owner.get($t);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});let n=t.get();if(n)return this._cachedInertia=n.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===ut.Fixed?0:1/this.inertia}get active(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.active)}get center(){return this.globalPos}get transform(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(K)}get motion(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(Vt)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this._oldTransform.pos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this._oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this._oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,n){if(this.collisionType!==ut.Active)return;let r=n.scale(this.inverseMass);if(this.limitDegreeOfFreedom.includes(Ae.X)&&(r.x=0),this.limitDegreeOfFreedom.includes(Ae.Y)&&(r.y=0),this.vel.addEqual(r),!this.limitDegreeOfFreedom.includes(Ae.Rotation)){let h=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*h.cross(n)}}applyLinearImpulse(t){if(this.collisionType!==ut.Active)return;let n=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(Ae.X)&&(n.x=0),this.limitDegreeOfFreedom.includes(Ae.Y)&&(n.y=0),this.vel=this.vel.add(n)}applyAngularImpulse(t,n){if(this.collisionType===ut.Active&&!this.limitDegreeOfFreedom.includes(Ae.Rotation)){let r=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*r.cross(n)}}captureOldTransform(){this.__oldTransformCaptured=!0,this.transform.get().clone(this._oldTransform),this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y)}clone(){return super.clone()}}pt._ID=0;class Md{constructor(t){this.data=t,this.type="Component Added"}}function Fd(u){return!!u&&u.type==="Component Added"}class Bd{constructor(t){this.data=t,this.type="Component Removed"}}function Ld(u){return!!u&&u.type==="Component Removed"}let Jm={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate"};class ne{constructor(t,n){if(this.events=new x,this.id=ne._ID++,this.scene=null,this._name="anonymous",this.active=!0,this._componentsToRemove=[],this._componentTypeToInstance=new Map,this._componentStringToInstance=new Map,this._tagsMemo=[],this._typesMemo=[],this.componentAdded$=new fs,this.componentRemoved$=new fs,this._parent=null,this.childrenAdded$=new fs,this.childrenRemoved$=new fs,this._children=[],this._isInitialized=!1,this._setName(n),t)for(let r of t)this.addComponent(r)}_setName(t){t&&(this._name=t)}get name(){return this._name}kill(){this.active&&(this.active=!1,this.unparent())}isKilled(){return!this.active}get tags(){return this._tagsMemo}hasTag(t){return this.tags.includes(t)}addTag(t){return this.addComponent(new Gh(t))}removeTag(t,n=!1){return this.removeComponent(t,n)}get types(){return this._typesMemo}_rebuildMemos(){this._tagsMemo=Array.from(this._componentStringToInstance.values()).filter(t=>t instanceof Gh).map(t=>t.type),this._typesMemo=Array.from(this._componentStringToInstance.keys())}getComponents(){return Array.from(this._componentStringToInstance.values())}_notifyAddComponent(t){this._rebuildMemos();let n=new Md({component:t,entity:this});this.componentAdded$.notifyAll(n)}_notifyRemoveComponent(t){let n=new Bd({component:t,entity:this});this.componentRemoved$.notifyAll(n),this._rebuildMemos()}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(Bs(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){let t=[this],n=this.parent;for(;n;)t.push(n),n=n.parent;return t.reverse()}getDescendants(){let t=[this],n=[this];for(;n.length>0;){let r=n.pop();n=n.concat(r.children),t=t.concat(r.children)}return t}clone(){let t=new ne;for(let n of this.types)t.addComponent(this.get(n).clone());for(let n of this.children)t.addChild(n.clone());return t}addTemplate(t,n=!1){for(let r of t.getComponents())this.addComponent(r.clone(),n);for(let r of t.children)this.addChild(r.clone().addTemplate(r));return this}addComponent(t,n=!1){if(this.has(t.type))if(n)this.removeComponent(t,!0);else return this;if(t.dependencies&&t.dependencies.length)for(let h of t.dependencies)this.addComponent(new h);t.owner=this;let r=t.constructor;return this._componentTypeToInstance.set(r,t),this._componentStringToInstance.set(t.type,t),t.onAdd&&t.onAdd(this),this._notifyAddComponent(t),this}removeComponent(t,n=!1){return n?typeof t=="string"?this._removeComponentByType(t):t instanceof He&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this}clearComponents(){let t=this.getComponents();for(let n of t)this.removeComponent(n)}_removeComponentByType(t){if(this.has(t)){let n=this.get(t);n.owner=null,n.onRemove&&n.onRemove(this);let r=n.constructor;this._componentTypeToInstance.delete(r),this._componentStringToInstance.delete(n.type),this._notifyRemoveComponent(n)}}processComponentRemoval(){for(let t of this._componentsToRemove){let n=typeof t=="string"?t:t.type;this._removeComponentByType(n)}this._componentsToRemove.length=0}has(t){return typeof t=="string"?this._componentStringToInstance.has(t):this._componentTypeToInstance.has(t)}get(t){return typeof t=="string"?this._componentStringToInstance.get(t):this._componentTypeToInstance.get(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),this.events.emit("initialize",new Ui(t,this)),this._isInitialized=!0)}_preupdate(t,n){this.events.emit("preupdate",new nt(t,n,this)),this.onPreUpdate(t,n)}_postupdate(t,n){this.events.emit("postupdate",new bt(t,n,this)),this.onPostUpdate(t,n)}onInitialize(t){}onPreUpdate(t,n){}onPostUpdate(t,n){}update(t,n){this._initialize(t),this._preupdate(t,n);for(let r of this.children)r.update(t,n);this._postupdate(t,n)}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}}ne._ID=0;function $h(u){return!!u.tick}class Wn{constructor(t,n){this._options=t,this._graphics=n,this.graphics=[]}get name(){return this._options.name}hide(t){if(!t)this.graphics.length=0;else{let n=null;t instanceof De?n=t:n=this._graphics.getGraphic(t),this.graphics=this.graphics.filter(r=>r.graphic!==n),this._graphics.recalculateBounds()}}show(t,n){n={...n};let r;return t instanceof De?r=this._graphics.copyGraphics?t.clone():t:(r=this._graphics.getGraphic(t),r||et.getInstance().error(`No such graphic added to component named ${t}. These named graphics are available: `,this._graphics.getNames())),r?(this.graphics.push({graphic:r,options:n}),this._graphics.recalculateBounds(),r):null}use(t,n){return n={...n},this.hide(),this.show(t,n)}get order(){return this._options.order}set order(t){this._options.order=t}get offset(){var t;return(t=this._options.offset)!==null&&t!==void 0?t:I.Zero}set offset(t){this._options.offset=t}get currentKeys(){var t;return(t=this.name)!==null&&t!==void 0?t:"anonymous"}clone(t){let n=new Wn({...this._options},t);return n.graphics=[...this.graphics.map(r=>({graphic:r.graphic.clone(),options:{...r.options}}))],n}}class mo{constructor(t){this._component=t,this._layers=[],this._layerMap={},this.default=new Wn({name:"default",order:0},t),this._maybeAddLayer(this.default)}create(t){let n=new Wn(t,this._component);return this._maybeAddLayer(n)}get(t){return t?this._getLayer(t):this._layers}currentKeys(){let t=[];for(let n of this._layers)t.push(n.currentKeys);return t}has(t){return t in this._layerMap}_maybeAddLayer(t){return this._layerMap[t.name]?this._layerMap[t.name]:(this._layerMap[t.name]=t,this._layers.push(t),this._layers.sort((n,r)=>n.order-r.order),t)}_getLayer(t){return this._layerMap[t]}clone(t){let n=new mo(t);return n._layerMap={},n._layers=[],n.default=this.default.clone(t),n._maybeAddLayer(n.default),this._layers.filter(h=>h.name!=="default").map(h=>h.clone(t)).forEach(h=>n._maybeAddLayer(h)),n}}class ue extends He{getGraphic(t){return this._graphics[t]}getNames(){return Object.keys(this._graphics)}constructor(t){super(),this.type="ex.graphics",this._graphics={},this.visible=!0,this.opacity=1,this.offset=I.Zero,this.anchor=I.Half,this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,this._localBounds=null,t={visible:this.visible,...t};let{current:n,anchor:r,opacity:h,visible:c,graphics:f,offset:p,copyGraphics:_,onPreDraw:v,onPostDraw:w}=t;this._graphics=f||{},this.offset=p??this.offset,this.opacity=h??this.opacity,this.anchor=r??this.anchor,this.copyGraphics=_??this.copyGraphics,this.onPreDraw=v??this.onPreDraw,this.onPostDraw=w??this.onPostDraw,this.visible=!!c,this.layers=new mo(this),n&&this._graphics[n]&&this.show(this._graphics[n])}get current(){return this.layers.default.graphics}get graphics(){return this._graphics}add(t,n){let r="default",h=null;return typeof t=="string"?(r=t,h=n):h=t,this._graphics[r]=this.copyGraphics?h.clone():h,r==="default"&&this.show("default"),h}show(t,n){let r=this.layers.default.show(t,n);return this.recalculateBounds(),r}use(t,n){let r=this.layers.default.use(t,n);return this.recalculateBounds(),r}hide(t){this.layers.default.hide(t)}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new ot;for(let n of this.layers.get())for(let{graphic:r,options:h}of n.graphics){let c=this.anchor,f=this.offset;h?.anchor&&(c=h.anchor),h?.offset&&(f=h.offset);let p=r.localBounds,_=-p.width*c.x+f.x,v=-p.height*c.y+f.y;t=r?.localBounds.translate(M(_+n.offset.x,v+n.offset.y)).combine(t)}this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}update(t,n=0){for(let r of this.layers.get())for(let{graphic:h}of r.graphics)$h(h)&&h?.tick(t,n)}clone(){let t=new ue;return t._graphics={...this._graphics},t.offset=this.offset.clone(),t.opacity=this.opacity,t.anchor=this.anchor.clone(),t.copyGraphics=this.copyGraphics,t.onPreDraw=this.onPreDraw,t.onPostDraw=this.onPostDraw,t.visible=this.visible,t.layers=this.layers.clone(t),t}}class vo extends Ki{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new vo({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class yo extends Ki{get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}constructor(t){var n,r,h;super(t),this._radius=0;let c=(n=t.lineWidth)!==null&&n!==void 0?n:t.strokeColor?1:0;this.padding=(r=t.padding)!==null&&r!==void 0?r:2+c/2,this.radius=t.radius,this.filtering=(h=t.filtering)!==null&&h!==void 0?h:_e.Blended,this.rasterize()}clone(){return new yo({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class Xi extends He{constructor(){super(...arguments),this.type="ex.pointer",this.useColliderShape=!0,this.useGraphicsBounds=!1}}class Bt{static CreateReversibleEasingFunction(t){return(n,r,h,c)=>h<r?r-(t(n,h,r,c)-h):t(n,r,h,c)}static CreateVectorEasingFunction(t){return(n,r,h,c)=>new I(t(n,r.x,h.x,c),t(n,r.y,h.y,c))}}Bt.Linear=Bt.CreateReversibleEasingFunction((u,t,n,r)=>(n=n-t,n*u/r+t)),Bt.EaseInQuad=Bt.CreateReversibleEasingFunction((u,t,n,r)=>(n=n-t,u/=r,n*u*u+t)),Bt.EaseOutQuad=Bt.CreateReversibleEasingFunction((u,t,n,r)=>(n=n-t,u/=r,-n*u*(u-2)+t)),Bt.EaseInOutQuad=Bt.CreateReversibleEasingFunction((u,t,n,r)=>(n=n-t,u/=r/2,u<1?n/2*u*u+t:(u--,-n/2*(u*(u-2)-1)+t))),Bt.EaseInCubic=Bt.CreateReversibleEasingFunction((u,t,n,r)=>(n=n-t,u/=r,n*u*u*u+t)),Bt.EaseOutCubic=Bt.CreateReversibleEasingFunction((u,t,n,r)=>(n=n-t,u/=r,u--,n*(u*u*u+1)+t)),Bt.EaseInOutCubic=Bt.CreateReversibleEasingFunction((u,t,n,r)=>(n=n-t,u/=r/2,u<1?n/2*u*u*u+t:(u-=2,n/2*(u*u*u+2)+t)));class Nd{constructor(t){this._actions=[],this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){let n=this._actions.indexOf(t);this._actions.splice(n,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();let t=this._actions.length;for(let n=0;n<t;n++)this._actions[n].reset();this._completedActions=[]}update(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._entity)&&this._completedActions.push(this._actions.shift()))}}class Vd{constructor(t,n,r){this._stopped=!1,this._repeatBuilder=n,this._repeatContext=new qn(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=r,this._originalRepeat=r,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Od{constructor(t,n){this._stopped=!1,this._repeatBuilder=n,this._repeatContext=new qn(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class Ud{constructor(t,n,r,h){if(this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(K),this._motion=t.get(Vt),this._speed=h,this._offset=new I(n,r),h<=0)throw et.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+h),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new I(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=M(this._end.x,this._end.y),this._motion.vel=M(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){let n=t.get(K);return this._stopped||n.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=M(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class zd{constructor(t,n,r,h){this.entity=t,this._started=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._end=new I(n,r),this._speed=h}update(t){this._started||(this._started=!0,this._start=new I(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());let n=this._dir.scale(this._speed);this._motion.vel=M(n.x,n.y),this.isComplete(this.entity)&&(this._tx.pos=M(this._end.x,this._end.y),this._motion.vel=M(0,0))}isComplete(t){let n=t.get(K);return this._stopped||new I(n.pos.x,n.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=M(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}var qe;(function(u){u[u.ShortestPath=0]="ShortestPath",u[u.LongestPath=1]="LongestPath",u[u.Clockwise=2]="Clockwise",u[u.CounterClockwise=3]="CounterClockwise"})(qe||(qe={}));class Gd{constructor(t,n,r,h){this._started=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._end=n,this._speed=r,this._rotationType=h||qe.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;let n=Math.abs(this._end-this._start),r=es-n;switch(n>r?(this._shortDistance=r,this._longDistance=n):(this._shortDistance=n,this._longDistance=r),this._shortestPathIsPositive=(this._start-this._end+es)%es>=Math.PI,this._rotationType){case qe.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case qe.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case qe.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case qe.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){let t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Hd{constructor(t,n,r,h){this._started=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._speed=r,this._offset=n,this._rotationType=h||qe.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;let n=Math.abs(this._end-this._start),r=es-n;switch(n>r?(this._shortDistance=r,this._longDistance=n):(this._shortDistance=n,this._longDistance=r),this._shortestPathIsPositive=(this._start-this._end+es)%es>=Math.PI,this._rotationType){case qe.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case qe.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case qe.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case qe.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){let t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}class Wd{constructor(t,n,r,h,c){this._started=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._endX=n,this._endY=r,this._speedX=h,this._speedY=c}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{let n=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*n}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{let n=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*n}this.isComplete()&&(this._tx.scale=M(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class qd{constructor(t,n,r,h){this._started=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._offset=new I(n,r),this._speedX=this._speedY=h}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class jd{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class $d{constructor(t,n,r,h,c){this.easingFcn=c,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new I(0,0),this._lerpEnd=new I(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._lerpDuration=h,this._lerpEnd=new I(n,r)}_initialize(){this._lerpStart=new I(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let n=this._tx.pos.x,r=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?n=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):n=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?r=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):r=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=M((n-this._tx.pos.x)/(t/1e3),(r-this._tx.pos.y)/(t/1e3))):(this._tx.pos=M(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=I.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=M(0,0),this._stopped=!0}}class Kd{constructor(t,n,r,h,c){this.easingFcn=c,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new I(0,0),this._lerpEnd=new I(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._lerpDuration=h,this._offset=new I(n,r)}_initialize(){this._lerpStart=new I(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let n=this._tx.pos.x,r=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?n=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):n=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?r=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):r=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=M((n-this._tx.pos.x)/(t/1e3),(r-this._tx.pos.y)/(t/1e3))):(this._tx.pos=M(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=I.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=M(0,0),this._stopped=!0}}class Qd{constructor(t,n,r,h=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(ue),this._timeVisible=n,this._timeNotVisible=r,this._duration=(n+r)*h}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.visible&&this._elapsedTime>=this._timeVisible&&(this._graphics.visible=!1,this._elapsedTime=0),!this._graphics.visible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.visible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.visible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class Xd{constructor(t,n,r){this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(ue),this._endOpacity=n,this._speed=this._ogspeed=r}update(t){this._graphics&&(this._started||(this._started=!0,this._speed=this._ogspeed,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),et.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||Math.abs(this._graphics.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Yd{constructor(t){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class Zd{constructor(t){this._stopped=!1,this._entity=t}update(t){this._entity.get(Yi).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class Kh{constructor(t,n,r){this._started=!1,this._stopped=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._followTx=n.get(K),this._followMotion=n.get(Vt),this._current=new I(this._tx.pos.x,this._tx.pos.y),this._end=new I(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=r!==void 0?r:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());let n=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(n!==0&&(this._speed=n),this._current=M(this._tx.pos.x,this._tx.pos.y),this._end=M(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){let r=this._dir.scale(this._speed);this._motion.vel=M(r.x,r.y)}else this._motion.vel=M(0,0);this.isComplete()&&(this._tx.pos=M(this._end.x,this._end.y),this._motion.vel=M(0,0))}stop(){this._motion.vel=M(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class Qh{constructor(t,n,r){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(K),this._motion=t.get(Vt),this._meetTx=n.get(K),this._meetMotion=n.get(Vt),this._current=new I(this._tx.pos.x,this._tx.pos.y),this._end=new I(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=r||0,r!==void 0&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());let n=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));n!==0&&!this._speedWasSpecified&&(this._speed=n),this._current=M(this._tx.pos.x,this._tx.pos.y),this._end=M(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();let r=this._dir.scale(this._speed);this._motion.vel=M(r.x,r.y),this.isComplete()&&(this._tx.pos=M(this._end.x,this._end.y),this._motion.vel=M(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=M(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=void 0}}class qn{constructor(t){this._entity=t,this._queue=new Nd(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}easeTo(...t){var n,r;let h=0,c=0,f=0,p=Bt.Linear;return t[0]instanceof I?(h=t[0].x,c=t[0].y,f=t[1],p=(n=t[2])!==null&&n!==void 0?n:p):(h=t[0],c=t[1],f=t[2],p=(r=t[3])!==null&&r!==void 0?r:p),this._queue.add(new $d(this._entity,h,c,f,p)),this}easeBy(...t){var n,r;let h=0,c=0,f=0,p=Bt.Linear;return t[0]instanceof I?(h=t[0].x,c=t[0].y,f=t[1],p=(n=t[2])!==null&&n!==void 0?n:p):(h=t[0],c=t[1],f=t[2],p=(r=t[3])!==null&&r!==void 0?r:p),this._queue.add(new Kd(this._entity,h,c,f,p)),this}moveTo(t,n,r){let h=0,c=0,f=0;return t instanceof I?(h=t.x,c=t.y,f=n):(h=t,c=n,f=r),this._queue.add(new zd(this._entity,h,c,f)),this}moveBy(t,n,r){let h=0,c=0,f=0;return t instanceof I?(h=t.x,c=t.y,f=n):(h=t,c=n,f=r),this._queue.add(new Ud(this._entity,h,c,f)),this}rotateTo(t,n,r){return this._queue.add(new Gd(this._entity,t,n,r)),this}rotateBy(t,n,r){return this._queue.add(new Hd(this._entity,t,n,r)),this}scaleTo(t,n,r,h){let c=1,f=1,p=0,_=0;return t instanceof I&&n instanceof I&&(c=t.x,f=t.y,p=n.x,_=n.y),typeof t=="number"&&typeof n=="number"&&(c=t,f=n,p=r,_=h),this._queue.add(new Wd(this._entity,c,f,p,_)),this}scaleBy(t,n,r){let h=1,c=1;return t instanceof I&&(h=t.x,c=t.y,r=n),typeof t=="number"&&typeof n=="number"&&(h=t,c=n),this._queue.add(new qd(this._entity,h,c,r)),this}blink(t,n,r=1){return this._queue.add(new Qd(this._entity,t,n,r)),this}fade(t,n){return this._queue.add(new Xd(this._entity,t,n)),this}delay(t){return this._queue.add(new Yd(t)),this}die(){return this._queue.add(new Zd(this._entity)),this}callMethod(t){return this._queue.add(new jd(t)),this}repeat(t,n){return n?(this._queue.add(new Vd(this._entity,t,n)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Od(this._entity,t)),this}follow(t,n){return n===void 0?this._queue.add(new Kh(this._entity,t)):this._queue.add(new Kh(this._entity,t,n)),this}meet(t,n){return n===void 0?this._queue.add(new Qh(this._entity,t)):this._queue.add(new Qh(this._entity,t,n)),this}toPromise(){return new Promise(n=>{this._queue.add(new jd(()=>{n()}))})}}class Yi extends He{constructor(){super(...arguments),this.type="ex.actions",this.dependencies=[K,Vt]}onAdd(t){this._ctx=new qn(t)}onRemove(){this._ctx=null}getQueue(){var t;return(t=this._ctx)===null||t===void 0?void 0:t.getQueue()}runAction(t){var n;return(n=this._ctx)===null||n===void 0?void 0:n.runAction(t)}update(t){var n;return(n=this._ctx)===null||n===void 0?void 0:n.update(t)}clearActions(){var t;(t=this._ctx)===null||t===void 0||t.clearActions()}easeTo(...t){return this._ctx.easeTo.apply(this._ctx,t)}easeBy(...t){return this._ctx.easeBy.apply(this._ctx,t)}moveTo(t,n,r){return this._ctx.moveTo.apply(this._ctx,[t,n,r])}moveBy(t,n,r){return this._ctx.moveBy.apply(this._ctx,[t,n,r])}rotateTo(t,n,r){return this._ctx.rotateTo(t,n,r)}rotateBy(t,n,r){return this._ctx.rotateBy(t,n,r)}scaleTo(t,n,r,h){return this._ctx.scaleTo.apply(this._ctx,[t,n,r,h])}scaleBy(t,n,r){return this._ctx.scaleBy.apply(this._ctx,[t,n,r])}blink(t,n,r){return this._ctx.blink(t,n,r)}fade(t,n){return this._ctx.fade(t,n)}delay(t){return this._ctx.delay(t)}die(){return this._ctx.die()}callMethod(t){return this._ctx.callMethod(t)}repeat(t,n){return this._ctx.repeat(t,n)}repeatForever(t){return this._ctx.repeatForever(t)}follow(t,n){return this._ctx.follow(t,n)}meet(t,n){return this._ctx.meet(t,n)}toPromise(){return this._ctx.toPromise()}}var wo;(function(u){u.Em="em",u.Rem="rem",u.Px="px",u.Pt="pt",u.Percent="%"})(wo||(wo={}));var xo;(function(u){u.Left="left",u.Right="right",u.Center="center",u.Start="start",u.End="end"})(xo||(xo={}));var bo;(function(u){u.Top="top",u.Hanging="hanging",u.Middle="middle",u.Alphabetic="alphabetic",u.Ideographic="ideographic",u.Bottom="bottom"})(bo||(bo={}));var Eo;(function(u){u.Normal="normal",u.Italic="italic",u.Oblique="oblique"})(Eo||(Eo={}));var To;(function(u){u.LeftToRight="ltr",u.RightToLeft="rtl"})(To||(To={}));class Zi{constructor(t,n,r,h){this.font=t,this.text=n,this.color=r,this.maxWidth=h,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.dimensions=this.measureText(n),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,n){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let r=null;n!=null?r=this._getLinesFromText(t,n):r=t.split(`
`);let h=r.reduce((C,S)=>C.length>S.length?C:S);this._applyFont(this.ctx);let c=this.ctx.measureText(h),f=Math.abs(c.actualBoundingBoxAscent)+Math.abs(c.actualBoundingBoxDescent),p=f*r.length;f=p;let _=p-Math.abs(c.actualBoundingBoxAscent),v=0,w=0;return new ot({left:v-Math.abs(c.actualBoundingBoxLeft)-this.font.padding,top:w-Math.abs(c.actualBoundingBoxAscent)-this.font.padding,bottom:w+_+this.font.padding,right:v+Math.abs(c.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,n){n.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,n.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality}static getHashCode(t,n,r){var h;return n+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((h=t.strokeColor)===null||h===void 0?void 0:h.toString())+(r?r.toString():t.color.toString()))}getHashCode(t=!0){return Zi.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var n,r;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((n=this.font.lineDash)!==null&&n!==void 0?n:t.getLineDash()),t.strokeStyle=(r=this.font.strokeColor)===null||r===void 0?void 0:r.toString(),t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(t.shadowColor=this.font.shadow.color.toString(),t.shadowBlur=this.font.shadow.blur,t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y)}_drawText(t,n,r){this._applyRasterProperties(t),this._applyFont(t);for(let h=0;h<n.length;h++){let c=n[h];this.color&&t.fillText(c,0,h*r),this.font.strokeColor&&t.strokeText(c,0,h*r)}this.font.showDebug&&(Nh(t,O.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),Nh(t,O.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){let n=[],r=0,h=0,c=Math.min(4096,t.canvas.width),f=Math.min(4096,t.canvas.height);for(;r<t.canvas.width;){for(;h<t.canvas.height;){let p=document.createElement("canvas");p.width=c,p.height=f,p.getContext("2d").drawImage(t.canvas,r,h,c,f,0,0,c,f),n.push({x:r,y:h,canvas:p}),h+=f}r+=c,h=0}return n}flagDirty(){this._dirty=!0}render(t,n,r,h){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=t;let c=this.getHashCode();if(this._lastHashCode!==c&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,h),this._setDimension(this.dimensions,this.ctx);let f=this._getLinesFromText(this.text,h),p=this.dimensions.height/f.length;if(this._drawText(this.ctx,f,p),t instanceof Qs)for(let _ of this._textFragments)t.textureLoader.delete(_.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),t instanceof Qs)for(let _ of this._textFragments)t.textureLoader.load(_.canvas,this.font.filtering,!0);this._lastHashCode=c,this._dirty=!1}for(let f of this._textFragments)t.drawImage(f.canvas,0,0,f.canvas.width,f.canvas.height,f.x/this.font.quality+n-this.ctx.canvas.width/this.font.quality/2,f.y/this.font.quality+r-this.ctx.canvas.height/this.font.quality/2,f.canvas.width/this.font.quality,f.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof Qs)for(let t of this._textFragments)this._ex.textureLoader.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,n){if(this._chachedText===t&&this._cachedRenderWidth===n)return this._chachedLines;let r=t.split(`
`);if(n==null)return r;for(let h=0;h<r.length;h++){let c=r[h],f="";if(this.measureText(c).width>n){for(;this.measureText(c).width>n;)f=c[c.length-1]+f,c=c.slice(0,-1);r[h]=c,r[h+1]=f}}return this._chachedText=t,this._chachedLines=r,this._cachedRenderWidth=n,r}}class Pt{static measureText(t,n,r){let h=Zi.getHashCode(n,t);if(Pt._MEASURE_CACHE.has(h))return Pt._MEASURE_CACHE.get(h);Pt._LOGGER.debug("Font text measurement cache miss");let c=n.measureTextWithoutCache(t,r);return Pt._MEASURE_CACHE.set(h,c),c}static getTextInstance(t,n,r){let h=Zi.getHashCode(n,t,r),c=Pt._TEXT_CACHE.get(h);return c||(c=new Zi(n,t,r),Pt._TEXT_CACHE.set(h,c),Pt._LOGGER.debug("Font text instance cache miss")),Pt._TEXT_USAGE.set(c,performance.now()),c}static checkAndClearCache(){let t=[],n=new Set;for(let[h,c]of Pt._TEXT_USAGE.entries())if(c+100<performance.now())Pt._LOGGER.debug(`Text cache entry timed out ${h.text}`),t.push(h),h.dispose();else{let f=h.getHashCode(!1);n.add(f)}t.forEach(h=>{Pt._TEXT_USAGE.delete(h)}),this._TEXT_CACHE.clear();for(let[h]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(h.getHashCode(),h);let r=new Map;for(let h of n)Pt._MEASURE_CACHE.has(h)&&r.set(h,Pt._MEASURE_CACHE.get(h));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=r}static get cacheSize(){return Pt._TEXT_USAGE.size}static clearCache(){for(let[t]of Pt._TEXT_USAGE.entries())t.dispose();Pt._TEXT_USAGE.clear(),Pt._TEXT_CACHE.clear(),Pt._MEASURE_CACHE.clear()}}Pt._LOGGER=et.getInstance(),Pt._TEXT_USAGE=new Map,Pt._TEXT_CACHE=new Map,Pt._MEASURE_CACHE=new Map;class Ji extends De{constructor(t={}){var n,r,h,c,f,p,_,v,w,E,C,S,k,N,V,D,R,z,G;super(t),this.filtering=_e.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=O.Black,this.family="sans-serif",this.style=Eo.Normal,this.bold=!1,this.unit=wo.Px,this.textAlign=xo.Left,this.baseAlign=bo.Alphabetic,this.direction=To.LeftToRight,this.size=10,this.shadow=null,this._textBounds=new ot,this._textMeasurement=new Zi(this,"",O.Black),this.smoothing=(n=t?.smoothing)!==null&&n!==void 0?n:this.smoothing,this.padding=(r=t?.padding)!==null&&r!==void 0?r:this.padding,this.color=(h=t?.color)!==null&&h!==void 0?h:this.color,this.strokeColor=(c=t?.strokeColor)!==null&&c!==void 0?c:this.strokeColor,this.lineDash=(f=t?.lineDash)!==null&&f!==void 0?f:this.lineDash,this.lineWidth=(p=t?.lineWidth)!==null&&p!==void 0?p:this.lineWidth,this.filtering=(_=t?.filtering)!==null&&_!==void 0?_:this.filtering,this.family=(v=t?.family)!==null&&v!==void 0?v:this.family,this.style=(w=t?.style)!==null&&w!==void 0?w:this.style,this.bold=(E=t?.bold)!==null&&E!==void 0?E:this.bold,this.size=(C=t?.size)!==null&&C!==void 0?C:this.size,this.unit=(S=t?.unit)!==null&&S!==void 0?S:this.unit,this.textAlign=(k=t?.textAlign)!==null&&k!==void 0?k:this.textAlign,this.baseAlign=(N=t?.baseAlign)!==null&&N!==void 0?N:this.baseAlign,this.direction=(V=t?.direction)!==null&&V!==void 0?V:this.direction,this.quality=(D=t?.quality)!==null&&D!==void 0?D:this.quality,t?.shadow&&(this.shadow={},this.shadow.blur=(R=t.shadow.blur)!==null&&R!==void 0?R:this.shadow.blur,this.shadow.offset=(z=t.shadow.offset)!==null&&z!==void 0?z:this.shadow.offset,this.shadow.color=(G=t.shadow.color)!==null&&G!==void 0?G:this.shadow.color)}clone(){return new Ji({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,n,r){}_rotate(t){var n;let r=(n=this.origin)!==null&&n!==void 0?n:this._textBounds.center;t.translate(r.x,r.y),t.rotate(this.rotation),t.translate(-r.x,-r.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,n){return this._textMeasurement.measureText(t,n)}measureText(t,n){return Pt.measureText(t,this,n)}_postDraw(t){t.restore()}render(t,n,r,h,c,f){let p=Pt.getTextInstance(n,this,r);this._textBounds=p.dimensions,this._preDraw(t,h,c),p.render(t,h,c,f),this._postDraw(t)}}class jn extends De{constructor(t){var n,r;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(n=t.font)!==null&&n!==void 0?n:new Ji,this.color=(r=t.color)!==null&&r!==void 0?r:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,n;return new jn({text:this.text.slice(),color:(n=(t=this.color)===null||t===void 0?void 0:t.clone())!==null&&n!==void 0?n:O.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){let{width:t,height:n}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=n}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_preDraw(t,n,r){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(t,n,r)}_drawImage(t,n,r){var h;let c=O.Black;this.font instanceof Ji&&(c=(h=this.color)!==null&&h!==void 0?h:this.font.color);let{width:f,height:p}=this.font.measureText(this._text,this.maxWidth);this._textWidth=f,this._textHeight=p,this.font.render(t,this._text,c,n,r,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(n-f,r-p,f*2,p*2),this.maxWidth!=null&&t.debug.drawRect(n,r,this.maxWidth,this.height,{color:O.Yellow}))}}function J0(u){return u instanceof rs}let tb={CollisionStart:"collisionstart",CollisionEnd:"collisionend",PreCollision:"precollision",PostCollision:"postcollision",Kill:"kill",PreKill:"prekill",PostKill:"postkill",PreDraw:"predraw",PostDraw:"postdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerEnter:"pointerenter",PointerLeave:"pointerleave",PointerMove:"pointermove",PointerCancel:"pointercancel",Wheel:"pointerwheel",PointerDrag:"pointerdragstart",PointerDragEnd:"pointerdragend",PointerDragEnter:"pointerdragenter",PointerDragLeave:"pointerdragleave",PointerDragMove:"pointerdragmove",EnterViewPort:"enterviewport",ExitViewPort:"exitviewport"};class rs extends ne{get body(){return this.get(pt)}get transform(){return this.get(K)}get motion(){return this.get(Vt)}get graphics(){return this.get(ue)}get collider(){return this.get($t)}get pointer(){return this.get(Xi)}get actions(){return this.get(Yi)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(K).scale}set scale(t){this.get(K).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=li(t,n=>this._handleAnchorChange(n)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){var n;this._color=t.clone();let h=(n=this.graphics.layers.default.graphics[0])===null||n===void 0?void 0:n.graphic;(h instanceof Ki||h instanceof jn)&&(h.color=this._color)}constructor(t){super(),this.events=new x,this._anchor=li(I.Half,F=>this._handleAnchorChange(F)),this.logger=et.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=F=>{this._dragging&&(this.pos=F.worldPos)},this._pointerDragLeaveHandler=F=>{this._dragging&&(this.pos=F.worldPos)};let{name:n,x:r,y:h,pos:c,coordPlane:f,scale:p,width:_,height:v,radius:w,collider:E,vel:C,acc:S,rotation:k,angularVelocity:N,z:V,color:D,visible:R,anchor:z,collisionType:G,collisionGroup:st}={...t};this._setName(n),this.anchor=z??rs.defaults.anchor.clone();let Q=new K;this.addComponent(Q),this.pos=c??M(r??0,h??0),this.rotation=k??0,this.scale=p??M(1,1),this.z=V??0,Q.coordPlane=f??ke.World,this.addComponent(new Xi),this.addComponent(new ue({anchor:this.anchor})),this.addComponent(new Vt),this.vel=C??I.Zero,this.acc=S??I.Zero,this.angularVelocity=N??0,this.addComponent(new Yi),this.addComponent(new pt),this.body.collisionType=G??ut.Passive,st&&(this.body.group=st),E?this.addComponent(new $t(E)):w?this.addComponent(new $t(ce.Circle(w))):_>0&&v>0?this.addComponent(new $t(ce.Box(_,v,this.anchor))):this.addComponent(new $t),this.graphics.visible=R??!0,D&&(this.color=D,_&&v?this.graphics.add(new vo({color:D,width:_,height:v})):w&&this.graphics.add(new yo({color:D,radius:w})))}clone(){let t=new rs({color:this.color.clone(),anchor:this.anchor.clone()});t.clearComponents(),t.processComponentRemoval();let n=this.getComponents();for(let r of n)t.addComponent(r.clone(),!0);return t}onInitialize(t){}_initialize(t){super._initialize(t);for(let n of this.children)n._initialize(t)}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}_prekill(t){this.events.emit("prekill",new B(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){this.events.emit("postkill",new H(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new P(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.active=!0}isKilled(){return!this.active}get z(){return this.get(K).z}set z(t){this.get(K).z=t}get center(){let t=this.getGlobalPos();return new I(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new I(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(K).globalRotation}getGlobalPos(){return this.get(K).globalPos}getGlobalScale(){return this.get(K).globalScale}contains(t,n,r=!1){let h=M(t,n),c=this.get($t);c.update();let f=c.get();if(!f)return!1;let p=f.contains(h);return r?p||this.children.some(_=>_.contains(t,n,!0)):p}within(t,n){let r=this.get($t),h=t.get($t),c=r.get(),f=h.get();return c&&f?c.getClosestLineBetween(f).getLength()<=n:!1}update(t,n){this._initialize(t),this._preupdate(t,n),this._postupdate(t,n)}onPreUpdate(t,n){}onPostUpdate(t,n){}_preupdate(t,n){this.events.emit("preupdate",new nt(t,n,this)),this.onPreUpdate(t,n)}_postupdate(t,n){this.events.emit("postupdate",new bt(t,n,this)),this.onPostUpdate(t,n)}}rs.defaults={anchor:I.Half};function Jd(u){return u instanceof Xh}class Xh extends rs{constructor(t){var n,r;super({...t}),this.get(K).coordPlane=ke.Screen,this.anchor=(n=t?.anchor)!==null&&n!==void 0?n:M(0,0),this.body.collisionType=(r=t?.collisionType)!==null&&r!==void 0?r:ut.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!t?.collider&&t?.width>0&&t?.height>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,n,r=!0){if(r)return super.contains(t,n);let h=this._engine.worldToScreenCoordinates(new I(t,n));return super.contains(h.x,h.y)}}class _i{get complete(){return this._complete}constructor(t,n,r,h,c,f){if(this._logger=et.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null,typeof t!="function"){let p=t;t=p.fcn,n=p.interval,r=p.repeats,h=p.numberOfRepeats,c=p.randomRange,f=p.random}if(h&&h>=0&&(this.maxNumberOfRepeats=h,!r))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=_i._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=n,c){if(c[0]>c[1])throw new Error("min value must be lower than max value for range");this.random=f??new On,this.randomRange=c,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=r||this.repeats,t&&this.on(t)}on(t){this._callbacks.push(t)}off(t){let n=this._callbacks.indexOf(t);this._callbacks.splice(n,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(n=>{n.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,n){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=n,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}_i._MAX_ID=0;class Ao extends He{constructor(t){super(),this.type="ex.parallax",this.parallaxFactor=M(1,1),this.parallaxFactor=t??this.parallaxFactor}}class Co extends He{constructor(t,n=!0){super(),this.draw=t,this.useTransform=n,this.type="ex.debuggraphics"}}let tv={PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw"};class tf extends ne{flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let t=0;t<this.tiles.length;t++)this.tiles[t]&&this.tiles[t].flagDirty()}get x(){var t;return(t=this._transform.pos.x)!==null&&t!==void 0?t:0}set x(t){var n;!((n=this._transform)===null||n===void 0)&&n.pos&&(this.get(K).pos=M(t,this.y))}get y(){var t,n;return(n=(t=this._transform)===null||t===void 0?void 0:t.pos.y)!==null&&n!==void 0?n:0}set y(t){var n;!((n=this._transform)===null||n===void 0)&&n.pos&&(this._transform.pos=M(this.x,t))}get z(){var t;return(t=this._transform.z)!==null&&t!==void 0?t:0}set z(t){this._transform&&(this._transform.z=t)}get rotation(){var t,n;return(n=(t=this._transform)===null||t===void 0?void 0:t.rotation)!==null&&n!==void 0?n:0}set rotation(t){var n;!((n=this._transform)===null||n===void 0)&&n.rotation&&(this._transform.rotation=t)}get scale(){var t,n;return(n=(t=this._transform)===null||t===void 0?void 0:t.scale)!==null&&n!==void 0?n:I.One}set scale(t){var n;!((n=this._transform)===null||n===void 0)&&n.scale&&(this._transform.scale=t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}constructor(t){var n,r;super(null,t.name),this.events=new x,this._token=0,this.logger=et.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this._collidersDirty=!0,this._originalOffsets=new WeakMap,this.addComponent(new K),this.addComponent(new Vt),this.addComponent(new pt({type:ut.Fixed})),this.addComponent(new ue({onPostDraw:(c,f)=>this.draw(c,f)})),this.addComponent(new Co(c=>this.debug(c))),this.addComponent(new $t),this._graphics=this.get(ue),this._transform=this.get(K),this._motion=this.get(Vt),this._collider=this.get($t),this._composite=this._collider.useCompositeCollider([]),this._transform.pos=(n=t.pos)!==null&&n!==void 0?n:I.Zero,this._oldPos=this._transform.pos.clone(),this._oldScale=this._transform.scale.clone(),this.renderFromTopOfGraphic=(r=t.renderFromTopOfGraphic)!==null&&r!==void 0?r:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let h=[];for(let c=0;c<this.columns;c++){for(let f=0;f<this.rows;f++){let p=new ef({x:c,y:f,map:this});p.map=this,this.tiles[c+f*this.columns]=p,h.push(p),this._rows[f]||(this._rows[f]=[]),this._rows[f].push(p)}this._cols[c]=h,h=[]}this._graphics.localBounds=new ot({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}_initialize(t){super._initialize(t),this._engine=t}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{let n=t.offset;return this._originalOffsets.set(t,n),n}}_updateColliders(){this._collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();let t=[];this._composite=this._collider.useCompositeCollider([]);let n;for(let r=0;r<this.columns;r++){for(let h=0;h<this.rows;h++){h===0&&(n=null);let c=this.tiles[r+h*this.columns];if(c.solid)if(c.getColliders().length>0){for(let f of c.getColliders()){let p=this._getOrSetColliderOriginalOffset(f);f.offset=M(c.x*this.tileWidth*this.scale.x,c.y*this.tileHeight*this.scale.y).add(p),f.owner=this,this._composite.addCollider(f)}n&&t.push(n),n=null}else n?n=n.combine(c.bounds):n=c.bounds;else n&&t.push(n),n=null}if(n){let h=t[t.length-1];h&&h.top===n.top&&h.bottom===n.bottom?t[t.length-1]=h.combine(n):t.push(n)}}for(let r of t){let h=ce.Box(r.width,r.height,I.Zero,M(r.left-this.pos.x,r.top-this.pos.y));h.owner=this,this._composite.addCollider(h)}this._collider.update(),this._collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){return this.tiles[t]}getTile(t,n){return t<0||n<0||t>=this.columns||n>=this.rows?null:this.tiles[t+n*this.columns]}getTileByPoint(t){let n=Math.floor((t.x-this.pos.x)/(this.tileWidth*this.scale.x)),r=Math.floor((t.y-this.pos.y)/(this.tileHeight*this.scale.y)),h=this.getTile(n,r);return n>=0&&r>=0&&n<this.columns&&r<this.rows&&h?h:null}getRows(){return this._rows}getColumns(){return this._cols}update(t,n){this.onPreUpdate(t,n),this.emit("preupdate",new nt(t,n,this)),(!this._oldPos.equals(this.pos)||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._token++,this.pos.clone(this._oldPos),this.scale.clone(this._oldScale),this._transform.pos=this.pos,this.onPostUpdate(t,n),this.emit("postupdate",new bt(t,n,this))}draw(t,n){this.emit("predraw",new at(t,n,this));let r=this._engine.screen.getWorldBounds(),h=0,c=this.columns,f=0,p=this.rows,_,v,w,E=this.get(Ao);if(E){let S=this.pos,k=I.One.sub(E.parallaxFactor),N=this._engine.currentScene.camera.pos.scale(k);S=S.sub(N),r=r.translate(S)}let C;for(h;h<c;h++){for(f;f<p;f++)if(C=this.getTile(h,f),!!r.overlaps(C.bounds))for(_=this.getTile(h,f).getGraphics(),v=0,w=_.length;v<w;v++){let S=_[v];if(S){$h(S)&&S?.tick(n,this._token);let k=this.renderFromTopOfGraphic?0:S.height-this.tileHeight;S.draw(t,h*this.tileWidth,f*this.tileHeight-k)}}f=0}this.emit("postdraw",new ct(t,n,this))}debug(t){let n=this.tileWidth*this.columns,r=this.tileHeight*this.rows,h=I.Zero;for(let f=0;f<this.rows+1;f++){let p=M(0,f*this.tileHeight);t.drawLine(h.add(p),h.add(M(n,p.y)),O.Red,2)}for(let f=0;f<this.columns+1;f++){let p=M(f*this.tileWidth,0);t.drawLine(h.add(p),h.add(M(p.x,r)),O.Red,2)}let c=this._composite.getColliders();for(let f of c){let p=O.Gray;p.a=.5;let _=f.localBounds,v=f.worldPos.sub(this.pos);t.drawRectangle(v,_.width,_.height,p)}}}class ef extends ne{get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(t){var n;(n=this.map)===null||n===void 0||n.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t)}removeGraphic(t){Bs(t,this._graphics)}clearGraphics(){this._graphics.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){let n=this._colliders.indexOf(t);n>-1&&this._colliders.splice(n,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}constructor(t){var n,r;super(),this._posDirty=!1,this._solid=!1,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this._width=t.map.tileWidth*this.map.scale.x,this._height=t.map.tileHeight*this.map.scale.y,this.solid=(n=t.solid)!==null&&n!==void 0?n:this.solid,this._graphics=(r=t.graphics)!==null&&r!==void 0?r:[],this._recalculate()}flagDirty(){return this._posDirty=!0}_recalculate(){this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(M(this.x*this._width,this.y*this._height)),this._bounds=new ot(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get center(){return this._posDirty&&this._recalculate(),new I(this._pos.x+this._width/2,this._pos.y+this._height/2)}}class sf{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new nf(t))}lockToActorAxis(t,n){this.camera.addStrategy(new rf(t,n))}elasticToActor(t,n,r){this.camera.addStrategy(new of(t,n,r))}radiusAroundActor(t,n){this.camera.addStrategy(new af(t,n))}limitCameraBounds(t){this.camera.addStrategy(new hf(t))}}var Io;(function(u){u[u.X=0]="X",u[u.Y=1]="Y"})(Io||(Io={}));class nf{constructor(t){this.target=t,this.action=(n,r,h,c)=>n.center}}class rf{constructor(t,n){this.target=t,this.axis=n,this.action=(r,h,c,f)=>{let p=r.center,_=h.getFocus();return this.axis===Io.X?new I(p.x,_.y):new I(_.x,p.y)}}}class of{constructor(t,n,r){this.target=t,this.cameraElasticity=n,this.cameraFriction=r,this.action=(h,c,f,p)=>{let _=h.center,v=c.getFocus(),w=c.vel.clone(),E=_.sub(v).scale(this.cameraElasticity);w=w.add(E);let C=w.scale(-1).scale(this.cameraFriction);return w=w.add(C),v=v.add(w),v}}}class af{constructor(t,n){this.target=t,this.radius=n,this.action=(r,h,c,f)=>{let p=r.center,_=h.getFocus(),v=p.sub(_),w=v.size;if(w>=this.radius){let E=w-this.radius;return _.add(v.normalize().scale(E))}return _}}}class hf{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(n,r,h,c)=>{let f=r.getFocus();this.boundSizeChecked||((n.bottom-n.top<h.drawHeight||n.right-n.left<h.drawWidth)&&et.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let p=f.x,_=f.y;return f.x<n.left+h.halfDrawWidth?p=n.left+h.halfDrawWidth:f.x>n.right-h.halfDrawWidth&&(p=n.right-h.halfDrawWidth),f.y<n.top+h.halfDrawHeight?_=n.top+h.halfDrawHeight:f.y>n.bottom-h.halfDrawHeight&&(_=n.bottom-h.halfDrawHeight),M(p,_)}}}let ev={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate"};class lf{constructor(){this.events=new x,this.transform=qt.identity(),this.inverse=qt.identity(),this._cameraStrategies=[],this.strategy=new sf(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=yd(I.Zero,()=>this._posChanged=!0),this.vel=I.Zero,this.acc=I.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Bt.EaseInOutCubic,this._easing=Bt.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._pos=yd(t,()=>this._posChanged=!0),this._posChanged=!0}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=M(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=M(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=M(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=M(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=M(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=M(this.acc.x,t)}getFocus(){return this.pos}move(t,n,r=Bt.EaseInOutCubic){if(typeof r!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(h=>{this._lerpResolve=h}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=n,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=r,this._lerpPromise)}shake(t,n,r){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=n,this._shakeDuration=r}zoomOverTime(t,n=0,r=Bt.EaseInOutCubic){if(this._zoomPromise=new Promise(h=>{this._zoomResolve=h}),n)this._isZooming=!0,this._zoomEasing=r,this._currentZoomTime=0,this._zoomDuration=n,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new ot(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){Bs(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,n){this.events.emit("preupdate",new nt(t,n,this)),this.onPreUpdate(t,n)}onPreUpdate(t,n){}_postupdate(t,n){this.events.emit("postupdate",new bt(t,n,this)),this.onPostUpdate(t,n)}onPostUpdate(t,n){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;let n=this._screen.contentArea,r=M(n.width/2,n.height/2);if(!this._engine.loadingComplete){let h=this._screen.peekResolution();h&&(r=M(h.width/2,h.height/2))}this._halfWidth=r.x,this._halfHeight=r.y,this._posChanged||(this.pos=r),this.updateTransform(),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(),this.onInitialize(t),this.events.emit("initialize",new Ui(t,this)),this._isInitialized=!0}}onInitialize(t){}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}runStrategies(t,n){for(let r of this._cameraStrategies)this.pos=r.action.call(r,r.target,this,t,n)}updateViewport(){this._viewport=new ot(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,n){if(this._initialize(t),this._preupdate(t,n),this.pos=this.pos.add(this.vel.scale(n/1e3)),this.zoom+=this.dz*n/1e3,this.vel=this.vel.add(this.acc.scale(n/1e3)),this.dz+=this.az*n/1e3,this.rotation+=this.angularVelocity*n/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){let r=this._zoomEasing,h=r(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=h,this._currentZoomTime+=n}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){let h=Bt.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=h,this._currentLerpTime+=n}else{this.pos=this._lerpEnd;let r=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(r)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=n,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,n),this.updateViewport(),this.updateTransform(),this._postupdate(t,n)}draw(t){t.multiply(this.transform)}updateTransform(){let t=this._screen.resolution.width/this.zoom,n=this._screen.resolution.height/this.zoom,r=M(-this.x+t/2+this._xShake,-this.y+n/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(t/2,n/2),this.transform.rotate(this.rotation),this.transform.translate(-t/2,-n/2),this.transform.translate(r.x,r.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}let sv={ExitTrigger:"exittrigger",EnterTrigger:"entertrigger"},iv={pos:I.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class cf extends rs{constructor(t){super({x:t.pos.x,y:t.pos.y,width:t.width,height:t.height}),this.events=new x,this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t={...iv,...t},this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.graphics.visible=t.visible,this.body.collisionType=ut.Passive,this.events.on("collisionstart",n=>{this.filter(n.other)&&(this.emit("enter",new bh(this,n.other)),this._dispatchAction(),this.repeat===0&&this.kill())}),this.events.on("collisionend",n=>{this.filter(n.other)&&this.emit("exit",new Eh(this,n.other))})}set target(t){this._target=t,this.filter=n=>n===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){this.repeat!==0&&(this.action.call(this),this.repeat--)}}var Fe;(function(u){u.Update="update",u.Draw="draw"})(Fe||(Fe={}));class os{constructor(){this.priority=0}notify(t){}}class uf{constructor(t){this.data=t,this.type="Entity Added"}}function $n(u){return!!u&&u.type==="Entity Added"}class df{constructor(t){this.data=t,this.type="Entity Removed"}}function nv(u){return!!u&&u.type==="Entity Removed"}class ff{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._entitiesToRemove=[]}updateEntities(t,n){for(let r of this.entities)r.update(t.engine,n),r.active||this.removeEntity(r)}findEntitiesForRemoval(){for(let t of this.entities)t.active||this.removeEntity(t)}notify(t){Fd(t)&&this._world.queryManager.addEntity(t.data.entity),Ld(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)}addEntity(t){t.active=!0,t.scene=this._world.context,t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.componentAdded$.register(this),t.componentRemoved$.register(this),t.children.forEach(n=>{n.scene=t.scene,this.addEntity(n)}),t.childrenAdded$.register({notify:n=>{this.addEntity(n)}}),t.childrenRemoved$.register({notify:n=>{this.removeEntity(n,!1)}}))}removeEntity(t,n=!0){var r;let h=0;t instanceof ne?h=t.id:h=t;let c=this._entityIndex[h];if(c&&c.active&&(c.active=!1),c&&n){this._entitiesToRemove.push(c);return}delete this._entityIndex[h],c&&(c.scene=null,Bs(c,this.entities),this._world.queryManager.removeEntity(c),c.componentAdded$.unregister(this),c.componentRemoved$.unregister(this),c.children.forEach(f=>{f.scene=null,this.removeEntity(f,n)}),c.childrenAdded$.clear(),c.childrenRemoved$.clear(),!((r=this._world.context)===null||r===void 0)&&r.engine&&this._world.context.engine.stats.currFrame.actors.killed++)}processEntityRemovals(){for(let t of this._entitiesToRemove)t.active||this.removeEntity(t,!1);this._entitiesToRemove.length=0}processComponentRemovals(){for(let t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(n=>n.name===t)}clear(){for(let t of this.entities)this.removeEntity(t)}}let So=u=>[...u].sort((n,r)=>n.localeCompare(r)).join("+");class pf extends fs{get key(){return this._key?this._key:this._key=So(this.types)}constructor(t){super(),this._entities=[],t[0]instanceof Function?this.types=t.map(n=>new n().type):this.types=t}getEntities(t){return t&&this._entities.sort(t),this._entities}addEntity(t){!Sh(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new uf(t)))}removeEntity(t){Bs(t,this._entities)&&this.notifyAll(new df(t))}clear(){this._entities.length=0;for(let t of this.observers)this.unregister(t)}matches(t){let n=[];t instanceof ne?n=t.types:n=t;let r=!0;for(let h of this.types)if(r=r&&n.indexOf(h)>-1,!r)return!1;return r}contain(t){return this.types.indexOf(t)>-1}}class _f{constructor(t){this._world=t,this._queries={}}_addQuery(t){this._queries[So(t.types)]=t;for(let n of this._world.entityManager.entities)t.addEntity(n)}maybeRemoveQuery(t){t.observers.length===0&&(t.clear(),delete this._queries[So(t.types)])}addEntity(t){for(let n in this._queries)this._queries[n]&&this._queries[n].addEntity(t)}removeComponent(t,n){for(let r in this._queries)this._queries[r].contain(n.type)&&this._queries[r].removeEntity(t)}removeEntity(t){for(let n in this._queries)this._queries[n].removeEntity(t)}createQuery(t){let n=this.getQuery(t);if(n)return n;let r=new pf(t);return this._addQuery(r),r}getQuery(t){let n=So(t);return this._queries[n]?this._queries[n]:null}}class gf{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(n=>n instanceof t)}addSystem(t){if(!t.types||t.types.length===0)throw new Error("Attempted to add a System without any types");let n=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort((r,h)=>r.priority-h.priority),n.register(t),this.initialized&&t.initialize&&t.initialize(this._world.context)}removeSystem(t){Bs(t,this.systems);let n=this._world.queryManager.getQuery(t.types);n&&(n.unregister(t),this._world.queryManager.maybeRemoveQuery(n))}initialize(){if(!this.initialized){this.initialized=!0;for(let t of this.systems)t.initialize&&t.initialize(this._world.context)}}updateSystems(t,n,r){let h=this.systems.filter(c=>c.systemType===t);for(let c of h)c.preupdate&&c.preupdate(n,r);for(let c of h){let f=this._world.queryManager.getQuery(c.types).getEntities(c.sort);if(n instanceof Xn)for(let p of f)p._initialize(n?.engine);c.update(f,r)}for(let c of h)c.postupdate&&c.postupdate(n,r)}clear(){for(let t of this.systems)this.removeSystem(t)}}class mf{constructor(t){this.context=t,this.queryManager=new _f(this),this.entityManager=new ff(this),this.systemManager=new gf(this)}update(t,n){t===Fe.Update&&this.entityManager.updateEntities(this.context,n),this.systemManager.updateSystems(t,this.context,n),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){t instanceof ne&&this.entityManager.addEntity(t),t instanceof os&&this.systemManager.addSystem(t)}remove(t,n=!0){t instanceof ne&&this.entityManager.removeEntity(t,n),t instanceof os&&this.systemManager.removeSystem(t)}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class Ce{static integrate(t,n,r,h){let c=h/1e3;n.vel.addEqual(r.scale(c,Ce._ACC)),t.pos.add(n.vel.scale(c,Ce._VEL),Ce._POS).addEqual(r.scale(.5*c*c,Ce._VEL_ACC)),n.angularVelocity+=n.torque*(1/n.inertia)*c;let f=t.rotation+n.angularVelocity*c;t.scale.add(n.scaleFactor.scale(c,this._SCALE_FACTOR),Ce._SCALE),t.get().setTransform(Ce._POS,f,Ce._SCALE)}}Ce._POS=new I(0,0),Ce._SCALE=new I(1,1),Ce._ACC=new I(0,0),Ce._VEL=new I(0,0),Ce._VEL_ACC=new I(0,0),Ce._SCALE_FACTOR=new I(0,0);class vf extends os{constructor(){super(...arguments),this.types=["ex.transform","ex.motion"],this.systemType=Fe.Update,this.priority=-1}update(t,n){let r,h;for(let c=0;c<t.length;c++){r=t[c].get(K),h=t[c].get(Vt);let f=t[c].get(pt);if(f?.sleeping)continue;let p=h.acc.clone();f?.collisionType===ut.Active&&f?.useGravity&&p.addEqual(Y.gravity),f?.captureOldTransform(),Ce.integrate(r,h,p,n)}}}class yf{constructor(){this.directionMap=new Map,this.distanceMap=new Map}solve(t){this.preSolve(t),t=t.filter(n=>!n.isCanceled()),t.sort((n,r)=>{let h=this.distanceMap.get(n.id),c=this.distanceMap.get(r.id);return h-c});for(let n of t)this.solvePosition(n),this.solveVelocity(n);return this.postSolve(t),t}preSolve(t){for(let r of t){if(Math.abs(r.mtv.x)<1e-4&&Math.abs(r.mtv.y)<1e-4){r.cancel();continue}let h=Wt.fromDirection(r.mtv),c=r.mtv.negate(),f=r.colliderA.worldPos.squareDistance(r.colliderB.worldPos);this.distanceMap.set(r.id,f),r.colliderA.events.emit("precollision",new Ht(r.colliderA,r.colliderB,h,c)),r.colliderB.events.emit("precollision",new Ht(r.colliderB,r.colliderA,Wt.getOpposite(h),c.negate()))}}postSolve(t){var n,r;for(let h of t){if(h.isCanceled())continue;let c=h.colliderA,f=h.colliderB,p=(n=c.owner)===null||n===void 0?void 0:n.get(pt),_=(r=f.owner)===null||r===void 0?void 0:r.get(pt);if(p&&_&&(p.collisionType===ut.Passive||_.collisionType===ut.Passive))continue;let v=Wt.fromDirection(h.mtv),w=h.mtv.negate();h.colliderA.events.emit("postcollision",new ai(h.colliderA,h.colliderB,v,w)),h.colliderB.events.emit("postcollision",new ai(h.colliderB,h.colliderA,Wt.getOpposite(v),w.negate()))}}solvePosition(t){var n,r;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let c=t.mtv,f=t.colliderA,p=t.colliderB,_=(n=f.owner)===null||n===void 0?void 0:n.get(pt),v=(r=p.owner)===null||r===void 0?void 0:r.get(pt);if(_&&v){if(_.collisionType===ut.Passive||v.collisionType===ut.Passive)return;_.collisionType===ut.Active&&v.collisionType===ut.Active&&(c=c.scale(.5)),_.collisionType===ut.Active&&(_.globalPos.x-=c.x,_.globalPos.y-=c.y,f.update(_.transform.get())),v.collisionType===ut.Active&&(v.globalPos.x+=c.x,v.globalPos.y+=c.y,p.update(v.transform.get()))}}solveVelocity(t){var n,r;if(t.isCanceled())return;let h=t.colliderA,c=t.colliderB,f=(n=h.owner)===null||n===void 0?void 0:n.get(pt),p=(r=c.owner)===null||r===void 0?void 0:r.get(pt);if(f&&p){if(f.collisionType===ut.Passive||p.collisionType===ut.Passive)return;let _=t.normal,v=_.negate();if(f.collisionType===ut.Active&&f.vel.normalize().dot(v)<0){let w=_.scale(_.dot(f.vel.negate()));f.vel=f.vel.add(w)}if(p.collisionType===ut.Active&&p.vel.normalize().dot(_)<0){let w=v.scale(v.dot(p.vel.negate()));p.vel=p.vel.add(w)}}}}class wf{constructor(t,n,r){this.point=t,this.local=n,this.contact=r,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new I(0,0),this.bToContact=new I(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){var t,n;let r=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(pt),h=(n=this.contact.colliderB.owner)===null||n===void 0?void 0:n.get(pt);if(r&&h){let c=this.contact.normal,f=this.contact.tangent;this.aToContact=this.point.sub(r.globalPos),this.bToContact=this.point.sub(h.globalPos);let p=this.aToContact.cross(c),_=this.bToContact.cross(c);this.normalMass=r.inverseMass+h.inverseMass+r.inverseInertia*p*p+h.inverseInertia*_*_;let v=this.aToContact.cross(f),w=this.bToContact.cross(f);this.tangentMass=r.inverseMass+h.inverseMass+r.inverseInertia*v*v+h.inverseInertia*w*w}return this}getRelativeVelocity(){var t,n;let r=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(pt),h=(n=this.contact.colliderB.owner)===null||n===void 0?void 0:n.get(pt);if(r&&h){let c=r.vel.add(I.cross(r.angularVelocity,this.aToContact));return h.vel.add(I.cross(h.angularVelocity,this.bToContact)).sub(c)}return I.Zero}}class xf{constructor(){this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var n;return(n=this.idToContactConstraint.get(t))!==null&&n!==void 0?n:[]}solve(t){return this.preSolve(t),t=t.filter(n=>!n.isCanceled()),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var n,r,h;for(let p of t){if(Math.abs(p.mtv.x)<1e-4&&Math.abs(p.mtv.y)<1e-4){p.cancel();continue}let _=Wt.fromDirection(p.mtv);p.colliderA.events.emit("precollision",new Ht(p.colliderA,p.colliderB,_,p.mtv)),p.colliderA.events.emit("beforecollisionresolve",new ro(p.colliderA,p.colliderB,_,p.mtv,p)),p.colliderB.events.emit("precollision",new Ht(p.colliderB,p.colliderA,Wt.getOpposite(_),p.mtv.negate())),p.colliderB.events.emit("beforecollisionresolve",new ro(p.colliderB,p.colliderA,Wt.getOpposite(_),p.mtv.negate(),p)),p.matchAwake()}let f=Array.from(this.idToContactConstraint.keys());for(let p of t){let _=f.indexOf(p.id);_>-1&&f.splice(_,1);let v=(n=this.idToContactConstraint.get(p.id))!==null&&n!==void 0?n:[],w=0,E=p.colliderA.owner.get(pt),C=p.colliderB.owner.get(pt);if(E&&C)for(let S of p.points){let k=p.normal,N=p.tangent,V=S.sub(E.globalPos),D=S.sub(C.globalPos),R=V.cross(k),z=D.cross(k),G=E.inverseMass+C.inverseMass+E.inverseInertia*R*R+C.inverseInertia*z*z,st=V.cross(N),Q=D.cross(N),F=E.inverseMass+C.inverseMass+E.inverseInertia*st*st+C.inverseInertia*Q*Q;v[w]&&((h=(r=v[w])===null||r===void 0?void 0:r.point)===null||h===void 0?void 0:h.squareDistance(S))<4?(v[w].point=S,v[w].local=p.localPoints[w]):v[w]=new wf(S,p.localPoints[w],p),v[w].aToContact=V,v[w].bToContact=D,v[w].normalMass=1/G,v[w].tangentMass=1/F;let gt=E.bounciness>C.bounciness?E.bounciness:C.bounciness,Et=p.normal.dot(v[w].getRelativeVelocity());v[w].originalVelocityAndRestitution=0,Et<-.1&&(v[w].originalVelocityAndRestitution=-gt*Et),w++}this.idToContactConstraint.set(p.id,v)}for(let p of f)this.idToContactConstraint.delete(p);if(Y.warmStart)this.warmStart(t);else for(let p of t){let _=this.getContactConstraints(p.id);for(let v of _)v.normalImpulse=0,v.tangentImpulse=0}}postSolve(t){for(let n of t){let r=n.colliderA.owner.get(pt),h=n.colliderB.owner.get(pt);if(r&&h){if(r.collisionType===ut.Passive||h.collisionType===ut.Passive)continue;r.updateMotion(),h.updateMotion()}let c=Wt.fromDirection(n.mtv);n.colliderA.events.emit("postcollision",new ai(n.colliderA,n.colliderB,c,n.mtv)),n.colliderA.events.emit("aftercollisionresolve",new oo(n.colliderA,n.colliderB,c,n.mtv,n)),n.colliderB.events.emit("postcollision",new ai(n.colliderB,n.colliderA,Wt.getOpposite(c),n.mtv.negate())),n.colliderB.events.emit("aftercollisionresolve",new oo(n.colliderB,n.colliderA,Wt.getOpposite(c),n.mtv.negate(),n))}this.lastFrameContacts.clear();for(let n of t)this.lastFrameContacts.set(n.id,n)}warmStart(t){var n,r,h;for(let c of t){let f=(n=c.colliderA.owner)===null||n===void 0?void 0:n.get(pt),p=(r=c.colliderB.owner)===null||r===void 0?void 0:r.get(pt);if(f&&p){let _=(h=this.idToContactConstraint.get(c.id))!==null&&h!==void 0?h:[];for(let v of _)if(Y.warmStart){let w=c.normal.scale(v.normalImpulse),E=c.tangent.scale(v.tangentImpulse),C=w.add(E);f.applyImpulse(v.point,C.negate()),p.applyImpulse(v.point,C)}else v.normalImpulse=0,v.tangentImpulse=0}}}solvePosition(t){var n,r,h;for(let c=0;c<Y.positionIterations;c++)for(let f of t){let p=(n=f.colliderA.owner)===null||n===void 0?void 0:n.get(pt),_=(r=f.colliderB.owner)===null||r===void 0?void 0:r.get(pt);if(p&&_){if(p.collisionType===ut.Passive||_.collisionType===ut.Passive)continue;let v=(h=this.idToContactConstraint.get(f.id))!==null&&h!==void 0?h:[];for(let w of v){let E=f.normal,C=ns.FindContactSeparation(f,w.local),S=Y.steeringFactor,k=-5,N=Y.slop,V=Pe(S*(C+N),k,0),D=E.scale(-V*w.normalMass);if(p.collisionType===ut.Active){let R=D.negate().scale(p.inverseMass);p.limitDegreeOfFreedom.includes(Ae.X)&&(R.x=0),p.limitDegreeOfFreedom.includes(Ae.Y)&&(R.y=0),p.globalPos=p.globalPos.add(R),p.limitDegreeOfFreedom.includes(Ae.Rotation)||(p.rotation-=w.aToContact.cross(D)*p.inverseInertia)}if(_.collisionType===ut.Active){let R=D.scale(_.inverseMass);_.limitDegreeOfFreedom.includes(Ae.X)&&(R.x=0),_.limitDegreeOfFreedom.includes(Ae.Y)&&(R.y=0),_.globalPos=_.globalPos.add(R),_.limitDegreeOfFreedom.includes(Ae.Rotation)||(_.rotation+=w.bToContact.cross(D)*_.inverseInertia)}}}}}solveVelocity(t){var n,r,h;for(let c=0;c<Y.velocityIterations;c++)for(let f of t){let p=(n=f.colliderA.owner)===null||n===void 0?void 0:n.get(pt),_=(r=f.colliderB.owner)===null||r===void 0?void 0:r.get(pt);if(p&&_){if(p.collisionType===ut.Passive||_.collisionType===ut.Passive)continue;let v=Math.min(p.friction,_.friction),w=(h=this.idToContactConstraint.get(f.id))!==null&&h!==void 0?h:[];for(let E of w){let k=-E.getRelativeVelocity().dot(f.tangent)*E.tangentMass,N=v*E.normalImpulse,V=Pe(E.tangentImpulse+k,-N,N);k=V-E.tangentImpulse,E.tangentImpulse=V;let D=f.tangent.scale(k);p.applyImpulse(E.point,D.negate()),_.applyImpulse(E.point,D)}for(let E of w){let S=E.getRelativeVelocity().dot(f.normal),k=-E.normalMass*(S-E.originalVelocityAndRestitution),N=Math.max(E.normalImpulse+k,0);k=N-E.normalImpulse,E.normalImpulse=N;let V=f.normal.scale(k);p.applyImpulse(E.point,V.negate()),_.applyImpulse(E.point,V)}}}}}class Yh extends os{constructor(t){super(),this.types=["ex.transform","ex.motion","ex.collider"],this.systemType=Fe.Update,this.priority=-1,this._realisticSolver=new xf,this._arcadeSolver=new yf,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._processor=t.collisionProcessor,this._trackCollider=n=>this._processor.track(n),this._untrackCollider=n=>this._processor.untrack(n)}notify(t){if($n(t)){let n=t.data.get($t);n.$colliderAdded.subscribe(this._trackCollider),n.$colliderRemoved.subscribe(this._untrackCollider);let r=n.get();r&&this._processor.track(r)}else{let n=t.data.get($t),r=n.get();n&&r&&this._processor.untrack(r)}}initialize(t){this._engine=t.engine}update(t,n){var r,h,c,f;if(!Y.enabled)return;let p=[];for(let E of t){let C=E.get($t),S=C?.get();if(C&&(!((r=C.owner)===null||r===void 0)&&r.active)&&S)if(C.update(),S instanceof ge){let k=S.getColliders();p=p.concat(k)}else p.push(S)}this._processor.update(p);let _=this._processor.broadphase(p,n);this._currentFrameContacts.clear();let v=this._processor.narrowphase(_,(f=(c=(h=this._engine)===null||h===void 0?void 0:h.debug)===null||c===void 0?void 0:c.stats)===null||f===void 0?void 0:f.currFrame);v=this.getSolver().solve(v);for(let E of v){let C=E.id.indexOf("|");if(C>0){let S=E.id.substring(C+1);this._currentFrameContacts.set(S,E)}else this._currentFrameContacts.set(E.id,E)}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts)}getSolver(){return Y.collisionResolutionStrategy===fi.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t)}runContactStartEnd(){for(let[t,n]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){let r=n.colliderA,h=n.colliderB;r.events.emit("collisionstart",new Bn(r,h,n)),r.events.emit("contactstart",new io(r,h,n)),h.events.emit("collisionstart",new Bn(h,r,n)),h.events.emit("contactstart",new io(h,r,n))}for(let[t,n]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){let r=n.colliderA,h=n.colliderB;r.events.emit("collisionend",new Ln(r,h)),r.events.emit("contactend",new no(r,h)),h.events.emit("collisionend",new Ln(h,r)),h.events.emit("contactend",new no(h,r))}}}var Kn;(function(u){u.Forward="forward",u.Backward="backward"})(Kn||(Kn={}));var as;(function(u){u.End="end",u.Loop="loop",u.PingPong="pingpong",u.Freeze="freeze"})(as||(as={}));let rv={Frame:"frame",Loop:"loop",Ended:"ended"};class _s extends De{constructor(t){var n,r;super(t),this.events=new x,this.frames=[],this.strategy=as.Loop,this.frameDuration=100,this.timeScale=1,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._reversed=!1,this.frames=t.frames,this.strategy=(n=t.strategy)!==null&&n!==void 0?n:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(r=t.frameDuration)!==null&&r!==void 0?r:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new _s({frames:this.frames.map(t=>({...t})),frameDuration:this.frameDuration,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){let t=this.currentFrame;return t?Math.abs(t.graphic.width*this.scale.x):0}get height(){let t=this.currentFrame;return t?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,n,r,h=as.Loop){let c=t.sprites.length-1,f=n.filter(p=>p<0||p>c);return f.length&&_s._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${f.join(",")} no frame will be shown`),new _s({frames:t.sprites.filter((p,_)=>n.indexOf(_)>-1).map(p=>({graphic:p,duration:r})),strategy:h})}static fromSpriteSheetCoordinates(t){let{spriteSheet:n,frameCoordinates:r,durationPerFrameMs:h,strategy:c,reverse:f}=t,p=h??100,_=[];for(let v of r){let{x:w,y:E,duration:C}=v,S=n.getSprite(w,E);S?_.push({graphic:S,duration:C??p}):_s._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${w}, ${E}), please check your SpriteSheet to confirm that sprite exists`)}return new _s({frames:_,strategy:c,reverse:f})}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get isPlaying(){return this._playing}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?Kn.Backward:Kn.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0}get canFinish(){switch(this.strategy){case as.End:case as.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t){this._currentFrame=t,this._timeLeftInFrame=this.frameDuration;let n=this.frames[this._currentFrame];n&&!this._done&&(this._timeLeftInFrame=n?.duration||this.frameDuration,this.events.emit("frame",{...n,frameIndex:this.currentFrameIndex}))}_nextFrame(){let t=this._currentFrame;if(this._done)return t;let n=-1;switch(this.strategy){case as.Loop:{n=(t+1)%this.frames.length,n===0&&this.events.emit("loop",this);break}case as.End:{n=t+1,n>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case as.Freeze:{n=Pe(t+1,0,this.frames.length-1),n>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case as.PingPong:{t+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),t+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),n=t+this._pingPongDirection%this.frames.length;break}}return n}tick(t,n=0){this._idempotencyToken!==n&&(this._idempotencyToken=n,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=t*this.timeScale,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,n,r){this.currentFrame&&this.currentFrame.graphic.draw(t,n,r)}}_s._LOGGER=et.getInstance();class Qn extends De{constructor(t){super(t),this.members=[],this.members=t.members,this._updateDimensions()}clone(){return new Qn({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){let t=new ot;for(let{graphic:n,pos:r}of this.members)t=n.localBounds.translate(r).combine(t);return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new ot;for(let{graphic:n,pos:r}of this.members)t=n.localBounds.translate(r).combine(t);return t}_isAnimationOrGroup(t){return t instanceof _s||t instanceof Qn}tick(t,n){for(let r of this.members){let h=r.graphic;this._isAnimationOrGroup(h)&&h.tick(t,n)}}reset(){for(let t of this.members){let n=t.graphic;this._isAnimationOrGroup(n)&&n.reset()}}_preDraw(t,n,r){this._updateDimensions(),super._preDraw(t,n,r)}_drawImage(t,n,r){for(let h of this.members)t.save(),t.translate(n,r),h.graphic.draw(t,h.pos.x,h.pos.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}function bf(u){return class extends u{assign(t){for(let n in t)typeof this[n]!="function"&&(this[n]=t[n])}constructor(...t){super(...t),t.filter(function(r){return r!==void 0}).length===1&&t[0]&&typeof t[0]=="object"&&!(t[0]instanceof Array)&&this.assign(t[0])}}}var tn;(function(u){u[u.Circle=0]="Circle",u[u.Rectangle=1]="Rectangle"})(tn||(tn={}));class ov extends ne{constructor(t,n,r,h,c,f,p,_,v,w){super(),this.position=new I(0,0),this.velocity=new I(0,0),this.acceleration=new I(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=O.White,this.endColor=O.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=O.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let E=t;if(E&&!(t instanceof Ef)){let C=t;E=C.emitter,n=C.life,r=C.opacity,c=C.endColor,h=C.beginColor,f=C.position,p=C.velocity,_=C.acceleration,v=C.startSize,w=C.endSize}if(this.emitter=E,this.life=n||this.life,this.opacity=r||this.opacity,this.endColor=c||this.endColor.clone(),this.beginColor=h||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.emitter.particleTransform===en.Global){let C=this.emitter.transform.globalPos;this.position=(f||this.position).add(C),this.velocity=(p||this.velocity).rotate(this.emitter.transform.globalRotation)}else this.velocity=p||this.velocity,this.position=f||this.position;this.acceleration=_||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=v||0,this.endSize=w||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new K),this.addComponent(this.graphics=new ue),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=M(1,1),this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(this.particleSprite)):(this.graphics.localBounds=ot.fromDimension(this.particleSize,this.particleSize,I.Half),this.graphics.onPostDraw=C=>{C.save(),this.graphics.opacity=this.opacity;let S=this._currentColor.clone();S.a=1,C.debug.drawPoint(M(0,0),{color:S,size:this.particleSize}),C.restore()})}kill(){this.emitter.removeParticle(this)}update(t,n){if(this.life=this.life-n,this.elapsedMultiplier=this.elapsedMultiplier+n,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=Pe(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=Pe(this.sizeRate*n+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=Pe(this._currentColor.r+this._rRate*n,0,255),this._currentColor.g=Pe(this._currentColor.g+this._gRate*n,0,255),this._currentColor.b=Pe(this._currentColor.b+this._bRate*n,0,255),this._currentColor.a=Pe(this.opacity,1e-4,1),this.focus){let r=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(n/1e3);this.velocity=this.velocity.add(r)}else this.velocity=this.velocity.add(this.acceleration.scale(n/1e3));this.position=this.position.add(this.velocity.scale(n/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*n/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=M(1,1),this.graphics.opacity=this.opacity}}class Po extends bf(ov){constructor(t,n,r,h,c,f,p,_,v,w){super(t,n,r,h,c,f,p,_,v,w)}}var en;(function(u){u.Global="global",u.Local="local"})(en||(en={}));class Ef extends rs{get opacity(){return super.graphics.opacity}set opacity(t){super.graphics.opacity=t}get particleSprite(){return this._sprite}set particleSprite(t){t&&(this._sprite=t)}constructor(t){var n,r;super({width:(n=t.width)!==null&&n!==void 0?n:0,height:(r=t.height)!==null&&r!==void 0?r:0}),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new I(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.fadeFlag=!1,this.focus=null,this.focusAccel=null,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=O.White,this.endColor=O.White,this._sprite=null,this.emitterType=tn.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this.particleTransform=en.Global;let{x:h,y:c,pos:f,isEmitting:p,minVel:_,maxVel:v,acceleration:w,minAngle:E,maxAngle:C,emitRate:S,particleLife:k,opacity:N,fadeFlag:V,focus:D,focusAccel:R,startSize:z,endSize:G,minSize:st,maxSize:Q,beginColor:F,endColor:gt,particleSprite:Et,emitterType:Ct,radius:vt,particleRotationalVelocity:Xt,particleTransform:Be,randomRotation:Le,random:Ne}={...t};this.pos=f??M(h??0,c??0),this.isEmitting=p??this.isEmitting,this.minVel=_??this.minVel,this.maxVel=v??this.maxVel,this.acceleration=w??this.acceleration,this.minAngle=E??this.minAngle,this.maxAngle=C??this.maxAngle,this.emitRate=S??this.emitRate,this.particleLife=k??this.particleLife,this.opacity=N??this.opacity,this.fadeFlag=V??this.fadeFlag,this.focus=D??this.focus,this.focusAccel=R??this.focusAccel,this.startSize=z??this.startSize,this.endSize=G??this.endSize,this.minSize=st??this.minSize,this.maxSize=Q??this.maxSize,this.beginColor=F??this.beginColor,this.endColor=gt??this.endColor,this.particleSprite=Et??this.particleSprite,this.emitterType=Ct??this.emitterType,this.radius=vt??this.radius,this.particleRotationalVelocity=Xt??this.particleRotationalVelocity,this.randomRotation=Le??this.randomRotation,this.particleTransform=Be??this.particleTransform,this.body.collisionType=ut.PreventCollision,this.random=Ne??new On}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var n;for(let r=0;r<t;r++){let h=this._createParticle();this.particles.push(h),!((n=this===null||this===void 0?void 0:this.scene)===null||n===void 0)&&n.world&&(this.particleTransform===en.Global?this.scene.world.add(h):this.addChild(h))}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,n=0,r=Fs(this.minAngle,this.maxAngle,this.random),h=Fs(this.minVel,this.maxVel,this.random),c=this.startSize||Fs(this.minSize,this.maxSize,this.random),f=h*Math.cos(r),p=h*Math.sin(r);if(this.emitterType===tn.Rectangle)t=Fs(0,this.width,this.random),n=Fs(0,this.height,this.random);else if(this.emitterType===tn.Circle){let v=Fs(0,this.radius,this.random);t=v*Math.cos(r),n=v*Math.sin(r)}let _=new Po(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new I(t,n),new I(f,p),this.acceleration,this.startSize,this.endSize);return _.fadeFlag=this.fadeFlag,_.particleSize=c,this.particleSprite&&(_.particleSprite=this.particleSprite,_.graphics.opacity=this.opacity,_.graphics.use(this._sprite)),_.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(_.currentRotation=Fs(0,Math.PI*2,this.random)),this.focus&&(_.focus=this.focus.add(new I(this.pos.x,this.pos.y)),_.focusAccel=this.focusAccel),_}update(t,n){var r;super.update(t,n),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(n/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let h=0;h<this.deadParticles.length;h++)Bs(this.deadParticles[h],this.particles),!((r=this===null||this===void 0?void 0:this.scene)===null||r===void 0)&&r.world&&this.scene.world.remove(this.deadParticles[h],!1);this.deadParticles.length=0}}class Tf extends os{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=Fe.Draw,this.priority=0,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}get sortedTransforms(){return this._sortedTransforms}initialize(t){this._camera=t.camera,this._engine=t.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,n)=>t.z-n.z),this._zHasChanged=!1)}notify(t){if($n(t)){let n=t.data.get(K);this._sortedTransforms.push(n),n.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{let n=t.data.get(K);n.zIndexChanged$.unsubscribe(this._zIndexUpdate);let r=this._sortedTransforms.indexOf(n);r>-1&&this._sortedTransforms.splice(r,1)}}update(t,n){this._token++;let r;Pt.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(let h of this._sortedTransforms){let c=h.owner;if(c.hasTag("ex.offscreen")||(r=c.get(ue),!r.visible))continue;h.coordPlane===ke.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),h.coordPlane===ke.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),r.update(n,this._token);let f=c.get(Ao);if(f){let _=I.One.sub(f.parallaxFactor),v=this._camera.pos.scale(_);this._graphicsContext.translate(v.x,v.y)}this._applyTransform(c),r.material&&(this._graphicsContext.material=r.material),r.onPreDraw&&r.onPreDraw(this._graphicsContext,n);let p=c instanceof Po?c.opacity:1;this._graphicsContext.opacity*=r.opacity*p,this._drawGraphicsComponent(r),r.onPostDraw&&r.onPostDraw(this._graphicsContext,n),this._graphicsContext.restore(),h.coordPlane===ke.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}this._graphicsContext.restore()}_drawGraphicsComponent(t){var n,r;if(t.visible){let h=t.flipHorizontal,c=t.flipVertical;for(let f of t.layers.get())for(let{graphic:p,options:_}of f.graphics){let v=t.anchor,w=t.offset;_?.anchor&&(v=_.anchor),_?.offset&&(w=_.offset);let E=-p.width*v.x+w.x,C=-p.height*v.y+w.y,S=p.flipHorizontal,k=p.flipVertical;if((h||c)&&(p.flipHorizontal=h?!S:S,p.flipVertical=c?!k:k),p?.draw(this._graphicsContext,E+f.offset.x,C+f.offset.y),(h||c)&&(p.flipHorizontal=S,p.flipVertical=k),!((n=this._engine)===null||n===void 0)&&n.isDebug&&this._engine.debug.graphics.showBounds){let N=M(E+f.offset.x,C+f.offset.y);if(p instanceof Qn)for(let V of p.members)(r=V.graphic)===null||r===void 0||r.localBounds.translate(N.add(V.pos)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor);else p?.localBounds.translate(N).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(t){let n=t.getAncestors();for(let r of n){let h=r?.get(K),c=r?.get(pt),f=h.pos,p=h.scale,_=h.rotation;if(c&&this._engine.fixedUpdateFps&&c.__oldTransformCaptured&&c.enableFixedUpdateInterpolate){let v=this._engine.currentFrameLagMs/(1e3/this._engine.fixedUpdateFps);f=h.pos.scale(v).add(c.oldPos.scale(1-v)),p=h.scale.scale(v).add(c.oldScale.scale(1-v));let w=(1-v)*Math.cos(c.oldRotation)+v*Math.cos(h.rotation),E=(1-v)*Math.sin(c.oldRotation)+v*Math.sin(h.rotation);_=Math.atan2(E,w)}h&&(this._graphicsContext.z=h.z,this._graphicsContext.translate(f.x,f.y),this._graphicsContext.scale(p.x,p.y),this._graphicsContext.rotate(_))}}}class Af extends os{constructor(){super(...arguments),this.types=["ex.transform"],this.systemType=Fe.Draw,this.priority=999}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine,this._collisionSystem=t.world.systemManager.get(Yh)}update(t,n){var r;if(!this._engine.isDebug)return;let h=this._engine.debug.filter,c,f,p=this._engine.debug.entity,_,v=this._engine.debug.transform,w,E=this._engine.debug.motion,C,S=this._engine.debug.collider,k=this._engine.debug.physics,N,V=this._engine.debug.graphics,D,R,z=this._engine.debug.body,G=this._engine.debug.camera;for(let st of t){if(st.hasTag("offscreen")||st instanceof Po||h.useFilter&&(!(h.ids.length===0||h.ids.includes(st.id))||!(h.nameQuery===""||st.name.includes(h.nameQuery))))continue;let Q=I.Zero,F=M(0,16);if(c=st.id,f=st.name,_=st.get(K),this._pushCameraTransform(_),this._graphicsContext.save(),this._applyTransform(st),_&&((v.showAll||v.showPosition)&&this._graphicsContext.debug.drawPoint(I.Zero,{size:4,color:v.positionColor}),(v.showAll||v.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${_.pos.toString(2)}`,Q),Q=Q.add(F)),(v.showAll||v.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${_.z.toFixed(1)})`,Q),Q=Q.add(F)),(p.showAll||p.showId)&&(this._graphicsContext.debug.drawText(`id(${c}) ${st.parent?"child of id("+((r=st.parent)===null||r===void 0?void 0:r.id)+")":""}`,Q),Q=Q.add(F)),(p.showAll||p.showName)&&(this._graphicsContext.debug.drawText(`name(${f})`,Q),Q=Q.add(F)),(v.showAll||v.showRotation)&&(this._graphicsContext.drawLine(I.Zero,I.fromAngle(_.rotation).scale(50).add(I.Zero),v.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${gd(_.rotation).toFixed(2)})`,Q),Q=Q.add(F)),(v.showAll||v.showScale)&&this._graphicsContext.drawLine(I.Zero,_.scale.add(I.Zero),v.scaleColor,2)),N=st.get(ue),N&&(V.showAll||V.showBounds)&&N.localBounds.draw(this._graphicsContext,V.boundsColor),D=st.get(Co),D&&(D.useTransform||this._graphicsContext.restore(),D.draw(this._graphicsContext),D.useTransform||(this._graphicsContext.save(),this._applyTransform(st))),R=st.get(pt),R&&((z.showAll||z.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${R.group.name})`,Q),Q=Q.add(F)),(z.showAll||z.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${R.collisionType})`,Q),Q=Q.add(F)),(z.showAll||z.showMass)&&(this._graphicsContext.debug.drawText(`mass(${R.mass})`,Q),Q=Q.add(F)),(z.showAll||z.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${R.sleepMotion})`,Q),Q=Q.add(F)),(z.showAll||z.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${R.canSleep?R.sleeping:"cant sleep"})`,Q),Q=Q.add(F))),this._graphicsContext.restore(),w=st.get(Vt),w&&((E.showAll||E.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${w.vel.toString(2)}`,Q.add(_.globalPos)),this._graphicsContext.drawLine(_.globalPos,_.globalPos.add(w.vel),E.velocityColor,2),Q=Q.add(F)),(E.showAll||E.showAcceleration)&&this._graphicsContext.drawLine(_.globalPos,_.globalPos.add(w.acc),E.accelerationColor,2)),C=st.get($t),C){let gt=C.get();if((S.showAll||S.showGeometry)&&gt&&gt.debug(this._graphicsContext,S.geometryColor),S.showAll||S.showBounds){if(gt instanceof ge){let Et=gt.getColliders();for(let Ct of Et){let vt=Ct.bounds,Xt=M(vt.left,vt.top);this._graphicsContext.debug.drawRect(Xt.x,Xt.y,vt.width,vt.height,{color:S.boundsColor}),(S.showAll||S.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${Ct.owner.id})`,Xt)}C.bounds.draw(this._graphicsContext,S.boundsColor)}else if(gt){let Et=C.bounds,Ct=M(Et.left,Et.top);this._graphicsContext.debug.drawRect(Ct.x,Ct.y,Et.width,Et.height,{color:S.boundsColor}),(S.showAll||S.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${C.owner.id})`,Ct)}}}this._popCameraTransform(_)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(k.showAll||k.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),k.showAll||k.showCollisionContacts||k.showCollisionNormals)for(let[st,Q]of this._engine.debug.stats.currFrame.physics.contacts){if(k.showAll||k.showCollisionContacts)for(let F of Q.points)this._graphicsContext.debug.drawPoint(F,{size:5,color:k.collisionContactColor});if(k.showAll||k.showCollisionNormals)for(let F of Q.points)this._graphicsContext.debug.drawLine(F,Q.normal.scale(30).add(F),{color:k.collisionNormalColor})}this._graphicsContext.restore(),G&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(G.showAll||G.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,G.focusColor),(G.showAll||G.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}_applyTransform(t){let n=t.getAncestors();for(let r of n){let h=r?.get(K);h&&(this._graphicsContext.translate(h.pos.x,h.pos.y),this._graphicsContext.scale(h.scale.x,h.scale.y),this._graphicsContext.rotate(h.rotation))}}_pushCameraTransform(t){t.coordPlane===ke.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===ke.World&&this._graphicsContext.restore()}}class Ro extends os{constructor(){super(...arguments),this.types=["ex.transform","ex.pointer"],this.systemType=Fe.Update,this.priority=-1,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}initialize(t){this._engine=t.engine}preupdate(){this._receiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,n)=>n.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}notify(t){if($n(t)){let n=t.data.get(K);this._sortedTransforms.push(n),this._sortedEntities.push(n.owner),n.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{let n=t.data.get(K);n.zIndexChanged$.unsubscribe(this._zIndexUpdate);let r=this._sortedTransforms.indexOf(n);r>-1&&(this._sortedTransforms.splice(r,1),this._sortedEntities.splice(r,1))}}entityCurrentlyUnderPointer(t,n){return this.currentFrameEntityToPointers.has(t.id)&&this.currentFrameEntityToPointers.get(t.id).includes(n)}entityWasUnderPointer(t,n){return this.lastFrameEntityToPointers.has(t.id)&&this.lastFrameEntityToPointers.get(t.id).includes(n)}entered(t,n){return this.entityCurrentlyUnderPointer(t,n)&&!this.lastFrameEntityToPointers.has(t.id)}left(t,n){return!this.currentFrameEntityToPointers.has(t.id)&&this.entityWasUnderPointer(t,n)}addPointerToEntity(t,n){if(!this.currentFrameEntityToPointers.has(t.id)){this.currentFrameEntityToPointers.set(t.id,[n]);return}let r=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,r.concat(n))}update(t){this._processPointerToEntity(this._sortedEntities),this._dispatchEvents(this._sortedEntities),this._receiver.update(),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear(),this._receiver.clear()}_processPointerToEntity(t){var n;let r,h,c,f;for(let p of t){if(r=p.get(K),f=(n=p.get(Xi))!==null&&n!==void 0?n:new Xi,h=p.get($t),h&&(f.useColliderShape||this.overrideUseColliderShape)){h.update();let _=h.get();if(_)for(let[v,w]of this._receiver.currentFramePointerCoords.entries())_.contains(r.coordPlane===ke.World?w.worldPos:w.screenPos)&&this.addPointerToEntity(p,v)}if(c=p.get(ue),c&&(f.useGraphicsBounds||this.overrideUseGraphicsBounds)){let _=c.localBounds.transform(r.get().matrix);for(let[v,w]of this._receiver.currentFramePointerCoords.entries())_.contains(r.coordPlane===ke.World?w.worldPos:w.screenPos)&&this.addPointerToEntity(p,v)}}}_processDownAndEmit(t){let n=new Map;for(let r of this._receiver.currentFrameDown)r.active&&t.active&&this.entityCurrentlyUnderPointer(t,r.pointerId)&&(t.events.emit("pointerdown",r),this._receiver.isDragStart(r.pointerId)&&t.events.emit("pointerdragstart",r)),n.set(r.pointerId,r);return n}_processUpAndEmit(t){let n=new Map;for(let r of this._receiver.currentFrameUp)r.active&&t.active&&this.entityCurrentlyUnderPointer(t,r.pointerId)&&(t.events.emit("pointerup",r),this._receiver.isDragEnd(r.pointerId)&&t.events.emit("pointerdragend",r)),n.set(r.pointerId,r);return n}_processMoveAndEmit(t){let n=new Map;for(let r of this._receiver.currentFrameMove)r.active&&t.active&&this.entityCurrentlyUnderPointer(t,r.pointerId)&&(t.events.emit("pointermove",r),this._receiver.isDragging(r.pointerId)&&t.events.emit("pointerdragmove",r)),n.set(r.pointerId,r);return n}_processEnterLeaveAndEmit(t,n){for(let r of n){if(r.active&&t.active&&this.entered(t,r.pointerId)){t.events.emit("pointerenter",r),this._receiver.isDragging(r.pointerId)&&t.events.emit("pointerdragenter",r);break}if(r.active&&t.active&&(this.left(t,r.pointerId)||this.entityCurrentlyUnderPointer(t,r.pointerId)&&r.type==="up")){t.events.emit("pointerleave",r),this._receiver.isDragging(r.pointerId)&&t.events.emit("pointerdragleave",r);break}}}_processCancelAndEmit(t){for(let n of this._receiver.currentFrameCancel)n.active&&t.active&&this.entityCurrentlyUnderPointer(t,n.pointerId)&&t.events.emit("pointercancel",n)}_processWheelAndEmit(t){for(let n of this._receiver.currentFrameWheel)n.active&&t.active&&this.entityCurrentlyUnderPointer(t,0)&&t.events.emit("pointerwheel",n)}_dispatchEvents(t){let n=new Set(this.lastFrameEntityToPointers.keys()),r=new Set(this.currentFrameEntityToPointers.keys()),h=t.filter(_=>n.has(_.id)||r.has(_.id)),c,f,p;for(let _ of h){p=this._processDownAndEmit(_),f=this._processUpAndEmit(_),c=this._processMoveAndEmit(_);let v=[...c.values(),...p.values(),...f.values()];this._processEnterLeaveAndEmit(_,v),this._processCancelAndEmit(_),this._processWheelAndEmit(_)}}}class Cf extends os{constructor(){super(...arguments),this.types=["ex.actions"],this.systemType=Fe.Update,this.priority=-1,this._actions=[]}notify(t){if($n(t)){let n=t.data.get(Yi);this._actions.push(n)}else{let n=t.data.get(Yi),r=this._actions.indexOf(n);r>-1&&this._actions.splice(r,1)}}update(t,n){for(let r of this._actions)r.update(n)}}class Do extends He{constructor(t){super(),this.type="ex.isometricentity",this.elevation=0,this.map=t}}class If extends os{constructor(){super(...arguments),this.types=["ex.transform","ex.isometricentity"],this.systemType=Fe.Update,this.priority=99}update(t,n){let r,h;for(let c of t){r=c.get(K),h=c.get(Do);let p=Math.max(h.map.columns*h.map.tileWidth,h.map.rows*h.map.tileHeight)*h.elevation+r.pos.y;r.z=p}}}class Sf extends os{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=Fe.Draw,this.priority=-1}initialize(t){this._camera=t.camera,this._screen=t.engine.screen}update(t){this._worldBounds=this._screen.getWorldBounds();let n,r,h;for(let c of t){r=c.get(ue),n=c.get(K),h=c.get(Ao);let f;if(h){let _=I.One.sub(h.parallaxFactor);f=this._camera.pos.scale(_)}let p=this._isOffscreen(n,r,f);p&&!c.hasTag("ex.offscreen")&&(c.events.emit("exitviewport",new wh(c)),c.addTag("ex.offscreen")),!p&&c.hasTag("ex.offscreen")&&(c.events.emit("enterviewport",new xh(c)),c.removeTag("ex.offscreen"))}}_isOffscreen(t,n,r){if(t.coordPlane===ke.World){let h=n.localBounds;r&&(h=h.translate(r));let c=h.transform(t.get().matrix);return!this._worldBounds.overlaps(c)}else return!1}}class Pf{constructor(){this.collisionProcessor=new qh}rayCast(t,n){return this.collisionProcessor.rayCast(t,n)}}let av={Initialize:"initialize",Activate:"activate",Deactivate:"deactivate",PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw"};class Xn{get actors(){return this.world.entityManager.entities.filter(t=>t instanceof rs)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof cf)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof tf)}get timers(){return this._timers}constructor(){this._logger=et.getInstance(),this.events=new x,this.camera=new lf,this.world=new mf(this),this.physics=new Pf,this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(new Cf),this.world.add(new vf),this.world.add(new Yh(this.physics)),this.world.add(new Ro),this.world.add(new If),this.world.add(new Sf),this.world.add(new Tf),this.world.add(new Af)}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,n){}onPostUpdate(t,n){}onPreDraw(t,n){}onPostDraw(t,n){}_initializeChildren(){for(let t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.engine=t,this.camera._initialize(t),this.world.systemManager.initialize(),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.events.emit("initialize",new Ui(t,this)),this._isInitialized=!0)}_activate(t){this._logger.debug("Scene.onActivate",this),this.onActivate(t)}_deactivate(t){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t)}_preupdate(t,n){this.emit("preupdate",new nt(t,n,this)),this.onPreUpdate(t,n)}_postupdate(t,n){this.emit("postupdate",new bt(t,n,this)),this.onPostUpdate(t,n)}_predraw(t,n){this.emit("predraw",new at(t,n,this)),this.onPreDraw(t,n)}_postdraw(t,n){this.emit("postdraw",new ct(t,n,this)),this.onPostDraw(t,n)}update(t,n){this._preupdate(t,n);let r,h;for(r=0,h=this._cancelQueue.length;r<h;r++)this.removeTimer(this._cancelQueue[r]);this._cancelQueue.length=0;for(let c of this._timers)c.update(n);this.world.update(Fe.Update,n),this.camera&&this.camera.update(t,n),this._collectActorStats(t),this._postupdate(t,n)}draw(t,n){var r;this._predraw(t,n),this.world.update(Fe.Draw,n),!((r=this.engine)===null||r===void 0)&&r.isDebug&&this.debugDraw(t),this._postdraw(t,n)}debugDraw(t){this.emit("predebugdraw",new xt(t,this)),this.emit("postdebugdraw",new tt(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),this.world.add(t),t.scene=this,t instanceof _i){Sh(this._timers,t)||this.addTimer(t);return}}transfer(t){let n;t instanceof ne&&t.scene&&t.scene!==this&&(n=t.scene,t.scene.world.remove(t,!1)),t instanceof _i&&t.scene&&(n=t.scene,t.scene.removeTimer(t)),n?.emit("entityremoved",{target:t}),this.add(t)}remove(t){t instanceof ne&&(this.emit("entityremoved",{target:t}),t.active&&t.kill(),this.world.remove(t)),t instanceof _i&&this.removeTimer(t)}clear(t=!0){for(let n of this.entities)this.world.remove(n,t);for(let n of this.timers)this.removeTimer(n)}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){let n=this._timers.indexOf(t);return n!==-1&&this._timers.splice(n,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){let n=this.actors.filter(r=>r instanceof Xh);for(let r of n)t.stats.currFrame.actors.ui++;for(let r of this.actors){t.stats.currFrame.actors.alive++;for(let h of r.children)Jd(h)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}var gi;(function(u){u.Protanope="Protanope",u.Deuteranope="Deuteranope",u.Tritanope="Tritanope"})(gi||(gi={}));let hv=`#version 300 es\r
precision mediump float;\r
// our texture\r
uniform sampler2D u_image;\r
// the texCoords passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// color blind type\r
uniform int u_type;\r
\r
// simulation?\r
uniform bool u_simulate;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 o =  texture(u_image, v_texcoord);\r
  // RGB to LMS matrix conversion\r
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\r
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\r
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\r
  // Simulate color blindness\r
  float l;\r
  float m;\r
  float s;\r
  //MODE CODE//\r
  if (u_type == 0) {\r
    // Protanope\r
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;;\r
  } else if (u_type == 1) {\r
    // Deuteranope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;\r
  } else if (u_type == 2) {\r
    // Tritanope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\r
  }\r
\r
  // LMS to RGB matrix conversion\r
  vec4 error; // simulate the colors\r
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\r
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\r
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\r
  error.a = 1.0;\r
  vec4 diff = o - error;\r
  vec4 correction; // correct the colors\r
  correction.r = 0.0;\r
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\r
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\r
  correction = o + correction;\r
  correction.a = o.a;\r
  //SIMULATE//\r
\r
  // sim \r
  if (u_simulate) {\r
    fragColor = error.rgba;\r
  } else {\r
    fragColor = correction.rgba;\r
  }\r
}`;class Rf{constructor(t,n){this._shader=new Ge({gl:t,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_texcoord;
      out vec2 v_texcoord;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_texcoord;
      }`,fragmentSource:n}),this._shader.compile(),this._buffer=new Ls({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Ns({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class Df{constructor(t,n=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=n}initialize(t){this._shader=new Rf(t,hv),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){let n=this._shader.getShader();n.use(),this._colorBlindnessMode===gi.Protanope?n.setUniformInt("u_type",0):this._colorBlindnessMode===gi.Deuteranope?n.setUniformInt("u_type",1):this._colorBlindnessMode===gi.Tritanope&&n.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){let n=this._shader.getShader();n.use(),n.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class kf{constructor(t){this._engine=t,this._colorBlindPostProcessor=new Df(gi.Protanope)}correct(t){this._engine.graphicsContext instanceof Qs&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof Qs&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class Mf{constructor(t){this.stats={currFrame:new Yn,prevFrame:new Yn},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!0,showName:!1},this.transform={showAll:!1,showPosition:!1,showPositionLabel:!1,positionColor:O.Yellow,showZIndex:!1,showScale:!1,scaleColor:O.Green,showRotation:!1,rotationColor:O.Blue},this.graphics={showAll:!1,showBounds:!0,boundsColor:O.Yellow},this.collider={showAll:!1,showBounds:!0,boundsColor:O.Blue,showOwner:!1,showGeometry:!0,geometryColor:O.Green},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:O.Cyan,showCollisionContacts:!0,collisionContactColor:O.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:O.Yellow,showAcceleration:!1,accelerationColor:O.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:O.Red,showZoom:!1},this._engine=t,this.colorBlindMode=new kf(this._engine)}useTestClock(){let t=this._engine.clock,n=t.isRunning();t.stop();let r=t.toTestClock();return n&&r.start(),this._engine.clock=r,r}useStandardClock(){let t=this._engine.clock,n=t.isRunning();t.stop();let r=t.toStandardClock();return n&&r.start(),this._engine.clock=r,r}}class Yn{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new ko,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){let t=new Yn;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class ko{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){let t=new ko;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}class Zh{on(t,n){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(n),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,n){n||(n=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,n),this._nativeHandlers[t]=null}_decorate(t){return n=>{this._paused||t(n)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(let t in this._nativeHandlers)this.off(t)}constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}}class Ff{constructor(t,n){this._windowGlobal=t,this._documentGlobal=n,this._windowComponent=new Zh(this._windowGlobal),this._documentComponent=new Zh(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class Zn{static fromPagePosition(t,n,r){let h,c,f,p;arguments.length===3?(h=t,c=n,f=new I(h,c),p=r):(f=t,h=f.x,c=f.y,p=n);let _=p.screen.pageToScreenCoordinates(f),v=p.screen.screenToWorldCoordinates(_);return new Zn(v,f,_)}constructor(t,n,r){this.worldPos=t,this.pagePos=n,this.screenPos=r}}class sn{cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}constructor(t,n,r,h,c,f){this.type=t,this.pointerId=n,this.button=r,this.pointerType=h,this.coordinates=c,this.nativeEvent=f,this.active=!0}}class Jh{cancel(){this.active=!1}constructor(t,n,r,h,c,f,p,_,v,w,E,C){this.x=t,this.y=n,this.pageX=r,this.pageY=h,this.screenX=c,this.screenY=f,this.index=p,this.deltaX=_,this.deltaY=v,this.deltaZ=w,this.deltaMode=E,this.ev=C,this.active=!0}}class Bf{constructor(){this.events=new x,this.lastPagePos=I.Zero,this.lastScreenPos=I.Zero,this.lastWorldPos=I.Zero,this._onPointerMove=t=>{this.lastPagePos=new I(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new I(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new I(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new I(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new I(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new I(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}}var mi;(function(u){u.Pixel="Pixel",u.Line="Line",u.Page="Page"})(mi||(mi={}));var Os;(function(u){u[u.NoButton=-1]="NoButton",u[u.Left=0]="Left",u[u.Middle=1]="Middle",u[u.Right=2]="Right",u[u.Unknown=3]="Unknown"})(Os||(Os={}));var gs;(function(u){u.Left="Left",u.Middle="Middle",u.Right="Right",u.Unknown="Unknown",u.NoButton="NoButton"})(gs||(gs={}));var ms;(function(u){u.Touch="Touch",u.Mouse="Mouse",u.Pen="Pen",u.Unknown="Unknown"})(ms||(ms={}));let eb={Move:"move",Down:"down",Up:"up",Wheel:"wheel"};function lv(u){return globalThis.TouchEvent&&u instanceof globalThis.TouchEvent}function cv(u){return globalThis.PointerEvent&&u instanceof globalThis.PointerEvent}class Jn{constructor(t,n){this.target=t,this.engine=n,this.events=new x,this.primary=new Bf,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}recreate(t,n){let r=new Jn(t,n);return r.primary=this.primary,r._pointers=this._pointers,r}at(t){if(t>=this._pointers.length)for(let n=this._pointers.length-1,r=t;n<r;n++)this._pointers.push(new Bf);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var n;return(n=this.currentFramePointerDown.get(t))!==null&&n!==void 0?n:!1}wasDown(t){var n;return(n=this.lastFramePointerDown.get(t))!==null&&n!==void 0?n:!1}isDragging(t){return this.isDown(t)}isDragStart(t){return this.isDown(t)&&!this.wasDown(t)}isDragEnd(t){return!this.isDown(t)&&this.wasDown(t)}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(let t of this.currentFrameDown)this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t);for(let t of this.currentFrameUp)this.emit("up",t),this.at(t.pointerId).emit("up",t);for(let t of this.currentFrameMove)this.emit("move",t),this.at(t.pointerId).emit("move",t);for(let t of this.currentFrameCancel)this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t);for(let t of this.currentFrameWheel)this.emit("wheel",t),this.primary.emit("pointerwheel",t)}clear(){for(let t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);let n=this._activeNativePointerIdsToNormalized.entries();for(let[r,h]of n)h===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(r)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(t){var n;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));let r={passive:!(this.engine.pageScrollPreventionMode===Zs.All||this.engine.pageScrollPreventionMode===Zs.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,r):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,r):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,r),((n=t?.grabWindowFocus)!==null&&n!==void 0?n:!0)&&_d()){let c=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",c):(this.target.addEventListener("touchstart",c),this.target.addEventListener("mousedown",c))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);let r=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((h,c)=>h-c).findIndex(h=>h===t);return this._activeNativePointerIdsToNormalized.set(t,r),r}_handle(t){t.preventDefault();let n=new Map,r,h;if(lv(t)){r=gs.Unknown,h=ms.Touch;for(let c=0;c<t.changedTouches.length;c++){let f=t.changedTouches[c],p=Zn.fromPagePosition(f.pageX,f.pageY,this.engine),_=c+1,v=this._normalizePointerId(_);this.currentFramePointerCoords.set(v,p),n.set(v,p)}}else{r=this._nativeButtonToPointerButton(t.button),h=ms.Mouse;let c=Zn.fromPagePosition(t.pageX,t.pageY,this.engine),f=1;cv(t)&&(f=t.pointerId,h=this._stringToPointerType(t.pointerType));let p=this._normalizePointerId(f);this.currentFramePointerCoords.set(p,c),n.set(p,c)}for(let[c,f]of n.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new sn("down",c,r,h,f,t)),this.currentFramePointerDown.set(c,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new sn("up",c,r,h,f,t)),this.currentFramePointerDown.set(c,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new sn("move",c,r,h,f,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new sn("cancel",c,r,h,f,t));break}}_handleWheel(t){(this.engine.pageScrollPreventionMode===Zs.All||this.engine.pageScrollPreventionMode===Zs.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();let n=this.engine.screen.pageToScreenCoordinates(M(t.pageX,t.pageY)),r=this.engine.screen.screenToWorldCoordinates(n),h=-1/40,c=t.deltaX||t.wheelDeltaX*h||0,f=t.deltaY||t.wheelDeltaY*h||t.wheelDelta*h||t.detail||0,p=t.deltaZ||0,_=mi.Pixel;t.deltaMode&&(t.deltaMode===1?_=mi.Line:t.deltaMode===2&&(_=mi.Page));let v=new Jh(r.x,r.y,t.pageX,t.pageY,n.x,n.y,0,c,f,p,_,t);this.currentFrameWheel.push(v)}triggerEvent(t,n){let r=this.engine.screen.worldToPageCoordinates(n);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:r.x,clientY:r.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:r.x,clientY:r.y}));let h=this.engine.currentScene.world.systemManager.get(Ro),c=this.engine.currentScene.world.queryManager.createQuery(h.types);h.preupdate(),h.update(c.getEntities())}_nativeButtonToPointerButton(t){switch(t){case Os.NoButton:return gs.NoButton;case Os.Left:return gs.Left;case Os.Middle:return gs.Middle;case Os.Right:return gs.Right;case Os.Unknown:return gs.Unknown;default:return md(t)}}_stringToPointerType(t){switch(t){case"touch":return ms.Touch;case"mouse":return ms.Mouse;case"pen":return ms.Pen;default:return ms.Unknown}}}class Lf{constructor(t){var n;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=(n=t.samplePeriod)!==null&&n!==void 0?n:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;let t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class tl{constructor(t){var n,r,h;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=(n=this.now())!==null&&n!==void 0?n:0,this._maxFps=(r=t.maxFps)!==null&&r!==void 0?r:this._maxFps,this._onFatalException=(h=t.onFatalException)!==null&&h!==void 0?h:this._onFatalException,this.fpsSampler=new Lf({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new Nf({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new el({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,n=0){let r=this._totalElapsed+n;this._scheduledCbs.push([t,r])}_runScheduledCbs(){for(let t=this._scheduledCbs.length-1;t>-1;t--)this._scheduledCbs[t][1]<=this._totalElapsed&&(this._scheduledCbs[t][0](),this._scheduledCbs.splice(t,1))}update(t){try{this.fpsSampler.start();let n=this.now(),r=n-this._lastTime||1,h=1e3/this._maxFps;if(r>=h){let c=0;h!==0&&(c=r%h,r=r-c),r>200&&(r=1),this._elapsed=t||r,this._totalElapsed+=this._elapsed,this._runScheduledCbs(),this.tick(t||r),h!==0?this._lastTime=n-c:this._lastTime=n,this.fpsSampler.end()}}catch(n){this._onFatalException(n),this.stop()}}}class el extends tl{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;let t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(n){throw window.cancelAnimationFrame(this._requestId),n}};t()}stop(){this._running=!1}}class Nf extends tl{constructor(t){super({...t}),this._logger=et.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!==null&&t!==void 0?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){let n=t??this._updateMs;this._running?(this.update(n),this._currentTime+=n):this._logger.warn("The clock is not running, no step will be performed")}run(t,n){for(let r=0;r<t;r++)this.step(n??this._updateMs)}}var uv=Ft(7379);class Vf{constructor(){this._toasterCss=uv.Z.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){let n=document.createElement("span");return n.innerText=t,n}toast(t,n,r){this._initialize();let h=document.createElement("div");h.className="ex-toast-message";let c=t.split("[LINK]").map(w=>this._createFragment(w));if(n){let w=document.createElement("a");w.href=n,r?w.innerText=r:w.innerText=n,c.splice(1,0,w)}let f=document.createElement("div");c.forEach(w=>{f.appendChild(w)}),h.appendChild(f);let p=document.createElement("button");p.innerText="x",p.addEventListener("click",()=>{this._container.removeChild(h)}),h.appendChild(p);let _=w=>{if(w.key==="Escape")try{this._container.removeChild(h)}catch{}document.removeEventListener("keydown",_)};document.addEventListener("keydown",_);let v=this._container.firstChild;this._container.insertBefore(h,v)}}class Of{constructor(t){this.inputs=t,this._handlers=new Map}execute(){for(let[t,n]of this._handlers.entries()){let r=t(this.inputs);r&&n(r)}}on(t,n){this._handlers.set(t,n)}}g();let dv={FallbackGraphicsContext:"fallbackgraphicscontext",Initialize:"initialize",Visible:"visible",Hidden:"hidden",Start:"start",Stop:"stop",PreUpdate:"preupdate",PostUpdate:"postupdate",PreFrame:"preframe",PostFrame:"postframe",PreDraw:"predraw",PostDraw:"postdraw"};var Zs;(function(u){u[u.None=0]="None",u[u.Canvas=1]="Canvas",u[u.All=2]="All"})(Zs||(Zs={}));class nn{get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}emit(t,n){this.events.emit(t,n)}on(t,n){return this.events.on(t,n)}once(t,n){return this.events.once(t,n)}off(t,n){this.events.off(t,n)}constructor(t){var n,r,h,c,f,p;this.events=new x,this.maxFps=Number.POSITIVE_INFINITY,this.scenes={},this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=E=>{et.getInstance().fatal(E)},this._toaster=new Vf,this._timescale=1,this._isInitialized=!1,this._deferredGoTo=null,this._originalOptions={},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._loadingComplete=!1,this._isReady=!1,this._isReadyPromise=new Promise(E=>{this._isReadyResolve=E}),this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],t={...nn._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,m.freeze(),this.browser=new Ff(window,document);let _=new Pd;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=_.test())){let E=document.createElement("div");if(E.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(E),_.failedTests.forEach(function(C){let S=document.createElement("div");S.innerText="Browser feature missing "+C,document.body.appendChild(S)}),t.canvasElementId){let C=document.getElementById(t.canvasElementId);C&&C.parentElement.removeChild(C)}return}else this._compatible=!0;console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${Hf})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=et.getInstance(),this._logger.defaultLevel===Ee.Debug&&_.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId?(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),this.canvas=document.getElementById(t.canvasElementId)):t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let v=(n=t.displayMode)!==null&&n!==void 0?n:ee.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(v=ee.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),v=ee.FitScreen),this._originalDisplayMode=v;let w=m.isEnabled("use-canvas-context");if(!w)try{this.graphicsContext=new Qs({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})}catch(E){this._logger.warn(`Excalibur could not load webgl for some reason (${E.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/webgl`),w=!0}w&&(this.graphicsContext=new lo({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new Lh({canvas:this.canvas,context:this.graphicsContext,antialiasing:(r=t.antialiasing)!==null&&r!==void 0?r:!0,browser:this.browser,viewport:(h=t.viewport)!==null&&h!==void 0?h:t.width&&t.height?{width:t.width,height:t.height}:Bh.SVGA,resolution:t.resolution,displayMode:v,pixelRatio:t.suppressHiDPIScaling?1:(c=t.pixelRatio)!==null&&c!==void 0?c:null}),he.filtering=t.antialiasing?_e.Blended:_e.Pixel,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=(f=t.maxFps)!==null&&f!==void 0?f:this.maxFps,this.fixedUpdateFps=(p=t.fixedUpdateFps)!==null&&p!==void 0?p:this.fixedUpdateFps,this.clock=new el({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:E=>this.onFatalException(E)}),this.enableCanvasTransparency=t.enableCanvasTransparency,this._loader=new Id,this._loader.wireEngine(this),this.debug=new Mf(this),this._initialize(t),this.rootScene=this.currentScene=new Xn,this.addScene("root",this.rootScene),window.___EXCALIBUR_DEVTOOL=this}_monitorPerformanceThresholdAndTriggerFallback(){let{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback,{threshold:n,showPlayerMessage:r}=this._originalOptions.configurePerformanceCanvas2DFallback;if(n===void 0&&(n=nn._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),r===void 0&&(r=nn._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!m.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===n.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let h=0;for(let f=0;f<this._fpsSamples.length;f++)h+=this._fpsSamples[f];let c=h/this._fpsSamples.length;this._fpsSamples.length===n.numberOfFrames&&c<=n.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),r&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,n,r;let h=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(h,this.canvas),this.canvas=h;let c=this._originalOptions,f=this._originalDisplayMode;this.graphicsContext=new lo({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:c.antialiasing,backgroundColor:c.backgroundColor,snapToPixel:c.snapToPixel,useDrawSorting:c.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new Lh({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=c.antialiasing)!==null&&t!==void 0?t:!0,browser:this.browser,viewport:(n=c.viewport)!==null&&n!==void 0?n:c.width&&c.height?{width:c.width,height:c.height}:Bh.SVGA,resolution:c.resolution,displayMode:f,pixelRatio:c.suppressHiDPIScaling?1:(r=c.pixelRatio)!==null&&r!==void 0?r:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();let p=c&&c.pointerScope===hi.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(p,this),this.input.pointers.init()}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<=0){et.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0.");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,n){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=n}removeScene(t){if(t instanceof Xn)for(let n in this.scenes)this.scenes.hasOwnProperty(n)&&this.scenes[n]===t&&delete this.scenes[n];typeof t=="string"&&delete this.scenes[t]}add(t){if(arguments.length===2){this.addScene(arguments[0],arguments[1]);return}this._deferredGoTo&&this.scenes[this._deferredGoTo]?this.scenes[this._deferredGoTo].add(t):this.currentScene.add(t)}remove(t){t instanceof ne&&this.currentScene.remove(t),t instanceof Xn&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}goToScene(t,n){if(!this.isInitialized){this._deferredGoTo=t;return}if(this.scenes[t]){let r=this.currentScene,h=this.scenes[t];if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){let f={engine:this,previousScene:r,nextScene:h};this.currentScene._deactivate.apply(this.currentScene,[f,h]),this.currentScene.events.emit("deactivate",new yh(f,this.currentScene))}this.currentScene=h,this.screen.setCurrentCamera(h.camera),this.currentScene._initialize(this);let c={engine:this,previousScene:r,nextScene:h,data:n};this.currentScene._activate.apply(this.currentScene,[c,h]),this.currentScene.events.emit("activate",new vh(c,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){var n,r,h,c;this.pageScrollPreventionMode=t.scrollPreventionMode;let f=t&&t.pointerScope===hi.Document?document:this.canvas;this.input={keyboard:new Ah,pointers:new Jn(f,this),gamepads:new Nn},this.input.keyboard.init({grabWindowFocus:(r=(n=this._originalOptions)===null||n===void 0?void 0:n.grabWindowFocus)!==null&&r!==void 0?r:!0}),this.input.pointers.init({grabWindowFocus:(c=(h=this._originalOptions)===null||h===void 0?void 0:h.grabWindowFocus)!==null&&c!==void 0?c:!0}),this.input.gamepads.init(),this.inputMapper=new Of(this.input),this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new Ks(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new be(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}_overrideInitialize(t){if(!this.isInitialized)if(this.onInitialize(t),this.events.emit("initialize",new Ui(t,this)),this._isInitialized=!0,this._deferredGoTo){let n=this._deferredGoTo;this._deferredGoTo=null,this.goToScene(n)}else this.goToScene("root")}_update(t){if(!this.ready){this._loader.update(this,t),this.input.keyboard.update(),this.input.gamepads.update(),this.inputMapper.execute();return}this._preupdate(t),this.currentScene.update(this,t),this.graphicsContext.updatePostProcessors(t),this._postupdate(t),this.input.keyboard.update(),this.input.gamepads.update(),this.inputMapper.execute()}_preupdate(t){this.emit("preupdate",new nt(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,n){}_postupdate(t){this.emit("postupdate",new bt(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,n){}_draw(t){if(this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this._predraw(this.graphicsContext,t),!this._isReady){this._loader.canvas.draw(this.graphicsContext,0,0),this.graphicsContext.flush();return}this.graphicsContext.backgroundColor=this.backgroundColor,this.currentScene.draw(this.graphicsContext,t),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,n){this.emit("predraw",new at(t,n,this)),this.onPreDraw(t,n)}onPreDraw(t,n){}_postdraw(t,n){this.emit("postdraw",new ct(t,n,this)),this.onPostDraw(t,n)}onPostDraw(t,n){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return this._loadingComplete}get ready(){return this._isReady}isReady(){return this._isReadyPromise}async start(t){if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");return t&&(this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this)),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this._logger.debug("Game clock started"),t&&(await this.load(this._loader),this._loadingComplete=!0,this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport()),this._loadingComplete=!0,this._overrideInitialize(this),this._isReady=!0,this._isReadyResolve(),this.emit("start",new W(this)),this._isReadyPromise}_mainloop(t){this.emit("preframe",new Oe(this,this.stats.prevFrame));let n=t*this.timescale;this.currentFrameElapsedMs=n;let r=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=r,this.stats.currFrame.delta=n,this.stats.currFrame.fps=this.clock.fpsSampler.fps,jt.clear();let h=this.clock.now(),c=1e3/this.fixedUpdateFps;if(this.fixedUpdateFps)for(this._lagMs+=n;this._lagMs>=c;)this._update(c),this._lagMs-=c;else this._update(n);let f=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(n);let p=this.clock.now();this.stats.currFrame.duration.update=f-h,this.stats.currFrame.duration.draw=p-f,this.stats.currFrame.graphics.drawnImages=jt.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=jt.DrawCallCount,this.emit("postframe",new $s(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()}stop(){this.clock.isRunning()&&(this.emit("stop",new j(this)),this.browser.pause(),this.clock.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(r=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:r})})}_checkForScreenShots(){for(let t of this._screenShotRequests){let n=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,r=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,h=document.createElement("canvas");h.width=n,h.height=r;let c=h.getContext("2d");c.imageSmoothingEnabled=this.screen.antialiasing,c.drawImage(this.canvas,0,0,n,r);let f=new Image,p=h.toDataURL("image/png");f.src=p,t.resolve(f)}this._screenShotRequests.length=0}async load(t){try{await t.load()}catch(n){this._logger.error("Error loading resources, things may not behave properly",n),await Promise.resolve()}}}nn._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!0,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,snapToPixel:!1,pointerScope:hi.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:Zs.Canvas,backgroundColor:O.fromHex("#2185d0")};class fv{constructor(){this._handlers={},this._wiredEventDispatchers=[],this._deferedHandlerRemovals=[]}clear(){this._handlers={},this._wiredEventDispatchers=[]}_processDeferredHandlerRemovals(){for(let t of this._deferedHandlerRemovals)this._removeHandler(t.name,t.handler);this._deferedHandlerRemovals.length=0}emit(t,n){if(this._processDeferredHandlerRemovals(),!t)return;t=t.toLowerCase(),(typeof n>"u"||n===null)&&(n=new T);let r,h;if(this._handlers[t])for(r=0,h=this._handlers[t].length,r;r<h;r++)this._handlers[t][r](n);for(r=0,h=this._wiredEventDispatchers.length,r;r<h;r++)this._wiredEventDispatchers[r].emit(t,n)}on(t,n){this._processDeferredHandlerRemovals(),t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(n)}off(t,n){this._deferedHandlerRemovals.push({name:t,handler:n})}_removeHandler(t,n){t=t.toLowerCase();let r=this._handlers[t];if(r)if(!n)this._handlers[t].length=0;else{let h=r.indexOf(n);h>-1&&this._handlers[t].splice(h,1)}}once(t,n){this._processDeferredHandlerRemovals();let r=h=>{let c=h||new T;this.off(t,r),n(c)};this.on(t,r)}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){let n=t._wiredEventDispatchers.indexOf(this);n>-1&&t._wiredEventDispatchers.splice(n,1)}}class pv extends rs{get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this._text.opacity}set opacity(t){this._text.opacity=t}get spriteFont(){return this._spriteFont}set spriteFont(t){t&&(this._spriteFont=t,this._text.font=this._spriteFont)}constructor(t){super(t),this._font=new Ji,this._text=new jn({text:"",font:this._font});let{text:n,pos:r,x:h,y:c,spriteFont:f,font:p,color:_}=t;this.pos=r??(h&&c?M(h,c):this.pos),this.text=n??this.text,this.font=p??this.font,this.spriteFont=f??this.spriteFont,this._text.color=_??this.color;let v=this.get(ue);v.anchor=I.Zero,v.use(this._text)}_initialize(t){super._initialize(t)}getTextWidth(){return this._text.width}}class Uf extends ne{getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t),this._gfx.visible=!0,this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(let n of this._graphics){let r=M(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:n.height-this.map.tileHeight));t=t.combine(n.localBounds.translate(r))}return t}removeGraphic(t){let n=this._graphics.indexOf(t);n>-1&&this._graphics.splice(n,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.visible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){let n=this._colliders.indexOf(t);n>-1&&this._colliders.splice(n,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(M(this.x,this.y))}get center(){return this.pos.add(M(0,this.map.tileHeight/2))}constructor(t,n,r,h){super([new K,new ue({offset:r??I.Zero,onPostDraw:(C,S)=>this.draw(C,S)}),new Do(h)]),this.solid=!1,this._tileBounds=new ot,this._graphics=[],this._colliders=[],this.x=t,this.y=n,this.map=h,this._transform=this.get(K),this._isometricEntityComponent=this.get(Do);let c=this.map.tileWidth/2,f=this.map.tileHeight/2,p=(this.x-this.y)*c,_=(this.x+this.y)*f;this._transform.pos=M(p,_),this._isometricEntityComponent.elevation=0,this._gfx=this.get(ue),this._gfx.visible=!1;let v=this.map.tileWidth,w=this.map.tileHeight,E=M(0,this.map.renderFromTopOfGraphic?w:0);this._gfx.localBounds=this._tileBounds=new ot({left:-v/2,top:-w,right:v/2,bottom:w}).translate(E)}draw(t,n){let r=this.map.tileWidth/2;t.save(),t.translate(-r,0);for(let h of this._graphics)h.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:h.height-this.map.tileHeight));t.restore()}}class _v extends ne{constructor(t){super([new K,new pt({type:ut.Fixed}),new $t,new Co(v=>this.debug(v),!1)],t.name),this.renderFromTopOfGraphic=!1,this.graphicsOffset=M(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;let{pos:n,tileWidth:r,tileHeight:h,columns:c,rows:f,renderFromTopOfGraphic:p,graphicsOffset:_}=t;this.transform=this.get(K),n&&(this.transform.pos=n),this.collider=this.get($t),this.collider&&this.collider.set(this._composite=new ge([])),this.renderFromTopOfGraphic=p??this.renderFromTopOfGraphic,this.graphicsOffset=_??this.graphicsOffset,this.tileWidth=r,this.tileHeight=h,this.columns=c,this.rows=f,this.tiles=new Array(c*f);for(let v=0;v<f;v++)for(let w=0;w<c;w++){let E=new Uf(w,v,this.graphicsOffset,this);this.tiles[w+v*c]=E,this.addChild(E)}}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1)}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{let n=t.offset;return this._originalOffsets.set(t,n),n}}updateColliders(){this._composite.clearColliders();let t=this.get(K).pos;for(let n of this.tiles)if(n.solid)for(let r of n.getColliders()){let h=this._getOrSetColliderOriginalOffset(r);r.offset=this.tileToWorld(M(n.x,n.y)).sub(t).add(h).sub(M(this.tileWidth/2,this.tileHeight)),r.owner=this,this._composite.addCollider(r)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);let n=this.tileWidth/2,r=this.tileHeight/2;return M(~~((t.x/n+t.y/r)/2),~~((t.y/r-t.x/n)/2))}tileToWorld(t){let n=this.tileWidth/2,r=this.tileHeight/2,h=(t.x-t.y)*n,c=(t.x+t.y)*r;return M(h,c).add(this.transform.pos)}getTile(t,n){return t<0||n<0||t>=this.columns||n>=this.rows?null:this.tiles[t+n*this.columns]}getTileByPoint(t){let n=this.worldToTile(t);return this.getTile(n.x,n.y)}_getMaxZIndex(){let t=Number.NEGATIVE_INFINITY;for(let n of this.tiles){let r=n.get(K).z;r>t&&(t=r)}return t}debug(t){t.save(),t.z=this._getMaxZIndex()+.5;for(let n=0;n<this.rows+1;n++){let r=this.tileToWorld(M(0,n)),h=this.tileToWorld(M(this.columns,n));t.drawLine(r,h,O.Red,2)}for(let n=0;n<this.columns+1;n++){let r=this.tileToWorld(M(n,0)),h=this.tileToWorld(M(n,this.rows));t.drawLine(r,h,O.Red,2)}for(let n of this.tiles)t.drawCircle(this.tileToWorld(M(n.x,n.y)),3,O.Yellow);t.restore()}}class sl{constructor(t,n){this._stopped=!1,this._sequenceBuilder=n,this._sequenceContext=new qn(t),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(t){this._actionQueue.update(t)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(t){return new sl(t,this._sequenceBuilder)}}class gv{constructor(t){this._actions=t}update(t){for(let n=0;n<this._actions.length;n++)this._actions[n].update(t)}isComplete(t){return this._actions.every(n=>n.isComplete(t))}reset(){this._actions.forEach(t=>t.reset())}stop(){this._actions.forEach(t=>t.stop())}}class vi{static create(t,n){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t))throw new Error(`Collision group ${t} already exists`);let r=new is(t,this._CURRENT_BIT,n!==void 0?n:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,r),r}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}vi._STARTING_BIT=1,vi._MAX_GROUPS=32,vi._CURRENT_GROUP=1,vi._CURRENT_BIT=vi._STARTING_BIT,vi._GROUPS=new Map;function mv(u){return!!u._initialize}function vv(u){return!!u.onInitialize}function yv(u){return!!u._preupdate}function wv(u){return!!u.onPreUpdate}function xv(u){return!!u.onPostUpdate}function bv(u){return!!u.onPostUpdate}function Ev(u){return!!u.onPreDraw}function Tv(u){return!!u.onPostDraw}class Av{constructor(t,n=O.Magenta,r=!1){this.path=t,this.color=n,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new ao(t,"arraybuffer",r),this._transparentColor=n}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){let t=await this._resource.load();this._stream=new zf(t),this._gif=new Gf(this._stream,this._transparentColor);let n=this._gif.images.map(r=>new Dh(r.src,!1));return await Promise.all(n.map(r=>r.load())),this.data=this._textures=n}isLoaded(){return!!this.data}toSprite(t=0){return this._textures[t].toSprite()}toSpriteSheet(){let t=this._textures.map(n=>n.toSprite());return new ui({sprites:t})}toAnimation(t){let n=this.toSpriteSheet(),r=n.sprites.length;return this._animation=_s.fromSpriteSheet(n,Ih(0,r),t),this._animation}get readCheckBytes(){return this._gif.checkBytes}}let Mo=u=>u.reduce(function(t,n){return t*2+n},0),il=u=>{let t=[];for(let n=7;n>=0;n--)t.push(!!(u&1<<n));return t};class zf{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=n=>{let r=[];for(let h=0;h<n;h++)r.push(this.readByte());return r},this.read=n=>{let r="";for(let h=0;h<n;h++)r+=String.fromCharCode(this.readByte());return r},this.readUnsigned=()=>{let n=this.readBytes(2);return(n[1]<<8)+n[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}}let Cv=function(u,t){let n=0,r=function(C){let S=0;for(let k=0;k<C;k++)t.charCodeAt(n>>3)&1<<(n&7)&&(S|=1<<k),n++;return S},h=[],c=1<<u,f=c+1,p=u+1,_=[],v=function(){_=[],p=u+1;for(let C=0;C<c;C++)_[C]=[C];_[c]=[],_[f]=null},w,E;for(;;){if(E=w,w=r(p),w===c){v();continue}if(w===f)break;if(w<_.length)E!==c&&_.push(_[E].concat(_[w][0]));else{if(w!==_.length)throw new Error("Invalid LZW code.");_.push(_[E].concat(_[E][0]))}h.push.apply(h,_[w]),_.length===1<<p&&p<12&&p++}return h};class Gf{constructor(t,n=O.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=r=>{let h=[];for(let c=0;c<r;c++){let p="#"+this._st.readBytes(3).map(_=>{let v=_.toString(16);return v.length===1?"0"+v:v}).join("");h.push(p)}return h},this.readSubBlocks=()=>{let r,h;h="";do r=this._st.readByte(),h+=this._st.read(r);while(r!==0);return h},this.parseHeader=()=>{let r={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(r.sig=this._st.read(3),r.ver=this._st.read(3),r.sig!=="GIF")throw new Error("Not a GIF file.");r.width=this._st.readUnsigned(),r.height=this._st.readUnsigned();let h=il(this._st.readByte());r.gctFlag=h.shift(),r.colorRes=Mo(h.splice(0,3)),r.sorted=h.shift(),r.globalColorTableSize=Mo(h.splice(0,3)),r.bgColor=this._st.readByte(),r.pixelAspectRatio=this._st.readByte(),r.gctFlag&&(r.globalColorTable=this.parseColorTable(1<<r.globalColorTableSize+1),this.globalColorTable=r.globalColorTable),this._handler.hdr&&this._handler.hdr(r)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=r=>{let h=v=>{this.checkBytes.push(this._st.readByte());let w=il(this._st.readByte());v.reserved=w.splice(0,3),v.disposalMethod=Mo(w.splice(0,3)),v.userInput=w.shift(),v.transparencyGiven=w.shift(),v.delayTime=this._st.readUnsigned(),v.transparencyIndex=this._st.readByte(),v.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(v)&&this.checkBytes.push(this._handler.gce)},c=v=>{v.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(v)&&this.checkBytes.push(this._handler.com)},f=v=>{this.checkBytes.push(this._st.readByte()),v.ptHeader=this._st.readBytes(12),v.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(v)&&this.checkBytes.push(this._handler.pte)},p=v=>{let w=C=>{this.checkBytes.push(this._st.readByte()),C.unknown=this._st.readByte(),C.iterations=this._st.readUnsigned(),C.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(C)&&this.checkBytes.push(this._handler.app)},E=C=>{C.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[C.identifier]&&this._handler.app[C.identifier](C)&&this.checkBytes.push(this._handler.app[C.identifier])};switch(this.checkBytes.push(this._st.readByte()),v.identifier=this._st.read(8),v.authCode=this._st.read(3),v.identifier){case"NETSCAPE":w(v);break;default:E(v);break}},_=v=>{v.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(v)&&this.checkBytes.push(this._handler.unknown)};switch(r.label=this._st.readByte(),r.label){case 249:r.extType="gce",h(r);break;case 254:r.extType="com",c(r);break;case 1:r.extType="pte",f(r);break;case 255:r.extType="app",p(r);break;default:r.extType="unknown",_(r);break}},this.parseImg=r=>{let h=(p,_)=>{let v=new Array(p.length),w=p.length/_,E=(N,V)=>{let D=p.slice(V*_,(V+1)*_);v.splice.apply(v,[N*_,_].concat(D))},C=[0,4,2,1],S=[8,8,4,2],k=0;for(let N=0;N<4;N++)for(let V=C[N];V<w;V+=S[N])E(V,k),k++;return v};r.leftPos=this._st.readUnsigned(),r.topPos=this._st.readUnsigned(),r.width=this._st.readUnsigned(),r.height=this._st.readUnsigned();let c=il(this._st.readByte());r.lctFlag=c.shift(),r.interlaced=c.shift(),r.sorted=c.shift(),r.reserved=c.splice(0,2),r.lctSize=Mo(c.splice(0,3)),r.lctFlag&&(r.lct=this.parseColorTable(1<<r.lctSize+1)),r.lzwMinCodeSize=this._st.readByte();let f=this.readSubBlocks();r.pixels=Cv(r.lzwMinCodeSize,f),r.interlaced&&(r.pixels=h(r.pixels,r.width)),this.frames.push(r),this.arrayToImage(r),this._handler.img&&this._handler.img(r)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{let r={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(r.sentinel)){case"!":r.type="ext",this.parseExt(r);break;case",":r.type="img",this.parseImg(r);break;case";":r.type="eof",this._handler.eof&&this._handler.eof(r)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+r.sentinel.toString(16))}r.type!=="eof"&&this.parseBlock()},this.arrayToImage=r=>{let h=0,c=document.createElement("canvas");c.id=h.toString(),c.width=r.width,c.height=r.height,h++;let f=c.getContext("2d"),p=1,_=0,v=0;for(let E=0;E<r.pixels.length;E++)v%r.width===0&&(_++,v=0),this.globalColorTable[r.pixels[E]]===this._transparentColor.toHex()?f.fillStyle="rgba(0, 0, 0, 0)":f.fillStyle=this.globalColorTable[r.pixels[E]],f.fillRect(v,_,p,p),v++;let w=new Image;w.src=c.toDataURL(),this.images.push(w)},this._st=t,this._handler={},this._transparentColor=n,this.parseHeader(),this.parseBlock()}}class nl extends De{constructor(t){super(),this.color=O.Black,this.thickness=1;let{start:n,end:r,color:h,thickness:c}=t;this.start=n,this.end=r,this.color=h??this.color,this.thickness=c??this.thickness;let{width:f,height:p}=ot.fromPoints([n,r]);this.width=f,this.height=p}_drawImage(t,n,r){t.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new nl({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class rl extends Ki{get points(){return this._points}set points(t){this._points=t;let n=this.minPoint;this.width=this._points.reduce((r,h)=>Math.max(h.x,r),0)-n.x,this.height=this._points.reduce((r,h)=>Math.max(h.y,r),0)-n.y,this.flagDirty()}get minPoint(){let t=this._points.reduce((r,h)=>Math.min(h.x,r),1/0),n=this._points.reduce((r,h)=>Math.min(h.y,r),1/0);return M(t,n)}constructor(t){super(t),this.points=t.points,this.filtering=_e.Blended,this.rasterize()}clone(){return new rl({points:this.points.map(t=>t.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();let n=this.minPoint.negate(),r=this.points[0].add(n);t.moveTo(r.x,r.y),this.points.forEach(h=>{t.lineTo(h.x+n.x,h.y+n.y)}),t.lineTo(r.x,r.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}class Iv{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){let t=new ji;return this._queue.push(t),t.promise}dequeue(t){this._queue.shift().resolve(t)}}class Sv{constructor(t){this._count=t,this._waitQueue=new Iv}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(t=1){if(t!==0){for(;t!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),t--;this._count+=t}}}let Hf="0.28.0";g()})();var sb=b.fWn,ib=b.Ia8,nb=b.rqv,rb=b.hLI,ob=b.yyv,ab=b.tX5,Rt=b.vtX,hb=b.r7K,lb=b.lCh,cb=b.cE4,ub=b.fwF,db=b.sce,fb=b.AQ6,pb=b._c7,_b=b.KUs,gb=b.Ajp,mb=b.dkO,vb=b.RDh,yb=b._H9,wb=b.mxs,xb=b.OmD,bb=b.kBf,Eb=b.C4F,Tb=b.NQt,Ab=b.JjN,Cb=b.EK_,Ib=b.V1s,Sb=b.xHm,Pb=b.Xz7,Rb=b.Cdc,Db=b.FKn,kb=b.SUY,Mb=b.ab2,Fb=b.GfZ,Bb=b.YMS,Lb=b.oyv,Nb=b.aUb,Vb=b.SdD,Ob=b.JUv,Ub=b.jEj,zb=b.TFq,Gb=b.HDU,Hb=b.R_y,Wb=b.ydN,qb=b.t50,jb=b.s$$,Ot=b.v2G,It=b.Ilk,$b=b.s9i,Kb=b.dxL,Qb=b.LLX,Xb=b.wA2,Yb=b.R_p,Zb=b.IQ$,Jb=b.I5F,tE=b.X8$,eE=b.FR6,sE=b.U8o,iE=b.kbG,nE=b.iS_,rE=b.cGG,oE=b.RPN,aE=b.skb,hE=b.SLU,lE=b.RdJ,cE=b.cNu,uE=b.gU7,dE=b.LSk,fE=b.Nmp,pE=b.d1Y,_E=b.xrL,gE=b.sRW,mE=b.cmV,vE=b.qWz,yE=b.N0Q,wE=b.q8b,xE=b.ynB,bE=b.jT9,EE=b.wAz,qf=b.D4V,TE=b.NLr,AE=b.N6H,CE=b.W1A,IE=b.JHW,SE=b.ZZ$,PE=b.v2K,RE=b.pBf,DE=b.vpe,kE=b.GMl,ME=b.zW2,FE=b.B0K,BE=b.Nv7,LE=b.C_p,NE=b.MUA,VE=b.xqU,OE=b.pTp,UE=b.vUK,zE=b.j9l,wi=b.Zxw,GE=b.v51,HE=b.Hdx,xi=b.Z$d,WE=b.iqV,qE=b.o$7,jE=b.olM,$E=b.Zm$,KE=b.$QH,QE=b.i78,XE=b.nJg,YE=b.h6u,ZE=b.hts,JE=b.j88,tT=b.VME,eT=b.fy2,sT=b.nt,iT=b.Ukr,nT=b.zsu,rT=b.oA6,oT=b.TVh,aT=b.TwZ,hT=b.GTT,lT=b.xxj,cT=b.XdK,uT=b.Jmb,dT=b.cXo,fT=b.Dm5,pT=b.IIB,_T=b.ebW,gT=b.zI0,mT=b.LYD,vT=b.cEG,yT=b.SEl,wT=b.t9V,xT=b.ez5,bT=b.N1d,St=b.R8U,ET=b.SKZ,bi=b.__J,TT=b.RI$,AT=b.x12,CT=b.ccz,IT=b.aNw,ST=b.XrL,PT=b.xwn,RT=b.dNK,DT=b.ini,kT=b.YdH,MT=b.F5T,FT=b.y3G,BT=b.l57,LT=b.xn0,NT=b.t2V,VT=b.uxB,OT=b.cpd,UT=b.fiy,zT=b.$XZ,GT=b.UG6,HT=b.uqK,WT=b.STE,qT=b.y$z,jT=b.mAD,$T=b.sOq,KT=b.hUw,QT=b._0G,XT=b.Sqs,YT=b.hpZ,ZT=b.Vol,JT=b.vYX,je=b.wIZ,tA=b.cBi,eA=b.c30,sA=b.MPV,iA=b.RFv,nA=b.Ux6,rA=b.rxy,oA=b.I$c,aA=b.kfC,hA=b.VjY,lA=b.mgq,cA=b.YVA,uA=b.Kgp,dA=b.HH$,fA=b.M_d,pA=b.rgh,_A=b.Ra6,gA=b.KhR,mA=b.BS5,vA=b.xhz,yA=b.xOq,wA=b.a9j,xA=b.bHk,bA=b.CgK,EA=b.cuY,TA=b.kvE,AA=b.SBu,CA=b.AE_,IA=b.ctO,SA=b.OLH,PA=b.kky,RA=b.nSF,DA=b.zHn,kA=b.zwx,MA=b.AeJ,FA=b.hLz,BA=b.D9g,LA=b.wA,NA=b.jhr,VA=b.GVs,OA=b._zO,UA=b.LXZ,zA=b.w6$,GA=b.mhV,HA=b.MOD,WA=b.kwd,qA=b.Lmr,Ye=b.xsS,jA=b.K5l,$A=b.lLr,KA=b.Z$r,QA=b.IXb,XA=b.SGH,YA=b.SMj,ZA=b.L34,JA=b.exe,tC=b.bnF,eC=b.MFA,sC=b.$uU,iC=b.Sap,nC=b.jyi,rC=b.E03,oC=b.V6q,aC=b.rg2,hC=b.DVW,lC=b.nVo,cC=b.F6N,uC=b.xP7,dC=b.Odq,fC=b.Zif,Ve=b.ZGJ,pC=b.MJk,_C=b.xvT,tr=b.PHM,gC=b.dpR,mC=b.n9L,vC=b.KwO,yC=b.SxM,wC=b.B7y,xC=b.x7r,bC=b.wx7,EC=b.Uvn,TC=b.OFT,AC=b.xzN,CC=b.CcZ,IC=b.M5Z,SC=b.ZrN,PC=b.OWs,RC=b.dF9,DC=b.oZy,kC=b.rD2,MC=b.VHo,FC=b.ohE,BC=b.R$E,LC=b.xQN,NC=b.AdJ,VC=b.q3I,OC=b.Pab,UC=b.uZ5,zC=b.McK,GC=b.F9c,HC=b.k0b,WC=b.hnT,qC=b.RSJ,jC=b.Mku,$C=b.h90,KC=b.rms,QC=b.ErP,XC=b.aVg,YC=b.lPc,ZC=b.Z8E,JC=b._N2,tI=b.yFn,eI=b.lNv,sI=b.cu9,iI=b.MZQ,nI=b.FUM,rI=b.BxR,oI=b.vdf,aI=b.iaL,hI=b.w6H,lI=b.Q4c,cI=b.Xxe,uI=b.Uxb,dI=b.Yr5,Z=b.Bhw,fI=b.yOA;var $={width:800,height:600};var rn=class extends Rt{constructor(e){super({pos:Z($.width/2,$.height-e.height/2),width:$.width,height:e.height,color:e.color??It.Green,collisionType:Ot.Fixed}),this.addComponent(new Ve("ground"))}};var $f=function(s){let e=[],i=0;for(let o=0;o<s.length;o++){let a=s.charCodeAt(o);a<128?e[i++]=a:a<2048?(e[i++]=a>>6|192,e[i++]=a&63|128):(a&64512)===55296&&o+1<s.length&&(s.charCodeAt(o+1)&64512)===56320?(a=65536+((a&1023)<<10)+(s.charCodeAt(++o)&1023),e[i++]=a>>18|240,e[i++]=a>>12&63|128,e[i++]=a>>6&63|128,e[i++]=a&63|128):(e[i++]=a>>12|224,e[i++]=a>>6&63|128,e[i++]=a&63|128)}return e},Rv=function(s){let e=[],i=0,o=0;for(;i<s.length;){let a=s[i++];if(a<128)e[o++]=String.fromCharCode(a);else if(a>191&&a<224){let l=s[i++];e[o++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){let l=s[i++],d=s[i++],g=s[i++],m=((a&7)<<18|(l&63)<<12|(d&63)<<6|g&63)-65536;e[o++]=String.fromCharCode(55296+(m>>10)),e[o++]=String.fromCharCode(56320+(m&1023))}else{let l=s[i++],d=s[i++];e[o++]=String.fromCharCode((a&15)<<12|(l&63)<<6|d&63)}}return e.join("")},Kf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();let i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let a=0;a<s.length;a+=3){let l=s[a],d=a+1<s.length,g=d?s[a+1]:0,m=a+2<s.length,y=m?s[a+2]:0,x=l>>2,A=(l&3)<<4|g>>4,T=(g&15)<<2|y>>6,P=y&63;m||(P=64,d||(T=64)),o.push(i[x],i[A],i[T],i[P])}return o.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray($f(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):Rv(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();let i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let a=0;a<s.length;){let l=i[s.charAt(a++)],g=a<s.length?i[s.charAt(a)]:0;++a;let y=a<s.length?i[s.charAt(a)]:64;++a;let A=a<s.length?i[s.charAt(a)]:64;if(++a,l==null||g==null||y==null||A==null)throw new ol;let T=l<<2|g>>4;if(o.push(T),y!==64){let P=g<<4&240|y>>2;if(o.push(P),A!==64){let B=y<<6&192|A;o.push(B)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}},ol=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Dv=function(s){let e=$f(s);return Kf.encodeByteArray(e,!0)},er=function(s){return Dv(s).replace(/\./g,"")},kv=function(s){try{return Kf.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Mv(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Fv=()=>Mv().__FIREBASE_DEFAULTS__,Bv=()=>{if(typeof process>"u"||typeof process.env>"u")return;let s=process.env.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},Lv=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=s&&kv(s[1]);return e&&JSON.parse(e)},Qf=()=>{try{return Fv()||Bv()||Lv()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},Nv=s=>{var e,i;return(i=(e=Qf())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[s]},Xf=s=>{let e=Nv(s);if(!e)return;let i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},al=()=>{var s;return(s=Qf())===null||s===void 0?void 0:s.config};var Bo=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}};function Yf(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let i={alg:"none",type:"JWT"},o=e||"demo-project",a=s.iat||0,l=s.sub||s.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let d=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}}},s),g="";return[er(JSON.stringify(i)),er(JSON.stringify(d)),g].join(".")}function hl(){try{return typeof indexedDB=="object"}catch{return!1}}function Zf(){return new Promise((s,e)=>{try{let i=!0,o="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(o);a.onsuccess=()=>{a.result.close(),i||self.indexedDB.deleteDatabase(o),s(!0)},a.onupgradeneeded=()=>{i=!1},a.onerror=()=>{var l;e(((l=a.error)===null||l===void 0?void 0:l.message)||"")}}catch(i){e(i)}})}var Vv="FirebaseError",Us=class s extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=Vv,Object.setPrototypeOf(this,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,sr.prototype.create)}},sr=class{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){let o=i[0]||{},a=`${this.service}/${e}`,l=this.errors[e],d=l?Ov(l,o):"Error",g=`${this.serviceName}: ${d} (${a}).`;return new Us(a,g,o)}};function Ov(s,e){return s.replace(Uv,(i,o)=>{let a=e[o];return a!=null?String(a):`<${o}?>`})}var Uv=/\{\$([^}]+)}/g;function ir(s,e){if(s===e)return!0;let i=Object.keys(s),o=Object.keys(e);for(let a of i){if(!o.includes(a))return!1;let l=s[a],d=e[a];if(jf(l)&&jf(d)){if(!ir(l,d))return!1}else if(l!==d)return!1}for(let a of o)if(!i.includes(a))return!1;return!0}function jf(s){return s!==null&&typeof s=="object"}var xI=4*60*60*1e3;function nr(s){return s&&s._delegate?s._delegate:s}var zs=class{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Ei="[DEFAULT]";var ll=class{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){let o=new Bo;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{let a=this.getOrInitializeService({instanceIdentifier:i});a&&o.resolve(a)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;let o=this.normalizeInstanceIdentifier(e?.identifier),a=(i=e?.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(l){if(a)return null;throw l}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Gv(e))try{this.getOrInitializeService({instanceIdentifier:Ei})}catch{}for(let[i,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(i);try{let l=this.getOrInitializeService({instanceIdentifier:a});o.resolve(l)}catch{}}}}clearInstance(e=Ei){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ei){return this.instances.has(e)}getOptions(e=Ei){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let a=this.getOrInitializeService({instanceIdentifier:o,options:i});for(let[l,d]of this.instancesDeferred.entries()){let g=this.normalizeInstanceIdentifier(l);o===g&&d.resolve(a)}return a}onInit(e,i){var o;let a=this.normalizeInstanceIdentifier(i),l=(o=this.onInitCallbacks.get(a))!==null&&o!==void 0?o:new Set;l.add(e),this.onInitCallbacks.set(a,l);let d=this.instances.get(a);return d&&e(d,a),()=>{l.delete(e)}}invokeOnInitCallbacks(e,i){let o=this.onInitCallbacks.get(i);if(o)for(let a of o)try{a(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:zv(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Ei){return this.component?this.component.multipleInstances?e:Ei:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function zv(s){return s===Ei?void 0:s}function Gv(s){return s.instantiationMode==="EAGER"}var Lo=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let i=new ll(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}};var Hv=[],yt;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(yt||(yt={}));var Wv={debug:yt.DEBUG,verbose:yt.VERBOSE,info:yt.INFO,warn:yt.WARN,error:yt.ERROR,silent:yt.SILENT},qv=yt.INFO,jv={[yt.DEBUG]:"log",[yt.VERBOSE]:"log",[yt.INFO]:"info",[yt.WARN]:"warn",[yt.ERROR]:"error"},$v=(s,e,...i)=>{if(e<s.logLevel)return;let o=new Date().toISOString(),a=jv[e];if(a)console[a](`[${o}]  ${s.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},on=class{constructor(e){this.name=e,this._logLevel=qv,this._logHandler=$v,this._userLogHandler=null,Hv.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in yt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Wv[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,yt.DEBUG,...e),this._logHandler(this,yt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,yt.VERBOSE,...e),this._logHandler(this,yt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,yt.INFO,...e),this._logHandler(this,yt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,yt.WARN,...e),this._logHandler(this,yt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,yt.ERROR,...e),this._logHandler(this,yt.ERROR,...e)}};var Kv=(s,e)=>e.some(i=>s instanceof i),Jf,tp;function Qv(){return Jf||(Jf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xv(){return tp||(tp=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ep=new WeakMap,ul=new WeakMap,sp=new WeakMap,cl=new WeakMap,fl=new WeakMap;function Yv(s){let e=new Promise((i,o)=>{let a=()=>{s.removeEventListener("success",l),s.removeEventListener("error",d)},l=()=>{i(xs(s.result)),a()},d=()=>{o(s.error),a()};s.addEventListener("success",l),s.addEventListener("error",d)});return e.then(i=>{i instanceof IDBCursor&&ep.set(i,s)}).catch(()=>{}),fl.set(e,s),e}function Zv(s){if(ul.has(s))return;let e=new Promise((i,o)=>{let a=()=>{s.removeEventListener("complete",l),s.removeEventListener("error",d),s.removeEventListener("abort",d)},l=()=>{i(),a()},d=()=>{o(s.error||new DOMException("AbortError","AbortError")),a()};s.addEventListener("complete",l),s.addEventListener("error",d),s.addEventListener("abort",d)});ul.set(s,e)}var dl={get(s,e,i){if(s instanceof IDBTransaction){if(e==="done")return ul.get(s);if(e==="objectStoreNames")return s.objectStoreNames||sp.get(s);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return xs(s[e])},set(s,e,i){return s[e]=i,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function ip(s){dl=s(dl)}function Jv(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){let o=s.call(No(this),e,...i);return sp.set(o,e.sort?e.sort():[e]),xs(o)}:Xv().includes(s)?function(...e){return s.apply(No(this),e),xs(ep.get(this))}:function(...e){return xs(s.apply(No(this),e))}}function ty(s){return typeof s=="function"?Jv(s):(s instanceof IDBTransaction&&Zv(s),Kv(s,Qv())?new Proxy(s,dl):s)}function xs(s){if(s instanceof IDBRequest)return Yv(s);if(cl.has(s))return cl.get(s);let e=ty(s);return e!==s&&(cl.set(s,e),fl.set(e,s)),e}var No=s=>fl.get(s);function rp(s,e,{blocked:i,upgrade:o,blocking:a,terminated:l}={}){let d=indexedDB.open(s,e),g=xs(d);return o&&d.addEventListener("upgradeneeded",m=>{o(xs(d.result),m.oldVersion,m.newVersion,xs(d.transaction),m)}),i&&d.addEventListener("blocked",m=>i(m.oldVersion,m.newVersion,m)),g.then(m=>{l&&m.addEventListener("close",()=>l()),a&&m.addEventListener("versionchange",y=>a(y.oldVersion,y.newVersion,y))}).catch(()=>{}),g}var ey=["get","getKey","getAll","getAllKeys","count"],sy=["put","add","delete","clear"],pl=new Map;function np(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(pl.get(e))return pl.get(e);let i=e.replace(/FromIndex$/,""),o=e!==i,a=sy.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(a||ey.includes(i)))return;let l=async function(d,...g){let m=this.transaction(d,a?"readwrite":"readonly"),y=m.store;return o&&(y=y.index(g.shift())),(await Promise.all([y[i](...g),a&&m.done]))[0]};return pl.set(e,l),l}ip(s=>({...s,get:(e,i,o)=>np(e,i)||s.get(e,i,o),has:(e,i)=>!!np(e,i)||s.has(e,i)}));var gl=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(iy(i)){let o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}};function iy(s){let e=s.getComponent();return e?.type==="VERSION"}var ml="@firebase/app",op="0.9.22";var Ti=new on("@firebase/app"),ny="@firebase/app-compat",ry="@firebase/analytics-compat",oy="@firebase/analytics",ay="@firebase/app-check-compat",hy="@firebase/app-check",ly="@firebase/auth",cy="@firebase/auth-compat",uy="@firebase/database",dy="@firebase/database-compat",fy="@firebase/functions",py="@firebase/functions-compat",_y="@firebase/installations",gy="@firebase/installations-compat",my="@firebase/messaging",vy="@firebase/messaging-compat",yy="@firebase/performance",wy="@firebase/performance-compat",xy="@firebase/remote-config",by="@firebase/remote-config-compat",Ey="@firebase/storage",Ty="@firebase/storage-compat",Ay="@firebase/firestore",Cy="@firebase/firestore-compat",Iy="firebase",Sy="10.5.2";var vl="[DEFAULT]",Py={[ml]:"fire-core",[ny]:"fire-core-compat",[oy]:"fire-analytics",[ry]:"fire-analytics-compat",[hy]:"fire-app-check",[ay]:"fire-app-check-compat",[ly]:"fire-auth",[cy]:"fire-auth-compat",[uy]:"fire-rtdb",[dy]:"fire-rtdb-compat",[fy]:"fire-fn",[py]:"fire-fn-compat",[_y]:"fire-iid",[gy]:"fire-iid-compat",[my]:"fire-fcm",[vy]:"fire-fcm-compat",[yy]:"fire-perf",[wy]:"fire-perf-compat",[xy]:"fire-rc",[by]:"fire-rc-compat",[Ey]:"fire-gcs",[Ty]:"fire-gcs-compat",[Ay]:"fire-fst",[Cy]:"fire-fst-compat","fire-js":"fire-js",[Iy]:"fire-js-all"};var Vo=new Map,yl=new Map;function Ry(s,e){try{s.container.addComponent(e)}catch(i){Ti.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,i)}}function rr(s){let e=s.name;if(yl.has(e))return Ti.debug(`There were multiple attempts to register component ${e}.`),!1;yl.set(e,s);for(let i of Vo.values())Ry(i,s);return!0}function cp(s,e){let i=s.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),s.container.getProvider(e)}var Dy={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Js=new sr("app","Firebase",Dy);var wl=class{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new zs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Js.create("app-deleted",{appName:this._name})}};var up=Sy;function El(s,e={}){let i=s;typeof e!="object"&&(e={name:e});let o=Object.assign({name:vl,automaticDataCollectionEnabled:!1},e),a=o.name;if(typeof a!="string"||!a)throw Js.create("bad-app-name",{appName:String(a)});if(i||(i=al()),!i)throw Js.create("no-options");let l=Vo.get(a);if(l){if(ir(i,l.options)&&ir(o,l.config))return l;throw Js.create("duplicate-app",{appName:a})}let d=new Lo(a);for(let m of yl.values())d.addComponent(m);let g=new wl(i,o,d);return Vo.set(a,g),g}function dp(s=vl){let e=Vo.get(s);if(!e&&s===vl&&al())return El();if(!e)throw Js.create("no-app",{appName:s});return e}function ti(s,e,i){var o;let a=(o=Py[s])!==null&&o!==void 0?o:s;i&&(a+=`-${i}`);let l=a.match(/\s|\//),d=e.match(/\s|\//);if(l||d){let g=[`Unable to register library "${a}" with version "${e}":`];l&&g.push(`library name "${a}" contains illegal characters (whitespace or "/")`),l&&d&&g.push("and"),d&&g.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ti.warn(g.join(" "));return}rr(new zs(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}var ky="firebase-heartbeat-database",My=1,or="firebase-heartbeat-store",_l=null;function fp(){return _l||(_l=rp(ky,My,{upgrade:(s,e)=>{switch(e){case 0:s.createObjectStore(or)}}}).catch(s=>{throw Js.create("idb-open",{originalErrorMessage:s.message})})),_l}async function Fy(s){try{return await(await fp()).transaction(or).objectStore(or).get(pp(s))}catch(e){if(e instanceof Us)Ti.warn(e.message);else{let i=Js.create("idb-get",{originalErrorMessage:e?.message});Ti.warn(i.message)}}}async function ap(s,e){try{let o=(await fp()).transaction(or,"readwrite");await o.objectStore(or).put(e,pp(s)),await o.done}catch(i){if(i instanceof Us)Ti.warn(i.message);else{let o=Js.create("idb-set",{originalErrorMessage:i?.message});Ti.warn(o.message)}}}function pp(s){return`${s.name}!${s.options.appId}`}var By=1024,Ly=30*24*60*60*1e3,xl=class{constructor(e){this.container=e,this._heartbeatsCache=null;let i=this.container.getProvider("app").getImmediate();this._storage=new bl(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=hp();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o)))return this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{let l=new Date(a.date).valueOf();return Date.now()-l<=Ly}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";let e=hp(),{heartbeatsToSend:i,unsentEntries:o}=Ny(this._heartbeatsCache.heartbeats),a=er(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}};function hp(){return new Date().toISOString().substring(0,10)}function Ny(s,e=By){let i=[],o=s.slice();for(let a of s){let l=i.find(d=>d.agent===a.agent);if(l){if(l.dates.push(a.date),lp(i)>e){l.dates.pop();break}}else if(i.push({agent:a.agent,dates:[a.date]}),lp(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}var bl=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return hl()?Zf().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Fy(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){let a=await this.read();return ap(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){let a=await this.read();return ap(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}};function lp(s){return er(JSON.stringify({version:2,heartbeats:s})).length}function Vy(s){rr(new zs("platform-logger",e=>new gl(e),"PRIVATE")),rr(new zs("heartbeat",e=>new xl(e),"PRIVATE")),ti(ml,op,s),ti(ml,op,"esm2017"),ti("fire-js","")}Vy("");var Oy="firebase",Uy="10.5.2";ti(Oy,Uy,"app");var zy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ls={},q,ql=ql||{},lt=zy||self;function Jo(s){var e=typeof s;return e=e!="object"?e:s?Array.isArray(s)?"array":e:"null",e=="array"||e=="object"&&typeof s.length=="number"}function wr(s){var e=typeof s;return e=="object"&&s!=null||e=="function"}function Gy(s){return Object.prototype.hasOwnProperty.call(s,Tl)&&s[Tl]||(s[Tl]=++Hy)}var Tl="closure_uid_"+(1e9*Math.random()>>>0),Hy=0;function Wy(s,e,i){return s.call.apply(s.bind,arguments)}function qy(s,e,i){if(!s)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var a=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(a,o),s.apply(e,a)}}return function(){return s.apply(e,arguments)}}function me(s,e,i){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?me=Wy:me=qy,me.apply(null,arguments)}function Oo(s,e){var i=Array.prototype.slice.call(arguments,1);return function(){var o=i.slice();return o.push.apply(o,arguments),s.apply(this,o)}}function oe(s,e){function i(){}i.prototype=e.prototype,s.$=e.prototype,s.prototype=new i,s.prototype.constructor=s,s.ac=function(o,a,l){for(var d=Array(arguments.length-2),g=2;g<arguments.length;g++)d[g-2]=arguments[g];return e.prototype[a].apply(o,d)}}function ei(){this.s=this.s,this.o=this.o}var jy=0;ei.prototype.s=!1;ei.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),jy!=0)&&Gy(this)};ei.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Ip=Array.prototype.indexOf?function(s,e){return Array.prototype.indexOf.call(s,e,void 0)}:function(s,e){if(typeof s=="string")return typeof e!="string"||e.length!=1?-1:s.indexOf(e,0);for(let i=0;i<s.length;i++)if(i in s&&s[i]===e)return i;return-1};function jl(s){let e=s.length;if(0<e){let i=Array(e);for(let o=0;o<e;o++)i[o]=s[o];return i}return[]}function _p(s,e){for(let i=1;i<arguments.length;i++){let o=arguments[i];if(Jo(o)){let a=s.length||0,l=o.length||0;s.length=a+l;for(let d=0;d<l;d++)s[a+d]=o[d]}else s.push(o)}}function ve(s,e){this.type=s,this.g=this.target=e,this.defaultPrevented=!1}ve.prototype.h=function(){this.defaultPrevented=!0};var $y=function(){if(!lt.addEventListener||!Object.defineProperty)return!1;var s=!1,e=Object.defineProperty({},"passive",{get:function(){s=!0}});try{lt.addEventListener("test",()=>{},e),lt.removeEventListener("test",()=>{},e)}catch{}return s}();function dr(s){return/^[\s\xa0]*$/.test(s)}function ta(){var s=lt.navigator;return s&&(s=s.userAgent)?s:""}function bs(s){return ta().indexOf(s)!=-1}function $l(s){return $l[" "](s),s}$l[" "]=function(){};function Ky(s,e){var i=Lw;return Object.prototype.hasOwnProperty.call(i,s)?i[s]:i[s]=e(s)}var Qy=bs("Opera"),cn=bs("Trident")||bs("MSIE"),Sp=bs("Edge"),Pl=Sp||cn,Pp=bs("Gecko")&&!(ta().toLowerCase().indexOf("webkit")!=-1&&!bs("Edge"))&&!(bs("Trident")||bs("MSIE"))&&!bs("Edge"),Xy=ta().toLowerCase().indexOf("webkit")!=-1&&!bs("Edge");function Rp(){var s=lt.document;return s?s.documentMode:void 0}var Rl;t:{if(Uo="",zo=function(){var s=ta();if(Pp)return/rv:([^\);]+)(\)|;)/.exec(s);if(Sp)return/Edge\/([\d\.]+)/.exec(s);if(cn)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(s);if(Xy)return/WebKit\/(\S+)/.exec(s);if(Qy)return/(?:Version)[ \/]?(\S+)/.exec(s)}(),zo&&(Uo=zo?zo[1]:""),cn&&(Go=Rp(),Go!=null&&Go>parseFloat(Uo))){Rl=String(Go);break t}Rl=Uo}var Uo,zo,Go,Dl;lt.document&&cn?(Al=Rp(),Dl=Al||parseInt(Rl,10)||void 0):Dl=void 0;var Al,Yy=Dl;function fr(s,e){if(ve.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var i=this.type=s.type,o=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=e,e=s.relatedTarget){if(Pp){t:{try{$l(e.nodeName);var a=!0;break t}catch{}a=!1}a||(e=null)}}else i=="mouseover"?e=s.fromElement:i=="mouseout"&&(e=s.toElement);this.relatedTarget=e,o?(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:Zy[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&fr.$.h.call(this)}}oe(fr,ve);var Zy={2:"touch",3:"pen",4:"mouse"};fr.prototype.h=function(){fr.$.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var xr="closure_listenable_"+(1e6*Math.random()|0),Jy=0;function tw(s,e,i,o,a){this.listener=s,this.proxy=null,this.src=e,this.type=i,this.capture=!!o,this.la=a,this.key=++Jy,this.fa=this.ia=!1}function ea(s){s.fa=!0,s.listener=null,s.proxy=null,s.src=null,s.la=null}function Kl(s,e,i){for(let o in s)e.call(i,s[o],o,s)}function ew(s,e){for(let i in s)e.call(void 0,s[i],i,s)}function Dp(s){let e={};for(let i in s)e[i]=s[i];return e}var gp="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function kp(s,e){let i,o;for(let a=1;a<arguments.length;a++){o=arguments[a];for(i in o)s[i]=o[i];for(let l=0;l<gp.length;l++)i=gp[l],Object.prototype.hasOwnProperty.call(o,i)&&(s[i]=o[i])}}function sa(s){this.src=s,this.g={},this.h=0}sa.prototype.add=function(s,e,i,o,a){var l=s.toString();s=this.g[l],s||(s=this.g[l]=[],this.h++);var d=Ml(s,e,o,a);return-1<d?(e=s[d],i||(e.ia=!1)):(e=new tw(e,this.src,l,!!o,a),e.ia=i,s.push(e)),e};function kl(s,e){var i=e.type;if(i in s.g){var o=s.g[i],a=Ip(o,e),l;(l=0<=a)&&Array.prototype.splice.call(o,a,1),l&&(ea(e),s.g[i].length==0&&(delete s.g[i],s.h--))}}function Ml(s,e,i,o){for(var a=0;a<s.length;++a){var l=s[a];if(!l.fa&&l.listener==e&&l.capture==!!i&&l.la==o)return a}return-1}var Ql="closure_lm_"+(1e6*Math.random()|0),Cl={};function Mp(s,e,i,o,a){if(o&&o.once)return Bp(s,e,i,o,a);if(Array.isArray(e)){for(var l=0;l<e.length;l++)Mp(s,e[l],i,o,a);return null}return i=Zl(i),s&&s[xr]?s.O(e,i,wr(o)?!!o.capture:!!o,a):Fp(s,e,i,!1,o,a)}function Fp(s,e,i,o,a,l){if(!e)throw Error("Invalid event type");var d=wr(a)?!!a.capture:!!a,g=Yl(s);if(g||(s[Ql]=g=new sa(s)),i=g.add(e,i,o,d,l),i.proxy)return i;if(o=sw(),i.proxy=o,o.src=s,o.listener=i,s.addEventListener)$y||(a=d),a===void 0&&(a=!1),s.addEventListener(e.toString(),o,a);else if(s.attachEvent)s.attachEvent(Np(e.toString()),o);else if(s.addListener&&s.removeListener)s.addListener(o);else throw Error("addEventListener and attachEvent are unavailable.");return i}function sw(){function s(i){return e.call(s.src,s.listener,i)}let e=iw;return s}function Bp(s,e,i,o,a){if(Array.isArray(e)){for(var l=0;l<e.length;l++)Bp(s,e[l],i,o,a);return null}return i=Zl(i),s&&s[xr]?s.P(e,i,wr(o)?!!o.capture:!!o,a):Fp(s,e,i,!0,o,a)}function Lp(s,e,i,o,a){if(Array.isArray(e))for(var l=0;l<e.length;l++)Lp(s,e[l],i,o,a);else o=wr(o)?!!o.capture:!!o,i=Zl(i),s&&s[xr]?(s=s.i,e=String(e).toString(),e in s.g&&(l=s.g[e],i=Ml(l,i,o,a),-1<i&&(ea(l[i]),Array.prototype.splice.call(l,i,1),l.length==0&&(delete s.g[e],s.h--)))):s&&(s=Yl(s))&&(e=s.g[e.toString()],s=-1,e&&(s=Ml(e,i,o,a)),(i=-1<s?e[s]:null)&&Xl(i))}function Xl(s){if(typeof s!="number"&&s&&!s.fa){var e=s.src;if(e&&e[xr])kl(e.i,s);else{var i=s.type,o=s.proxy;e.removeEventListener?e.removeEventListener(i,o,s.capture):e.detachEvent?e.detachEvent(Np(i),o):e.addListener&&e.removeListener&&e.removeListener(o),(i=Yl(e))?(kl(i,s),i.h==0&&(i.src=null,e[Ql]=null)):ea(s)}}}function Np(s){return s in Cl?Cl[s]:Cl[s]="on"+s}function iw(s,e){if(s.fa)s=!0;else{e=new fr(e,this);var i=s.listener,o=s.la||s.src;s.ia&&Xl(s),s=i.call(o,e)}return s}function Yl(s){return s=s[Ql],s instanceof sa?s:null}var Il="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zl(s){return typeof s=="function"?s:(s[Il]||(s[Il]=function(e){return s.handleEvent(e)}),s[Il])}function re(){ei.call(this),this.i=new sa(this),this.S=this,this.J=null}oe(re,ei);re.prototype[xr]=!0;re.prototype.removeEventListener=function(s,e,i,o){Lp(this,s,e,i,o)};function fe(s,e){var i,o=s.J;if(o)for(i=[];o;o=o.J)i.push(o);if(s=s.S,o=e.type||e,typeof e=="string")e=new ve(e,s);else if(e instanceof ve)e.target=e.target||s;else{var a=e;e=new ve(o,s),kp(e,a)}if(a=!0,i)for(var l=i.length-1;0<=l;l--){var d=e.g=i[l];a=Ho(d,o,!0,e)&&a}if(d=e.g=s,a=Ho(d,o,!0,e)&&a,a=Ho(d,o,!1,e)&&a,i)for(l=0;l<i.length;l++)d=e.g=i[l],a=Ho(d,o,!1,e)&&a}re.prototype.N=function(){if(re.$.N.call(this),this.i){var s=this.i,e;for(e in s.g){for(var i=s.g[e],o=0;o<i.length;o++)ea(i[o]);delete s.g[e],s.h--}}this.J=null};re.prototype.O=function(s,e,i,o){return this.i.add(String(s),e,!1,i,o)};re.prototype.P=function(s,e,i,o){return this.i.add(String(s),e,!0,i,o)};function Ho(s,e,i,o){if(e=s.i.g[String(e)],!e)return!0;e=e.concat();for(var a=!0,l=0;l<e.length;++l){var d=e[l];if(d&&!d.fa&&d.capture==i){var g=d.listener,m=d.la||d.src;d.ia&&kl(s.i,d),a=g.call(m,o)!==!1&&a}}return a&&!o.defaultPrevented}var Jl=lt.JSON.stringify,Fl=class{constructor(e,i){this.i=e,this.j=i,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function nw(){var s=tc;let e=null;return s.g&&(e=s.g,s.g=s.g.next,s.g||(s.h=null),e.next=null),e}var Bl=class{constructor(){this.h=this.g=null}add(e,i){let o=Vp.get();o.set(e,i),this.h?this.h.next=o:this.g=o,this.h=o}},Vp=new Fl(()=>new Ll,s=>s.reset()),Ll=class{constructor(){this.next=this.g=this.h=null}set(e,i){this.h=e,this.g=i,this.next=null}reset(){this.next=this.g=this.h=null}};function rw(s){var e=1;s=s.split(":");let i=[];for(;0<e&&s.length;)i.push(s.shift()),e--;return s.length&&i.push(s.join(":")),i}function ow(s){lt.setTimeout(()=>{throw s},0)}var pr,_r=!1,tc=new Bl,Op=()=>{let s=lt.Promise.resolve(void 0);pr=()=>{s.then(aw)}},aw=()=>{for(var s;s=nw();){try{s.h.call(s.g)}catch(i){ow(i)}var e=Vp;e.j(s),100>e.h&&(e.h++,s.next=e.g,e.g=s)}_r=!1};function ia(s,e){re.call(this),this.h=s||1,this.g=e||lt,this.j=me(this.qb,this),this.l=Date.now()}oe(ia,re);q=ia.prototype;q.ga=!1;q.T=null;q.qb=function(){if(this.ga){var s=Date.now()-this.l;0<s&&s<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-s):(this.T&&(this.g.clearTimeout(this.T),this.T=null),fe(this,"tick"),this.ga&&(ec(this),this.start()))}};q.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ec(s){s.ga=!1,s.T&&(s.g.clearTimeout(s.T),s.T=null)}q.N=function(){ia.$.N.call(this),ec(this),delete this.g};function sc(s,e,i){if(typeof s=="function")i&&(s=me(s,i));else if(s&&typeof s.handleEvent=="function")s=me(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:lt.setTimeout(s,e||0)}function Up(s){s.g=sc(()=>{s.g=null,s.i&&(s.i=!1,Up(s))},s.j);let e=s.h;s.h=null,s.m.apply(null,e)}var Nl=class extends ei{constructor(e,i){super(),this.m=e,this.j=i,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Up(this)}N(){super.N(),this.g&&(lt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function gr(s){ei.call(this),this.h=s,this.g={}}oe(gr,ei);var mp=[];function zp(s,e,i,o){Array.isArray(i)||(i&&(mp[0]=i.toString()),i=mp);for(var a=0;a<i.length;a++){var l=Mp(e,i[a],o||s.handleEvent,!1,s.h||s);if(!l)break;s.g[l.key]=l}}function Gp(s){Kl(s.g,function(e,i){this.g.hasOwnProperty(i)&&Xl(e)},s),s.g={}}gr.prototype.N=function(){gr.$.N.call(this),Gp(this)};gr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function na(){this.g=!0}na.prototype.Ea=function(){this.g=!1};function hw(s,e,i,o,a,l){s.info(function(){if(s.g)if(l)for(var d="",g=l.split("&"),m=0;m<g.length;m++){var y=g[m].split("=");if(1<y.length){var x=y[0];y=y[1];var A=x.split("_");d=2<=A.length&&A[1]=="type"?d+(x+"="+y+"&"):d+(x+"=redacted&")}}else d=null;else d=l;return"XMLHTTP REQ ("+o+") [attempt "+a+"]: "+e+`
`+i+`
`+d})}function lw(s,e,i,o,a,l,d){s.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+a+"]: "+e+`
`+i+`
`+l+" "+d})}function hn(s,e,i,o){s.info(function(){return"XMLHTTP TEXT ("+e+"): "+uw(s,i)+(o?" "+o:"")})}function cw(s,e){s.info(function(){return"TIMEOUT: "+e})}na.prototype.info=function(){};function uw(s,e){if(!s.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i){for(s=0;s<i.length;s++)if(Array.isArray(i[s])){var o=i[s];if(!(2>o.length)){var a=o[1];if(Array.isArray(a)&&!(1>a.length)){var l=a[0];if(l!="noop"&&l!="stop"&&l!="close")for(var d=1;d<a.length;d++)a[d]=""}}}}return Jl(i)}catch{return e}}var Si={},vp=null;function ra(){return vp=vp||new re}Si.Ta="serverreachability";function Hp(s){ve.call(this,Si.Ta,s)}oe(Hp,ve);function mr(s){let e=ra();fe(e,new Hp(e))}Si.STAT_EVENT="statevent";function Wp(s,e){ve.call(this,Si.STAT_EVENT,s),this.stat=e}oe(Wp,ve);function Ie(s){let e=ra();fe(e,new Wp(e,s))}Si.Ua="timingevent";function qp(s,e){ve.call(this,Si.Ua,s),this.size=e}oe(qp,ve);function br(s,e){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return lt.setTimeout(function(){s()},e)}var oa={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},jp={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ic(){}ic.prototype.h=null;function yp(s){return s.h||(s.h=s.i())}function $p(){}var Er={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function nc(){ve.call(this,"d")}oe(nc,ve);function rc(){ve.call(this,"c")}oe(rc,ve);var Vl;function aa(){}oe(aa,ic);aa.prototype.g=function(){return new XMLHttpRequest};aa.prototype.i=function(){return{}};Vl=new aa;function Tr(s,e,i,o){this.l=s,this.j=e,this.m=i,this.W=o||1,this.U=new gr(this),this.P=dw,s=Pl?125:void 0,this.V=new ia(s),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Kp}function Kp(){this.i=null,this.g="",this.h=!1}var dw=45e3,Ol={},jo={};q=Tr.prototype;q.setTimeout=function(s){this.P=s};function Ul(s,e,i){s.L=1,s.v=la(Hs(e)),s.s=i,s.S=!0,Qp(s,null)}function Qp(s,e){s.G=Date.now(),Ar(s),s.A=Hs(s.v);var i=s.A,o=s.W;Array.isArray(o)||(o=[String(o)]),i_(i.i,"t",o),s.C=0,i=s.l.J,s.h=new Kp,s.g=T_(s.l,i?e:null,!s.s),0<s.O&&(s.M=new Nl(me(s.Pa,s,s.g),s.O)),zp(s.U,s.g,"readystatechange",s.nb),e=s.I?Dp(s.I):{},s.s?(s.u||(s.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",s.g.ha(s.A,s.u,s.s,e)):(s.u="GET",s.g.ha(s.A,s.u,null,e)),mr(),hw(s.j,s.u,s.A,s.m,s.W,s.s)}q.nb=function(s){s=s.target;let e=this.M;e&&Es(s)==3?e.l():this.Pa(s)};q.Pa=function(s){try{if(s==this.g)t:{let x=Es(this.g);var e=this.g.Ia();let A=this.g.da();if(!(3>x)&&(x!=3||Pl||this.g&&(this.h.h||this.g.ja()||Ep(this.g)))){this.J||x!=4||e==7||(e==8||0>=A?mr(3):mr(2)),ha(this);var i=this.g.da();this.ca=i;e:if(Xp(this)){var o=Ep(this.g);s="";var a=o.length,l=Es(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ai(this),ur(this);var d="";break e}this.h.i=new lt.TextDecoder}for(e=0;e<a;e++)this.h.h=!0,s+=this.h.i.decode(o[e],{stream:l&&e==a-1});o.splice(0,a),this.h.g+=s,this.C=0,d=this.h.g}else d=this.g.ja();if(this.i=i==200,lw(this.j,this.u,this.A,this.m,this.W,x,i),this.i){if(this.aa&&!this.K){e:{if(this.g){var g,m=this.g;if((g=m.g?m.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!dr(g)){var y=g;break e}}y=null}if(i=y)hn(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zl(this,i);else{this.i=!1,this.o=3,Ie(12),Ai(this),ur(this);break t}}this.S?(Yp(this,x,d),Pl&&this.i&&x==3&&(zp(this.U,this.V,"tick",this.mb),this.V.start())):(hn(this.j,this.m,d,null),zl(this,d)),x==4&&Ai(this),this.i&&!this.J&&(x==4?w_(this.l,this):(this.i=!1,Ar(this)))}else Mw(this.g),i==400&&0<d.indexOf("Unknown SID")?(this.o=3,Ie(12)):(this.o=0,Ie(13)),Ai(this),ur(this)}}}catch{}finally{}};function Xp(s){return s.g?s.u=="GET"&&s.L!=2&&s.l.Ha:!1}function Yp(s,e,i){let o=!0,a;for(;!s.J&&s.C<i.length;)if(a=fw(s,i),a==jo){e==4&&(s.o=4,Ie(14),o=!1),hn(s.j,s.m,null,"[Incomplete Response]");break}else if(a==Ol){s.o=4,Ie(15),hn(s.j,s.m,i,"[Invalid Chunk]"),o=!1;break}else hn(s.j,s.m,a,null),zl(s,a);Xp(s)&&a!=jo&&a!=Ol&&(s.h.g="",s.C=0),e!=4||i.length!=0||s.h.h||(s.o=1,Ie(16),o=!1),s.i=s.i&&o,o?0<i.length&&!s.ba&&(s.ba=!0,e=s.l,e.g==s&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+i.length),uc(e),e.M=!0,Ie(11))):(hn(s.j,s.m,i,"[Invalid Chunked Response]"),Ai(s),ur(s))}q.mb=function(){if(this.g){var s=Es(this.g),e=this.g.ja();this.C<e.length&&(ha(this),Yp(this,s,e),this.i&&s!=4&&Ar(this))}};function fw(s,e){var i=s.C,o=e.indexOf(`
`,i);return o==-1?jo:(i=Number(e.substring(i,o)),isNaN(i)?Ol:(o+=1,o+i>e.length?jo:(e=e.slice(o,o+i),s.C=o+i,e)))}q.cancel=function(){this.J=!0,Ai(this)};function Ar(s){s.Y=Date.now()+s.P,Zp(s,s.P)}function Zp(s,e){if(s.B!=null)throw Error("WatchDog timer not null");s.B=br(me(s.lb,s),e)}function ha(s){s.B&&(lt.clearTimeout(s.B),s.B=null)}q.lb=function(){this.B=null;let s=Date.now();0<=s-this.Y?(cw(this.j,this.A),this.L!=2&&(mr(),Ie(17)),Ai(this),this.o=2,ur(this)):Zp(this,this.Y-s)};function ur(s){s.l.H==0||s.J||w_(s.l,s)}function Ai(s){ha(s);var e=s.M;e&&typeof e.sa=="function"&&e.sa(),s.M=null,ec(s.V),Gp(s.U),s.g&&(e=s.g,s.g=null,e.abort(),e.sa())}function zl(s,e){try{var i=s.l;if(i.H!=0&&(i.g==s||Gl(i.i,s))){if(!s.K&&Gl(i.i,s)&&i.H==3){try{var o=i.Ja.g.parse(e)}catch{o=null}if(Array.isArray(o)&&o.length==3){var a=o;if(a[0]==0){t:if(!i.u){if(i.g)if(i.g.G+3e3<s.G)Qo(i),da(i);else break t;cc(i),Ie(18)}}else i.Fa=a[1],0<i.Fa-i.V&&37500>a[2]&&i.G&&i.A==0&&!i.v&&(i.v=br(me(i.ib,i),6e3));if(1>=o_(i.i)&&i.oa){try{i.oa()}catch{}i.oa=void 0}}else Ci(i,11)}else if((s.K||i.g==s)&&Qo(i),!dr(e))for(a=i.Ja.g.parse(e),e=0;e<a.length;e++){let y=a[e];if(i.V=y[0],y=y[1],i.H==2)if(y[0]=="c"){i.K=y[1],i.pa=y[2];let x=y[3];x!=null&&(i.ra=x,i.l.info("VER="+i.ra));let A=y[4];A!=null&&(i.Ga=A,i.l.info("SVER="+i.Ga));let T=y[5];T!=null&&typeof T=="number"&&0<T&&(o=1.5*T,i.L=o,i.l.info("backChannelRequestTimeoutMs_="+o)),o=i;let P=s.g;if(P){let B=P.g?P.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(B){var l=o.i;l.g||B.indexOf("spdy")==-1&&B.indexOf("quic")==-1&&B.indexOf("h2")==-1||(l.j=l.l,l.g=new Set,l.h&&(oc(l,l.h),l.h=null))}if(o.F){let H=P.g?P.g.getResponseHeader("X-HTTP-Session-Id"):null;H&&(o.Da=H,kt(o.I,o.F,H))}}i.H=3,i.h&&i.h.Ba(),i.ca&&(i.S=Date.now()-s.G,i.l.info("Handshake RTT: "+i.S+"ms")),o=i;var d=s;if(o.wa=E_(o,o.J?o.pa:null,o.Y),d.K){a_(o.i,d);var g=d,m=o.L;m&&g.setTimeout(m),g.B&&(ha(g),Ar(g)),o.g=d}else v_(o);0<i.j.length&&fa(i)}else y[0]!="stop"&&y[0]!="close"||Ci(i,7);else i.H==3&&(y[0]=="stop"||y[0]=="close"?y[0]=="stop"?Ci(i,7):lc(i):y[0]!="noop"&&i.h&&i.h.Aa(y),i.A=0)}}mr(4)}catch{}}function pw(s){if(s.Z&&typeof s.Z=="function")return s.Z();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(Jo(s)){for(var e=[],i=s.length,o=0;o<i;o++)e.push(s[o]);return e}e=[],i=0;for(o in s)e[i++]=s[o];return e}function _w(s){if(s.ta&&typeof s.ta=="function")return s.ta();if(!s.Z||typeof s.Z!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(Jo(s)||typeof s=="string"){var e=[];s=s.length;for(var i=0;i<s;i++)e.push(i);return e}e=[],i=0;for(let o in s)e[i++]=o;return e}}}function Jp(s,e){if(s.forEach&&typeof s.forEach=="function")s.forEach(e,void 0);else if(Jo(s)||typeof s=="string")Array.prototype.forEach.call(s,e,void 0);else for(var i=_w(s),o=pw(s),a=o.length,l=0;l<a;l++)e.call(void 0,o[l],i&&i[l],s)}var t_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gw(s,e){if(s){s=s.split("&");for(var i=0;i<s.length;i++){var o=s[i].indexOf("="),a=null;if(0<=o){var l=s[i].substring(0,o);a=s[i].substring(o+1)}else l=s[i];e(l,a?decodeURIComponent(a.replace(/\+/g," ")):"")}}}function Ii(s){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,s instanceof Ii){this.h=s.h,$o(this,s.j),this.s=s.s,this.g=s.g,Ko(this,s.m),this.l=s.l;var e=s.i,i=new vr;i.i=e.i,e.g&&(i.g=new Map(e.g),i.h=e.h),wp(this,i),this.o=s.o}else s&&(e=String(s).match(t_))?(this.h=!1,$o(this,e[1]||"",!0),this.s=lr(e[2]||""),this.g=lr(e[3]||"",!0),Ko(this,e[4]),this.l=lr(e[5]||"",!0),wp(this,e[6]||"",!0),this.o=lr(e[7]||"")):(this.h=!1,this.i=new vr(null,this.h))}Ii.prototype.toString=function(){var s=[],e=this.j;e&&s.push(cr(e,xp,!0),":");var i=this.g;return(i||e=="file")&&(s.push("//"),(e=this.s)&&s.push(cr(e,xp,!0),"@"),s.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i=this.m,i!=null&&s.push(":",String(i))),(i=this.l)&&(this.g&&i.charAt(0)!="/"&&s.push("/"),s.push(cr(i,i.charAt(0)=="/"?yw:vw,!0))),(i=this.i.toString())&&s.push("?",i),(i=this.o)&&s.push("#",cr(i,xw)),s.join("")};function Hs(s){return new Ii(s)}function $o(s,e,i){s.j=i?lr(e,!0):e,s.j&&(s.j=s.j.replace(/:$/,""))}function Ko(s,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);s.m=e}else s.m=null}function wp(s,e,i){e instanceof vr?(s.i=e,bw(s.i,s.h)):(i||(e=cr(e,ww)),s.i=new vr(e,s.h))}function kt(s,e,i){s.i.set(e,i)}function la(s){return kt(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function lr(s,e){return s?e?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function cr(s,e,i){return typeof s=="string"?(s=encodeURI(s).replace(e,mw),i&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function mw(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var xp=/[#\/\?@]/g,vw=/[#\?:]/g,yw=/[#\?]/g,ww=/[#\?@]/g,xw=/#/g;function vr(s,e){this.h=this.g=null,this.i=s||null,this.j=!!e}function si(s){s.g||(s.g=new Map,s.h=0,s.i&&gw(s.i,function(e,i){s.add(decodeURIComponent(e.replace(/\+/g," ")),i)}))}q=vr.prototype;q.add=function(s,e){si(this),this.i=null,s=un(this,s);var i=this.g.get(s);return i||this.g.set(s,i=[]),i.push(e),this.h+=1,this};function e_(s,e){si(s),e=un(s,e),s.g.has(e)&&(s.i=null,s.h-=s.g.get(e).length,s.g.delete(e))}function s_(s,e){return si(s),e=un(s,e),s.g.has(e)}q.forEach=function(s,e){si(this),this.g.forEach(function(i,o){i.forEach(function(a){s.call(e,a,o,this)},this)},this)};q.ta=function(){si(this);let s=Array.from(this.g.values()),e=Array.from(this.g.keys()),i=[];for(let o=0;o<e.length;o++){let a=s[o];for(let l=0;l<a.length;l++)i.push(e[o])}return i};q.Z=function(s){si(this);let e=[];if(typeof s=="string")s_(this,s)&&(e=e.concat(this.g.get(un(this,s))));else{s=Array.from(this.g.values());for(let i=0;i<s.length;i++)e=e.concat(s[i])}return e};q.set=function(s,e){return si(this),this.i=null,s=un(this,s),s_(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[e]),this.h+=1,this};q.get=function(s,e){return s?(s=this.Z(s),0<s.length?String(s[0]):e):e};function i_(s,e,i){e_(s,e),0<i.length&&(s.i=null,s.g.set(un(s,e),jl(i)),s.h+=i.length)}q.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],e=Array.from(this.g.keys());for(var i=0;i<e.length;i++){var o=e[i];let l=encodeURIComponent(String(o)),d=this.Z(o);for(o=0;o<d.length;o++){var a=l;d[o]!==""&&(a+="="+encodeURIComponent(String(d[o]))),s.push(a)}}return this.i=s.join("&")};function un(s,e){return e=String(e),s.j&&(e=e.toLowerCase()),e}function bw(s,e){e&&!s.j&&(si(s),s.i=null,s.g.forEach(function(i,o){var a=o.toLowerCase();o!=a&&(e_(this,o),i_(this,a,i))},s)),s.j=e}var Ew=class{constructor(s,e){this.g=s,this.map=e}};function n_(s){this.l=s||Tw,lt.PerformanceNavigationTiming?(s=lt.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(lt.g&&lt.g.Ka&&lt.g.Ka()&&lt.g.Ka().dc),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Tw=10;function r_(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function o_(s){return s.h?1:s.g?s.g.size:0}function Gl(s,e){return s.h?s.h==e:s.g?s.g.has(e):!1}function oc(s,e){s.g?s.g.add(e):s.h=e}function a_(s,e){s.h&&s.h==e?s.h=null:s.g&&s.g.has(e)&&s.g.delete(e)}n_.prototype.cancel=function(){if(this.i=h_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function h_(s){if(s.h!=null)return s.i.concat(s.h.F);if(s.g!=null&&s.g.size!==0){let e=s.i;for(let i of s.g.values())e=e.concat(i.F);return e}return jl(s.i)}var Aw=class{stringify(s){return lt.JSON.stringify(s,void 0)}parse(s){return lt.JSON.parse(s,void 0)}};function Cw(){this.g=new Aw}function Iw(s,e,i){let o=i||"";try{Jp(s,function(a,l){let d=a;wr(a)&&(d=Jl(a)),e.push(o+l+"="+encodeURIComponent(d))})}catch(a){throw e.push(o+"type="+encodeURIComponent("_badmap")),a}}function Sw(s,e){let i=new na;if(lt.Image){let o=new Image;o.onload=Oo(Wo,i,o,"TestLoadImage: loaded",!0,e),o.onerror=Oo(Wo,i,o,"TestLoadImage: error",!1,e),o.onabort=Oo(Wo,i,o,"TestLoadImage: abort",!1,e),o.ontimeout=Oo(Wo,i,o,"TestLoadImage: timeout",!1,e),lt.setTimeout(function(){o.ontimeout&&o.ontimeout()},1e4),o.src=s}else e(!1)}function Wo(s,e,i,o,a){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,a(o)}catch{}}function Cr(s){this.l=s.ec||null,this.j=s.ob||!1}oe(Cr,ic);Cr.prototype.g=function(){return new ca(this.l,this.j)};Cr.prototype.i=function(s){return function(){return s}}({});function ca(s,e){re.call(this),this.F=s,this.u=e,this.m=void 0,this.readyState=ac,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}oe(ca,re);var ac=0;q=ca.prototype;q.open=function(s,e){if(this.readyState!=ac)throw this.abort(),Error("Error reopening a connection");this.C=s,this.B=e,this.readyState=1,yr(this)};q.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};s&&(e.body=s),(this.F||lt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};q.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ir(this)),this.readyState=ac};q.$a=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,yr(this)),this.g&&(this.readyState=3,yr(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof lt.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;l_(this)}else s.text().then(this.Za.bind(this),this.ka.bind(this))};function l_(s){s.j.read().then(s.Xa.bind(s)).catch(s.ka.bind(s))}q.Xa=function(s){if(this.g){if(this.u&&s.value)this.response.push(s.value);else if(!this.u){var e=s.value?s.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!s.done}))&&(this.response=this.responseText+=e)}s.done?Ir(this):yr(this),this.readyState==3&&l_(this)}};q.Za=function(s){this.g&&(this.response=this.responseText=s,Ir(this))};q.Ya=function(s){this.g&&(this.response=s,Ir(this))};q.ka=function(){this.g&&Ir(this)};function Ir(s){s.readyState=4,s.l=null,s.j=null,s.A=null,yr(s)}q.setRequestHeader=function(s,e){this.v.append(s,e)};q.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""};q.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,s.push(i[0]+": "+i[1]),i=e.next();return s.join(`\r
`)};function yr(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(ca.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});var Pw=lt.JSON.parse;function Ut(s){re.call(this),this.headers=new Map,this.u=s||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=c_,this.L=this.M=!1}oe(Ut,re);var c_="",Rw=/^https?$/i,Dw=["POST","PUT"];q=Ut.prototype;q.Oa=function(s){this.M=s};q.ha=function(s,e,i,o){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+s);e=e?e.toUpperCase():"GET",this.I=s,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Vl.g(),this.C=this.u?yp(this.u):yp(Vl),this.g.onreadystatechange=me(this.La,this);try{this.G=!0,this.g.open(e,String(s),!0),this.G=!1}catch(l){bp(this,l);return}if(s=i||"",i=new Map(this.headers),o)if(Object.getPrototypeOf(o)===Object.prototype)for(var a in o)i.set(a,o[a]);else if(typeof o.keys=="function"&&typeof o.get=="function")for(let l of o.keys())i.set(l,o.get(l));else throw Error("Unknown input type for opt_headers: "+String(o));o=Array.from(i.keys()).find(l=>l.toLowerCase()=="content-type"),a=lt.FormData&&s instanceof lt.FormData,!(0<=Ip(Dw,e))||o||a||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[l,d]of i)this.g.setRequestHeader(l,d);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{f_(this),0<this.B&&((this.L=kw(this.g))?(this.g.timeout=this.B,this.g.ontimeout=me(this.ua,this)):this.A=sc(this.ua,this.B,this)),this.v=!0,this.g.send(s),this.v=!1}catch(l){bp(this,l)}};function kw(s){return cn&&typeof s.timeout=="number"&&s.ontimeout!==void 0}q.ua=function(){typeof ql<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,fe(this,"timeout"),this.abort(8))};function bp(s,e){s.h=!1,s.g&&(s.l=!0,s.g.abort(),s.l=!1),s.j=e,s.m=5,u_(s),ua(s)}function u_(s){s.F||(s.F=!0,fe(s,"complete"),fe(s,"error"))}q.abort=function(s){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=s||7,fe(this,"complete"),fe(this,"abort"),ua(this))};q.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ua(this,!0)),Ut.$.N.call(this)};q.La=function(){this.s||(this.G||this.v||this.l?d_(this):this.kb())};q.kb=function(){d_(this)};function d_(s){if(s.h&&typeof ql<"u"&&(!s.C[1]||Es(s)!=4||s.da()!=2)){if(s.v&&Es(s)==4)sc(s.La,0,s);else if(fe(s,"readystatechange"),Es(s)==4){s.h=!1;try{let d=s.da();t:switch(d){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var i;if(!(i=e)){var o;if(o=d===0){var a=String(s.I).match(t_)[1]||null;!a&&lt.self&&lt.self.location&&(a=lt.self.location.protocol.slice(0,-1)),o=!Rw.test(a?a.toLowerCase():"")}i=o}if(i)fe(s,"complete"),fe(s,"success");else{s.m=6;try{var l=2<Es(s)?s.g.statusText:""}catch{l=""}s.j=l+" ["+s.da()+"]",u_(s)}}finally{ua(s)}}}}function ua(s,e){if(s.g){f_(s);let i=s.g,o=s.C[0]?()=>{}:null;s.g=null,s.C=null,e||fe(s,"ready");try{i.onreadystatechange=o}catch{}}}function f_(s){s.g&&s.L&&(s.g.ontimeout=null),s.A&&(lt.clearTimeout(s.A),s.A=null)}q.isActive=function(){return!!this.g};function Es(s){return s.g?s.g.readyState:0}q.da=function(){try{return 2<Es(this)?this.g.status:-1}catch{return-1}};q.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};q.Wa=function(s){if(this.g){var e=this.g.responseText;return s&&e.indexOf(s)==0&&(e=e.substring(s.length)),Pw(e)}};function Ep(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.K){case c_:case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Mw(s){let e={};s=(s.g&&2<=Es(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let o=0;o<s.length;o++){if(dr(s[o]))continue;var i=rw(s[o]);let a=i[0];if(i=i[1],typeof i!="string")continue;i=i.trim();let l=e[a]||[];e[a]=l,l.push(i)}ew(e,function(o){return o.join(", ")})}q.Ia=function(){return this.m};q.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function p_(s){let e="";return Kl(s,function(i,o){e+=o,e+=":",e+=i,e+=`\r
`}),e}function hc(s,e,i){t:{for(o in i){var o=!1;break t}o=!0}o||(i=p_(i),typeof s=="string"?i!=null&&encodeURIComponent(String(i)):kt(s,e,i))}function ar(s,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[s]||e}function __(s){this.Ga=0,this.j=[],this.l=new na,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ar("failFast",!1,s),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ar("baseRetryDelayMs",5e3,s),this.hb=ar("retryDelaySeedMs",1e4,s),this.eb=ar("forwardChannelMaxRetries",2,s),this.xa=ar("forwardChannelRequestTimeoutMs",2e4,s),this.va=s&&s.xmlHttpFactory||void 0,this.Ha=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.i=new n_(s&&s.concurrentRequestLimit),this.Ja=new Cw,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=s&&s.bc||!1,s&&s.Ea&&this.l.Ea(),s&&s.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&s&&s.detectBufferingProxy||!1,this.qa=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.qa=s.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}q=__.prototype;q.ra=8;q.H=1;function lc(s){if(g_(s),s.H==3){var e=s.W++,i=Hs(s.I);if(kt(i,"SID",s.K),kt(i,"RID",e),kt(i,"TYPE","terminate"),Sr(s,i),e=new Tr(s,s.l,e),e.L=2,e.v=la(Hs(i)),i=!1,lt.navigator&&lt.navigator.sendBeacon)try{i=lt.navigator.sendBeacon(e.v.toString(),"")}catch{}!i&&lt.Image&&(new Image().src=e.v,i=!0),i||(e.g=T_(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Ar(e)}b_(s)}function da(s){s.g&&(uc(s),s.g.cancel(),s.g=null)}function g_(s){da(s),s.u&&(lt.clearTimeout(s.u),s.u=null),Qo(s),s.i.cancel(),s.m&&(typeof s.m=="number"&&lt.clearTimeout(s.m),s.m=null)}function fa(s){if(!r_(s.i)&&!s.m){s.m=!0;var e=s.Na;pr||Op(),_r||(pr(),_r=!0),tc.add(e,s),s.C=0}}function Fw(s,e){return o_(s.i)>=s.i.j-(s.m?1:0)?!1:s.m?(s.j=e.F.concat(s.j),!0):s.H==1||s.H==2||s.C>=(s.cb?0:s.eb)?!1:(s.m=br(me(s.Na,s,e),x_(s,s.C)),s.C++,!0)}q.Na=function(s){if(this.m)if(this.m=null,this.H==1){if(!s){this.W=Math.floor(1e5*Math.random()),s=this.W++;let a=new Tr(this,this.l,s),l=this.s;if(this.U&&(l?(l=Dp(l),kp(l,this.U)):l=this.U),this.o!==null||this.O||(a.I=l,l=null),this.P)t:{for(var e=0,i=0;i<this.j.length;i++){e:{var o=this.j[i];if("__data__"in o.map&&(o=o.map.__data__,typeof o=="string")){o=o.length;break e}o=void 0}if(o===void 0)break;if(e+=o,4096<e){e=i;break t}if(e===4096||i===this.j.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=m_(this,a,e),i=Hs(this.I),kt(i,"RID",s),kt(i,"CVER",22),this.F&&kt(i,"X-HTTP-Session-Id",this.F),Sr(this,i),l&&(this.O?e="headers="+encodeURIComponent(String(p_(l)))+"&"+e:this.o&&hc(i,this.o,l)),oc(this.i,a),this.bb&&kt(i,"TYPE","init"),this.P?(kt(i,"$req",e),kt(i,"SID","null"),a.aa=!0,Ul(a,i,null)):Ul(a,i,e),this.H=2}}else this.H==3&&(s?Tp(this,s):this.j.length==0||r_(this.i)||Tp(this))};function Tp(s,e){var i;e?i=e.m:i=s.W++;let o=Hs(s.I);kt(o,"SID",s.K),kt(o,"RID",i),kt(o,"AID",s.V),Sr(s,o),s.o&&s.s&&hc(o,s.o,s.s),i=new Tr(s,s.l,i,s.C+1),s.o===null&&(i.I=s.s),e&&(s.j=e.F.concat(s.j)),e=m_(s,i,1e3),i.setTimeout(Math.round(.5*s.xa)+Math.round(.5*s.xa*Math.random())),oc(s.i,i),Ul(i,o,e)}function Sr(s,e){s.na&&Kl(s.na,function(i,o){kt(e,o,i)}),s.h&&Jp({},function(i,o){kt(e,o,i)})}function m_(s,e,i){i=Math.min(s.j.length,i);var o=s.h?me(s.h.Va,s.h,s):null;t:{var a=s.j;let l=-1;for(;;){let d=["count="+i];l==-1?0<i?(l=a[0].g,d.push("ofs="+l)):l=0:d.push("ofs="+l);let g=!0;for(let m=0;m<i;m++){let y=a[m].g,x=a[m].map;if(y-=l,0>y)l=Math.max(0,a[m].g-100),g=!1;else try{Iw(x,d,"req"+y+"_")}catch{o&&o(x)}}if(g){o=d.join("&");break t}}}return s=s.j.splice(0,i),e.F=s,o}function v_(s){if(!s.g&&!s.u){s.ba=1;var e=s.Ma;pr||Op(),_r||(pr(),_r=!0),tc.add(e,s),s.A=0}}function cc(s){return s.g||s.u||3<=s.A?!1:(s.ba++,s.u=br(me(s.Ma,s),x_(s,s.A)),s.A++,!0)}q.Ma=function(){if(this.u=null,y_(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var s=2*this.S;this.l.info("BP detection timer enabled: "+s),this.B=br(me(this.jb,this),s)}};q.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ie(10),da(this),y_(this))};function uc(s){s.B!=null&&(lt.clearTimeout(s.B),s.B=null)}function y_(s){s.g=new Tr(s,s.l,"rpc",s.ba),s.o===null&&(s.g.I=s.s),s.g.O=0;var e=Hs(s.wa);kt(e,"RID","rpc"),kt(e,"SID",s.K),kt(e,"AID",s.V),kt(e,"CI",s.G?"0":"1"),!s.G&&s.qa&&kt(e,"TO",s.qa),kt(e,"TYPE","xmlhttp"),Sr(s,e),s.o&&s.s&&hc(e,s.o,s.s),s.L&&s.g.setTimeout(s.L);var i=s.g;s=s.pa,i.L=1,i.v=la(Hs(e)),i.s=null,i.S=!0,Qp(i,s)}q.ib=function(){this.v!=null&&(this.v=null,da(this),cc(this),Ie(19))};function Qo(s){s.v!=null&&(lt.clearTimeout(s.v),s.v=null)}function w_(s,e){var i=null;if(s.g==e){Qo(s),uc(s),s.g=null;var o=2}else if(Gl(s.i,e))i=e.F,a_(s.i,e),o=1;else return;if(s.H!=0){if(e.i)if(o==1){i=e.s?e.s.length:0,e=Date.now()-e.G;var a=s.C;o=ra(),fe(o,new qp(o,i)),fa(s)}else v_(s);else if(a=e.o,a==3||a==0&&0<e.ca||!(o==1&&Fw(s,e)||o==2&&cc(s)))switch(i&&0<i.length&&(e=s.i,e.i=e.i.concat(i)),a){case 1:Ci(s,5);break;case 4:Ci(s,10);break;case 3:Ci(s,6);break;default:Ci(s,2)}}}function x_(s,e){let i=s.ab+Math.floor(Math.random()*s.hb);return s.isActive()||(i*=2),i*e}function Ci(s,e){if(s.l.info("Error code "+e),e==2){var i=null;s.h&&(i=null);var o=me(s.pb,s);i||(i=new Ii("//www.google.com/images/cleardot.gif"),lt.location&&lt.location.protocol=="http"||$o(i,"https"),la(i)),Sw(i.toString(),o)}else Ie(2);s.H=0,s.h&&s.h.za(e),b_(s),g_(s)}q.pb=function(s){s?(this.l.info("Successfully pinged google.com"),Ie(2)):(this.l.info("Failed to ping google.com"),Ie(1))};function b_(s){if(s.H=0,s.ma=[],s.h){let e=h_(s.i);(e.length!=0||s.j.length!=0)&&(_p(s.ma,e),_p(s.ma,s.j),s.i.i.length=0,jl(s.j),s.j.length=0),s.h.ya()}}function E_(s,e,i){var o=i instanceof Ii?Hs(i):new Ii(i);if(o.g!="")e&&(o.g=e+"."+o.g),Ko(o,o.m);else{var a=lt.location;o=a.protocol,e=e?e+"."+a.hostname:a.hostname,a=+a.port;var l=new Ii(null);o&&$o(l,o),e&&(l.g=e),a&&Ko(l,a),i&&(l.l=i),o=l}return i=s.F,e=s.Da,i&&e&&kt(o,i,e),kt(o,"VER",s.ra),Sr(s,o),o}function T_(s,e,i){if(e&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=i&&s.Ha&&!s.va?new Ut(new Cr({ob:!0})):new Ut(s.va),e.Oa(s.J),e}q.isActive=function(){return!!this.h&&this.h.isActive(this)};function A_(){}q=A_.prototype;q.Ba=function(){};q.Aa=function(){};q.za=function(){};q.ya=function(){};q.isActive=function(){return!0};q.Va=function(){};function Xo(){if(cn&&!(10<=Number(Yy)))throw Error("Environmental error: no available transport.")}Xo.prototype.g=function(s,e){return new $e(s,e)};function $e(s,e){re.call(this),this.g=new __(e),this.l=s,this.h=e&&e.messageUrlParams||null,s=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.s=s,s=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(s?s["X-WebChannel-Content-Type"]=e.messageContentType:s={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(s?s["X-WebChannel-Client-Profile"]=e.Ca:s={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=s,(s=e&&e.cc)&&!dr(s)&&(this.g.o=s),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!dr(e)&&(this.g.F=e,s=this.h,s!==null&&e in s&&(s=this.h,e in s&&delete s[e])),this.j=new dn(this)}oe($e,re);$e.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var s=this.g,e=this.l,i=this.h||void 0;Ie(0),s.Y=e,s.na=i||{},s.G=s.aa,s.I=E_(s,null,s.Y),fa(s)};$e.prototype.close=function(){lc(this.g)};$e.prototype.u=function(s){var e=this.g;if(typeof s=="string"){var i={};i.__data__=s,s=i}else this.v&&(i={},i.__data__=Jl(s),s=i);e.j.push(new Ew(e.fb++,s)),e.H==3&&fa(e)};$e.prototype.N=function(){this.g.h=null,delete this.j,lc(this.g),delete this.g,$e.$.N.call(this)};function C_(s){nc.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var e=s.__sm__;if(e){t:{for(let i in e){s=i;break t}s=void 0}(this.i=s)&&(s=this.i,e=e!==null&&s in e?e[s]:void 0),this.data=e}else this.data=s}oe(C_,nc);function I_(){rc.call(this),this.status=1}oe(I_,rc);function dn(s){this.g=s}oe(dn,A_);dn.prototype.Ba=function(){fe(this.g,"a")};dn.prototype.Aa=function(s){fe(this.g,new C_(s))};dn.prototype.za=function(s){fe(this.g,new I_)};dn.prototype.ya=function(){fe(this.g,"b")};function Bw(){this.blockSize=-1}function hs(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}oe(hs,Bw);hs.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Sl(s,e,i){i||(i=0);var o=Array(16);if(typeof e=="string")for(var a=0;16>a;++a)o[a]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;else for(a=0;16>a;++a)o[a]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;e=s.g[0],i=s.g[1],a=s.g[2];var l=s.g[3],d=e+(l^i&(a^l))+o[0]+3614090360&4294967295;e=i+(d<<7&4294967295|d>>>25),d=l+(a^e&(i^a))+o[1]+3905402710&4294967295,l=e+(d<<12&4294967295|d>>>20),d=a+(i^l&(e^i))+o[2]+606105819&4294967295,a=l+(d<<17&4294967295|d>>>15),d=i+(e^a&(l^e))+o[3]+3250441966&4294967295,i=a+(d<<22&4294967295|d>>>10),d=e+(l^i&(a^l))+o[4]+4118548399&4294967295,e=i+(d<<7&4294967295|d>>>25),d=l+(a^e&(i^a))+o[5]+1200080426&4294967295,l=e+(d<<12&4294967295|d>>>20),d=a+(i^l&(e^i))+o[6]+2821735955&4294967295,a=l+(d<<17&4294967295|d>>>15),d=i+(e^a&(l^e))+o[7]+4249261313&4294967295,i=a+(d<<22&4294967295|d>>>10),d=e+(l^i&(a^l))+o[8]+1770035416&4294967295,e=i+(d<<7&4294967295|d>>>25),d=l+(a^e&(i^a))+o[9]+2336552879&4294967295,l=e+(d<<12&4294967295|d>>>20),d=a+(i^l&(e^i))+o[10]+4294925233&4294967295,a=l+(d<<17&4294967295|d>>>15),d=i+(e^a&(l^e))+o[11]+2304563134&4294967295,i=a+(d<<22&4294967295|d>>>10),d=e+(l^i&(a^l))+o[12]+1804603682&4294967295,e=i+(d<<7&4294967295|d>>>25),d=l+(a^e&(i^a))+o[13]+4254626195&4294967295,l=e+(d<<12&4294967295|d>>>20),d=a+(i^l&(e^i))+o[14]+2792965006&4294967295,a=l+(d<<17&4294967295|d>>>15),d=i+(e^a&(l^e))+o[15]+1236535329&4294967295,i=a+(d<<22&4294967295|d>>>10),d=e+(a^l&(i^a))+o[1]+4129170786&4294967295,e=i+(d<<5&4294967295|d>>>27),d=l+(i^a&(e^i))+o[6]+3225465664&4294967295,l=e+(d<<9&4294967295|d>>>23),d=a+(e^i&(l^e))+o[11]+643717713&4294967295,a=l+(d<<14&4294967295|d>>>18),d=i+(l^e&(a^l))+o[0]+3921069994&4294967295,i=a+(d<<20&4294967295|d>>>12),d=e+(a^l&(i^a))+o[5]+3593408605&4294967295,e=i+(d<<5&4294967295|d>>>27),d=l+(i^a&(e^i))+o[10]+38016083&4294967295,l=e+(d<<9&4294967295|d>>>23),d=a+(e^i&(l^e))+o[15]+3634488961&4294967295,a=l+(d<<14&4294967295|d>>>18),d=i+(l^e&(a^l))+o[4]+3889429448&4294967295,i=a+(d<<20&4294967295|d>>>12),d=e+(a^l&(i^a))+o[9]+568446438&4294967295,e=i+(d<<5&4294967295|d>>>27),d=l+(i^a&(e^i))+o[14]+3275163606&4294967295,l=e+(d<<9&4294967295|d>>>23),d=a+(e^i&(l^e))+o[3]+4107603335&4294967295,a=l+(d<<14&4294967295|d>>>18),d=i+(l^e&(a^l))+o[8]+1163531501&4294967295,i=a+(d<<20&4294967295|d>>>12),d=e+(a^l&(i^a))+o[13]+2850285829&4294967295,e=i+(d<<5&4294967295|d>>>27),d=l+(i^a&(e^i))+o[2]+4243563512&4294967295,l=e+(d<<9&4294967295|d>>>23),d=a+(e^i&(l^e))+o[7]+1735328473&4294967295,a=l+(d<<14&4294967295|d>>>18),d=i+(l^e&(a^l))+o[12]+2368359562&4294967295,i=a+(d<<20&4294967295|d>>>12),d=e+(i^a^l)+o[5]+4294588738&4294967295,e=i+(d<<4&4294967295|d>>>28),d=l+(e^i^a)+o[8]+2272392833&4294967295,l=e+(d<<11&4294967295|d>>>21),d=a+(l^e^i)+o[11]+1839030562&4294967295,a=l+(d<<16&4294967295|d>>>16),d=i+(a^l^e)+o[14]+4259657740&4294967295,i=a+(d<<23&4294967295|d>>>9),d=e+(i^a^l)+o[1]+2763975236&4294967295,e=i+(d<<4&4294967295|d>>>28),d=l+(e^i^a)+o[4]+1272893353&4294967295,l=e+(d<<11&4294967295|d>>>21),d=a+(l^e^i)+o[7]+4139469664&4294967295,a=l+(d<<16&4294967295|d>>>16),d=i+(a^l^e)+o[10]+3200236656&4294967295,i=a+(d<<23&4294967295|d>>>9),d=e+(i^a^l)+o[13]+681279174&4294967295,e=i+(d<<4&4294967295|d>>>28),d=l+(e^i^a)+o[0]+3936430074&4294967295,l=e+(d<<11&4294967295|d>>>21),d=a+(l^e^i)+o[3]+3572445317&4294967295,a=l+(d<<16&4294967295|d>>>16),d=i+(a^l^e)+o[6]+76029189&4294967295,i=a+(d<<23&4294967295|d>>>9),d=e+(i^a^l)+o[9]+3654602809&4294967295,e=i+(d<<4&4294967295|d>>>28),d=l+(e^i^a)+o[12]+3873151461&4294967295,l=e+(d<<11&4294967295|d>>>21),d=a+(l^e^i)+o[15]+530742520&4294967295,a=l+(d<<16&4294967295|d>>>16),d=i+(a^l^e)+o[2]+3299628645&4294967295,i=a+(d<<23&4294967295|d>>>9),d=e+(a^(i|~l))+o[0]+4096336452&4294967295,e=i+(d<<6&4294967295|d>>>26),d=l+(i^(e|~a))+o[7]+1126891415&4294967295,l=e+(d<<10&4294967295|d>>>22),d=a+(e^(l|~i))+o[14]+2878612391&4294967295,a=l+(d<<15&4294967295|d>>>17),d=i+(l^(a|~e))+o[5]+4237533241&4294967295,i=a+(d<<21&4294967295|d>>>11),d=e+(a^(i|~l))+o[12]+1700485571&4294967295,e=i+(d<<6&4294967295|d>>>26),d=l+(i^(e|~a))+o[3]+2399980690&4294967295,l=e+(d<<10&4294967295|d>>>22),d=a+(e^(l|~i))+o[10]+4293915773&4294967295,a=l+(d<<15&4294967295|d>>>17),d=i+(l^(a|~e))+o[1]+2240044497&4294967295,i=a+(d<<21&4294967295|d>>>11),d=e+(a^(i|~l))+o[8]+1873313359&4294967295,e=i+(d<<6&4294967295|d>>>26),d=l+(i^(e|~a))+o[15]+4264355552&4294967295,l=e+(d<<10&4294967295|d>>>22),d=a+(e^(l|~i))+o[6]+2734768916&4294967295,a=l+(d<<15&4294967295|d>>>17),d=i+(l^(a|~e))+o[13]+1309151649&4294967295,i=a+(d<<21&4294967295|d>>>11),d=e+(a^(i|~l))+o[4]+4149444226&4294967295,e=i+(d<<6&4294967295|d>>>26),d=l+(i^(e|~a))+o[11]+3174756917&4294967295,l=e+(d<<10&4294967295|d>>>22),d=a+(e^(l|~i))+o[2]+718787259&4294967295,a=l+(d<<15&4294967295|d>>>17),d=i+(l^(a|~e))+o[9]+3951481745&4294967295,s.g[0]=s.g[0]+e&4294967295,s.g[1]=s.g[1]+(a+(d<<21&4294967295|d>>>11))&4294967295,s.g[2]=s.g[2]+a&4294967295,s.g[3]=s.g[3]+l&4294967295}hs.prototype.j=function(s,e){e===void 0&&(e=s.length);for(var i=e-this.blockSize,o=this.m,a=this.h,l=0;l<e;){if(a==0)for(;l<=i;)Sl(this,s,l),l+=this.blockSize;if(typeof s=="string"){for(;l<e;)if(o[a++]=s.charCodeAt(l++),a==this.blockSize){Sl(this,o),a=0;break}}else for(;l<e;)if(o[a++]=s[l++],a==this.blockSize){Sl(this,o),a=0;break}}this.h=a,this.i+=e};hs.prototype.l=function(){var s=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);s[0]=128;for(var e=1;e<s.length-8;++e)s[e]=0;var i=8*this.i;for(e=s.length-8;e<s.length;++e)s[e]=i&255,i/=256;for(this.j(s),s=Array(16),e=i=0;4>e;++e)for(var o=0;32>o;o+=8)s[i++]=this.g[e]>>>o&255;return s};function At(s,e){this.h=e;for(var i=[],o=!0,a=s.length-1;0<=a;a--){var l=s[a]|0;o&&l==e||(i[a]=l,o=!1)}this.g=i}var Lw={};function dc(s){return-128<=s&&128>s?Ky(s,function(e){return new At([e|0],0>e?-1:0)}):new At([s|0],0>s?-1:0)}function Ts(s){if(isNaN(s)||!isFinite(s))return ln;if(0>s)return de(Ts(-s));for(var e=[],i=1,o=0;s>=i;o++)e[o]=s/i|0,i*=Hl;return new At(e,0)}function S_(s,e){if(s.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(s.charAt(0)=="-")return de(S_(s.substring(1),e));if(0<=s.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=Ts(Math.pow(e,8)),o=ln,a=0;a<s.length;a+=8){var l=Math.min(8,s.length-a),d=parseInt(s.substring(a,a+l),e);8>l?(l=Ts(Math.pow(e,l)),o=o.R(l).add(Ts(d))):(o=o.R(i),o=o.add(Ts(d)))}return o}var Hl=4294967296,ln=dc(0),Wl=dc(1),Ap=dc(16777216);q=At.prototype;q.ea=function(){if(Ze(this))return-de(this).ea();for(var s=0,e=1,i=0;i<this.g.length;i++){var o=this.D(i);s+=(0<=o?o:Hl+o)*e,e*=Hl}return s};q.toString=function(s){if(s=s||10,2>s||36<s)throw Error("radix out of range: "+s);if(Gs(this))return"0";if(Ze(this))return"-"+de(this).toString(s);for(var e=Ts(Math.pow(s,6)),i=this,o="";;){var a=Zo(i,e).g;i=Yo(i,a.R(e));var l=((0<i.g.length?i.g[0]:i.h)>>>0).toString(s);if(i=a,Gs(i))return l+o;for(;6>l.length;)l="0"+l;o=l+o}};q.D=function(s){return 0>s?0:s<this.g.length?this.g[s]:this.h};function Gs(s){if(s.h!=0)return!1;for(var e=0;e<s.g.length;e++)if(s.g[e]!=0)return!1;return!0}function Ze(s){return s.h==-1}q.X=function(s){return s=Yo(this,s),Ze(s)?-1:Gs(s)?0:1};function de(s){for(var e=s.g.length,i=[],o=0;o<e;o++)i[o]=~s.g[o];return new At(i,~s.h).add(Wl)}q.abs=function(){return Ze(this)?de(this):this};q.add=function(s){for(var e=Math.max(this.g.length,s.g.length),i=[],o=0,a=0;a<=e;a++){var l=o+(this.D(a)&65535)+(s.D(a)&65535),d=(l>>>16)+(this.D(a)>>>16)+(s.D(a)>>>16);o=d>>>16,l&=65535,d&=65535,i[a]=d<<16|l}return new At(i,i[i.length-1]&-2147483648?-1:0)};function Yo(s,e){return s.add(de(e))}q.R=function(s){if(Gs(this)||Gs(s))return ln;if(Ze(this))return Ze(s)?de(this).R(de(s)):de(de(this).R(s));if(Ze(s))return de(this.R(de(s)));if(0>this.X(Ap)&&0>s.X(Ap))return Ts(this.ea()*s.ea());for(var e=this.g.length+s.g.length,i=[],o=0;o<2*e;o++)i[o]=0;for(o=0;o<this.g.length;o++)for(var a=0;a<s.g.length;a++){var l=this.D(o)>>>16,d=this.D(o)&65535,g=s.D(a)>>>16,m=s.D(a)&65535;i[2*o+2*a]+=d*m,qo(i,2*o+2*a),i[2*o+2*a+1]+=l*m,qo(i,2*o+2*a+1),i[2*o+2*a+1]+=d*g,qo(i,2*o+2*a+1),i[2*o+2*a+2]+=l*g,qo(i,2*o+2*a+2)}for(o=0;o<e;o++)i[o]=i[2*o+1]<<16|i[2*o];for(o=e;o<2*e;o++)i[o]=0;return new At(i,0)};function qo(s,e){for(;(s[e]&65535)!=s[e];)s[e+1]+=s[e]>>>16,s[e]&=65535,e++}function hr(s,e){this.g=s,this.h=e}function Zo(s,e){if(Gs(e))throw Error("division by zero");if(Gs(s))return new hr(ln,ln);if(Ze(s))return e=Zo(de(s),e),new hr(de(e.g),de(e.h));if(Ze(e))return e=Zo(s,de(e)),new hr(de(e.g),e.h);if(30<s.g.length){if(Ze(s)||Ze(e))throw Error("slowDivide_ only works with positive integers.");for(var i=Wl,o=e;0>=o.X(s);)i=Cp(i),o=Cp(o);var a=an(i,1),l=an(o,1);for(o=an(o,2),i=an(i,2);!Gs(o);){var d=l.add(o);0>=d.X(s)&&(a=a.add(i),l=d),o=an(o,1),i=an(i,1)}return e=Yo(s,a.R(e)),new hr(a,e)}for(a=ln;0<=s.X(e);){for(i=Math.max(1,Math.floor(s.ea()/e.ea())),o=Math.ceil(Math.log(i)/Math.LN2),o=48>=o?1:Math.pow(2,o-48),l=Ts(i),d=l.R(e);Ze(d)||0<d.X(s);)i-=o,l=Ts(i),d=l.R(e);Gs(l)&&(l=Wl),a=a.add(l),s=Yo(s,d)}return new hr(a,s)}q.gb=function(s){return Zo(this,s).h};q.and=function(s){for(var e=Math.max(this.g.length,s.g.length),i=[],o=0;o<e;o++)i[o]=this.D(o)&s.D(o);return new At(i,this.h&s.h)};q.or=function(s){for(var e=Math.max(this.g.length,s.g.length),i=[],o=0;o<e;o++)i[o]=this.D(o)|s.D(o);return new At(i,this.h|s.h)};q.xor=function(s){for(var e=Math.max(this.g.length,s.g.length),i=[],o=0;o<e;o++)i[o]=this.D(o)^s.D(o);return new At(i,this.h^s.h)};function Cp(s){for(var e=s.g.length+1,i=[],o=0;o<e;o++)i[o]=s.D(o)<<1|s.D(o-1)>>>31;return new At(i,s.h)}function an(s,e){var i=e>>5;e%=32;for(var o=s.g.length-i,a=[],l=0;l<o;l++)a[l]=0<e?s.D(l+i)>>>e|s.D(l+i+1)<<32-e:s.D(l+i);return new At(a,s.h)}Xo.prototype.createWebChannel=Xo.prototype.g;$e.prototype.send=$e.prototype.u;$e.prototype.open=$e.prototype.m;$e.prototype.close=$e.prototype.close;oa.NO_ERROR=0;oa.TIMEOUT=8;oa.HTTP_ERROR=6;jp.COMPLETE="complete";$p.EventType=Er;Er.OPEN="a";Er.CLOSE="b";Er.ERROR="c";Er.MESSAGE="d";re.prototype.listen=re.prototype.O;Ut.prototype.listenOnce=Ut.prototype.P;Ut.prototype.getLastError=Ut.prototype.Sa;Ut.prototype.getLastErrorCode=Ut.prototype.Ia;Ut.prototype.getStatus=Ut.prototype.da;Ut.prototype.getResponseJson=Ut.prototype.Wa;Ut.prototype.getResponseText=Ut.prototype.ja;Ut.prototype.send=Ut.prototype.ha;Ut.prototype.setWithCredentials=Ut.prototype.Oa;hs.prototype.digest=hs.prototype.l;hs.prototype.reset=hs.prototype.reset;hs.prototype.update=hs.prototype.j;At.prototype.add=At.prototype.add;At.prototype.multiply=At.prototype.R;At.prototype.modulo=At.prototype.gb;At.prototype.compare=At.prototype.X;At.prototype.toNumber=At.prototype.ea;At.prototype.toString=At.prototype.toString;At.prototype.getBits=At.prototype.D;At.fromNumber=Ts;At.fromString=S_;var P_=ls.createWebChannelTransport=function(){return new Xo},R_=ls.getStatEventTarget=function(){return ra()},pa=ls.ErrorCode=oa,D_=ls.EventType=jp,k_=ls.Event=Si,fc=ls.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},M_=ls.FetchXmlHttpFactory=Cr,Pr=ls.WebChannel=$p,F_=ls.XhrIo=Ut,B_=ls.Md5=hs,Pi=ls.Integer=At;var L_="@firebase/firestore";var ae=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ae.UNAUTHENTICATED=new ae(null),ae.GOOGLE_CREDENTIALS=new ae("google-credentials-uid"),ae.FIRST_PARTY=new ae("first-party-uid"),ae.MOCK_USER=new ae("mock-user");var Rn="10.5.2";var Mi=new on("@firebase/firestore");function Rr(){return Mi.logLevel}function X(s,...e){if(Mi.logLevel<=yt.DEBUG){let i=e.map(Yu);Mi.debug(`Firestore (${Rn}): ${s}`,...i)}}function Ws(s,...e){if(Mi.logLevel<=yt.ERROR){let i=e.map(Yu);Mi.error(`Firestore (${Rn}): ${s}`,...i)}}function vn(s,...e){if(Mi.logLevel<=yt.WARN){let i=e.map(Yu);Mi.warn(`Firestore (${Rn}): ${s}`,...i)}}function Yu(s){if(typeof s=="string")return s;try{return function(i){return JSON.stringify(i)}(s)}catch{return s}}function ht(s="Unexpected state"){let e=`FIRESTORE (${Rn}) INTERNAL ASSERTION FAILED: `+s;throw Ws(e),new Error(e)}function Mt(s,e){s||ht()}function ft(s,e){return s}var L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},J=class extends Us{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Is=class{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}};var ya=class{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},vc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(ae.UNAUTHENTICATED))}shutdown(){}},yc=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}},wc=class{constructor(e){this.t=e,this.currentUser=ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){let o=this.i,a=m=>this.i!==o?(o=this.i,i(m)):Promise.resolve(),l=new Is;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new Is,e.enqueueRetryable(()=>a(this.currentUser))};let d=()=>{let m=l;e.enqueueRetryable(async()=>{await m.promise,await a(this.currentUser)})},g=m=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(m=>g(m)),setTimeout(()=>{if(!this.auth){let m=this.t.getImmediate({optional:!0});m?g(m):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new Is)}},0),d()}getToken(){let e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(o=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(Mt(typeof o.accessToken=="string"),new ya(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return Mt(e===null||typeof e=="string"),new ae(e)}},xc=class{constructor(e,i,o){this.l=e,this.h=i,this.P=o,this.type="FirstParty",this.user=ae.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},bc=class{constructor(e,i,o){this.l=e,this.h=i,this.P=o}getToken(){return Promise.resolve(new xc(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ec=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Tc=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,i){let o=l=>{l.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);let d=l.token!==this.R;return this.R=l.token,X("FirebaseAppCheckTokenProvider",`Received ${d?"new":"existing"} token.`),d?i(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable(()=>o(l))};let a=l=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.appCheck.addTokenListener(this.o)};this.A.onInit(l=>a(l)),setTimeout(()=>{if(!this.appCheck){let l=this.A.getImmediate({optional:!0});l?a(l):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(Mt(typeof i.token=="string"),this.R=i.token,new Ec(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Nw(s){let e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<s;o++)i[o]=Math.floor(256*Math.random());return i}var wa=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/e.length)*e.length,o="";for(;o.length<20;){let a=Nw(40);for(let l=0;l<a.length;++l)o.length<20&&a[l]<i&&(o+=e.charAt(a[l]%e.length))}return o}};function Tt(s,e){return s<e?-1:s>e?1:0}function yn(s,e,i){return s.length===e.length&&s.every((o,a)=>i(o,e[a]))}var pe=class s{constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new J(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new J(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<-62135596800)throw new J(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new J(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return s.fromMillis(Date.now())}static fromDate(e){return s.fromMillis(e.getTime())}static fromMillis(e){let i=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*i));return new s(i,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Tt(this.nanoseconds,e.nanoseconds):Tt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var dt=class s{constructor(e){this.timestamp=e}static fromTimestamp(e){return new s(e)}static min(){return new s(new pe(0,0))}static max(){return new s(new pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var xa=class s{constructor(e,i,o){i===void 0?i=0:i>e.length&&ht(),o===void 0?o=e.length-i:o>e.length-i&&ht(),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return s.comparator(this,e)===0}child(e){let i=this.segments.slice(this.offset,this.limit());return e instanceof s?e.forEach(o=>{i.push(o)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){let o=Math.min(e.length,i.length);for(let a=0;a<o;a++){let l=e.get(a),d=i.get(a);if(l<d)return-1;if(l>d)return 1}return e.length<i.length?-1:e.length>i.length?1:0}},Jt=class s extends xa{construct(e,i,o){return new s(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let i=[];for(let o of e){if(o.indexOf("//")>=0)throw new J(L.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter(a=>a.length>0))}return new s(i)}static emptyPath(){return new s([])}},Vw=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ke=class s extends xa{construct(e,i,o){return new s(e,i,o)}static isValidIdentifier(e){return Vw.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),s.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new s(["__name__"])}static fromServerFormat(e){let i=[],o="",a=0,l=()=>{if(o.length===0)throw new J(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""},d=!1;for(;a<e.length;){let g=e[a];if(g==="\\"){if(a+1===e.length)throw new J(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let m=e[a+1];if(m!=="\\"&&m!=="."&&m!=="`")throw new J(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=m,a+=2}else g==="`"?(d=!d,a++):g!=="."||d?(o+=g,a++):(l(),a++)}if(l(),d)throw new J(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new s(i)}static emptyPath(){return new s([])}};var it=class s{constructor(e){this.path=e}static fromPath(e){return new s(Jt.fromString(e))}static fromName(e){return new s(Jt.fromString(e).popFirst(5))}static empty(){return new s(Jt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Jt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Jt.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new s(new Jt(e.slice()))}};var Ac=class{constructor(e,i,o,a){this.indexId=e,this.collectionGroup=i,this.fields=o,this.indexState=a}};Ac.UNKNOWN_ID=-1;function Ow(s,e){let i=s.toTimestamp().seconds,o=s.toTimestamp().nanoseconds+1,a=dt.fromTimestamp(o===1e9?new pe(i+1,0):new pe(i,o));return new Fi(a,it.empty(),e)}function Uw(s){return new Fi(s.readTime,s.key,-1)}var Fi=class s{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new s(dt.min(),it.empty(),-1)}static max(){return new s(dt.max(),it.empty(),-1)}};function zw(s,e){let i=s.readTime.compareTo(e.readTime);return i!==0?i:(i=it.comparator(s.documentKey,e.documentKey),i!==0?i:Tt(s.largestBatchId,e.largestBatchId))}var Gw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Cc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};async function Yr(s){if(s.code!==L.FAILED_PRECONDITION||s.message!==Gw)throw s;X("LocalStore","Unexpectedly lost primary lease")}var U=class s{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&ht(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new s((o,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(o,a)},this.catchCallback=l=>{this.wrapFailure(i,l).next(o,a)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{let i=e();return i instanceof s?i:s.resolve(i)}catch(i){return s.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):s.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):s.reject(i)}static resolve(e){return new s((i,o)=>{i(e)})}static reject(e){return new s((i,o)=>{o(e)})}static waitFor(e){return new s((i,o)=>{let a=0,l=0,d=!1;e.forEach(g=>{++a,g.next(()=>{++l,d&&l===a&&i()},m=>o(m))}),d=!0,l===a&&i()})}static or(e){let i=s.resolve(!1);for(let o of e)i=i.next(a=>a?s.resolve(a):o());return i}static forEach(e,i){let o=[];return e.forEach((a,l)=>{o.push(i.call(this,a,l))}),this.waitFor(o)}static mapArray(e,i){return new s((o,a)=>{let l=e.length,d=new Array(l),g=0;for(let m=0;m<l;m++){let y=m;i(e[y]).next(x=>{d[y]=x,++g,g===l&&o(d)},x=>a(x))}})}static doWhile(e,i){return new s((o,a)=>{let l=()=>{e()===!0?i().next(()=>{l()},a):o()};l()})}};function Zr(s){return s.name==="IndexedDbTransactionError"}var Lr=class{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this.se(o),this.oe=o=>i.writeSequenceNumber(o))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}};Lr._e=-1;function Ka(s){return s==null}function Nr(s){return s===0&&1/s==-1/0}function Hw(s){return typeof s=="number"&&Number.isInteger(s)&&!Nr(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}var Ww=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ZI=[...Ww,"documentOverlays"],qw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],jw=qw,JI=[...jw,"indexConfiguration","indexState","indexEntries"];function N_(s){let e=0;for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&e++;return e}function Dn(s,e){for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&e(i,s[i])}function hg(s){for(let e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}var Gt=class s{constructor(e,i){this.comparator=e,this.root=i||Ss.EMPTY}insert(e,i){return new s(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Ss.BLACK,null,null))}remove(e){return new s(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ss.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){let o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){let a=this.comparator(e,o.key);if(a===0)return i+o.left.size;a<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,o)=>(e(i,o),!1))}toString(){let e=[];return this.inorderTraversal((i,o)=>(e.push(`${i}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new gn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new gn(this.root,e,this.comparator,!1)}getReverseIterator(){return new gn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new gn(this.root,e,this.comparator,!0)}},gn=class{constructor(e,i,o,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=i?o(e.key,i):1,i&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ss=class s{constructor(e,i,o,a,l){this.key=e,this.value=i,this.color=o??s.RED,this.left=a??s.EMPTY,this.right=l??s.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,a,l){return new s(e??this.key,i??this.value,o??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let a=this,l=o(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,i,o),null):l===0?a.copy(null,i,null,null,null):a.copy(null,null,null,null,a.right.insert(e,i,o)),a.fixUp()}removeMin(){if(this.left.isEmpty())return s.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,a=this;if(i(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,i),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),i(e,a.key)===0){if(a.right.isEmpty())return s.EMPTY;o=a.right.min(),a=a.copy(o.key,o.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,i))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,s.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,s.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ht();let e=this.left.check();if(e!==this.right.check())throw ht();return e+(this.isRed()?0:1)}};Ss.EMPTY=null,Ss.RED=!0,Ss.BLACK=!1;Ss.EMPTY=new class{constructor(){this.size=0}get key(){throw ht()}get value(){throw ht()}get color(){throw ht()}get left(){throw ht()}get right(){throw ht()}copy(e,i,o,a,l){return this}insert(e,i,o){return new Ss(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var we=class s{constructor(e){this.comparator=e,this.data=new Gt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,o)=>(e(i),!1))}forEachInRange(e,i){let o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){let a=o.getNext();if(this.comparator(a.key,e[1])>=0)return;i(a.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){let i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new ba(this.data.getIterator())}getIteratorFrom(e){return new ba(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(o=>{i=i.add(o)}),i}isEqual(e){if(!(e instanceof s)||this.size!==e.size)return!1;let i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){let a=i.getNext().key,l=o.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(i=>{e.push(i)}),e}toString(){let e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){let i=new s(this.comparator);return i.data=e,i}},ba=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Cs=class s{constructor(e){this.fields=e,e.sort(Ke.comparator)}static empty(){return new s([])}unionWith(e){let i=new we(Ke.comparator);for(let o of this.fields)i=i.add(o);for(let o of e)i=i.add(o);return new s(i.toArray())}covers(e){for(let i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return yn(this.fields,e.fields,(i,o)=>i.isEqual(o))}};var Ea=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Se=class s{constructor(e){this.binaryString=e}static fromBase64String(e){let i=function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new Ea("Invalid base64 string: "+l):l}}(e);return new s(i)}static fromUint8Array(e){let i=function(a){let l="";for(let d=0;d<a.length;++d)l+=String.fromCharCode(a[d]);return l}(e);return new s(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){let o=new Uint8Array(i.length);for(let a=0;a<i.length;a++)o[a]=i.charCodeAt(a);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Tt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Se.EMPTY_BYTE_STRING=new Se("");var $w=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ii(s){if(Mt(!!s),typeof s=="string"){let e=0,i=$w.exec(s);if(Mt(!!i),i[1]){let a=i[1];a=(a+"000000000").substr(0,9),e=Number(a)}let o=new Date(s);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:zt(s.seconds),nanos:zt(s.nanos)}}function zt(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function ni(s){return typeof s=="string"?Se.fromBase64String(s):Se.fromUint8Array(s)}function Zu(s){var e,i;return((i=(((e=s?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||i===void 0?void 0:i.stringValue)==="server_timestamp"}function Ju(s){let e=s.mapValue.fields.__previous_value__;return Zu(e)?Ju(e):e}function Vr(s){let e=ii(s.mapValue.fields.__local_write_time__.timestampValue);return new pe(e.seconds,e.nanos)}var Ic=class{constructor(e,i,o,a,l,d,g,m,y){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=a,this.ssl=l,this.forceLongPolling=d,this.autoDetectLongPolling=g,this.longPollingOptions=m,this.useFetchStreams=y}},Ta=class s{constructor(e,i){this.projectId=e,this.database=i||"(default)"}static empty(){return new s("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof s&&e.projectId===this.projectId&&e.database===this.database}};var _a={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bi(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?Zu(s)?4:lg(s)?9007199254740991:10:ht()}function Ds(s,e){if(s===e)return!0;let i=Bi(s);if(i!==Bi(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return Vr(s).isEqual(Vr(e));case 3:return function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;let d=ii(a.timestampValue),g=ii(l.timestampValue);return d.seconds===g.seconds&&d.nanos===g.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(a,l){return ni(a.bytesValue).isEqual(ni(l.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(a,l){return zt(a.geoPointValue.latitude)===zt(l.geoPointValue.latitude)&&zt(a.geoPointValue.longitude)===zt(l.geoPointValue.longitude)}(s,e);case 2:return function(a,l){if("integerValue"in a&&"integerValue"in l)return zt(a.integerValue)===zt(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){let d=zt(a.doubleValue),g=zt(l.doubleValue);return d===g?Nr(d)===Nr(g):isNaN(d)&&isNaN(g)}return!1}(s,e);case 9:return yn(s.arrayValue.values||[],e.arrayValue.values||[],Ds);case 10:return function(a,l){let d=a.mapValue.fields||{},g=l.mapValue.fields||{};if(N_(d)!==N_(g))return!1;for(let m in d)if(d.hasOwnProperty(m)&&(g[m]===void 0||!Ds(d[m],g[m])))return!1;return!0}(s,e);default:return ht()}}function Or(s,e){return(s.values||[]).find(i=>Ds(i,e))!==void 0}function wn(s,e){if(s===e)return 0;let i=Bi(s),o=Bi(e);if(i!==o)return Tt(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return Tt(s.booleanValue,e.booleanValue);case 2:return function(l,d){let g=zt(l.integerValue||l.doubleValue),m=zt(d.integerValue||d.doubleValue);return g<m?-1:g>m?1:g===m?0:isNaN(g)?isNaN(m)?0:-1:1}(s,e);case 3:return V_(s.timestampValue,e.timestampValue);case 4:return V_(Vr(s),Vr(e));case 5:return Tt(s.stringValue,e.stringValue);case 6:return function(l,d){let g=ni(l),m=ni(d);return g.compareTo(m)}(s.bytesValue,e.bytesValue);case 7:return function(l,d){let g=l.split("/"),m=d.split("/");for(let y=0;y<g.length&&y<m.length;y++){let x=Tt(g[y],m[y]);if(x!==0)return x}return Tt(g.length,m.length)}(s.referenceValue,e.referenceValue);case 8:return function(l,d){let g=Tt(zt(l.latitude),zt(d.latitude));return g!==0?g:Tt(zt(l.longitude),zt(d.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return function(l,d){let g=l.values||[],m=d.values||[];for(let y=0;y<g.length&&y<m.length;++y){let x=wn(g[y],m[y]);if(x)return x}return Tt(g.length,m.length)}(s.arrayValue,e.arrayValue);case 10:return function(l,d){if(l===_a.mapValue&&d===_a.mapValue)return 0;if(l===_a.mapValue)return 1;if(d===_a.mapValue)return-1;let g=l.fields||{},m=Object.keys(g),y=d.fields||{},x=Object.keys(y);m.sort(),x.sort();for(let A=0;A<m.length&&A<x.length;++A){let T=Tt(m[A],x[A]);if(T!==0)return T;let P=wn(g[m[A]],y[x[A]]);if(P!==0)return P}return Tt(m.length,x.length)}(s.mapValue,e.mapValue);default:throw ht()}}function V_(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return Tt(s,e);let i=ii(s),o=ii(e),a=Tt(i.seconds,o.seconds);return a!==0?a:Tt(i.nanos,o.nanos)}function xn(s){return Sc(s)}function Sc(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(i){let o=ii(i);return`time(${o.seconds},${o.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(i){return ni(i).toBase64()}(s.bytesValue):"referenceValue"in s?function(i){return it.fromName(i).toString()}(s.referenceValue):"geoPointValue"in s?function(i){return`geo(${i.latitude},${i.longitude})`}(s.geoPointValue):"arrayValue"in s?function(i){let o="[",a=!0;for(let l of i.values||[])a?a=!1:o+=",",o+=Sc(l);return o+"]"}(s.arrayValue):"mapValue"in s?function(i){let o=Object.keys(i.fields||{}).sort(),a="{",l=!0;for(let d of o)l?l=!1:a+=",",a+=`${d}:${Sc(i.fields[d])}`;return a+"}"}(s.mapValue):ht()}function Pc(s){return!!s&&"integerValue"in s}function td(s){return!!s&&"arrayValue"in s}function O_(s){return!!s&&"nullValue"in s}function U_(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function ma(s){return!!s&&"mapValue"in s}function kr(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){let e={mapValue:{fields:{}}};return Dn(s.mapValue.fields,(i,o)=>e.mapValue.fields[i]=kr(o)),e}if(s.arrayValue){let e={arrayValue:{values:[]}};for(let i=0;i<(s.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=kr(s.arrayValue.values[i]);return e}return Object.assign({},s)}function lg(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var cs=class s{constructor(e){this.value=e}static empty(){return new s({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!ma(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=kr(i)}setAll(e){let i=Ke.emptyPath(),o={},a=[];e.forEach((d,g)=>{if(!i.isImmediateParentOf(g)){let m=this.getFieldsMap(i);this.applyChanges(m,o,a),o={},a=[],i=g.popLast()}d?o[g.lastSegment()]=kr(d):a.push(g.lastSegment())});let l=this.getFieldsMap(i);this.applyChanges(l,o,a)}delete(e){let i=this.field(e.popLast());ma(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Ds(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let a=i.mapValue.fields[e.get(o)];ma(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=a),i=a}return i.mapValue.fields}applyChanges(e,i,o){Dn(i,(a,l)=>e[a]=l);for(let a of o)delete e[a]}clone(){return new s(kr(this.value))}};function cg(s){let e=[];return Dn(s.fields,(i,o)=>{let a=new Ke([i]);if(ma(o)){let l=cg(o.mapValue).fields;if(l.length===0)e.push(a);else for(let d of l)e.push(a.child(d))}else e.push(a)}),new Cs(e)}var us=class s{constructor(e,i,o,a,l,d,g){this.key=e,this.documentType=i,this.version=o,this.readTime=a,this.createTime=l,this.data=d,this.documentState=g}static newInvalidDocument(e){return new s(e,0,dt.min(),dt.min(),dt.min(),cs.empty(),0)}static newFoundDocument(e,i,o,a){return new s(e,1,i,dt.min(),o,a,0)}static newNoDocument(e,i){return new s(e,2,i,dt.min(),dt.min(),cs.empty(),0)}static newUnknownDocument(e,i){return new s(e,3,i,dt.min(),dt.min(),cs.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(dt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=cs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=cs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=dt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof s&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new s(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var bn=class{constructor(e,i){this.position=e,this.inclusive=i}};function z_(s,e,i){let o=0;for(let a=0;a<s.position.length;a++){let l=e[a],d=s.position[a];if(l.field.isKeyField()?o=it.comparator(it.fromName(d.referenceValue),i.key):o=wn(d,i.data.field(l.field)),l.dir==="desc"&&(o*=-1),o!==0)break}return o}function G_(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let i=0;i<s.position.length;i++)if(!Ds(s.position[i],e.position[i]))return!1;return!0}var En=class{constructor(e,i="asc"){this.field=e,this.dir=i}};function Kw(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}var Aa=class{},se=class s extends Aa{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new Dc(e,i,o):i==="array-contains"?new Fc(e,o):i==="in"?new Bc(e,o):i==="not-in"?new Lc(e,o):i==="array-contains-any"?new Nc(e,o):new s(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new kc(e,o):new Mc(e,o)}matches(e){let i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(wn(i,this.value)):i!==null&&Bi(this.value)===Bi(i)&&this.matchesComparison(wn(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ht()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ks=class s extends Aa{constructor(e,i){super(),this.filters=e,this.op=i,this.ue=null}static create(e,i){return new s(e,i)}matches(e){return ug(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function ug(s){return s.op==="and"}function dg(s){return Qw(s)&&ug(s)}function Qw(s){for(let e of s.filters)if(e instanceof ks)return!1;return!0}function Rc(s){if(s instanceof se)return s.field.canonicalString()+s.op.toString()+xn(s.value);if(dg(s))return s.filters.map(e=>Rc(e)).join(",");{let e=s.filters.map(i=>Rc(i)).join(",");return`${s.op}(${e})`}}function fg(s,e){return s instanceof se?function(o,a){return a instanceof se&&o.op===a.op&&o.field.isEqual(a.field)&&Ds(o.value,a.value)}(s,e):s instanceof ks?function(o,a){return a instanceof ks&&o.op===a.op&&o.filters.length===a.filters.length?o.filters.reduce((l,d,g)=>l&&fg(d,a.filters[g]),!0):!1}(s,e):void ht()}function pg(s){return s instanceof se?function(i){return`${i.field.canonicalString()} ${i.op} ${xn(i.value)}`}(s):s instanceof ks?function(i){return i.op.toString()+" {"+i.getFilters().map(pg).join(" ,")+"}"}(s):"Filter"}var Dc=class extends se{constructor(e,i,o){super(e,i,o),this.key=it.fromName(o.referenceValue)}matches(e){let i=it.comparator(e.key,this.key);return this.matchesComparison(i)}},kc=class extends se{constructor(e,i){super(e,"in",i),this.keys=_g("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}},Mc=class extends se{constructor(e,i){super(e,"not-in",i),this.keys=_g("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}};function _g(s,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(o=>it.fromName(o.referenceValue))}var Fc=class extends se{constructor(e,i){super(e,"array-contains",i)}matches(e){let i=e.data.field(this.field);return td(i)&&Or(i.arrayValue,this.value)}},Bc=class extends se{constructor(e,i){super(e,"in",i)}matches(e){let i=e.data.field(this.field);return i!==null&&Or(this.value.arrayValue,i)}},Lc=class extends se{constructor(e,i){super(e,"not-in",i)}matches(e){if(Or(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let i=e.data.field(this.field);return i!==null&&!Or(this.value.arrayValue,i)}},Nc=class extends se{constructor(e,i){super(e,"array-contains-any",i)}matches(e){let i=e.data.field(this.field);return!(!td(i)||!i.arrayValue.values)&&i.arrayValue.values.some(o=>Or(this.value.arrayValue,o))}};var Vc=class{constructor(e,i=null,o=[],a=[],l=null,d=null,g=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=a,this.limit=l,this.startAt=d,this.endAt=g,this.ce=null}};function H_(s,e=null,i=[],o=[],a=null,l=null,d=null){return new Vc(s,e,i,o,a,l,d)}function ed(s){let e=ft(s);if(e.ce===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(o=>Rc(o)).join(","),i+="|ob:",i+=e.orderBy.map(o=>function(l){return l.field.canonicalString()+l.dir}(o)).join(","),Ka(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(o=>xn(o)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(o=>xn(o)).join(",")),e.ce=i}return e.ce}function sd(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<s.orderBy.length;i++)if(!Kw(s.orderBy[i],e.orderBy[i]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let i=0;i<s.filters.length;i++)if(!fg(s.filters[i],e.filters[i]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!G_(s.startAt,e.startAt)&&G_(s.endAt,e.endAt)}function Oc(s){return it.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}var Tn=class{constructor(e,i=null,o=[],a=[],l=null,d="F",g=null,m=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=a,this.limit=l,this.limitType=d,this.startAt=g,this.endAt=m,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function Xw(s,e,i,o,a,l,d,g){return new Tn(s,e,i,o,a,l,d,g)}function id(s){return new Tn(s)}function W_(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Yw(s){return s.collectionGroup!==null}function Mr(s){let e=ft(s);if(e.le===null){e.le=[];let i=new Set;for(let l of e.explicitOrderBy)e.le.push(l),i.add(l.field.canonicalString());let o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(d){let g=new we(Ke.comparator);return d.filters.forEach(m=>{m.getFlattenedFilters().forEach(y=>{y.isInequality()&&(g=g.add(y.field))})}),g})(e).forEach(l=>{i.has(l.canonicalString())||l.isKeyField()||e.le.push(new En(l,o))}),i.has(Ke.keyField().canonicalString())||e.le.push(new En(Ke.keyField(),o))}return e.le}function Ps(s){let e=ft(s);return e.he||(e.he=Zw(e,Mr(s))),e.he}function Zw(s,e){if(s.limitType==="F")return H_(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(a=>{let l=a.dir==="desc"?"asc":"desc";return new En(a.field,l)});let i=s.endAt?new bn(s.endAt.position,s.endAt.inclusive):null,o=s.startAt?new bn(s.startAt.position,s.startAt.inclusive):null;return H_(s.path,s.collectionGroup,e,s.filters,s.limit,i,o)}}function Uc(s,e,i){return new Tn(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,i,s.startAt,s.endAt)}function Qa(s,e){return sd(Ps(s),Ps(e))&&s.limitType===e.limitType}function gg(s){return`${ed(Ps(s))}|lt:${s.limitType}`}function fn(s){return`Query(target=${function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map(a=>pg(a)).join(", ")}]`),Ka(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map(a=>function(d){return`${d.field.canonicalString()} (${d.dir})`}(a)).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map(a=>xn(a)).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map(a=>xn(a)).join(",")),`Target(${o})`}(Ps(s))}; limitType=${s.limitType})`}function Xa(s,e){return e.isFoundDocument()&&function(o,a){let l=a.key.path;return o.collectionGroup!==null?a.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(l):it.isDocumentKey(o.path)?o.path.isEqual(l):o.path.isImmediateParentOf(l)}(s,e)&&function(o,a){for(let l of Mr(o))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0}(s,e)&&function(o,a){for(let l of o.filters)if(!l.matches(a))return!1;return!0}(s,e)&&function(o,a){return!(o.startAt&&!function(d,g,m){let y=z_(d,g,m);return d.inclusive?y<=0:y<0}(o.startAt,Mr(o),a)||o.endAt&&!function(d,g,m){let y=z_(d,g,m);return d.inclusive?y>=0:y>0}(o.endAt,Mr(o),a))}(s,e)}function Jw(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function mg(s){return(e,i)=>{let o=!1;for(let a of Mr(s)){let l=tx(a,e,i);if(l!==0)return l;o=o||a.field.isKeyField()}return 0}}function tx(s,e,i){let o=s.field.isKeyField()?it.comparator(e.key,i.key):function(l,d,g){let m=d.data.field(l),y=g.data.field(l);return m!==null&&y!==null?wn(m,y):ht()}(s.field,e,i);switch(s.dir){case"asc":return o;case"desc":return-1*o;default:return ht()}}var ri=class{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){let i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(let[a,l]of o)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,i){let o=this.mapKeyFn(e),a=this.inner[o];if(a===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,i]);a.push([e,i]),this.innerSize++}delete(e){let i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let a=0;a<o.length;a++)if(this.equalsFn(o[a][0],e))return o.length===1?delete this.inner[i]:o.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Dn(this.inner,(i,o)=>{for(let[a,l]of o)e(a,l)})}isEmpty(){return hg(this.inner)}size(){return this.innerSize}};var ex=new Gt(it.comparator);function qs(){return ex}var vg=new Gt(it.comparator);function Dr(...s){let e=vg;for(let i of s)e=e.insert(i.key,i);return e}function yg(s){let e=vg;return s.forEach((i,o)=>e=e.insert(i,o.overlayedDocument)),e}function Ri(){return Fr()}function wg(){return Fr()}function Fr(){return new ri(s=>s.toString(),(s,e)=>s.isEqual(e))}var sx=new Gt(it.comparator),ix=new we(it.comparator);function mt(...s){let e=ix;for(let i of s)e=e.add(i);return e}var nx=new we(Tt);function rx(){return nx}function xg(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nr(e)?"-0":e}}function bg(s){return{integerValue:""+s}}function ox(s,e){return Hw(e)?bg(e):xg(s,e)}var An=class{constructor(){this._=void 0}};function ax(s,e,i){return s instanceof Cn?function(a,l){let d={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&Zu(l)&&(l=Ju(l)),l&&(d.fields.__previous_value__=l),{mapValue:d}}(i,e):s instanceof Li?Tg(s,e):s instanceof Ni?Ag(s,e):function(a,l){let d=Eg(a,l),g=q_(d)+q_(a.Ie);return Pc(d)&&Pc(a.Ie)?bg(g):xg(a.serializer,g)}(s,e)}function hx(s,e,i){return s instanceof Li?Tg(s,e):s instanceof Ni?Ag(s,e):i}function Eg(s,e){return s instanceof In?function(o){return Pc(o)||function(l){return!!l&&"doubleValue"in l}(o)}(e)?e:{integerValue:0}:null}var Cn=class extends An{},Li=class extends An{constructor(e){super(),this.elements=e}};function Tg(s,e){let i=Cg(e);for(let o of s.elements)i.some(a=>Ds(a,o))||i.push(o);return{arrayValue:{values:i}}}var Ni=class extends An{constructor(e){super(),this.elements=e}};function Ag(s,e){let i=Cg(e);for(let o of s.elements)i=i.filter(a=>!Ds(a,o));return{arrayValue:{values:i}}}var In=class extends An{constructor(e,i){super(),this.serializer=e,this.Ie=i}};function q_(s){return zt(s.integerValue||s.doubleValue)}function Cg(s){return td(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function lx(s,e){return s.field.isEqual(e.field)&&function(o,a){return o instanceof Li&&a instanceof Li||o instanceof Ni&&a instanceof Ni?yn(o.elements,a.elements,Ds):o instanceof In&&a instanceof In?Ds(o.Ie,a.Ie):o instanceof Cn&&a instanceof Cn}(s.transform,e.transform)}var zc=class{constructor(e,i){this.version=e,this.transformResults=i}},ki=class s{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new s}static exists(e){return new s(void 0,e)}static updateTime(e){return new s(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function va(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}var Sn=class{};function Ig(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new Ca(s.key,ki.none()):new Vi(s.key,s.data,ki.none());{let i=s.data,o=cs.empty(),a=new we(Ke.comparator);for(let l of e.fields)if(!a.has(l)){let d=i.field(l);d===null&&l.length>1&&(l=l.popLast(),d=i.field(l)),d===null?o.delete(l):o.set(l,d),a=a.add(l)}return new js(s.key,o,new Cs(a.toArray()),ki.none())}}function cx(s,e,i){s instanceof Vi?function(a,l,d){let g=a.value.clone(),m=$_(a.fieldTransforms,l,d.transformResults);g.setAll(m),l.convertToFoundDocument(d.version,g).setHasCommittedMutations()}(s,e,i):s instanceof js?function(a,l,d){if(!va(a.precondition,l))return void l.convertToUnknownDocument(d.version);let g=$_(a.fieldTransforms,l,d.transformResults),m=l.data;m.setAll(Sg(a)),m.setAll(g),l.convertToFoundDocument(d.version,m).setHasCommittedMutations()}(s,e,i):function(a,l,d){l.convertToNoDocument(d.version).setHasCommittedMutations()}(0,e,i)}function Br(s,e,i,o){return s instanceof Vi?function(l,d,g,m){if(!va(l.precondition,d))return g;let y=l.value.clone(),x=K_(l.fieldTransforms,m,d);return y.setAll(x),d.convertToFoundDocument(d.version,y).setHasLocalMutations(),null}(s,e,i,o):s instanceof js?function(l,d,g,m){if(!va(l.precondition,d))return g;let y=K_(l.fieldTransforms,m,d),x=d.data;return x.setAll(Sg(l)),x.setAll(y),d.convertToFoundDocument(d.version,x).setHasLocalMutations(),g===null?null:g.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map(A=>A.field))}(s,e,i,o):function(l,d,g){return va(l.precondition,d)?(d.convertToNoDocument(d.version).setHasLocalMutations(),null):g}(s,e,i)}function ux(s,e){let i=null;for(let o of s.fieldTransforms){let a=e.data.field(o.field),l=Eg(o.transform,a||null);l!=null&&(i===null&&(i=cs.empty()),i.set(o.field,l))}return i||null}function j_(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(o,a){return o===void 0&&a===void 0||!(!o||!a)&&yn(o,a,(l,d)=>lx(l,d))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}var Vi=class extends Sn{constructor(e,i,o,a=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}},js=class extends Sn{constructor(e,i,o,a,l=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}};function Sg(s){let e=new Map;return s.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){let o=s.data.field(i);e.set(i,o)}}),e}function $_(s,e,i){let o=new Map;Mt(s.length===i.length);for(let a=0;a<i.length;a++){let l=s[a],d=l.transform,g=e.data.field(l.field);o.set(l.field,hx(d,g,i[a]))}return o}function K_(s,e,i){let o=new Map;for(let a of s){let l=a.transform,d=i.data.field(a.field);o.set(a.field,ax(l,d,e))}return o}var Ca=class extends Sn{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Gc=class extends Sn{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Hc=class{constructor(e,i,o,a){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=a}applyToRemoteDocument(e,i){let o=i.mutationResults;for(let a=0;a<this.mutations.length;a++){let l=this.mutations[a];l.key.isEqual(e.key)&&cx(l,e,o[a])}}applyToLocalView(e,i){for(let o of this.baseMutations)o.key.isEqual(e.key)&&(i=Br(o,e,i,this.localWriteTime));for(let o of this.mutations)o.key.isEqual(e.key)&&(i=Br(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){let o=wg();return this.mutations.forEach(a=>{let l=e.get(a.key),d=l.overlayedDocument,g=this.applyToLocalView(d,l.mutatedFields);g=i.has(a.key)?null:g;let m=Ig(d,g);m!==null&&o.set(a.key,m),d.isValidDocument()||d.convertToNoDocument(dt.min())}),o}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),mt())}isEqual(e){return this.batchId===e.batchId&&yn(this.mutations,e.mutations,(i,o)=>j_(i,o))&&yn(this.baseMutations,e.baseMutations,(i,o)=>j_(i,o))}},Wc=class s{constructor(e,i,o,a){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=a}static from(e,i,o){Mt(e.mutations.length===o.length);let a=function(){return sx}(),l=e.mutations;for(let d=0;d<l.length;d++)a=a.insert(l[d].key,o[d].version);return new s(e,i,o,a)}};var qc=class{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var jc=class{constructor(e,i){this.count=e,this.unchangedNames=i}};var Yt,wt;function dx(s){switch(s){default:return ht();case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0}}function Pg(s){if(s===void 0)return Ws("GRPC error has no .code"),L.UNKNOWN;switch(s){case Yt.OK:return L.OK;case Yt.CANCELLED:return L.CANCELLED;case Yt.UNKNOWN:return L.UNKNOWN;case Yt.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case Yt.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case Yt.INTERNAL:return L.INTERNAL;case Yt.UNAVAILABLE:return L.UNAVAILABLE;case Yt.UNAUTHENTICATED:return L.UNAUTHENTICATED;case Yt.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case Yt.NOT_FOUND:return L.NOT_FOUND;case Yt.ALREADY_EXISTS:return L.ALREADY_EXISTS;case Yt.PERMISSION_DENIED:return L.PERMISSION_DENIED;case Yt.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case Yt.ABORTED:return L.ABORTED;case Yt.OUT_OF_RANGE:return L.OUT_OF_RANGE;case Yt.UNIMPLEMENTED:return L.UNIMPLEMENTED;case Yt.DATA_LOSS:return L.DATA_LOSS;default:return ht()}}(wt=Yt||(Yt={}))[wt.OK=0]="OK",wt[wt.CANCELLED=1]="CANCELLED",wt[wt.UNKNOWN=2]="UNKNOWN",wt[wt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wt[wt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wt[wt.NOT_FOUND=5]="NOT_FOUND",wt[wt.ALREADY_EXISTS=6]="ALREADY_EXISTS",wt[wt.PERMISSION_DENIED=7]="PERMISSION_DENIED",wt[wt.UNAUTHENTICATED=16]="UNAUTHENTICATED",wt[wt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wt[wt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wt[wt.ABORTED=10]="ABORTED",wt[wt.OUT_OF_RANGE=11]="OUT_OF_RANGE",wt[wt.UNIMPLEMENTED=12]="UNIMPLEMENTED",wt[wt.INTERNAL=13]="INTERNAL",wt[wt.UNAVAILABLE=14]="UNAVAILABLE",wt[wt.DATA_LOSS=15]="DATA_LOSS";var Q_=null;function fx(){return new TextEncoder}var px=new Pi([4294967295,4294967295],0);function X_(s){let e=fx().encode(s),i=new B_;return i.update(e),new Uint8Array(i.digest())}function Y_(s){let e=new DataView(s.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new Pi([i,o],0),new Pi([a,l],0)]}var $c=class s{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new Di(`Invalid padding: ${i}`);if(o<0)throw new Di(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new Di(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new Di(`Invalid padding when bitmap length is 0: ${i}`);this.Te=8*e.length-i,this.Ee=Pi.fromNumber(this.Te)}de(e,i,o){let a=e.add(i.multiply(Pi.fromNumber(o)));return a.compare(px)===1&&(a=new Pi([a.getBits(0),a.getBits(1)],0)),a.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let i=X_(e),[o,a]=Y_(i);for(let l=0;l<this.hashCount;l++){let d=this.de(o,a,l);if(!this.Ae(d))return!1}return!0}static create(e,i,o){let a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),d=new s(l,a,i);return o.forEach(g=>d.insert(g)),d}insert(e){if(this.Te===0)return;let i=X_(e),[o,a]=Y_(i);for(let l=0;l<this.hashCount;l++){let d=this.de(o,a,l);this.Re(d)}}Re(e){let i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}},Di=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ia=class s{constructor(e,i,o,a,l){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,i,o){let a=new Map;return a.set(e,Ur.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new s(dt.min(),a,new Gt(Tt),qs(),mt())}},Ur=class s{constructor(e,i,o,a,l){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new s(o,i,mt(),mt(),mt())}};var mn=class{constructor(e,i,o,a){this.Ve=e,this.removedTargetIds=i,this.key=o,this.me=a}},Sa=class{constructor(e,i){this.targetId=e,this.fe=i}},Pa=class{constructor(e,i,o=Se.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=a}},Ra=class{constructor(){this.ge=0,this.pe=J_(),this.ye=Se.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=mt(),i=mt(),o=mt();return this.pe.forEach((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:i=i.add(a);break;case 1:o=o.add(a);break;default:ht()}}),new Ur(this.ye,this.we,e,i,o)}Fe(){this.Se=!1,this.pe=J_()}Me(e,i){this.Se=!0,this.pe=this.pe.insert(e,i)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1}Be(){this.Se=!0,this.we=!0}},Kc=class{constructor(e){this.Le=e,this.ke=new Map,this.qe=qs(),this.Qe=Z_(),this.Ke=new Gt(Tt)}$e(e){for(let i of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(i,e.me):this.We(i,e.key,e.me);for(let i of e.removedTargetIds)this.We(i,e.key,e.me)}Ge(e){this.forEachTarget(e,i=>{let o=this.ze(i);switch(e.state){case 0:this.je(i)&&o.Ce(e.resumeToken);break;case 1:o.Ne(),o.be||o.Fe(),o.Ce(e.resumeToken);break;case 2:o.Ne(),o.be||this.removeTarget(i);break;case 3:this.je(i)&&(o.Be(),o.Ce(e.resumeToken));break;case 4:this.je(i)&&(this.He(i),o.Ce(e.resumeToken));break;default:ht()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.ke.forEach((o,a)=>{this.je(a)&&i(a)})}Je(e){let i=e.targetId,o=e.fe.count,a=this.Ye(i);if(a){let l=a.target;if(Oc(l))if(o===0){let d=new it(l.path);this.We(i,d,us.newNoDocument(d,dt.min()))}else Mt(o===1);else{let d=this.Ze(i);if(d!==o){let g=this.Xe(e),m=g?this.et(g,e,d):1;if(m!==0){this.He(i);let y=m===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,y)}Q_?.tt(function(x,A,T,P,B){var H,W,j,at,ct,xt;let tt={localCacheCount:x,existenceFilterCount:A.count,databaseId:T.database,projectId:T.projectId},nt=A.unchangedNames;return nt&&(tt.bloomFilter={applied:B===0,hashCount:(H=nt?.hashCount)!==null&&H!==void 0?H:0,bitmapLength:(at=(j=(W=nt?.bits)===null||W===void 0?void 0:W.bitmap)===null||j===void 0?void 0:j.length)!==null&&at!==void 0?at:0,padding:(xt=(ct=nt?.bits)===null||ct===void 0?void 0:ct.padding)!==null&&xt!==void 0?xt:0,mightContain:bt=>{var Oe;return(Oe=P?.mightContain(bt))!==null&&Oe!==void 0&&Oe}}),tt}(d,e.fe,this.Le.nt(),g,m))}}}}Xe(e){let i=e.fe.unchangedNames;if(!i||!i.bits)return null;let{bits:{bitmap:o="",padding:a=0},hashCount:l=0}=i,d,g;try{d=ni(o).toUint8Array()}catch(m){if(m instanceof Ea)return vn("Decoding the base64 bloom filter in existence filter failed ("+m.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw m}try{g=new $c(d,a,l)}catch(m){return vn(m instanceof Di?"BloomFilter error: ":"Applying bloom filter failed: ",m),null}return g.Te===0?null:g}et(e,i,o){return i.fe.count===o-this.rt(e,i.targetId)?0:2}rt(e,i){let o=this.Le.getRemoteKeysForTarget(i),a=0;return o.forEach(l=>{let d=this.Le.nt(),g=`projects/${d.projectId}/databases/${d.database}/documents/${l.path.canonicalString()}`;e.mightContain(g)||(this.We(i,l,null),a++)}),a}it(e){let i=new Map;this.ke.forEach((l,d)=>{let g=this.Ye(d);if(g){if(l.current&&Oc(g.target)){let m=new it(g.target.path);this.qe.get(m)!==null||this.st(d,m)||this.We(d,m,us.newNoDocument(m,e))}l.De&&(i.set(d,l.ve()),l.Fe())}});let o=mt();this.Qe.forEach((l,d)=>{let g=!0;d.forEachWhile(m=>{let y=this.Ye(m);return!y||y.purpose==="TargetPurposeLimboResolution"||(g=!1,!1)}),g&&(o=o.add(l))}),this.qe.forEach((l,d)=>d.setReadTime(e));let a=new Ia(e,i,this.Ke,this.qe,o);return this.qe=qs(),this.Qe=Z_(),this.Ke=new Gt(Tt),a}Ue(e,i){if(!this.je(e))return;let o=this.st(e,i.key)?2:0;this.ze(e).Me(i.key,o),this.qe=this.qe.insert(i.key,i),this.Qe=this.Qe.insert(i.key,this.ot(i.key).add(e))}We(e,i,o){if(!this.je(e))return;let a=this.ze(e);this.st(e,i)?a.Me(i,1):a.xe(i),this.Qe=this.Qe.insert(i,this.ot(i).delete(e)),o&&(this.qe=this.qe.insert(i,o))}removeTarget(e){this.ke.delete(e)}Ze(e){let i=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let i=this.ke.get(e);return i||(i=new Ra,this.ke.set(e,i)),i}ot(e){let i=this.Qe.get(e);return i||(i=new we(Tt),this.Qe=this.Qe.insert(e,i)),i}je(e){let i=this.Ye(e)!==null;return i||X("WatchChangeAggregator","Detected inactive target",e),i}Ye(e){let i=this.ke.get(e);return i&&i.be?null:this.Le._t(e)}He(e){this.ke.set(e,new Ra),this.Le.getRemoteKeysForTarget(e).forEach(i=>{this.We(e,i,null)})}st(e,i){return this.Le.getRemoteKeysForTarget(e).has(i)}};function Z_(){return new Gt(it.comparator)}function J_(){return new Gt(it.comparator)}var _x=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),gx=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),mx=(()=>({and:"AND",or:"OR"}))(),Qc=class{constructor(e,i){this.databaseId=e,this.useProto3Json=i}};function Xc(s,e){return s.useProto3Json||Ka(e)?e:{value:e}}function Da(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Rg(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function vx(s,e){return Da(s,e.toTimestamp())}function Rs(s){return Mt(!!s),dt.fromTimestamp(function(i){let o=ii(i);return new pe(o.seconds,o.nanos)}(s))}function nd(s,e){return function(o){return new Jt(["projects",o.projectId,"databases",o.database])}(s).child("documents").child(e).canonicalString()}function Dg(s){let e=Jt.fromString(s);return Mt(Bg(e)),e}function Yc(s,e){return nd(s.databaseId,e.path)}function pc(s,e){let i=Dg(e);if(i.get(1)!==s.databaseId.projectId)throw new J(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+s.databaseId.projectId);if(i.get(3)!==s.databaseId.database)throw new J(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+s.databaseId.database);return new it(kg(i))}function Zc(s,e){return nd(s.databaseId,e)}function yx(s){let e=Dg(s);return e.length===4?Jt.emptyPath():kg(e)}function Jc(s){return new Jt(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function kg(s){return Mt(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function tg(s,e,i){return{name:Yc(s,e),fields:i.value.mapValue.fields}}function wx(s,e){let i;if("targetChange"in e){e.targetChange;let o=function(y){return y==="NO_CHANGE"?0:y==="ADD"?1:y==="REMOVE"?2:y==="CURRENT"?3:y==="RESET"?4:ht()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=function(y,x){return y.useProto3Json?(Mt(x===void 0||typeof x=="string"),Se.fromBase64String(x||"")):(Mt(x===void 0||x instanceof Uint8Array),Se.fromUint8Array(x||new Uint8Array))}(s,e.targetChange.resumeToken),d=e.targetChange.cause,g=d&&function(y){let x=y.code===void 0?L.UNKNOWN:Pg(y.code);return new J(x,y.message||"")}(d);i=new Pa(o,a,l,g||null)}else if("documentChange"in e){e.documentChange;let o=e.documentChange;o.document,o.document.name,o.document.updateTime;let a=pc(s,o.document.name),l=Rs(o.document.updateTime),d=o.document.createTime?Rs(o.document.createTime):dt.min(),g=new cs({mapValue:{fields:o.document.fields}}),m=us.newFoundDocument(a,l,d,g),y=o.targetIds||[],x=o.removedTargetIds||[];i=new mn(y,x,m.key,m)}else if("documentDelete"in e){e.documentDelete;let o=e.documentDelete;o.document;let a=pc(s,o.document),l=o.readTime?Rs(o.readTime):dt.min(),d=us.newNoDocument(a,l),g=o.removedTargetIds||[];i=new mn([],g,d.key,d)}else if("documentRemove"in e){e.documentRemove;let o=e.documentRemove;o.document;let a=pc(s,o.document),l=o.removedTargetIds||[];i=new mn([],l,a,null)}else{if(!("filter"in e))return ht();{e.filter;let o=e.filter;o.targetId;let{count:a=0,unchangedNames:l}=o,d=new jc(a,l),g=o.targetId;i=new Sa(g,d)}}return i}function xx(s,e){let i;if(e instanceof Vi)i={update:tg(s,e.key,e.value)};else if(e instanceof Ca)i={delete:Yc(s,e.key)};else if(e instanceof js)i={update:tg(s,e.key,e.data),updateMask:Rx(e.fieldMask)};else{if(!(e instanceof Gc))return ht();i={verify:Yc(s,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(o=>function(l,d){let g=d.transform;if(g instanceof Cn)return{fieldPath:d.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(g instanceof Li)return{fieldPath:d.field.canonicalString(),appendMissingElements:{values:g.elements}};if(g instanceof Ni)return{fieldPath:d.field.canonicalString(),removeAllFromArray:{values:g.elements}};if(g instanceof In)return{fieldPath:d.field.canonicalString(),increment:g.Ie};throw ht()}(0,o))),e.precondition.isNone||(i.currentDocument=function(a,l){return l.updateTime!==void 0?{updateTime:vx(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:ht()}(s,e.precondition)),i}function bx(s,e){return s&&s.length>0?(Mt(e!==void 0),s.map(i=>function(a,l){let d=a.updateTime?Rs(a.updateTime):Rs(l);return d.isEqual(dt.min())&&(d=Rs(l)),new zc(d,a.transformResults||[])}(i,e))):[]}function Ex(s,e){return{documents:[Zc(s,e.path)]}}function Tx(s,e){let i={structuredQuery:{}},o=e.path;e.collectionGroup!==null?(i.parent=Zc(s,o),i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i.parent=Zc(s,o.popLast()),i.structuredQuery.from=[{collectionId:o.lastSegment()}]);let a=function(m){if(m.length!==0)return Fg(ks.create(m,"and"))}(e.filters);a&&(i.structuredQuery.where=a);let l=function(m){if(m.length!==0)return m.map(y=>function(A){return{field:pn(A.field),direction:Ix(A.dir)}}(y))}(e.orderBy);l&&(i.structuredQuery.orderBy=l);let d=Xc(s,e.limit);return d!==null&&(i.structuredQuery.limit=d),e.startAt&&(i.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),i}function Ax(s){let e=yx(s.parent),i=s.structuredQuery,o=i.from?i.from.length:0,a=null;if(o>0){Mt(o===1);let x=i.from[0];x.allDescendants?a=x.collectionId:e=e.child(x.collectionId)}let l=[];i.where&&(l=function(A){let T=Mg(A);return T instanceof ks&&dg(T)?T.getFilters():[T]}(i.where));let d=[];i.orderBy&&(d=function(A){return A.map(T=>function(B){return new En(_n(B.field),function(W){switch(W){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(B.direction))}(T))}(i.orderBy));let g=null;i.limit&&(g=function(A){let T;return T=typeof A=="object"?A.value:A,Ka(T)?null:T}(i.limit));let m=null;i.startAt&&(m=function(A){let T=!!A.before,P=A.values||[];return new bn(P,T)}(i.startAt));let y=null;return i.endAt&&(y=function(A){let T=!A.before,P=A.values||[];return new bn(P,T)}(i.endAt)),Xw(e,a,d,l,g,"F",m,y)}function Cx(s,e){let i=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ht()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Mg(s){return s.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":let o=_n(i.unaryFilter.field);return se.create(o,"==",{doubleValue:NaN});case"IS_NULL":let a=_n(i.unaryFilter.field);return se.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let l=_n(i.unaryFilter.field);return se.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let d=_n(i.unaryFilter.field);return se.create(d,"!=",{nullValue:"NULL_VALUE"});default:return ht()}}(s):s.fieldFilter!==void 0?function(i){return se.create(_n(i.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ht()}}(i.fieldFilter.op),i.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(i){return ks.create(i.compositeFilter.filters.map(o=>Mg(o)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return ht()}}(i.compositeFilter.op))}(s):ht()}function Ix(s){return _x[s]}function Sx(s){return gx[s]}function Px(s){return mx[s]}function pn(s){return{fieldPath:s.canonicalString()}}function _n(s){return Ke.fromServerFormat(s.fieldPath)}function Fg(s){return s instanceof se?function(i){if(i.op==="=="){if(U_(i.value))return{unaryFilter:{field:pn(i.field),op:"IS_NAN"}};if(O_(i.value))return{unaryFilter:{field:pn(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(U_(i.value))return{unaryFilter:{field:pn(i.field),op:"IS_NOT_NAN"}};if(O_(i.value))return{unaryFilter:{field:pn(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pn(i.field),op:Sx(i.op),value:i.value}}}(s):s instanceof ks?function(i){let o=i.getFilters().map(a=>Fg(a));return o.length===1?o[0]:{compositeFilter:{op:Px(i.op),filters:o}}}(s):ht()}function Rx(s){let e=[];return s.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function Bg(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}var zr=class s{constructor(e,i,o,a,l=dt.min(),d=dt.min(),g=Se.EMPTY_BYTE_STRING,m=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=d,this.resumeToken=g,this.expectedCount=m}withSequenceNumber(e){return new s(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new s(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var tu=class{constructor(e){this.ut=e}};function Dx(s){let e=Ax({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Uc(e,e.limit,"L"):e}var ka=class{constructor(){}ht(e,i){this.Pt(e,i),i.It()}Pt(e,i){if("nullValue"in e)this.Tt(i,5);else if("booleanValue"in e)this.Tt(i,10),i.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(i,15),i.Et(zt(e.integerValue));else if("doubleValue"in e){let o=zt(e.doubleValue);isNaN(o)?this.Tt(i,13):(this.Tt(i,15),Nr(o)?i.Et(0):i.Et(o))}else if("timestampValue"in e){let o=e.timestampValue;this.Tt(i,20),typeof o=="string"?i.dt(o):(i.dt(`${o.seconds||""}`),i.Et(o.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,i),this.Rt(i);else if("bytesValue"in e)this.Tt(i,30),i.Vt(ni(e.bytesValue)),this.Rt(i);else if("referenceValue"in e)this.ft(e.referenceValue,i);else if("geoPointValue"in e){let o=e.geoPointValue;this.Tt(i,45),i.Et(o.latitude||0),i.Et(o.longitude||0)}else"mapValue"in e?lg(e)?this.Tt(i,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,i),this.Rt(i)):"arrayValue"in e?(this.yt(e.arrayValue,i),this.Rt(i)):ht()}At(e,i){this.Tt(i,25),this.wt(e,i)}wt(e,i){i.dt(e)}gt(e,i){let o=e.fields||{};this.Tt(i,55);for(let a of Object.keys(o))this.At(a,i),this.Pt(o[a],i)}yt(e,i){let o=e.values||[];this.Tt(i,50);for(let a of o)this.Pt(a,i)}ft(e,i){this.Tt(i,37),it.fromName(e).path.forEach(o=>{this.Tt(i,60),this.wt(o,i)})}Tt(e,i){e.Et(i)}Rt(e){e.Et(2)}};ka.St=new ka;var eu=class{constructor(){this.on=new su}addToCollectionParentIndex(e,i){return this.on.add(i),U.resolve()}getCollectionParents(e,i){return U.resolve(this.on.getEntries(i))}addFieldIndex(e,i){return U.resolve()}deleteFieldIndex(e,i){return U.resolve()}deleteAllFieldIndexes(e){return U.resolve()}createTargetIndexes(e,i){return U.resolve()}getDocumentsMatchingTarget(e,i){return U.resolve(null)}getIndexType(e,i){return U.resolve(0)}getFieldIndexes(e,i){return U.resolve([])}getNextCollectionGroupToUpdate(e){return U.resolve(null)}getMinOffset(e,i){return U.resolve(Fi.min())}getMinOffsetFromCollectionGroup(e,i){return U.resolve(Fi.min())}updateCollectionGroup(e,i,o){return U.resolve()}updateIndexEntries(e,i){return U.resolve()}},su=class{constructor(){this.index={}}add(e){let i=e.lastSegment(),o=e.popLast(),a=this.index[i]||new we(Jt.comparator),l=!a.has(o);return this.index[i]=a.add(o),l}has(e){let i=e.lastSegment(),o=e.popLast(),a=this.index[i];return a&&a.has(o)}getEntries(e){return(this.index[e]||new we(Jt.comparator)).toArray()}};var eS=new Uint8Array(0);var As=class s{constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}static withCacheSize(e){return new s(e,s.DEFAULT_COLLECTION_PERCENTILE,s.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};As.DEFAULT_COLLECTION_PERCENTILE=10,As.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,As.DEFAULT=new As(41943040,As.DEFAULT_COLLECTION_PERCENTILE,As.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),As.DISABLED=new As(-1,0,0);var Gr=class s{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new s(0)}static Nn(){return new s(-1)}};var iu=class{constructor(){this.changes=new ri(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,us.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();let o=this.changes.get(i);return o!==void 0?U.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var nu=class{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}};var ru=class{constructor(e,i,o,a){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=a}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next(a=>(o=a,this.remoteDocumentCache.getEntry(e,i))).next(a=>(o!==null&&Br(o.mutation,a,Cs.empty(),pe.now()),a))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.getLocalViewOfDocuments(e,o,mt()).next(()=>o))}getLocalViewOfDocuments(e,i,o=mt()){let a=Ri();return this.populateOverlays(e,a,i).next(()=>this.computeViews(e,i,a,o).next(l=>{let d=Dr();return l.forEach((g,m)=>{d=d.insert(g,m.overlayedDocument)}),d}))}getOverlayedDocuments(e,i){let o=Ri();return this.populateOverlays(e,o,i).next(()=>this.computeViews(e,i,o,mt()))}populateOverlays(e,i,o){let a=[];return o.forEach(l=>{i.has(l)||a.push(l)}),this.documentOverlayCache.getOverlays(e,a).next(l=>{l.forEach((d,g)=>{i.set(d,g)})})}computeViews(e,i,o,a){let l=qs(),d=Fr(),g=function(){return Fr()}();return i.forEach((m,y)=>{let x=o.get(y.key);a.has(y.key)&&(x===void 0||x.mutation instanceof js)?l=l.insert(y.key,y):x!==void 0?(d.set(y.key,x.mutation.getFieldMask()),Br(x.mutation,y,x.mutation.getFieldMask(),pe.now())):d.set(y.key,Cs.empty())}),this.recalculateAndSaveOverlays(e,l).next(m=>(m.forEach((y,x)=>d.set(y,x)),i.forEach((y,x)=>{var A;return g.set(y,new nu(x,(A=d.get(y))!==null&&A!==void 0?A:null))}),g))}recalculateAndSaveOverlays(e,i){let o=Fr(),a=new Gt((d,g)=>d-g),l=mt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(d=>{for(let g of d)g.keys().forEach(m=>{let y=i.get(m);if(y===null)return;let x=o.get(m)||Cs.empty();x=g.applyToLocalView(y,x),o.set(m,x);let A=(a.get(g.batchId)||mt()).add(m);a=a.insert(g.batchId,A)})}).next(()=>{let d=[],g=a.getReverseIterator();for(;g.hasNext();){let m=g.getNext(),y=m.key,x=m.value,A=wg();x.forEach(T=>{if(!l.has(T)){let P=Ig(i.get(T),o.get(T));P!==null&&A.set(T,P),l=l.add(T)}}),d.push(this.documentOverlayCache.saveOverlays(e,y,A))}return U.waitFor(d)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,i,o,a){return function(d){return it.isDocumentKey(d.path)&&d.collectionGroup===null&&d.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):Yw(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,a):this.getDocumentsMatchingCollectionQuery(e,i,o,a)}getNextDocuments(e,i,o,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,a).next(l=>{let d=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,a-l.size):U.resolve(Ri()),g=-1,m=l;return d.next(y=>U.forEach(y,(x,A)=>(g<A.largestBatchId&&(g=A.largestBatchId),l.get(x)?U.resolve():this.remoteDocumentCache.getEntry(e,x).next(T=>{m=m.insert(x,T)}))).next(()=>this.populateOverlays(e,y,l)).next(()=>this.computeViews(e,m,y,mt())).next(x=>({batchId:g,changes:yg(x)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new it(i)).next(o=>{let a=Dr();return o.isFoundDocument()&&(a=a.insert(o.key,o)),a})}getDocumentsMatchingCollectionGroupQuery(e,i,o,a){let l=i.collectionGroup,d=Dr();return this.indexManager.getCollectionParents(e,l).next(g=>U.forEach(g,m=>{let y=function(A,T){return new Tn(T,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(i,m.child(l));return this.getDocumentsMatchingCollectionQuery(e,y,o,a).next(x=>{x.forEach((A,T)=>{d=d.insert(A,T)})})}).next(()=>d))}getDocumentsMatchingCollectionQuery(e,i,o,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next(d=>(l=d,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,l,a))).next(d=>{l.forEach((m,y)=>{let x=y.getKey();d.get(x)===null&&(d=d.insert(x,us.newInvalidDocument(x)))});let g=Dr();return d.forEach((m,y)=>{let x=l.get(m);x!==void 0&&Br(x.mutation,y,Cs.empty(),pe.now()),Xa(i,y)&&(g=g.insert(m,y))}),g})}};var ou=class{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,i){return U.resolve(this.ur.get(i))}saveBundleMetadata(e,i){return this.ur.set(i.id,function(a){return{id:a.id,version:a.version,createTime:Rs(a.createTime)}}(i)),U.resolve()}getNamedQuery(e,i){return U.resolve(this.cr.get(i))}saveNamedQuery(e,i){return this.cr.set(i.name,function(a){return{name:a.name,query:Dx(a.bundledQuery),readTime:Rs(a.readTime)}}(i)),U.resolve()}};var au=class{constructor(){this.overlays=new Gt(it.comparator),this.lr=new Map}getOverlay(e,i){return U.resolve(this.overlays.get(i))}getOverlays(e,i){let o=Ri();return U.forEach(i,a=>this.getOverlay(e,a).next(l=>{l!==null&&o.set(a,l)})).next(()=>o)}saveOverlays(e,i,o){return o.forEach((a,l)=>{this.lt(e,i,l)}),U.resolve()}removeOverlaysForBatchId(e,i,o){let a=this.lr.get(o);return a!==void 0&&(a.forEach(l=>this.overlays=this.overlays.remove(l)),this.lr.delete(o)),U.resolve()}getOverlaysForCollection(e,i,o){let a=Ri(),l=i.length+1,d=new it(i.child("")),g=this.overlays.getIteratorFrom(d);for(;g.hasNext();){let m=g.getNext().value,y=m.getKey();if(!i.isPrefixOf(y.path))break;y.path.length===l&&m.largestBatchId>o&&a.set(m.getKey(),m)}return U.resolve(a)}getOverlaysForCollectionGroup(e,i,o,a){let l=new Gt((y,x)=>y-x),d=this.overlays.getIterator();for(;d.hasNext();){let y=d.getNext().value;if(y.getKey().getCollectionGroup()===i&&y.largestBatchId>o){let x=l.get(y.largestBatchId);x===null&&(x=Ri(),l=l.insert(y.largestBatchId,x)),x.set(y.getKey(),y)}}let g=Ri(),m=l.getIterator();for(;m.hasNext()&&(m.getNext().value.forEach((y,x)=>g.set(y,x)),!(g.size()>=a)););return U.resolve(g)}lt(e,i,o){let a=this.overlays.get(o.key);if(a!==null){let d=this.lr.get(a.largestBatchId).delete(o.key);this.lr.set(a.largestBatchId,d)}this.overlays=this.overlays.insert(o.key,new qc(i,o));let l=this.lr.get(i);l===void 0&&(l=mt(),this.lr.set(i,l)),this.lr.set(i,l.add(o.key))}};var Hr=class{constructor(){this.hr=new we(Zt.Pr),this.Ir=new we(Zt.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,i){let o=new Zt(e,i);this.hr=this.hr.add(o),this.Ir=this.Ir.add(o)}Er(e,i){e.forEach(o=>this.addReference(o,i))}removeReference(e,i){this.dr(new Zt(e,i))}Ar(e,i){e.forEach(o=>this.removeReference(o,i))}Rr(e){let i=new it(new Jt([])),o=new Zt(i,e),a=new Zt(i,e+1),l=[];return this.Ir.forEachInRange([o,a],d=>{this.dr(d),l.push(d.key)}),l}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){let i=new it(new Jt([])),o=new Zt(i,e),a=new Zt(i,e+1),l=mt();return this.Ir.forEachInRange([o,a],d=>{l=l.add(d.key)}),l}containsKey(e){let i=new Zt(e,0),o=this.hr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}},Zt=class{constructor(e,i){this.key=e,this.gr=i}static Pr(e,i){return it.comparator(e.key,i.key)||Tt(e.gr,i.gr)}static Tr(e,i){return Tt(e.gr,i.gr)||it.comparator(e.key,i.key)}};var hu=class{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.pr=1,this.yr=new we(Zt.Pr)}checkEmpty(e){return U.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,a){let l=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let d=new Hc(l,i,o,a);this.mutationQueue.push(d);for(let g of a)this.yr=this.yr.add(new Zt(g.key,l)),this.indexManager.addToCollectionParentIndex(e,g.key.path.popLast());return U.resolve(d)}lookupMutationBatch(e,i){return U.resolve(this.wr(i))}getNextMutationBatchAfterBatchId(e,i){let o=i+1,a=this.Sr(o),l=a<0?0:a;return U.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return U.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return U.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){let o=new Zt(i,0),a=new Zt(i,Number.POSITIVE_INFINITY),l=[];return this.yr.forEachInRange([o,a],d=>{let g=this.wr(d.gr);l.push(g)}),U.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new we(Tt);return i.forEach(a=>{let l=new Zt(a,0),d=new Zt(a,Number.POSITIVE_INFINITY);this.yr.forEachInRange([l,d],g=>{o=o.add(g.gr)})}),U.resolve(this.br(o))}getAllMutationBatchesAffectingQuery(e,i){let o=i.path,a=o.length+1,l=o;it.isDocumentKey(l)||(l=l.child(""));let d=new Zt(new it(l),0),g=new we(Tt);return this.yr.forEachWhile(m=>{let y=m.key.path;return!!o.isPrefixOf(y)&&(y.length===a&&(g=g.add(m.gr)),!0)},d),U.resolve(this.br(g))}br(e){let i=[];return e.forEach(o=>{let a=this.wr(o);a!==null&&i.push(a)}),i}removeMutationBatch(e,i){Mt(this.Dr(i.batchId,"removed")===0),this.mutationQueue.shift();let o=this.yr;return U.forEach(i.mutations,a=>{let l=new Zt(a.key,i.batchId);return o=o.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.yr=o})}Fn(e){}containsKey(e,i){let o=new Zt(i,0),a=this.yr.firstAfterOrEqual(o);return U.resolve(i.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,U.resolve()}Dr(e,i){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){let i=this.Sr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}};var lu=class{constructor(e){this.Cr=e,this.docs=function(){return new Gt(it.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){let o=i.key,a=this.docs.get(o),l=a?a.size:0,d=this.Cr(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:d}),this.size+=d-l,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){let i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){let o=this.docs.get(i);return U.resolve(o?o.document.mutableCopy():us.newInvalidDocument(i))}getEntries(e,i){let o=qs();return i.forEach(a=>{let l=this.docs.get(a);o=o.insert(a,l?l.document.mutableCopy():us.newInvalidDocument(a))}),U.resolve(o)}getDocumentsMatchingQuery(e,i,o,a){let l=qs(),d=i.path,g=new it(d.child("")),m=this.docs.getIteratorFrom(g);for(;m.hasNext();){let{key:y,value:{document:x}}=m.getNext();if(!d.isPrefixOf(y.path))break;y.path.length>d.length+1||zw(Uw(x),o)<=0||(a.has(x.key)||Xa(i,x))&&(l=l.insert(x.key,x.mutableCopy()))}return U.resolve(l)}getAllFromCollectionGroup(e,i,o,a){ht()}vr(e,i){return U.forEach(this.docs,o=>i(o))}newChangeBuffer(e){return new cu(this)}getSize(e){return U.resolve(this.size)}},cu=class extends iu{constructor(e){super(),this._r=e}applyChanges(e){let i=[];return this.changes.forEach((o,a)=>{a.isValidDocument()?i.push(this._r.addEntry(e,a)):this._r.removeEntry(o)}),U.waitFor(i)}getFromCache(e,i){return this._r.getEntry(e,i)}getAllFromCache(e,i){return this._r.getEntries(e,i)}};var uu=class{constructor(e){this.persistence=e,this.Fr=new ri(i=>ed(i),sd),this.lastRemoteSnapshotVersion=dt.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Hr,this.targetCount=0,this.Nr=Gr.On()}forEachTarget(e,i){return this.Fr.forEach((o,a)=>i(a)),U.resolve()}getLastRemoteSnapshotVersion(e){return U.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return U.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),U.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.Mr&&(this.Mr=i),U.resolve()}kn(e){this.Fr.set(e.target,e);let i=e.targetId;i>this.highestTargetId&&(this.Nr=new Gr(i),this.highestTargetId=i),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,i){return this.kn(i),this.targetCount+=1,U.resolve()}updateTargetData(e,i){return this.kn(i),U.resolve()}removeTargetData(e,i){return this.Fr.delete(i.target),this.Or.Rr(i.targetId),this.targetCount-=1,U.resolve()}removeTargets(e,i,o){let a=0,l=[];return this.Fr.forEach((d,g)=>{g.sequenceNumber<=i&&o.get(g.targetId)===null&&(this.Fr.delete(d),l.push(this.removeMatchingKeysForTargetId(e,g.targetId)),a++)}),U.waitFor(l).next(()=>a)}getTargetCount(e){return U.resolve(this.targetCount)}getTargetData(e,i){let o=this.Fr.get(i)||null;return U.resolve(o)}addMatchingKeys(e,i,o){return this.Or.Er(i,o),U.resolve()}removeMatchingKeys(e,i,o){this.Or.Ar(i,o);let a=this.persistence.referenceDelegate,l=[];return a&&i.forEach(d=>{l.push(a.markPotentiallyOrphaned(e,d))}),U.waitFor(l)}removeMatchingKeysForTargetId(e,i){return this.Or.Rr(i),U.resolve()}getMatchingKeysForTargetId(e,i){let o=this.Or.mr(i);return U.resolve(o)}containsKey(e,i){return U.resolve(this.Or.containsKey(i))}};var du=class{constructor(e,i){this.Br={},this.overlays={},this.Lr=new Lr(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new uu(this),this.indexManager=new eu,this.remoteDocumentCache=function(a){return new lu(a)}(o=>this.referenceDelegate.Qr(o)),this.serializer=new tu(i),this.Kr=new ou(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new au,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.Br[e.toKey()];return o||(o=new hu(i,this.referenceDelegate),this.Br[e.toKey()]=o),o}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,i,o){X("MemoryPersistence","Starting transaction:",e);let a=new fu(this.Lr.next());return this.referenceDelegate.$r(),o(a).next(l=>this.referenceDelegate.Ur(a).next(()=>l)).toPromise().then(l=>(a.raiseOnCommittedEvent(),l))}Wr(e,i){return U.or(Object.values(this.Br).map(o=>()=>o.containsKey(e,i)))}},fu=class extends Cc{constructor(e){super(),this.currentSequenceNumber=e}},pu=class s{constructor(e){this.persistence=e,this.Gr=new Hr,this.zr=null}static jr(e){return new s(e)}get Hr(){if(this.zr)return this.zr;throw ht()}addReference(e,i,o){return this.Gr.addReference(o,i),this.Hr.delete(o.toString()),U.resolve()}removeReference(e,i,o){return this.Gr.removeReference(o,i),this.Hr.add(o.toString()),U.resolve()}markPotentiallyOrphaned(e,i){return this.Hr.add(i.toString()),U.resolve()}removeTarget(e,i){this.Gr.Rr(i.targetId).forEach(a=>this.Hr.add(a.toString()));let o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next(a=>{a.forEach(l=>this.Hr.add(l.toString()))}).next(()=>o.removeTargetData(e,i))}$r(){this.zr=new Set}Ur(e){let i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return U.forEach(this.Hr,o=>{let a=it.fromPath(o);return this.Jr(e,a).next(l=>{l||i.removeEntry(a,dt.min())})}).next(()=>(this.zr=null,i.apply(e)))}updateLimboDocument(e,i){return this.Jr(e,i).next(o=>{o?this.Hr.delete(i.toString()):this.Hr.add(i.toString())})}Qr(e){return 0}Jr(e,i){return U.or([()=>U.resolve(this.Gr.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Wr(e,i)])}};var _u=class s{constructor(e,i,o,a){this.targetId=e,this.fromCache=i,this.ki=o,this.qi=a}static Qi(e,i){let o=mt(),a=mt();for(let l of i.docChanges)switch(l.type){case 0:o=o.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new s(e,i.fromCache,o,a)}};var gu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var mu=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,i){this.Gi=e,this.indexManager=i,this.Ki=!0}getDocumentsMatchingQuery(e,i,o,a){let l={result:null};return this.zi(e,i).next(d=>{l.result=d}).next(()=>{if(!l.result)return this.ji(e,i,a,o).next(d=>{l.result=d})}).next(()=>{if(l.result)return;let d=new gu;return this.Hi(e,i,d).next(g=>{if(l.result=g,this.$i)return this.Ji(e,i,d,g.size)})}).next(()=>l.result)}Ji(e,i,o,a){return o.documentReadCount<this.Ui?(Rr()<=yt.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",fn(i),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),U.resolve()):(Rr()<=yt.DEBUG&&X("QueryEngine","Query:",fn(i),"scans",o.documentReadCount,"local documents and returns",a,"documents as results."),o.documentReadCount>this.Wi*a?(Rr()<=yt.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",fn(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ps(i))):U.resolve())}zi(e,i){if(W_(i))return U.resolve(null);let o=Ps(i);return this.indexManager.getIndexType(e,o).next(a=>a===0?null:(i.limit!==null&&a===1&&(i=Uc(i,null,"F"),o=Ps(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next(l=>{let d=mt(...l);return this.Gi.getDocuments(e,d).next(g=>this.indexManager.getMinOffset(e,o).next(m=>{let y=this.Yi(i,g);return this.Zi(i,y,d,m.readTime)?this.zi(e,Uc(i,null,"F")):this.Xi(e,y,i,m)}))})))}ji(e,i,o,a){return W_(i)||a.isEqual(dt.min())?U.resolve(null):this.Gi.getDocuments(e,o).next(l=>{let d=this.Yi(i,l);return this.Zi(i,d,o,a)?U.resolve(null):(Rr()<=yt.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),fn(i)),this.Xi(e,d,i,Ow(a,-1)).next(g=>g))})}Yi(e,i){let o=new we(mg(e));return i.forEach((a,l)=>{Xa(e,l)&&(o=o.add(l))}),o}Zi(e,i,o,a){if(e.limit===null)return!1;if(o.size!==i.size)return!0;let l=e.limitType==="F"?i.last():i.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}Hi(e,i,o){return Rr()<=yt.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",fn(i)),this.Gi.getDocumentsMatchingQuery(e,i,Fi.min(),o)}Xi(e,i,o,a){return this.Gi.getDocumentsMatchingQuery(e,o,a).next(l=>(i.forEach(d=>{l=l.insert(d.key,d)}),l))}};var vu=class{constructor(e,i,o,a){this.persistence=e,this.es=i,this.serializer=a,this.ts=new Gt(Tt),this.ns=new ri(l=>ed(l),sd),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(o)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ru(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.ts))}};function kx(s,e,i,o){return new vu(s,e,i,o)}async function Lg(s,e){let i=ft(s);return await i.persistence.runTransaction("Handle user change","readonly",o=>{let a;return i.mutationQueue.getAllMutationBatches(o).next(l=>(a=l,i.os(e),i.mutationQueue.getAllMutationBatches(o))).next(l=>{let d=[],g=[],m=mt();for(let y of a){d.push(y.batchId);for(let x of y.mutations)m=m.add(x.key)}for(let y of l){g.push(y.batchId);for(let x of y.mutations)m=m.add(x.key)}return i.localDocuments.getDocuments(o,m).next(y=>({_s:y,removedBatchIds:d,addedBatchIds:g}))})})}function Mx(s,e){let i=ft(s);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{let a=e.batch.keys(),l=i.ss.newChangeBuffer({trackRemovals:!0});return function(g,m,y,x){let A=y.batch,T=A.keys(),P=U.resolve();return T.forEach(B=>{P=P.next(()=>x.getEntry(m,B)).next(H=>{let W=y.docVersions.get(B);Mt(W!==null),H.version.compareTo(W)<0&&(A.applyToRemoteDocument(H,y),H.isValidDocument()&&(H.setReadTime(y.commitVersion),x.addEntry(H)))})}),P.next(()=>g.mutationQueue.removeMutationBatch(m,A))}(i,o,e,l).next(()=>l.apply(o)).next(()=>i.mutationQueue.performConsistencyCheck(o)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(o,a,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(g){let m=mt();for(let y=0;y<g.mutationResults.length;++y)g.mutationResults[y].transformResults.length>0&&(m=m.add(g.batch.mutations[y].key));return m}(e))).next(()=>i.localDocuments.getDocuments(o,a))})}function Ng(s){let e=ft(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.qr.getLastRemoteSnapshotVersion(i))}function Fx(s,e){let i=ft(s),o=e.snapshotVersion,a=i.ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",l=>{let d=i.ss.newChangeBuffer({trackRemovals:!0});a=i.ts;let g=[];e.targetChanges.forEach((x,A)=>{let T=a.get(A);if(!T)return;g.push(i.qr.removeMatchingKeys(l,x.removedDocuments,A).next(()=>i.qr.addMatchingKeys(l,x.addedDocuments,A)));let P=T.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(A)!==null?P=P.withResumeToken(Se.EMPTY_BYTE_STRING,dt.min()).withLastLimboFreeSnapshotVersion(dt.min()):x.resumeToken.approximateByteSize()>0&&(P=P.withResumeToken(x.resumeToken,o)),a=a.insert(A,P),function(H,W,j){return H.resumeToken.approximateByteSize()===0||W.snapshotVersion.toMicroseconds()-H.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(T,P,x)&&g.push(i.qr.updateTargetData(l,P))});let m=qs(),y=mt();if(e.documentUpdates.forEach(x=>{e.resolvedLimboDocuments.has(x)&&g.push(i.persistence.referenceDelegate.updateLimboDocument(l,x))}),g.push(Bx(l,d,e.documentUpdates).next(x=>{m=x.us,y=x.cs})),!o.isEqual(dt.min())){let x=i.qr.getLastRemoteSnapshotVersion(l).next(A=>i.qr.setTargetsMetadata(l,l.currentSequenceNumber,o));g.push(x)}return U.waitFor(g).next(()=>d.apply(l)).next(()=>i.localDocuments.getLocalViewOfDocuments(l,m,y)).next(()=>m)}).then(l=>(i.ts=a,l))}function Bx(s,e,i){let o=mt(),a=mt();return i.forEach(l=>o=o.add(l)),e.getEntries(s,o).next(l=>{let d=qs();return i.forEach((g,m)=>{let y=l.get(g);m.isFoundDocument()!==y.isFoundDocument()&&(a=a.add(g)),m.isNoDocument()&&m.version.isEqual(dt.min())?(e.removeEntry(g,m.readTime),d=d.insert(g,m)):!y.isValidDocument()||m.version.compareTo(y.version)>0||m.version.compareTo(y.version)===0&&y.hasPendingWrites?(e.addEntry(m),d=d.insert(g,m)):X("LocalStore","Ignoring outdated watch update for ",g,". Current version:",y.version," Watch version:",m.version)}),{us:d,cs:a}})}function Lx(s,e){let i=ft(s);return i.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function Nx(s,e){let i=ft(s);return i.persistence.runTransaction("Allocate target","readwrite",o=>{let a;return i.qr.getTargetData(o,e).next(l=>l?(a=l,U.resolve(a)):i.qr.allocateTargetId(o).next(d=>(a=new zr(e,d,"TargetPurposeListen",o.currentSequenceNumber),i.qr.addTargetData(o,a).next(()=>a))))}).then(o=>{let a=i.ts.get(o.targetId);return(a===null||o.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(i.ts=i.ts.insert(o.targetId,o),i.ns.set(e,o.targetId)),o})}async function yu(s,e,i){let o=ft(s),a=o.ts.get(e),l=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",l,d=>o.persistence.referenceDelegate.removeTarget(d,a))}catch(d){if(!Zr(d))throw d;X("LocalStore",`Failed to update sequence numbers for target ${e}: ${d}`)}o.ts=o.ts.remove(e),o.ns.delete(a.target)}function eg(s,e,i){let o=ft(s),a=dt.min(),l=mt();return o.persistence.runTransaction("Execute query","readwrite",d=>function(m,y,x){let A=ft(m),T=A.ns.get(x);return T!==void 0?U.resolve(A.ts.get(T)):A.qr.getTargetData(y,x)}(o,d,Ps(e)).next(g=>{if(g)return a=g.lastLimboFreeSnapshotVersion,o.qr.getMatchingKeysForTargetId(d,g.targetId).next(m=>{l=m})}).next(()=>o.es.getDocumentsMatchingQuery(d,e,i?a:dt.min(),i?l:mt())).next(g=>(Vx(o,Jw(e),g),{documents:g,ls:l})))}function Vx(s,e,i){let o=s.rs.get(e)||dt.min();i.forEach((a,l)=>{l.readTime.compareTo(o)>0&&(o=l.readTime)}),s.rs.set(e,o)}var Ma=class{constructor(){this.activeTargetIds=rx()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var wu=class{constructor(){this.eo=new Ma,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,i,o){this.no[e]=i}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Ma,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var xu=class{ro(e){}shutdown(){}};var Fa=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){X("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ao)e(0)}_o(){X("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ga=null;function _c(){return ga===null?ga=function(){return 268435456+Math.round(2147483648*Math.random())}():ga++,"0x"+ga.toString(16)}var Ox={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var bu=class{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}};var ye="WebChannelConnection",Eu=class extends class{constructor(i){this.databaseInfo=i,this.databaseId=i.databaseId;let o=i.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.mo=o+"://"+i.host,this.fo=`projects/${a}/databases/${l}`,this.po=this.databaseId.database==="(default)"?`project_id=${a}`:`project_id=${a}&database_id=${l}`}get yo(){return!1}wo(i,o,a,l,d){let g=_c(),m=this.So(i,o);X("RestConnection",`Sending RPC '${i}' ${g}:`,m,a);let y={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(y,l,d),this.Do(i,m,y,a).then(x=>(X("RestConnection",`Received RPC '${i}' ${g}: `,x),x),x=>{throw vn("RestConnection",`RPC '${i}' ${g} failed with error: `,x,"url: ",m,"request:",a),x})}Co(i,o,a,l,d,g){return this.wo(i,o,a,l,d)}bo(i,o,a){i["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Rn}(),i["Content-Type"]="text/plain",this.databaseInfo.appId&&(i["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach((l,d)=>i[d]=l),a&&a.headers.forEach((l,d)=>i[d]=l)}So(i,o){let a=Ox[i];return`${this.mo}/v1/${o}:${a}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,i,o,a){let l=_c();return new Promise((d,g)=>{let m=new F_;m.setWithCredentials(!0),m.listenOnce(D_.COMPLETE,()=>{try{switch(m.getLastErrorCode()){case pa.NO_ERROR:let x=m.getResponseJson();X(ye,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(x)),d(x);break;case pa.TIMEOUT:X(ye,`RPC '${e}' ${l} timed out`),g(new J(L.DEADLINE_EXCEEDED,"Request time out"));break;case pa.HTTP_ERROR:let A=m.getStatus();if(X(ye,`RPC '${e}' ${l} failed with status:`,A,"response text:",m.getResponseText()),A>0){let T=m.getResponseJson();Array.isArray(T)&&(T=T[0]);let P=T?.error;if(P&&P.status&&P.message){let B=function(W){let j=W.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(j)>=0?j:L.UNKNOWN}(P.status);g(new J(B,P.message))}else g(new J(L.UNKNOWN,"Server responded with status "+m.getStatus()))}else g(new J(L.UNAVAILABLE,"Connection failed."));break;default:ht()}}finally{X(ye,`RPC '${e}' ${l} completed.`)}});let y=JSON.stringify(a);X(ye,`RPC '${e}' ${l} sending request:`,a),m.send(i,"POST",y,o,15)})}vo(e,i,o){let a=_c(),l=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],d=P_(),g=R_(),m={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},y=this.longPollingOptions.timeoutSeconds;y!==void 0&&(m.longPollingTimeout=Math.round(1e3*y)),this.useFetchStreams&&(m.xmlHttpFactory=new M_({})),this.bo(m.initMessageHeaders,i,o),m.encodeInitMessageHeaders=!0;let x=l.join("");X(ye,`Creating RPC '${e}' stream ${a}: ${x}`,m);let A=d.createWebChannel(x,m),T=!1,P=!1,B=new bu({co:W=>{P?X(ye,`Not sending because RPC '${e}' stream ${a} is closed:`,W):(T||(X(ye,`Opening RPC '${e}' stream ${a} transport.`),A.open(),T=!0),X(ye,`RPC '${e}' stream ${a} sending:`,W),A.send(W))},lo:()=>A.close()}),H=(W,j,at)=>{W.listen(j,ct=>{try{at(ct)}catch(xt){setTimeout(()=>{throw xt},0)}})};return H(A,Pr.EventType.OPEN,()=>{P||X(ye,`RPC '${e}' stream ${a} transport opened.`)}),H(A,Pr.EventType.CLOSE,()=>{P||(P=!0,X(ye,`RPC '${e}' stream ${a} transport closed`),B.Ro())}),H(A,Pr.EventType.ERROR,W=>{P||(P=!0,vn(ye,`RPC '${e}' stream ${a} transport errored:`,W),B.Ro(new J(L.UNAVAILABLE,"The operation could not be completed")))}),H(A,Pr.EventType.MESSAGE,W=>{var j;if(!P){let at=W.data[0];Mt(!!at);let ct=at,xt=ct.error||((j=ct[0])===null||j===void 0?void 0:j.error);if(xt){X(ye,`RPC '${e}' stream ${a} received error:`,xt);let tt=xt.status,nt=function($s){let xe=Yt[$s];if(xe!==void 0)return Pg(xe)}(tt),bt=xt.message;nt===void 0&&(nt=L.INTERNAL,bt="Unknown error status: "+tt+" with message "+xt.message),P=!0,B.Ro(new J(nt,bt)),A.close()}else X(ye,`RPC '${e}' stream ${a} received:`,at),B.Vo(at)}}),H(g,k_.STAT_EVENT,W=>{W.stat===fc.PROXY?X(ye,`RPC '${e}' stream ${a} detected buffering proxy`):W.stat===fc.NOPROXY&&X(ye,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{B.Ao()},0),B}};function gc(){return typeof document<"u"?document:null}function Ya(s){return new Qc(s,!0)}var Ba=class{constructor(e,i,o=1e3,a=1.5,l=6e4){this.si=e,this.timerId=i,this.Fo=o,this.Mo=a,this.xo=l,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();let i=Math.floor(this.Oo+this.qo()),o=Math.max(0,Date.now()-this.Bo),a=Math.max(0,i-o);a>0&&X("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Oo} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,a,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}};var La=class{constructor(e,i,o,a,l,d,g,m){this.si=e,this.Ko=o,this.$o=a,this.connection=l,this.authCredentialsProvider=d,this.appCheckCredentialsProvider=g,this.listener=m,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new Ba(e,i)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,i){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,e!==4?this.zo.reset():i&&i.code===L.RESOURCE_EXHAUSTED?(Ws(i.toString()),Ws("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):i&&i.code===L.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(i)}r_(){}auth(){this.state=1;let e=this.i_(this.Uo),i=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,a])=>{this.Uo===i&&this.s_(o,a)},o=>{e(()=>{let a=new J(L.UNKNOWN,"Fetching auth token failed: "+o.message);return this.o_(a)})})}s_(e,i){let o=this.i_(this.Uo);this.stream=this.__(e,i),this.stream.ho(()=>{o(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(a=>{o(()=>this.o_(a))}),this.stream.onMessage(a=>{o(()=>this.onMessage(a))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return X("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return i=>{this.si.enqueueAndForget(()=>this.Uo===e?i():(X("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Tu=class extends La{constructor(e,i,o,a,l,d){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,a,d),this.serializer=l}__(e,i){return this.connection.vo("Listen",e,i)}onMessage(e){this.zo.reset();let i=wx(this.serializer,e),o=function(l){if(!("targetChange"in l))return dt.min();let d=l.targetChange;return d.targetIds&&d.targetIds.length?dt.min():d.readTime?Rs(d.readTime):dt.min()}(e);return this.listener.a_(i,o)}u_(e){let i={};i.database=Jc(this.serializer),i.addTarget=function(l,d){let g,m=d.target;if(g=Oc(m)?{documents:Ex(l,m)}:{query:Tx(l,m)},g.targetId=d.targetId,d.resumeToken.approximateByteSize()>0){g.resumeToken=Rg(l,d.resumeToken);let y=Xc(l,d.expectedCount);y!==null&&(g.expectedCount=y)}else if(d.snapshotVersion.compareTo(dt.min())>0){g.readTime=Da(l,d.snapshotVersion.toTimestamp());let y=Xc(l,d.expectedCount);y!==null&&(g.expectedCount=y)}return g}(this.serializer,e);let o=Cx(this.serializer,e);o&&(i.labels=o),this.e_(i)}c_(e){let i={};i.database=Jc(this.serializer),i.removeTarget=e,this.e_(i)}},Au=class extends La{constructor(e,i,o,a,l,d){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,a,d),this.serializer=l,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,i){return this.connection.vo("Write",e,i)}onMessage(e){if(Mt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();let i=bx(e.writeResults,e.commitTime),o=Rs(e.commitTime);return this.listener.I_(o,i)}return Mt(!e.writeResults||e.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){let e={};e.database=Jc(this.serializer),this.e_(e)}P_(e){let i={streamToken:this.lastStreamToken,writes:e.map(o=>xx(this.serializer,o))};this.e_(i)}};var Cu=class extends class{}{constructor(e,i,o,a){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=a,this.d_=!1}A_(){if(this.d_)throw new J(L.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,i,o){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.wo(e,i,o,a,l)).catch(a=>{throw a.name==="FirebaseError"?(a.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new J(L.UNKNOWN,a.toString())})}Co(e,i,o,a){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,d])=>this.connection.Co(e,i,o,l,d,a)).catch(l=>{throw l.name==="FirebaseError"?(l.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new J(L.UNKNOWN,l.toString())})}terminate(){this.d_=!0}};var Iu=class{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,e==="Online"&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){let i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Ws(i),this.f_=!1):X("OnlineStateTracker",i)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}};var Su=class{constructor(e,i,o,a,l){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=l,this.F_.ro(d=>{o.enqueueAndForget(async()=>{Oi(this)&&(X("RemoteStore","Restarting streams for network reachability change."),await async function(m){let y=ft(m);y.C_.add(4),await Jr(y),y.M_.set("Unknown"),y.C_.delete(4),await Za(y)}(this))})}),this.M_=new Iu(o,a)}};async function Za(s){if(Oi(s))for(let e of s.v_)await e(!0)}async function Jr(s){for(let e of s.v_)await e(!1)}function Vg(s,e){let i=ft(s);i.D_.has(e.targetId)||(i.D_.set(e.targetId,e),ad(i)?od(i):kn(i).Ho()&&rd(i,e))}function Og(s,e){let i=ft(s),o=kn(i);i.D_.delete(e),o.Ho()&&Ug(i,e),i.D_.size===0&&(o.Ho()?o.Zo():Oi(i)&&i.M_.set("Unknown"))}function rd(s,e){if(s.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(dt.min())>0){let i=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}kn(s).u_(e)}function Ug(s,e){s.x_.Oe(e),kn(s).c_(e)}function od(s){s.x_=new Kc({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>s.D_.get(e)||null,nt:()=>s.datastore.serializer.databaseId}),kn(s).start(),s.M_.g_()}function ad(s){return Oi(s)&&!kn(s).jo()&&s.D_.size>0}function Oi(s){return ft(s).C_.size===0}function zg(s){s.x_=void 0}async function Ux(s){s.D_.forEach((e,i)=>{rd(s,e)})}async function zx(s,e){zg(s),ad(s)?(s.M_.w_(e),od(s)):s.M_.set("Unknown")}async function Gx(s,e,i){if(s.M_.set("Online"),e instanceof Pa&&e.state===2&&e.cause)try{await async function(a,l){let d=l.cause;for(let g of l.targetIds)a.D_.has(g)&&(await a.remoteSyncer.rejectListen(g,d),a.D_.delete(g),a.x_.removeTarget(g))}(s,e)}catch(o){X("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await Na(s,o)}else if(e instanceof mn?s.x_.$e(e):e instanceof Sa?s.x_.Je(e):s.x_.Ge(e),!i.isEqual(dt.min()))try{let o=await Ng(s.localStore);i.compareTo(o)>=0&&await function(l,d){let g=l.x_.it(d);return g.targetChanges.forEach((m,y)=>{if(m.resumeToken.approximateByteSize()>0){let x=l.D_.get(y);x&&l.D_.set(y,x.withResumeToken(m.resumeToken,d))}}),g.targetMismatches.forEach((m,y)=>{let x=l.D_.get(m);if(!x)return;l.D_.set(m,x.withResumeToken(Se.EMPTY_BYTE_STRING,x.snapshotVersion)),Ug(l,m);let A=new zr(x.target,m,y,x.sequenceNumber);rd(l,A)}),l.remoteSyncer.applyRemoteEvent(g)}(s,i)}catch(o){X("RemoteStore","Failed to raise snapshot:",o),await Na(s,o)}}async function Na(s,e,i){if(!Zr(e))throw e;s.C_.add(1),await Jr(s),s.M_.set("Offline"),i||(i=()=>Ng(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{X("RemoteStore","Retrying IndexedDB access"),await i(),s.C_.delete(1),await Za(s)})}function Gg(s,e){return e().catch(i=>Na(s,i,e))}async function Ja(s){let e=ft(s),i=oi(e),o=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;Hx(e);)try{let a=await Lx(e.localStore,o);if(a===null){e.b_.length===0&&i.Zo();break}o=a.batchId,Wx(e,a)}catch(a){await Na(e,a)}Hg(e)&&Wg(e)}function Hx(s){return Oi(s)&&s.b_.length<10}function Wx(s,e){s.b_.push(e);let i=oi(s);i.Ho()&&i.h_&&i.P_(e.mutations)}function Hg(s){return Oi(s)&&!oi(s).jo()&&s.b_.length>0}function Wg(s){oi(s).start()}async function qx(s){oi(s).E_()}async function jx(s){let e=oi(s);for(let i of s.b_)e.P_(i.mutations)}async function $x(s,e,i){let o=s.b_.shift(),a=Wc.from(o,e,i);await Gg(s,()=>s.remoteSyncer.applySuccessfulWrite(a)),await Ja(s)}async function Kx(s,e){e&&oi(s).h_&&await async function(o,a){if(function(d){return dx(d)&&d!==L.ABORTED}(a.code)){let l=o.b_.shift();oi(o).Yo(),await Gg(o,()=>o.remoteSyncer.rejectFailedWrite(l.batchId,a)),await Ja(o)}}(s,e),Hg(s)&&Wg(s)}async function sg(s,e){let i=ft(s);i.asyncQueue.verifyOperationInProgress(),X("RemoteStore","RemoteStore received new credentials");let o=Oi(i);i.C_.add(3),await Jr(i),o&&i.M_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.C_.delete(3),await Za(i)}async function Qx(s,e){let i=ft(s);e?(i.C_.delete(2),await Za(i)):e||(i.C_.add(2),await Jr(i),i.M_.set("Unknown"))}function kn(s){return s.O_||(s.O_=function(i,o,a){let l=ft(i);return l.A_(),new Tu(o,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)}(s.datastore,s.asyncQueue,{ho:Ux.bind(null,s),Io:zx.bind(null,s),a_:Gx.bind(null,s)}),s.v_.push(async e=>{e?(s.O_.Yo(),ad(s)?od(s):s.M_.set("Unknown")):(await s.O_.stop(),zg(s))})),s.O_}function oi(s){return s.N_||(s.N_=function(i,o,a){let l=ft(i);return l.A_(),new Au(o,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)}(s.datastore,s.asyncQueue,{ho:qx.bind(null,s),Io:Kx.bind(null,s),T_:jx.bind(null,s),I_:$x.bind(null,s)}),s.v_.push(async e=>{e?(s.N_.Yo(),await Ja(s)):(await s.N_.stop(),s.b_.length>0&&(X("RemoteStore",`Stopping write stream with ${s.b_.length} pending writes`),s.b_=[]))})),s.N_}var Pu=class s{constructor(e,i,o,a,l){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=a,this.removalCallback=l,this.deferred=new Is,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(d=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,a,l){let d=Date.now()+o,g=new s(e,i,d,a,l);return g.start(o),g}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new J(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function hd(s,e){if(Ws("AsyncQueue",`${e}: ${s}`),Zr(s))return new J(L.UNAVAILABLE,`${e}: ${s}`);throw s}var Va=class s{constructor(e){this.comparator=e?(i,o)=>e(i,o)||it.comparator(i.key,o.key):(i,o)=>it.comparator(i.key,o.key),this.keyedMap=Dr(),this.sortedSet=new Gt(this.comparator)}static emptySet(e){return new s(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,o)=>(e(i),!1))}add(e){let i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){let i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof s)||this.size!==e.size)return!1;let i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){let a=i.getNext().key,l=o.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){let e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){let o=new s;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}};var Oa=class{constructor(){this.B_=new Gt(it.comparator)}track(e){let i=e.doc.key,o=this.B_.get(i);o?e.type!==0&&o.type===3?this.B_=this.B_.insert(i,e):e.type===3&&o.type!==1?this.B_=this.B_.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.B_=this.B_.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.B_=this.B_.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.B_=this.B_.remove(i):e.type===1&&o.type===2?this.B_=this.B_.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.B_=this.B_.insert(i,{type:2,doc:e.doc}):ht():this.B_=this.B_.insert(i,e)}L_(){let e=[];return this.B_.inorderTraversal((i,o)=>{e.push(o)}),e}},Pn=class s{constructor(e,i,o,a,l,d,g,m,y){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=a,this.mutatedKeys=l,this.fromCache=d,this.syncStateChanged=g,this.excludesMetadataChanges=m,this.hasCachedResults=y}static fromInitialDocuments(e,i,o,a,l){let d=[];return i.forEach(g=>{d.push({type:0,doc:g})}),new s(e,i,Va.emptySet(i),d,o,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let a=0;a<i.length;a++)if(i[a].type!==o[a].type||!i[a].doc.isEqual(o[a].doc))return!1;return!0}};var Ru=class{constructor(){this.k_=void 0,this.listeners=[]}},Du=class{constructor(){this.queries=new ri(e=>gg(e),Qa),this.onlineState="Unknown",this.q_=new Set}};async function Xx(s,e){let i=ft(s),o=e.query,a=!1,l=i.queries.get(o);if(l||(a=!0,l=new Ru),a)try{l.k_=await i.onListen(o)}catch(d){let g=hd(d,`Initialization of query '${fn(e.query)}' failed`);return void e.onError(g)}i.queries.set(o,l),l.listeners.push(e),e.Q_(i.onlineState),l.k_&&e.K_(l.k_)&&ld(i)}async function Yx(s,e){let i=ft(s),o=e.query,a=!1,l=i.queries.get(o);if(l){let d=l.listeners.indexOf(e);d>=0&&(l.listeners.splice(d,1),a=l.listeners.length===0)}if(a)return i.queries.delete(o),i.onUnlisten(o)}function Zx(s,e){let i=ft(s),o=!1;for(let a of e){let l=a.query,d=i.queries.get(l);if(d){for(let g of d.listeners)g.K_(a)&&(o=!0);d.k_=a}}o&&ld(i)}function Jx(s,e,i){let o=ft(s),a=o.queries.get(e);if(a)for(let l of a.listeners)l.onError(i);o.queries.delete(e)}function ld(s){s.q_.forEach(e=>{e.next()})}var ku=class{constructor(e,i,o){this.query=e,this.U_=i,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=o||{}}K_(e){if(!this.options.includeMetadataChanges){let o=[];for(let a of e.docChanges)a.type!==3&&o.push(a);e=new Pn(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.W_?this.z_(e)&&(this.U_.next(e),i=!0):this.j_(e,this.onlineState)&&(this.H_(e),i=!0),this.G_=e,i}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let i=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),i=!0),i}j_(e,i){if(!e.fromCache)return!0;let o=i!=="Offline";return(!this.options.J_||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}z_(e){if(e.docChanges.length>0)return!0;let i=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}H_(e){e=Pn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}};var Ua=class{constructor(e){this.key=e}},za=class{constructor(e){this.key=e}},Mu=class{constructor(e,i){this.query=e,this.ia=i,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=mt(),this.mutatedKeys=mt(),this._a=mg(e),this.aa=new Va(this._a)}get ua(){return this.ia}ca(e,i){let o=i?i.la:new Oa,a=i?i.aa:this.aa,l=i?i.mutatedKeys:this.mutatedKeys,d=a,g=!1,m=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,y=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((x,A)=>{let T=a.get(x),P=Xa(this.query,A)?A:null,B=!!T&&this.mutatedKeys.has(T.key),H=!!P&&(P.hasLocalMutations||this.mutatedKeys.has(P.key)&&P.hasCommittedMutations),W=!1;T&&P?T.data.isEqual(P.data)?B!==H&&(o.track({type:3,doc:P}),W=!0):this.ha(T,P)||(o.track({type:2,doc:P}),W=!0,(m&&this._a(P,m)>0||y&&this._a(P,y)<0)&&(g=!0)):!T&&P?(o.track({type:0,doc:P}),W=!0):T&&!P&&(o.track({type:1,doc:T}),W=!0,(m||y)&&(g=!0)),W&&(P?(d=d.add(P),l=H?l.add(x):l.delete(x)):(d=d.delete(x),l=l.delete(x)))}),this.query.limit!==null)for(;d.size>this.query.limit;){let x=this.query.limitType==="F"?d.last():d.first();d=d.delete(x.key),l=l.delete(x.key),o.track({type:1,doc:x})}return{aa:d,la:o,Zi:g,mutatedKeys:l}}ha(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o){let a=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;let l=e.la.L_();l.sort((y,x)=>function(T,P){let B=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ht()}};return B(T)-B(P)}(y.type,x.type)||this._a(y.doc,x.doc)),this.Pa(o);let d=i?this.Ia():[],g=this.oa.size===0&&this.current?1:0,m=g!==this.sa;return this.sa=g,l.length!==0||m?{snapshot:new Pn(this.query,e.aa,a,l,e.mutatedKeys,g===0,m,!1,!!o&&o.resumeToken.approximateByteSize()>0),Ta:d}:{Ta:d}}Q_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new Oa,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(i=>this.ia=this.ia.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.ia=this.ia.delete(i)),this.current=e.current)}Ia(){if(!this.current)return[];let e=this.oa;this.oa=mt(),this.aa.forEach(o=>{this.Ea(o.key)&&(this.oa=this.oa.add(o.key))});let i=[];return e.forEach(o=>{this.oa.has(o)||i.push(new za(o))}),this.oa.forEach(o=>{e.has(o)||i.push(new Ua(o))}),i}da(e){this.ia=e.ls,this.oa=mt();let i=this.ca(e.documents);return this.applyChanges(i,!0)}Aa(){return Pn.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}},Fu=class{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}},Bu=class{constructor(e){this.key=e,this.Ra=!1}},Lu=class{constructor(e,i,o,a,l,d){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=d,this.Va={},this.ma=new ri(g=>gg(g),Qa),this.fa=new Map,this.ga=new Set,this.pa=new Gt(it.comparator),this.ya=new Map,this.wa=new Hr,this.Sa={},this.ba=new Map,this.Da=Gr.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}};async function t0(s,e){let i=c0(s),o,a,l=i.ma.get(e);if(l)o=l.targetId,i.sharedClientState.addLocalQueryTarget(o),a=l.view.Aa();else{let d=await Nx(i.localStore,Ps(e)),g=i.sharedClientState.addLocalQueryTarget(d.targetId);o=d.targetId,a=await e0(i,e,o,g==="current",d.resumeToken),i.isPrimaryClient&&Vg(i.remoteStore,d)}return a}async function e0(s,e,i,o,a){s.va=(A,T,P)=>async function(H,W,j,at){let ct=W.view.ca(j);ct.Zi&&(ct=await eg(H.localStore,W.query,!1).then(({documents:nt})=>W.view.ca(nt,ct)));let xt=at&&at.targetChanges.get(W.targetId),tt=W.view.applyChanges(ct,H.isPrimaryClient,xt);return ng(H,W.targetId,tt.Ta),tt.snapshot}(s,A,T,P);let l=await eg(s.localStore,e,!0),d=new Mu(e,l.ls),g=d.ca(l.documents),m=Ur.createSynthesizedTargetChangeForCurrentChange(i,o&&s.onlineState!=="Offline",a),y=d.applyChanges(g,s.isPrimaryClient,m);ng(s,i,y.Ta);let x=new Fu(e,i,d);return s.ma.set(e,x),s.fa.has(i)?s.fa.get(i).push(e):s.fa.set(i,[e]),y.snapshot}async function s0(s,e){let i=ft(s),o=i.ma.get(e),a=i.fa.get(o.targetId);if(a.length>1)return i.fa.set(o.targetId,a.filter(l=>!Qa(l,e))),void i.ma.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(o.targetId),i.sharedClientState.isActiveQueryTarget(o.targetId)||await yu(i.localStore,o.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(o.targetId),Og(i.remoteStore,o.targetId),Nu(i,o.targetId)}).catch(Yr)):(Nu(i,o.targetId),await yu(i.localStore,o.targetId,!0))}async function i0(s,e,i){let o=u0(s);try{let a=await function(d,g){let m=ft(d),y=pe.now(),x=g.reduce((P,B)=>P.add(B.key),mt()),A,T;return m.persistence.runTransaction("Locally write mutations","readwrite",P=>{let B=qs(),H=mt();return m.ss.getEntries(P,x).next(W=>{B=W,B.forEach((j,at)=>{at.isValidDocument()||(H=H.add(j))})}).next(()=>m.localDocuments.getOverlayedDocuments(P,B)).next(W=>{A=W;let j=[];for(let at of g){let ct=ux(at,A.get(at.key).overlayedDocument);ct!=null&&j.push(new js(at.key,ct,cg(ct.value.mapValue),ki.exists(!0)))}return m.mutationQueue.addMutationBatch(P,y,j,g)}).next(W=>{T=W;let j=W.applyToLocalDocumentSet(A,H);return m.documentOverlayCache.saveOverlays(P,W.batchId,j)})}).then(()=>({batchId:T.batchId,changes:yg(A)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(a.batchId),function(d,g,m){let y=d.Sa[d.currentUser.toKey()];y||(y=new Gt(Tt)),y=y.insert(g,m),d.Sa[d.currentUser.toKey()]=y}(o,a.batchId,i),await to(o,a.changes),await Ja(o.remoteStore)}catch(a){let l=hd(a,"Failed to persist write");i.reject(l)}}async function qg(s,e){let i=ft(s);try{let o=await Fx(i.localStore,e);e.targetChanges.forEach((a,l)=>{let d=i.ya.get(l);d&&(Mt(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?d.Ra=!0:a.modifiedDocuments.size>0?Mt(d.Ra):a.removedDocuments.size>0&&(Mt(d.Ra),d.Ra=!1))}),await to(i,o,e)}catch(o){await Yr(o)}}function ig(s,e,i){let o=ft(s);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){let a=[];o.ma.forEach((l,d)=>{let g=d.view.Q_(e);g.snapshot&&a.push(g.snapshot)}),function(d,g){let m=ft(d);m.onlineState=g;let y=!1;m.queries.forEach((x,A)=>{for(let T of A.listeners)T.Q_(g)&&(y=!0)}),y&&ld(m)}(o.eventManager,e),a.length&&o.Va.a_(a),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function n0(s,e,i){let o=ft(s);o.sharedClientState.updateQueryState(e,"rejected",i);let a=o.ya.get(e),l=a&&a.key;if(l){let d=new Gt(it.comparator);d=d.insert(l,us.newNoDocument(l,dt.min()));let g=mt().add(l),m=new Ia(dt.min(),new Map,new Gt(Tt),d,g);await qg(o,m),o.pa=o.pa.remove(l),o.ya.delete(e),cd(o)}else await yu(o.localStore,e,!1).then(()=>Nu(o,e,i)).catch(Yr)}async function r0(s,e){let i=ft(s),o=e.batch.batchId;try{let a=await Mx(i.localStore,e);$g(i,o,null),jg(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await to(i,a)}catch(a){await Yr(a)}}async function o0(s,e,i){let o=ft(s);try{let a=await function(d,g){let m=ft(d);return m.persistence.runTransaction("Reject batch","readwrite-primary",y=>{let x;return m.mutationQueue.lookupMutationBatch(y,g).next(A=>(Mt(A!==null),x=A.keys(),m.mutationQueue.removeMutationBatch(y,A))).next(()=>m.mutationQueue.performConsistencyCheck(y)).next(()=>m.documentOverlayCache.removeOverlaysForBatchId(y,x,g)).next(()=>m.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(y,x)).next(()=>m.localDocuments.getDocuments(y,x))})}(o.localStore,e);$g(o,e,i),jg(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await to(o,a)}catch(a){await Yr(a)}}function jg(s,e){(s.ba.get(e)||[]).forEach(i=>{i.resolve()}),s.ba.delete(e)}function $g(s,e,i){let o=ft(s),a=o.Sa[o.currentUser.toKey()];if(a){let l=a.get(e);l&&(i?l.reject(i):l.resolve(),a=a.remove(e)),o.Sa[o.currentUser.toKey()]=a}}function Nu(s,e,i=null){s.sharedClientState.removeLocalQueryTarget(e);for(let o of s.fa.get(e))s.ma.delete(o),i&&s.Va.Fa(o,i);s.fa.delete(e),s.isPrimaryClient&&s.wa.Rr(e).forEach(o=>{s.wa.containsKey(o)||Kg(s,o)})}function Kg(s,e){s.ga.delete(e.path.canonicalString());let i=s.pa.get(e);i!==null&&(Og(s.remoteStore,i),s.pa=s.pa.remove(e),s.ya.delete(i),cd(s))}function ng(s,e,i){for(let o of i)o instanceof Ua?(s.wa.addReference(o.key,e),a0(s,o)):o instanceof za?(X("SyncEngine","Document no longer in limbo: "+o.key),s.wa.removeReference(o.key,e),s.wa.containsKey(o.key)||Kg(s,o.key)):ht()}function a0(s,e){let i=e.key,o=i.path.canonicalString();s.pa.get(i)||s.ga.has(o)||(X("SyncEngine","New document in limbo: "+i),s.ga.add(o),cd(s))}function cd(s){for(;s.ga.size>0&&s.pa.size<s.maxConcurrentLimboResolutions;){let e=s.ga.values().next().value;s.ga.delete(e);let i=new it(Jt.fromString(e)),o=s.Da.next();s.ya.set(o,new Bu(i)),s.pa=s.pa.insert(i,o),Vg(s.remoteStore,new zr(Ps(id(i.path)),o,"TargetPurposeLimboResolution",Lr._e))}}async function to(s,e,i){let o=ft(s),a=[],l=[],d=[];o.ma.isEmpty()||(o.ma.forEach((g,m)=>{d.push(o.va(m,e,i).then(y=>{if((y||i)&&o.isPrimaryClient&&o.sharedClientState.updateQueryState(m.targetId,y?.fromCache?"not-current":"current"),y){a.push(y);let x=_u.Qi(m.targetId,y);l.push(x)}}))}),await Promise.all(d),o.Va.a_(a),await async function(m,y){let x=ft(m);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>U.forEach(y,T=>U.forEach(T.ki,P=>x.persistence.referenceDelegate.addReference(A,T.targetId,P)).next(()=>U.forEach(T.qi,P=>x.persistence.referenceDelegate.removeReference(A,T.targetId,P)))))}catch(A){if(!Zr(A))throw A;X("LocalStore","Failed to update sequence numbers: "+A)}for(let A of y){let T=A.targetId;if(!A.fromCache){let P=x.ts.get(T),B=P.snapshotVersion,H=P.withLastLimboFreeSnapshotVersion(B);x.ts=x.ts.insert(T,H)}}}(o.localStore,l))}async function h0(s,e){let i=ft(s);if(!i.currentUser.isEqual(e)){X("SyncEngine","User change. New user:",e.toKey());let o=await Lg(i.localStore,e);i.currentUser=e,function(l,d){l.ba.forEach(g=>{g.forEach(m=>{m.reject(new J(L.CANCELLED,d))})}),l.ba.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await to(i,o._s)}}function l0(s,e){let i=ft(s),o=i.ya.get(e);if(o&&o.Ra)return mt().add(o.key);{let a=mt(),l=i.fa.get(e);if(!l)return a;for(let d of l){let g=i.ma.get(d);a=a.unionWith(g.view.ua)}return a}}function c0(s){let e=ft(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=qg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=l0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=n0.bind(null,e),e.Va.a_=Zx.bind(null,e.eventManager),e.Va.Fa=Jx.bind(null,e.eventManager),e}function u0(s){let e=ft(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=r0.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=o0.bind(null,e),e}var Ga=class{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Ya(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,i){return null}createIndexBackfillerScheduler(e,i){return null}createLocalStore(e){return kx(this.persistence,new mu,e.initialUser,this.serializer)}createPersistence(e){return new du(pu.jr,this.serializer)}createSharedClientState(e){return new wu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}};var Vu=class{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>ig(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=h0.bind(null,this.syncEngine),await Qx(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Du}()}createDatastore(e){let i=Ya(e.databaseInfo.databaseId),o=function(l){return new Eu(l)}(e.databaseInfo);return function(l,d,g,m){return new Cu(l,d,g,m)}(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return function(o,a,l,d,g){return new Su(o,a,l,d,g)}(this.localStore,this.datastore,e.asyncQueue,i=>ig(this.syncEngine,i,0),function(){return Fa.D()?new Fa:new xu}())}createSyncEngine(e,i){return function(a,l,d,g,m,y,x){let A=new Lu(a,l,d,g,m,y);return x&&(A.Ca=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}terminate(){return async function(i){let o=ft(i);X("RemoteStore","RemoteStore shutting down."),o.C_.add(5),await Jr(o),o.F_.shutdown(),o.M_.set("Unknown")}(this.remoteStore)}};var Ou=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):Ws("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,i){this.muted||setTimeout(()=>{this.muted||e(i)},0)}};var Uu=class{constructor(e,i,o,a){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=a,this.user=ae.UNAUTHENTICATED,this.clientId=wa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(o,async l=>{X("FirestoreClient","Received user=",l.uid),await this.authCredentialListener(l),this.user=l}),this.appCheckCredentials.start(o,l=>(X("FirestoreClient","Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new J(L.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Is;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){let o=hd(i,"Failed to shutdown persistence");e.reject(o)}}),e.promise}};async function mc(s,e){s.asyncQueue.verifyOperationInProgress(),X("FirestoreClient","Initializing OfflineComponentProvider");let i=await s.getConfiguration();await e.initialize(i);let o=i.initialUser;s.setCredentialChangeListener(async a=>{o.isEqual(a)||(await Lg(e.localStore,a),o=a)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function rg(s,e){s.asyncQueue.verifyOperationInProgress();let i=await f0(s);X("FirestoreClient","Initializing OnlineComponentProvider");let o=await s.getConfiguration();await e.initialize(i,o),s.setCredentialChangeListener(a=>sg(e.remoteStore,a)),s.setAppCheckTokenChangeListener((a,l)=>sg(e.remoteStore,l)),s._onlineComponents=e}function d0(s){return s.name==="FirebaseError"?s.code===L.FAILED_PRECONDITION||s.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}async function f0(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){X("FirestoreClient","Using user provided OfflineComponentProvider");try{await mc(s,s._uninitializedComponentsProvider._offline)}catch(e){let i=e;if(!d0(i))throw i;vn("Error using user provided cache. Falling back to memory cache: "+i),await mc(s,new Ga)}}else X("FirestoreClient","Using default OfflineComponentProvider"),await mc(s,new Ga);return s._offlineComponents}async function Qg(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(X("FirestoreClient","Using user provided OnlineComponentProvider"),await rg(s,s._uninitializedComponentsProvider._online)):(X("FirestoreClient","Using default OnlineComponentProvider"),await rg(s,new Vu))),s._onlineComponents}function p0(s){return Qg(s).then(e=>e.syncEngine)}async function _0(s){let e=await Qg(s),i=e.eventManager;return i.onListen=t0.bind(null,e.syncEngine),i.onUnlisten=s0.bind(null,e.syncEngine),i}function g0(s,e,i={}){let o=new Is;return s.asyncQueue.enqueueAndForget(async()=>function(l,d,g,m,y){let x=new Ou({next:T=>{d.enqueueAndForget(()=>Yx(l,A));let P=T.docs.has(g);!P&&T.fromCache?y.reject(new J(L.UNAVAILABLE,"Failed to get document because the client is offline.")):P&&T.fromCache&&m&&m.source==="server"?y.reject(new J(L.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):y.resolve(T)},error:T=>y.reject(T)}),A=new ku(id(g.path),x,{includeMetadataChanges:!0,J_:!0});return Xx(l,A)}(await _0(s),s.asyncQueue,e,i,o)),o.promise}function Xg(s){let e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}var og=new Map;function m0(s,e,i){if(!i)throw new J(L.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function v0(s,e,i,o){if(e===!0&&o===!0)throw new J(L.INVALID_ARGUMENT,`${s} and ${i} cannot be used together.`)}function ag(s){if(!it.isDocumentKey(s))throw new J(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function ud(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{let e=function(o){return o.constructor?o.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":ht()}function Wr(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new J(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let i=ud(s);throw new J(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return s}var Ha=class{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new J(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(i=e.ssl)===null||i===void 0||i;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new J(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}v0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Xg((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(l){if(l.timeoutSeconds!==void 0){if(isNaN(l.timeoutSeconds))throw new J(L.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (must not be NaN)`);if(l.timeoutSeconds<5)throw new J(L.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (minimum allowed value is 5)`);if(l.timeoutSeconds>30)throw new J(L.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,a){return o.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},qr=class{constructor(e,i,o,a){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ha({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new J(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new J(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ha(e),e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new vc;switch(o.type){case"firstParty":return new bc(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new J(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){let o=og.get(i);o&&(X("ComponentProvider","Removing Datastore"),og.delete(i),o.terminate())}(this),Promise.resolve()}};function y0(s,e,i,o={}){var a;let l=(s=Wr(s,qr))._getSettings(),d=`${e}:${i}`;if(l.host!=="firestore.googleapis.com"&&l.host!==d&&vn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},l),{host:d,ssl:!1})),o.mockUserToken){let g,m;if(typeof o.mockUserToken=="string")g=o.mockUserToken,m=ae.MOCK_USER;else{g=Yf(o.mockUserToken,(a=s._app)===null||a===void 0?void 0:a.options.projectId);let y=o.mockUserToken.sub||o.mockUserToken.user_id;if(!y)throw new J(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new ae(y)}s._authCredentials=new yc(new ya(g,m))}}var zu=class s{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new s(this.firestore,e,this._query)}},Je=class s{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new s(this.firestore,e,this._key)}},jr=class s extends zu{constructor(e,i,o){super(e,i,id(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Je(this.firestore,null,new it(e))}withConverter(e){return new s(this.firestore,e,this._path)}};function eo(s,e,...i){if(s=nr(s),arguments.length===1&&(e=wa.newId()),m0("doc","path",e),s instanceof qr){let o=Jt.fromString(e,...i);return ag(o),new Je(s,null,new it(o))}{if(!(s instanceof Je||s instanceof jr))throw new J(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let o=s._path.child(Jt.fromString(e,...i));return ag(o),new Je(s.firestore,s instanceof jr?s.converter:null,new it(o))}}var Gu=class{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new Ba(this,"async_queue_retry"),this.iu=()=>{let i=gc();i&&X("AsyncQueue","Visibility state changed to "+i.visibilityState),this.zo.Qo()};let e=gc();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;let i=gc();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});let i=new Is;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(this.Ya.length!==0){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!Zr(e))throw e;X("AsyncQueue","Operation failed with retryable error: "+e)}this.Ya.length>0&&this.zo.ko(()=>this._u())}}ou(e){let i=this.Ja.then(()=>(this.tu=!0,e().catch(o=>{this.eu=o,this.tu=!1;let a=function(d){let g=d.message||"";return d.stack&&(g=d.stack.includes(d.message)?d.stack:d.message+`
`+d.stack),g}(o);throw Ws("INTERNAL UNHANDLED ERROR: ",a),o}).then(o=>(this.tu=!1,o))));return this.Ja=i,i}enqueueAfterDelay(e,i,o){this.su(),this.ru.indexOf(e)>-1&&(i=0);let a=Pu.createAndSchedule(this,e,i,o,l=>this.au(l));return this.Xa.push(a),a}su(){this.eu&&ht()}verifyOperationInProgress(){}async uu(){let e;do e=this.Ja,await e;while(e!==this.Ja)}cu(e){for(let i of this.Xa)if(i.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((i,o)=>i.targetTimeMs-o.targetTimeMs);for(let i of this.Xa)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){let i=this.Xa.indexOf(e);this.Xa.splice(i,1)}};var $r=class extends qr{constructor(e,i,o,a){super(e,i,o,a),this.type="firestore",this._queue=function(){return new Gu}(),this._persistenceKey=a?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Jg(this),this._firestoreClient.terminate()}};function Yg(s,e){let i=typeof s=="object"?s:dp(),o=typeof s=="string"?s:e||"(default)",a=cp(i,"firestore").getImmediate({identifier:o});if(!a._initialized){let l=Xf("firestore");l&&y0(a,...l)}return a}function Zg(s){return s._firestoreClient||Jg(s),s._firestoreClient.verifyNotTerminated(),s._firestoreClient}function Jg(s){var e,i,o;let a=s._freezeSettings(),l=function(g,m,y,x){return new Ic(g,m,y,x.host,x.ssl,x.experimentalForceLongPolling,x.experimentalAutoDetectLongPolling,Xg(x.experimentalLongPollingOptions),x.useFetchStreams)}(s._databaseId,((e=s._app)===null||e===void 0?void 0:e.options.appId)||"",s._persistenceKey,a);s._firestoreClient=new Uu(s._authCredentials,s._appCheckCredentials,s._queue,l),!((i=a.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=a.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(s._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.localCache.kind,_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider})}var Kr=class s{constructor(e){this._byteString=e}static fromBase64String(e){try{return new s(Se.fromBase64String(e))}catch(i){throw new J(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new s(Se.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Qr=class{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new J(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Wa=class{constructor(e){this._methodName=e}};var Xr=class{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new J(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new J(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Tt(this._lat,e._lat)||Tt(this._long,e._long)}};var w0=/^__.*__$/,Hu=class{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new js(e,this.data,this.fieldMask,i,this.fieldTransforms):new Vi(e,this.data,i,this.fieldTransforms)}};function tm(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ht()}}var Wu=class s{constructor(e,i,o,a,l,d){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=a,l===void 0&&this.Pu(),this.fieldTransforms=l||[],this.fieldMask=d||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new s(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var i;let o=(i=this.path)===null||i===void 0?void 0:i.child(e),a=this.Tu({path:o,du:!1});return a.Au(e),a}Ru(e){var i;let o=(i=this.path)===null||i===void 0?void 0:i.child(e),a=this.Tu({path:o,du:!1});return a.Pu(),a}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return qa(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(e.length===0)throw this.mu("Document fields must not be empty");if(tm(this.Iu)&&w0.test(e))throw this.mu('Document fields cannot begin and end with "__"')}},qu=class{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||Ya(e)}pu(e,i,o,a=!1){return new Wu({Iu:e,methodName:i,gu:o,path:Ke.emptyPath(),du:!1,fu:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function x0(s){let e=s._freezeSettings(),i=Ya(s._databaseId);return new qu(s._databaseId,!!e.ignoreUndefinedProperties,i)}function b0(s,e,i,o,a,l={}){let d=s.pu(l.merge||l.mergeFields?2:0,e,i,a);nm("Data must be an object, but it was:",d,o);let g=sm(o,d),m,y;if(l.merge)m=new Cs(d.fieldMask),y=d.fieldTransforms;else if(l.mergeFields){let x=[];for(let A of l.mergeFields){let T=E0(e,A,i);if(!d.contains(T))throw new J(L.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);A0(x,T)||x.push(T)}m=new Cs(x),y=d.fieldTransforms.filter(A=>m.covers(A.field))}else m=null,y=d.fieldTransforms;return new Hu(new cs(g),m,y)}function em(s,e){if(im(s=nr(s)))return nm("Unsupported field value:",e,s),sm(s,e);if(s instanceof Wa)return function(o,a){if(!tm(a.Iu))throw a.mu(`${o._methodName}() can only be used with update() and set()`);if(!a.path)throw a.mu(`${o._methodName}() is not currently supported inside arrays`);let l=o._toFieldTransform(a);l&&a.fieldTransforms.push(l)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.du&&e.Iu!==4)throw e.mu("Nested arrays are not supported");return function(o,a){let l=[],d=0;for(let g of o){let m=em(g,a.Vu(d));m==null&&(m={nullValue:"NULL_VALUE"}),l.push(m),d++}return{arrayValue:{values:l}}}(s,e)}return function(o,a){if((o=nr(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return ox(a.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){let l=pe.fromDate(o);return{timestampValue:Da(a.serializer,l)}}if(o instanceof pe){let l=new pe(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:Da(a.serializer,l)}}if(o instanceof Xr)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof Kr)return{bytesValue:Rg(a.serializer,o._byteString)};if(o instanceof Je){let l=a.databaseId,d=o.firestore._databaseId;if(!d.isEqual(l))throw a.mu(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:nd(o.firestore._databaseId||a.databaseId,o._key.path)}}throw a.mu(`Unsupported field value: ${ud(o)}`)}(s,e)}function sm(s,e){let i={};return hg(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Dn(s,(o,a)=>{let l=em(a,e.Eu(o));l!=null&&(i[o]=l)}),{mapValue:{fields:i}}}function im(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof pe||s instanceof Xr||s instanceof Kr||s instanceof Je||s instanceof Wa)}function nm(s,e,i){if(!im(i)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(i)){let o=ud(i);throw o==="an object"?e.mu(s+" a custom object"):e.mu(s+" "+o)}}function E0(s,e,i){if((e=nr(e))instanceof Qr)return e._internalPath;if(typeof e=="string")return rm(s,e);throw qa("Field path arguments must be of type string or ",s,!1,void 0,i)}var T0=new RegExp("[~\\*/\\[\\]]");function rm(s,e,i){if(e.search(T0)>=0)throw qa(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,i);try{return new Qr(...e.split("."))._internalPath}catch{throw qa(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,i)}}function qa(s,e,i,o,a){let l=o&&!o.isEmpty(),d=a!==void 0,g=`Function ${e}() called with invalid data`;i&&(g+=" (via `toFirestore()`)"),g+=". ";let m="";return(l||d)&&(m+=" (found",l&&(m+=` in field ${o}`),d&&(m+=` in document ${a}`),m+=")"),new J(L.INVALID_ARGUMENT,g+s+m)}function A0(s,e){return s.some(i=>i.isEqual(e))}var ja=class{constructor(e,i,o,a,l){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new Je(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new ju(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let i=this._document.data.field(om("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}},ju=class extends ja{data(){return super.data()}};function om(s,e){return typeof e=="string"?rm(s,e):e instanceof Qr?e._internalPath:e._delegate._internalPath}var $u=class{convertValue(e,i="none"){switch(Bi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return zt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 10:return this.convertObject(e.mapValue,i);default:throw ht()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){let o={};return Dn(e,(a,l)=>{o[a]=this.convertValue(l,i)}),o}convertGeoPoint(e){return new Xr(zt(e.latitude),zt(e.longitude))}convertArray(e,i){return(e.values||[]).map(o=>this.convertValue(o,i))}convertServerTimestamp(e,i){switch(i){case"previous":let o=Ju(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(Vr(e));default:return null}}convertTimestamp(e){let i=ii(e);return new pe(i.seconds,i.nanos)}convertDocumentKey(e,i){let o=Jt.fromString(e);Mt(Bg(o));let a=new Ta(o.get(1),o.get(3)),l=new it(o.popFirst(5));return a.isEqual(i)||Ws(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),l}};function C0(s,e,i){let o;return o=s?i&&(i.merge||i.mergeFields)?s.toFirestore(e,i):s.toFirestore(e):e,o}var Ku=class{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},$a=class extends ja{constructor(e,i,o,a,l,d){super(e,i,o,a,d),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let i=new Qu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){let o=this._document.data.field(om("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}},Qu=class extends $a{data(e={}){return super.data(e)}};function th(s){s=Wr(s,Je);let e=Wr(s.firestore,$r);return g0(Zg(e),s._key).then(i=>S0(e,s,i))}var Xu=class extends $u{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kr(e)}convertReference(e){let i=this.convertDocumentKey(e,this.firestore._databaseId);return new Je(this.firestore,null,i)}};function am(s,e,i){s=Wr(s,Je);let o=Wr(s.firestore,$r),a=C0(s.converter,e,i);return I0(o,[b0(x0(o),"setDoc",s._key,a,s.converter!==null,i).toMutation(s._key,ki.none())])}function I0(s,e){return function(o,a){let l=new Is;return o.asyncQueue.enqueueAndForget(async()=>i0(await p0(o),a,l)),l.promise}(Zg(s),e)}function S0(s,e,i){let o=i.docs.get(e._key),a=new Xu(s);return new $a(s,a,e._key,o,new Ku(i.hasPendingWrites,i.fromCache),e.converter)}(function(e,i=!0){(function(a){Rn=a})(up),rr(new zs("firestore",(o,{instanceIdentifier:a,options:l})=>{let d=o.getProvider("app").getImmediate(),g=new $r(new wc(o.getProvider("auth-internal")),new Tc(o.getProvider("app-check-internal")),function(y,x){if(!Object.prototype.hasOwnProperty.apply(y.options,["projectId"]))throw new J(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ta(y.options.projectId,x)}(d,a),d);return l=Object.assign({useFetchStreams:i},l),g._setSettings(l),g},"PUBLIC").setMultipleInstances(!0)),ti(L_,"4.3.2",e),ti(L_,"4.3.2","esm2017")})();var P0=El({apiKey:"AIzaSyCU9FUCErx0y3Gus3ehjq4oTPl4RI1nyNc",authDomain:"game-of-madness.firebaseapp.com",projectId:"game-of-madness",storageBucket:"game-of-madness.appspot.com",messagingSenderId:"281390843386",appId:"1:281390843386:web:1fcc596847ca557b509043"}),so=Yg(P0);var Kt=0;function ds(s=1){return Kt+=s,Kt}function R0(){Kt=0}function Qt(s,e){return s.tags.indexOf(e)>-1}function Dt(s,e){return Math.random()*(e-s)+s}function Ms(){ds(25),Mn(Xe)}async function Qe(){let s=parseInt(window.localStorage.getItem("highscore"));isNaN(s)&&(s=0),Kt>s&&window.localStorage.setItem("highscore",Kt.toString());let e=eo(so,"high","score"),i=await th(e);i.exists()&&Kt>i.data().value&&am(eo(so,"high","score"),{value:Kt}),Xe.goToScene("mainMenu"),R0()}function D0(s){return s.input.keyboard.isHeld(St.A)||s.input.keyboard.isHeld(St.ArrowLeft)}function k0(s){return s.input.keyboard.isHeld(St.D)||s.input.keyboard.isHeld(St.ArrowRight)}function M0(s){return s.input.keyboard.isHeld(St.Space)}var eh=class extends Rt{_speed=100;_jumpSpeed=100;_grounded=!1;_original;constructor(e){super(e),this.addComponent(new Ve("player")),this._original={pos:this.pos.clone(),vel:this.vel.clone()}}onInitialize(e){super.onInitialize(e),this.on("collisionstart",i=>{Qt(i.other,"ground")&&(this._grounded=!0)}),this.on("collisionend",i=>{Qt(i.other,"ground")&&(this._grounded=!1)})}update(e,i){super.update(e,i),this.vel=Z(0,this.vel.y),D0(e)&&this.vel.setTo(-this._speed,this.vel.y),k0(e)&&this.vel.setTo(this._speed,this.vel.y),M0(e)&&this._grounded&&this.vel.setTo(this.vel.x,-this._jumpSpeed),this.pos.x+this.width/2>$.width?this.pos=Z($.width-this.width/2,this.pos.y):this.pos.x-this.width/2<0&&(this.pos=Z(this.width/2,this.pos.y))}reset(){this.pos=this._original.pos,this.vel=this._original.vel}};var sh=class extends Rt{constructor(i,o,a){super({pos:Z(Dt(i.x.min,i.x.max),Dt(i.y.min,i.y.max)),width:Dt(i.width.min,i.width.max),height:Dt(i.height.min,i.height.max),color:i.color??(a?It.Magenta:It.Red),collisionType:Ot.Active});this._title=o;this._isPortal=a}onInitialize(i){super.onInitialize(i),this.on("collisionstart",o=>{if(!this._isPortal&&Qt(o.other,"player")){Qe();return}else this._isPortal&&Qt(o.other,"player")&&Ms();Qt(o.other,"ground")&&(this.kill(),ds(),this._title.forceUpdate())})}reset(){this.kill()}};var ts=class extends bi{constructor(){super({text:`Score: ${Kt}`,pos:Z($.width-75,50),font:new wi({family:"impact",size:12,unit:xi.Px})})}forceUpdate(){this.text=`Score: ${Kt}`}};function F0(s,e){return new sh({x:{min:0,max:$.width},y:{min:-25,max:-25},width:{min:25,max:50},height:{min:25,max:50}},s,e)}var ih=class extends Ye{_title;_ground;_player;_blocks;_active;_teleportTimout;onInitialize(e){super.onInitialize(e),this._title=new ts,this.add(this._title),this._ground=new rn({height:50}),this.add(this._ground),this._blocks=[]}_spawnBlocks(){this._active&&(setTimeout(()=>this._spawnBlocks(),Dt(100,900/Math.max(Kt/50,1))),this._blocks.push(F0(this._title,Math.random()<1/25)),this.add(this._blocks[this._blocks.length-1]))}onActivate(e){super.onActivate(e),je.acc=Z(0,300),this._title.forceUpdate(),this._active=!0,this._player=new eh({pos:Z($.width/2,$.height-50-75),width:25,height:50,color:It.Yellow,collisionType:Ot.Active}),this.add(this._player),this._spawnBlocks(),this._teleportTimout=setTimeout(()=>{Mn(Xe)},15e3)}onDeactivate(e){super.onDeactivate(e),clearTimeout(this._teleportTimout),this._active=!1,this._blocks.forEach(i=>{i.active&&i.kill()}),this._blocks=[],this._player.kill()}};var nh=class extends Rt{_speed=500;constructor(e){super(e),this.addComponent(new Ve("bullet"))}onInitialize(e){super.onInitialize(e),this.vel=Z(this._speed,0)}update(e,i){super.update(e,i),this.pos.x-this.width/2>$.width&&this.kill()}};function B0(s){return s.input.keyboard.isHeld(St.A)||s.input.keyboard.isHeld(St.ArrowLeft)}function L0(s){return s.input.keyboard.isHeld(St.D)||s.input.keyboard.isHeld(St.ArrowRight)}function N0(s){return s.input.keyboard.isHeld(St.W)||s.input.keyboard.isHeld(St.ArrowUp)}function V0(s){return s.input.keyboard.isHeld(St.S)||s.input.keyboard.isHeld(St.ArrowDown)}function O0(s){return s.input.keyboard.isHeld(St.F)||s.input.keyboard.isHeld(St.Space)}var rh=class extends Rt{_speed=250;_lastShoot=Date.now();_original;constructor(e,i){super(e),this.addComponent(new Ve("player")),this._original={pos:this.pos.clone(),vel:this.vel.clone()}}reset(){this.pos=this._original.pos.clone(),this.vel=this._original.vel.clone(),this._lastShoot=Date.now()}update(e,i){super.update(e,i),this.vel=Z(0,0),B0(e)&&this.vel.setTo(-this._speed,this.vel.y),L0(e)&&this.vel.setTo(this._speed,this.vel.y),N0(e)&&this.vel.setTo(this.vel.x,-this._speed),V0(e)&&this.vel.setTo(this.vel.x,this._speed),O0(e)&&this._lastShoot+500<Date.now()&&(this._lastShoot=Date.now(),this.scene.add(new nh({pos:this.pos.clone().add(Z(this.width/2+7.5,0)),width:15,height:15,color:It.Black,collisionType:Ot.Active}))),this.pos.x+this.width/2>$.width?this.pos=Z($.width-this.width/2,this.pos.y):this.pos.x-this.width/2<0&&(this.pos=Z(this.width/2,this.pos.y)),this.pos.y+this.height/2>$.height?this.pos=Z(this.pos.x,$.height-this.height/2):this.pos.y-this.height/2<0&&(this.pos=Z(this.pos.x,this.height/2))}};var oh=class extends Rt{constructor(i,o){super({pos:i.pos,color:i.color??It.Red,width:25,height:50});this.title=o}_speed=Dt(100,150);onInitialize(i){super.onInitialize(i),this.vel=Z(-this._speed,0),this.on("collisionstart",o=>{Qt(o.other,"bullet")&&(ds(),this.title.forceUpdate(),this.kill(),o.other.kill()),Qt(o.other,"player")&&Qe()})}update(i,o){super.update(i,o),this.pos.x+this.width/2<0&&Qe()}};var ah=class extends Rt{onInitialize(e){super.onInitialize(e),this.on("collisionstart",i=>{Qt(i.other,"player")&&Ms()})}};var hh=class extends Ye{_title;_player;_zombieCount;_zombies;_portal;_active=!1;onInitialize(e){super.onInitialize(e),je.acc=Z(0,0),this._title=new ts,this.add(this._title),this._zombieCount=0,this._zombies=[]}onActivate(e){super.onActivate(e),je.acc=Z(0,0),this._title.forceUpdate(),this._player=new rh({pos:Z($.width/2,$.height/2),width:25,height:50,color:It.Yellow,collisionType:Ot.Active},this),this.add(this._player),this._active=!0,this._spawnZombie()}onDeactivate(e){super.onDeactivate(e),this._active=!1,this._player.kill(),this._zombies.forEach(i=>{i.active&&i.kill()}),this._zombies=[],this._zombieCount=0,this._portal!=null&&this._portal.kill(),this._portal=void 0}_spawnZombie(){if(this._active)if(setTimeout(()=>this._spawnZombie(),Dt(1e3,1e3+3e3/(Kt+1))),this._zombieCount++,this._zombieCount!=10){let e=new oh({pos:Z($.width+12.5,Dt(25,$.height-25)),color:It.Red},this._title);this._zombies.push(e),this.add(e)}else{let e=new ah({pos:Z(Dt(25,$.width-25),Dt(25,$.height-25)),width:50,height:50,color:It.Magenta,collisionType:Ot.Passive});this._portal=e,this.add(e)}}};function U0(s){return s.input.keyboard.isHeld(St.Space)}var lh=class extends Rt{_jumpSpeed=250;_grounded=!1;_original;constructor(e){super(e),this.addComponent(new Ve("player")),this._original={pos:this.pos.clone(),vel:this.vel.clone()}}onInitialize(e){super.onInitialize(e),this.on("collisionstart",i=>{Qt(i.other,"ground")&&(this._grounded=!0)}),this.on("collisionend",i=>{Qt(i.other,"ground")&&(this._grounded=!1)})}update(e,i){super.update(e,i),U0(e)&&this._grounded&&this.vel.setTo(this.vel.x,-this._jumpSpeed)}reset(){this.pos=this._original.pos,this.vel=this._original.vel}};function z0(s){switch(s){case 0:return 100;case 1:return 150;case 2:return 200}}var ch=class extends Rt{constructor(i,o,a){let l=Z(Dt(25,50),Dt(25,50));super({pos:Z($.width+l.x/2,$.height-($.height/3+l.y/2)),width:l.x,height:l.y,color:a?It.Magenta:It.Red,collisionType:Ot.Passive});this._title=o;this._isNextLevel=a;this._speed=z0(i)}_speed;onInitialize(i){super.onInitialize(i),this.vel=Z(-this._speed,0),this.on("collisionstart",o=>{Qt(o.other,"player")&&(this._isNextLevel?Ms():Qe())})}update(i,o){super.update(i,o),this.pos.x+this.width/2<0&&(this.kill(),ds(),this._title.forceUpdate())}};function G0(s){switch(s){case 0:return 1;case 1:return 1.375;case 2:return 1.75}}function H0(){return Kt<=7?0:Kt<=20?1:2}var uh=class extends Ye{_ground;_player;_title;_obstacleCount;_obstacles;_active=!1;onInitialize(e){super.onInitialize(e),this._obstacleCount=0,this._obstacles=[],this._title=new ts,this.add(this._title),this._ground=new rn({height:$.height/3}),this.add(this._ground)}onActivate(e){super.onActivate(e),je.acc=Z(0,300),this._player=new lh({pos:Z($.width/2,$.height-($.height/3+25)),width:25,height:50,color:It.Yellow,collisionType:Ot.Active}),this.add(this._player),this._title.forceUpdate(),this._active=!0,this._spawnObstacle()}onDeactivate(e){super.onDeactivate(e),this._obstacles.forEach(i=>{i.active&&i.kill()}),this._obstacles=[],this._obstacleCount=0,this._player.kill(),this._active=!1}_spawnObstacle(){if(!this._active)return;let e=H0();setTimeout(()=>this._spawnObstacle(),500+Dt(1500,5e3)/G0(e)),this._obstacleCount++,this._obstacles.push(new ch(e,this._title,this._obstacleCount%5==0)),this.add(this._obstacles[this._obstacles.length-1])}};function W0(s){return s.input.keyboard.isHeld(St.W)||s.input.keyboard.isHeld(St.ArrowUp)}function q0(s){return s.input.keyboard.isHeld(St.S)||s.input.keyboard.isHeld(St.ArrowDown)}var dh=class extends Rt{_speed=250;_original;constructor(e,i){super(e),this.addComponent(new Ve("player")),this._original={pos:this.pos.clone(),vel:this.vel.clone()}}reset(){this.pos=this._original.pos.clone(),this.vel=this._original.vel.clone()}update(e,i){super.update(e,i),this.vel=Z(0,0),W0(e)&&this.vel.setTo(this.vel.x,-this._speed),q0(e)&&this.vel.setTo(this.vel.x,this._speed),this.pos.y+this.height/2>$.height?this.pos=Z(this.pos.x,$.height-this.height/2):this.pos.y+this.height/2<0&&Ms()}};var Fn=class extends Rt{constructor(i,o,a,l,d=!0){super(i);this._spawnOnLeft=o;this._player=a;this._title=l;this._onlyBelowPlayer=d}_speed=300;onInitialize(i){super.onInitialize(i),this._spawnOnLeft?this.vel=Z(this._speed,0):this.vel=Z(-this._speed,0),this.on("collisionstart",o=>{Qt(o.other,"player")&&Qe()})}update(i,o){super.update(i,o);let a=!1;(this.pos.x-this.width>$.width||this.pos.x+this.width<0)&&(a=!0),(this.pos.y-this.height>$.height||this.pos.y+this.height<0)&&(a=!0),a&&(this.kill(),(!this._onlyBelowPlayer||this.pos.y>this._player.pos.y&&this._player.pos.y>0)&&(ds(),this._title.forceUpdate()))}};function j0(s,e,i){return Math.max(Math.min(s,i),e)}var fh=class extends Ye{_active;_title;_player;_cars;onActivate(e){super.onActivate(e),je.acc=Z(0,0),this._player=new dh({pos:Z($.width/2,$.height-35),width:25,height:50,color:It.Yellow,collisionType:Ot.Active},this),this.add(this._player),this._title=new ts,this.add(this._title),this._active=!0,this._cars=[],this._spawnCar()}onDeactivate(e){super.onDeactivate(e),this._title.kill(),this._player.kill(),this._active=!1,this._cars.forEach(i=>{i.active&&i.kill()})}_spawnCar(){if(!this._active)return;setTimeout(()=>this._spawnCar(),j0(500-Kt*.325,175,500));let e=Math.random()<.5,i=new Fn({pos:Z(e?-5:$.width+5,Dt(5,$.height-70)),width:10,height:10,color:It.Red,collisionType:Ot.Passive},e,this._player,this._title);this._cars.push(i),this.add(i)}};function $0(s){return s.input.keyboard.isHeld(St.Space)}var ph=class extends Rt{_jumpSpeed=300;_lastJump=Date.now();constructor(e){super({pos:e.pos,width:25,height:25,color:It.Yellow,collisionType:Ot.Active}),this.addComponent(new Ve("player"))}update(e,i){if(super.update(e,i),$0(e)){if(this._lastJump+250>=Date.now())return;this._lastJump=Date.now(),this.vel.setTo(this.vel.x,-this._jumpSpeed)}this.pos.y+this.height/2<0?Qe():this.pos.y-this.height/2>$.height&&Ms()}};var _h=class extends Rt{_endTime;constructor(e,i){super(e),this._endTime=Date.now()+i*1e3}onInitialize(e){super.onInitialize(e),this.on("collisionstart",i=>{Qt(i.other,"player")&&Qe()})}update(e,i){super.update(e,i),Date.now()>this._endTime&&this.kill()}};function K0(s,e,i){return Math.max(Math.min(s,i),e)}var gh=class extends Ye{_player;_laser;_title;_meteors;_active=!1;onActivate(e){super.onActivate(e),je.acc=Z(0,450),this._player=new ph({pos:Z($.width/2,$.height/3)}),this.add(this._player),this._laser=new _h({pos:Z($.width/2,Dt($.height/2,$.height/4*3)),width:Dt($.width*.25,$.width*.9),height:10,color:It.Red},Dt(1,6)),this.add(this._laser),this._title=new ts,this.add(this._title),this._active=!0,this._meteors=[],this._spawnMeteors()}onDeactivate(e){super.onDeactivate(e),this._player.kill(),this._laser.active&&this._laser.kill(),this._meteors.forEach(i=>{i.active&&i.kill()}),this._title.kill(),this._active=!1}_spawnMeteors(){if(!this._active)return;setTimeout(()=>this._spawnMeteors(),K0(600-Kt*.3,300,600));let e=Math.random()<.5,i=new Fn({pos:Z(e?-5:$.width+5,Dt(5,$.height-70)),width:10,height:10,color:It.Red,collisionType:Ot.Passive},e,this._player,this._title,!1);this._meteors.push(i),this.add(i)}};var dd={fallingBlocks:new ih,zombieShooter:new hh,dinoRunner:new uh,crossTheRoad:new fh,jumpTheBall:new gh},hm="";function lm(s){for(let e in dd)s.add(e,dd[e])}function Q0(s,e){s.goToScene(e),hm=e}function Mn(s){let e=Object.keys(dd),i=e[Math.floor(Math.random()*e.length)];for(;i==hm;)i=e[Math.floor(Math.random()*e.length)];Q0(s,i)}function X0(){ds(10)}var mh=class extends Ye{_mainLabel;_startLabel;_highscore;_worldHighscore;_timebonusInterval;async onActivate(e){super.onActivate(e),this._mainLabel=new bi({text:"Multigame of Madness: Improved",pos:Z($.width/2,$.height/2),font:new wi({family:"impact",size:24,textAlign:tr.Center,unit:xi.Px})}),this.add(this._mainLabel),this._startLabel=new bi({text:"Press space to start",pos:Z($.width/2,$.height/3*2),font:new wi({size:17,textAlign:tr.Center,unit:xi.Px})}),this.add(this._startLabel),this._highscore=new bi({text:"Highscore: "+(window.localStorage.getItem("highscore")??0),pos:Z($.width-100,100),font:new wi({size:17,textAlign:tr.Center,unit:xi.Px})}),this.add(this._highscore),this._timebonusInterval!=null&&clearInterval(this._timebonusInterval);let i=eo(so,"high","score"),o=await th(i);o.exists()&&(this._worldHighscore=new bi({text:"World highscore: "+o.data().value,pos:Z(100,100),font:new wi({size:17,textAlign:tr.Center,unit:xi.Px})}),this.add(this._worldHighscore))}update(e,i){super.update(e,i),e.input.keyboard.isHeld(St.Space)&&Mn(Xe)}onDeactivate(e){super.onDeactivate(e),this._mainLabel.kill(),this._startLabel.kill(),this._highscore.kill(),this._worldHighscore&&this._worldHighscore.active&&this._worldHighscore.kill(),this._timebonusInterval=window.setInterval(X0,3e4)}};je.useArcadePhysics();var Xe=new qf({width:$.width,height:$.height});Xe.add("mainMenu",new mh);lm(Xe);Xe.start().then(()=>{Xe.goToScene("mainMenu")});var fd=!0;window.addEventListener("load",()=>{document.getElementById("pause-btn").addEventListener("mousedown",()=>{fd?Xe.stop():Xe.start(),fd=!fd})});})();
/*! Bundled license information:

excalibur/build/esm/excalibur.js:
  (*!
   * excalibur - 0.28.0 - 2023-8-10
   * https://github.com/excaliburjs/Excalibur
   * Copyright (c) 2023 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
   * Licensed BSD-2-Clause
   * @preserve
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/component/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/logger/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm2017.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm2017.js:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
